{"meta":{"title":"yanliang's blog","subtitle":"","description":"","author":"yanliang","url":"https://gyl-coder.top","root":"/"},"pages":[{"title":"404 Not Found","date":"2020-12-27T04:47:15.974Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"404.html","permalink":"https://gyl-coder.top/404.html","excerpt":"","text":"404 å¾ˆæŠ±æ­‰ï¼Œæ‚¨è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨ å¯èƒ½æ˜¯è¾“å…¥åœ°å€æœ‰è¯¯æˆ–è¯¥åœ°å€å·²è¢«åˆ é™¤"},{"title":"å…³äº","date":"2020-12-27T04:47:15.978Z","updated":"2020-12-27T04:47:15.978Z","comments":true,"path":"about/index.html","permalink":"https://gyl-coder.top/about/index.html","excerpt":"","text":"Yanliang ğŸ‚ ã—ã‚ƒã¡ã ğŸ€ ä¸ªäººç®€ä»‹ ç¤¾ç•œä¸€æšï¼Œåæ ‡ SZğŸŒï¼Œæ°¸è¿œçƒ­çˆ±ï¼Œæ°¸è¿œå¹´è½»ç›¸çŸ¥ğŸ¤ çˆ±å¥½æ—…è¡Œ/éŸ³ä¹/ç”µå½±/é˜…è¯»âœ¨ å¯¹ä¸€åˆ‡æ–°é²œçš„äº‹ç‰©å……æ»¡å¥½å¥‡ğŸ§ ç›®æ ‡æ˜¯è¿‡ç®€å•çš„ç”Ÿæ´»ğŸ’ª å¯¹è‡ªå·±çš„è¦æ±‚æ˜¯æ¯å¤©éƒ½è¦æ¯”æ˜¨å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ğŸ‘Š ğŸ­ å®¢è§‚è¯„ä»· ğŸŒŒ åšå®¢ç®€ä»‹ å…¨ç«™ HTTPS Hexo æ¡†æ¶ + Volatis ä¸»é¢˜ åšå®¢ä¸­çš„éƒ¨åˆ†å›¾ç‰‡æºäºç½‘ç»œï¼Œä¾µåˆ  æœ¬åšå®¢æ–‡ç« é‡‡ç”¨ CC BY-NC-SA 4.0 åè®® åè®®ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ ğŸ”‘ æŠ€èƒ½å­¦ä¹  Java Mysql ç®—æ³• Spring Boot Kfaka â€¦. ğŸ“† å»ºç«™å†ç¨‹ 2020-10 ä¼˜åŒ– valine è¯„è®ºç³»ç»Ÿ ä¼˜åŒ–èƒŒæ™¯ ä¾§è¾¹æ æ·»åŠ ä¸€è¨€ &amp; æœ€æ–°è¯„è®º 2020-09 æ·»åŠ å½©è‰²æ ‡ç­¾ å‡çº§åšå®¢ä¸»é¢˜è‡³4.0.0 ä¾§è¾¹æ æ·»åŠ ä¸€è¨€ &amp; æœ€æ–°è¯„è®º 2020-08 github&amp;codingåŒçº¿éƒ¨ç½² æ·»åŠ ç«™ç‚¹ç›‘æ§é¡µé¢ æ·»åŠ å›´ä½å°å–µæ¸¸æˆ&amp;è‡ªå®šä¹‰é¡µè„š&amp;RSS 2020-07 â€¦â€¦ 2019-09 å»ºç«™ ğŸ‘¨â€âœˆï¸ ç‰ˆæƒå£°æ˜ åšå®¢å†…çš„æ‰€æœ‰åŸåˆ›å†…å®¹ï¼ˆåŒ…æ‹¬ä½†ä¸é™äºæ–‡ç« ã€å›¾åƒç­‰ï¼‰é™¤ç‰¹åˆ«å£°æ˜å¤–å‡é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®ï¼Œä»»ä½•äººéƒ½å¯ä»¥è‡ªç”±ä¼ æ’­ï¼Œä½†ä¸å¾—ç”¨äºå•†ç”¨ä¸”å¿…é¡»ç½²åå¹¶ä»¥ç›¸åŒæ–¹å¼åˆ†äº«ã€‚ æœ¬ç«™éƒ¨åˆ†å†…å®¹è½¬è½½äºç½‘ç»œï¼Œæœ‰å‡ºå¤„çš„å·²åœ¨æ–‡ä¸­ç½²åä½œè€…å¹¶é™„åŠ åŸæ–‡é“¾æ¥ï¼Œå‡ºå¤„å·²ä¸å¯å¯»çš„çš†å·²æ ‡æ³¨æ¥æºäºç½‘ç»œï¼Œè‹¥æ‚¨è®¤ä¸ºæœ¬åšå®¢æœ‰éƒ¨åˆ†å†…å®¹ä¾µçŠ¯äº†æ‚¨çš„ç‰ˆæƒï¼Œè¯·ç”µé‚®å‘ŠçŸ¥ï¼Œæˆ‘å°†è®¤çœŸå¤„ç†ã€‚ èµ .single-reward { position: relative; width: 100%; margin: 30px auto; text-align: center; z-index: 999 } .single-reward .reward-open { position: relative; line-height: 22px; width: 35px; height: 35px; padding: 7px; color: #fff; text-align: center; display: inline-block; border-radius: 100%; background: #d34836; } .single-reward .reward-main { position: absolute; top: 45px; left: -156px; margin: 0; padding: 4px 0 0; width: 355px; background: 0 0; display: none; animation: main .4s } .reward-open:hover .reward-main { display: block } .single-reward .reward-row { margin: 0 auto; padding: 20px 15px 10px; background: #f5f5f5; display: inline-block; border-radius: 4px; } .single-reward .reward-row:before { content: \"\"; width: 0; height: 0; border-left: 13px solid transparent; border-right: 13px solid transparent; border-bottom: 13px solid #f5f5f5; position: absolute; top: -9px; left: -9px; right: 0; margin: 0 auto } .single-reward .reward-row li { list-style-type: none; padding: 0 12px; display: inline-block } .reward-row li img { width: 130px; max-width: 130px; border-radius: 3px; position: relative } .reward-row li::after { margin-top: 10px; display: block; font-size: 13px; color: #121212; } .alipay-code:after { content: \"æ”¯ä»˜å®\" } .wechat-code:after { content: \"å¾®ä¿¡\" } .md .single-reward ul li:before{ content: none }"},{"title":"æ ‘æ´","date":"2020-11-21T13:51:21.000Z","updated":"2020-12-27T04:47:15.978Z","comments":true,"path":"bb/index.html","permalink":"https://gyl-coder.top/bb/index.html","excerpt":"","text":"ğŸ‘‰ğŸ¼é€šè¿‡ğŸ“±æ‰‹æœºå¾®ä¿¡å‘å‡ºï¼Œä¸»è¦è®°å½•ç¢ç‰‡åŒ–æ€è€ƒå’ŒåŠ¨æ€ã€‚ğŸ“‘"},{"title":"å›´ä½å°çŒ«","date":"2020-12-27T04:47:15.978Z","updated":"2020-12-27T04:47:15.978Z","comments":true,"path":"catchTheCat/index.html","permalink":"https://gyl-coder.top/catchTheCat/index.html","excerpt":"","text":"æ¸¸æˆè§„åˆ™ï¼š:bell: ç‚¹å‡»å°åœ†ç‚¹ï¼Œå›´ä½å°çŒ«ã€‚:bell: ä½ ç‚¹å‡»ä¸€æ¬¡ï¼Œå°çŒ«èµ°ä¸€æ¬¡ã€‚:bell: ç›´åˆ°ä½ æŠŠå°çŒ«å›´ä½ï¼ˆèµ¢ï¼‰ï¼Œæˆ–è€…å°çŒ«èµ°åˆ°è¾¹ç•Œå¹¶é€ƒè·‘ï¼ˆè¾“ï¼‰ã€‚"},{"title":"æ‰€æœ‰åˆ†ç±»","date":"2020-12-27T04:47:15.978Z","updated":"2020-12-27T04:47:15.978Z","comments":true,"path":"categories/index.html","permalink":"https://gyl-coder.top/categories/index.html","excerpt":"","text":""},{"title":"ç•™è¨€æ¿","date":"2020-12-27T04:47:15.978Z","updated":"2020-12-27T04:47:15.978Z","comments":true,"path":"comment/index.html","permalink":"https://gyl-coder.top/comment/index.html","excerpt":"","text":"æ¬¢è¿å‰æ¥çŒæ°´ã€‚ã€‚ã€‚"},{"title":"","date":"2020-12-27T04:47:15.978Z","updated":"2020-12-27T04:47:15.978Z","comments":true,"path":"friends/index.html","permalink":"https://gyl-coder.top/friends/index.html","excerpt":"","text":"f r i e n d xaoxuuç®€çº¦é£æ ¼ æœå­å°é…± LFhacksä¸ªäººåŸåˆ› å°åº·åšå®¢ä¸€ä¸ªæ”¶è—å›å¿†ä¸åˆ†äº«æŠ€æœ¯çš„åœ°æ–¹ï¼ é»‘çŸ³åšå®¢äººç”Ÿåœ¨å‹¤ï¼Œä¸ç´¢ä½•è·ã€‚ æ¬¢è¿å’Œæˆ‘äº¤æ¢å‹é“¾~ å„ä½å¤§ä½¬æƒ³äº¤æ¢å‹é“¾çš„è¯å¯ä»¥åœ¨ä¸‹æ–¹ç•™è¨€ï¼Œå¿…é¡»è¦æä¾›åç§°ã€å¤´åƒå’Œé“¾æ¥å“¦~è¯·å…ˆå°†æœ¬ç«™æ·»åŠ åˆ°ä½ æ»´å‹é“¾ä¸­å–”ï¼Œè°¢è°¢~ å‹é“¾æäº¤æ¨¡æ¿ï¼š åç§°ï¼šã€è¯·å¡«å…¥åç§°ï¼Œ9å­—ä»¥å†…ã€‘ å¤´åƒï¼šã€è¯·è¾“å…¥åœ°å€ï¼Œæ”¯æŒpngã€jpgã€gifç­‰å¸¸è§æ ¼å¼ã€‘ åœ°å€ï¼šã€è¯·å¡«å…¥åœ°å€ï¼Œä¸æ”¯æŒurl.cnç­‰çŸ­é“¾å½¢å¼ï¼Œå¿…é¡»ä»¥https://åè®®æ ‡å‡†å¼€å¤´ã€‘ ç½‘ç«™ç¼©ç•¥å›¾ï¼šã€è¯·å¡«å…¥åœ°å€ï¼Œä¸æ”¯æŒurl.cnç­‰çŸ­é“¾å½¢å¼ï¼Œå¿…é¡»ä»¥https://åè®®æ ‡å‡†å¼€å¤´ã€‘ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ åç§°ï¼šyanliang å¤´åƒï¼šhttps://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp åœ°å€ï¼šhttps://gyl-coder.top ç½‘ç«™ç¼©ç•¥å›¾ï¼šhttps://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/friends/yanliang.webp"},{"title":"æˆ‘çš„ç›¸å†Œ","date":"2020-12-27T04:47:15.978Z","updated":"2020-12-27T04:47:15.978Z","comments":true,"path":"photos/index.html","permalink":"https://gyl-coder.top/photos/index.html","excerpt":"","text":"ğŸƒæˆ‘çš„ç›¸å†Œ ç§ã®ã‚¢ãƒ«ãƒãƒ  &nbsp;ç”Ÿæ´»&nbsp;æ—…è¡Œ&nbsp;äºŒæ¬¡å…ƒ&nbsp;å…³äºå…‰å½±å½¼æ–¹ä¸ºè°ï¼Œæ— æˆ‘æœ‰é—®æ¯ä¸ªäººï¼Œéƒ½è¦åœ¨è‡ªå·±çš„ä¸–ç•Œä¸­ç”Ÿæ´»ã€‚æˆ–è®¸æ²¡æœ‰è½°è½°çƒˆçƒˆçš„ä¼ å¥‡æ•…äº‹ï¼Œä½†å°±æ˜¯é‚£ä»½å¹³æ·¡ï¼Œæ‰å¾—ä»¥è®©æˆ‘ä»¬ç–²æƒ«çš„å¿ƒå¾—åˆ°ä¼‘æ¯ã€‚åœ¨è¿™å½“ä¸­ï¼Œä¸ä¹ç”Ÿæ´»ä¸­çš„ç¾ã€‚ ä¹æœˆéœ²æ¹¿ï¼Œå¾…å›ä¹‹å‰æœ‰äººè¯´è¦ä¹ˆè¯»ä¹¦ï¼Œè¦ä¹ˆæ—…è¡Œï¼Œèº«ä½“å’Œçµé­‚ï¼Œæ€»æœ‰ä¸€ä¸ªè¦åœ¨è·¯ä¸Šï¼›æ›¾æ¢¦æƒ³ä»—å‰‘èµ°å¤©æ¶¯ï¼Œçœ‹ä¸€çœ‹ä¸–é—´çš„ç¹åã€‚è¿™æ˜¯ä¸€ä¸ªå‡ºèµ°çš„è¿‡ç¨‹ï¼Œåœ¨çŸ­æš‚çš„æ—¶é—´é‡Œä¸è‡ªå·±å¯¹è¯ï¼Œåœ¨æ—¶å…‰çš„ç¼éš™ä¸­é‡è§çœŸæ­£çš„è‡ªå·±ï¼Œå˜å¾—æ·¡ç„¶ä¸è±è¾¾ï¼Œè‡³äºé£æ™¯è¿™åªæ˜¯é™„èµ å“ã€‚éªšå¹´ï¼Œæ„¿ä½ èµ°å‡ºåŠç”Ÿï¼Œå½’æ¥ä»æ˜¯å°‘å¹´ã€‚ä¸€è¾ˆå­æ˜¯åœºä¿®è¡Œã€‚çŸ­çš„æ˜¯æ—…é€”ï¼Œé•¿çš„æ˜¯äººç”Ÿã€‚ Interestingæ”¶é›†ä¸€äº›æœ‰æ„æ€çš„å›¾ç‰‡ æ‘„å½±æ˜¯ä»€ä¹ˆ?æ‘„å½±æ˜¯å…‰ä¸å½±çš„ç»“åˆï¼Œå®ƒå°†å…‰çº¿æ°¸è¿œåœç•™åœ¨äº†ç‰©ä½“ä¸Šï¼Œå®ƒå°†ç¬é—´å˜ä¸ºæ°¸æ’ã€‚æˆ‘ä¸æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ‘„å½±è€…ï¼Œçº¯ç²¹åªæ˜¯ä¸ªå…´è¶£çˆ±å¥½ï¼Œç”šè‡³è°ˆä¸ä¸Šæ‘„å½±ç§°ä¹‹ä¸ºæ‹ç…§æ›´åˆé€‚ï¼Œå› ä¸ºå¤§å¤šæ•°æ—¶å€™æˆ‘éƒ½æ˜¯ç”¨æ‰‹æœºæ‹çš„ç…§ç‰‡ï¼Œå¼„è¿™ä¸ªç›¸å†Œäºæ­¤å¤„ä¸»è¦å±•ç¤ºä¸€äº›æˆ‘è‡ªå·±æ‹çš„è¿˜æœ‰çœ‹åˆ°çš„æœ‰æ„æ€çš„ä¸€äº›å›¾ç‰‡ã€‚"},{"title":"æ ‘æ´","date":"2020-12-27T04:47:15.986Z","updated":"2020-12-27T04:47:15.986Z","comments":false,"path":"shuoshuo/index.html","permalink":"https://gyl-coder.top/shuoshuo/index.html","excerpt":"","text":""},{"title":"æ‰€æœ‰æ ‡ç­¾","date":"2020-12-27T04:47:15.986Z","updated":"2020-12-27T04:47:15.986Z","comments":true,"path":"tags/index.html","permalink":"https://gyl-coder.top/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"æ¥å£ vs æŠ½è±¡ç±»çš„åŒºåˆ«ï¼Ÿ","slug":"java/abstract_interface","date":"2020-09-27T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"java/abstract_interface/","link":"","permalink":"https://gyl-coder.top/java/abstract_interface/","excerpt":"åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼ŒæŠ½è±¡ç±»å’Œæ¥å£æ˜¯ä¸¤ä¸ªç»å¸¸è¢«ç”¨åˆ°çš„è¯­æ³•æ¦‚å¿µï¼Œæ˜¯é¢å‘å¯¹è±¡å››å¤§ç‰¹æ€§ï¼Œä»¥åŠå¾ˆå¤šè®¾è®¡æ¨¡å¼ã€è®¾è®¡æ€æƒ³ã€è®¾è®¡åŸåˆ™ç¼–ç¨‹å®ç°çš„åŸºç¡€ã€‚ æ¯”å¦‚ï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¥å£æ¥å®ç°é¢å‘å¯¹è±¡çš„æŠ½è±¡ç‰¹æ€§ã€å¤šæ€ç‰¹æ€§å’ŒåŸºäºæ¥å£è€Œéå®ç°çš„è®¾è®¡åŸåˆ™ï¼Œä½¿ç”¨æŠ½è±¡ç±»æ¥å®ç°é¢å‘å¯¹è±¡çš„ç»§æ‰¿ç‰¹æ€§å’Œæ¨¡æ¿è®¾è®¡æ¨¡å¼ç­‰ã€‚","text":"åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼ŒæŠ½è±¡ç±»å’Œæ¥å£æ˜¯ä¸¤ä¸ªç»å¸¸è¢«ç”¨åˆ°çš„è¯­æ³•æ¦‚å¿µï¼Œæ˜¯é¢å‘å¯¹è±¡å››å¤§ç‰¹æ€§ï¼Œä»¥åŠå¾ˆå¤šè®¾è®¡æ¨¡å¼ã€è®¾è®¡æ€æƒ³ã€è®¾è®¡åŸåˆ™ç¼–ç¨‹å®ç°çš„åŸºç¡€ã€‚ æ¯”å¦‚ï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¥å£æ¥å®ç°é¢å‘å¯¹è±¡çš„æŠ½è±¡ç‰¹æ€§ã€å¤šæ€ç‰¹æ€§å’ŒåŸºäºæ¥å£è€Œéå®ç°çš„è®¾è®¡åŸåˆ™ï¼Œä½¿ç”¨æŠ½è±¡ç±»æ¥å®ç°é¢å‘å¯¹è±¡çš„ç»§æ‰¿ç‰¹æ€§å’Œæ¨¡æ¿è®¾è®¡æ¨¡å¼ç­‰ã€‚ ä»€ä¹ˆæ˜¯æŠ½è±¡ç±»å’Œæ¥å£ï¼Ÿ åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿä¸åŒçš„ç¼–ç¨‹è¯­è¨€å¯¹æ¥å£å’ŒæŠ½è±¡ç±»çš„å®šä¹‰æ–¹å¼å¯èƒ½æœ‰äº›å·®åˆ«ï¼Œä½†æ˜¯å·®åˆ«å¹¶ä¸å¤§ã€‚æœ¬æ–‡ä½¿ç”¨ Java è¯­è¨€ã€‚ æŠ½è±¡ç±»ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥çœ‹ä¸€ä¸ªå…¸å‹çš„æŠ½è±¡ç±»çš„ä½¿ç”¨åœºæ™¯ã€‚ Logger æ˜¯ä¸€ä¸ªè®°å½•æ—¥å¿—çš„æŠ½è±¡ç±»ï¼ŒFileLogger å’Œ MessageQueueLogger ç»§æ‰¿Loggerï¼Œåˆ†åˆ«å®ç°ä¸¤ç§ä¸åŒçš„æ—¥å¿—è®°å½•æ–¹å¼ï¼š è®°å½•æ—¥å¿—åˆ°æ–‡ä»¶ä¸­ è®°å½•æ—¥å¿—åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ FileLogger å’Œ MessageQueuLogger ä¸¤ä¸ªå­ç±»å¤ç”¨äº†çˆ¶ç±» Logger ä¸­çš„nameã€enabled ä»¥åŠ minPermittedLevel å±æ€§å’Œ log æ–¹æ³•ï¼Œä½†æ˜¯å› ä¸ºä¸¤ä¸ªå­ç±»å†™æ—¥å¿—çš„æ–¹å¼ä¸åŒï¼Œä»–ä»¬åˆå„è‡ªé‡å†™äº†çˆ¶ç±»ä¸­çš„doLogæ–¹æ³•ã€‚ çˆ¶ç±» import java.util.logging.Level; /** * æŠ½è±¡çˆ¶ç±» * @author yanliang * @date 9/27/2020 5:59 PM */ public abstract class Logger &#123; private String name; private boolean enabled; private Level minPermittedLevel; public Logger(String name, boolean enabled, Level minPermittedLevel) &#123; this.name = name; this.enabled = enabled; this.minPermittedLevel = minPermittedLevel; &#125; public void log(Level level, String message) &#123; boolean loggable = enabled &amp;&amp; (minPermittedLevel.intValue() &lt;= level.intValue()); if(!loggable) return; doLog(level, message); &#125; protected abstract void doLog(Level level, String message); &#125; FileLogger import java.io.FileWriter; import java.io.IOException; import java.io.Writer; import java.util.logging.Level; /** * æŠ½è±¡ç±»Loggerçš„å­ç±»ï¼šè¾“å‡ºæ—¥å¿—åˆ°æ–‡ä»¶ä¸­ * @author yanliang * @date 9/28/2020 4:44 PM */ public class FileLogger extends Logger &#123; private Writer fileWriter; public FileLogger(String name, boolean enabled, Level minPermittedLevel, String filePath) throws IOException &#123; super(name, enabled, minPermittedLevel); this.fileWriter = new FileWriter(filePath); &#125; @Override protected void doLog(Level level, String message) &#123; // æ ¼å¼åŒ–level å’Œ messageï¼Œè¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ fileWriter.write(...); &#125; &#125; MessageQueuLogger import java.util.logging.Level; /** * æŠ½è±¡ç±»Loggerçš„å­ç±»ï¼šè¾“å‡ºæ—¥å¿—åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ * @author yanliang * @date 9/28/2020 6:39 PM */ public class MessageQueueLogger extends Logger &#123; private MessageQueueClient messageQueueClient; public MessageQueueLogger(String name, boolean enabled, Level minPermittedLevel, MessageQueueClient messageQueueClient) &#123; super(name, enabled, minPermittedLevel); this.messageQueueClient = messageQueueClient; &#125; @Override protected void doLog(Level level, String message) &#123; // æ ¼å¼åŒ–level å’Œ messageï¼Œè¾“å‡ºåˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ messageQueueClient.send(...) &#125; &#125; é€šè¿‡ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹æŠ½è±¡ç±»æœ‰å“ªäº›ç‰¹æ€§ã€‚ æŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œåªèƒ½è¢«ç»§æ‰¿ã€‚ï¼ˆnew ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¼šæŠ¥ç¼–è¯‘é”™è¯¯ï¼‰ æŠ½è±¡ç±»å¯ä»¥åŒ…å«å±æ€§å’Œæ–¹æ³•ã€‚æ–¹æ³•æ—¢å¯ä»¥åŒ…å«å®ç°ï¼Œä¹Ÿå¯ä»¥ä¸åŒ…å«å®ç°ã€‚ä¸åŒ…å«å®ç°çš„æ–¹æ³•å«åšæŠ½è±¡æ–¹æ³• å­ç±»ç»§æ‰¿æŠ½è±¡ç±»ï¼Œå¿…é¡»å®ç°æŠ½è±¡ç±»ä¸­çš„æ‰€æœ‰æŠ½è±¡æ–¹æ³•ã€‚ æ¥å£åŒæ ·çš„ï¼Œä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥çœ‹ä¸‹æ¥å£çš„ä½¿ç”¨åœºæ™¯ã€‚ /** * è¿‡æ»¤å™¨æ¥å£ * @author yanliang * @date 9/28/2020 6:46 PM */ public interface Filter &#123; void doFilter(RpcRequest req) throws RpcException; &#125; /** * æ¥å£å®ç°ç±»ï¼šé‰´æƒè¿‡æ»¤å™¨ * @author yanliang * @date 9/28/2020 6:48 PM */ public class AuthencationFilter implements Filter &#123; @Override public void doFilter(RpcRequest req) throws RpcException &#123; // é‰´æƒé€»è¾‘ &#125; &#125; /** * æ¥å£å®ç°ç±»ï¼šé™æµè¿‡æ»¤å™¨ * @author yanliang * @date 9/28/2020 6:48 PM */ public class RateLimitFilter implements Filter&#123; @Override public void doFilter(RpcRequest req) throws RpcException &#123; // é™æµé€»è¾‘ &#125; &#125; /** * è¿‡æ»¤å™¨ä½¿ç”¨demo * @author yanliang * @date 9/28/2020 6:48 PM */ public class Application &#123; // è¿‡æ»¤å™¨åˆ—è¡¨ private List&lt;Filter&gt; filters = new ArrayList&lt;&gt;(); filters.add(new AuthencationFilter()); filters.add(new RateLimitFilter()); public void handleRpcRequest(RpcRequest req) &#123; try &#123; for (Filter filter : filters) &#123; filter.doFilter(req); &#125; &#125; catch (RpcException e) &#123; // å¤„ç†è¿‡æ»¤ç»“æœ &#125; // ... &#125; &#125; ä¸Šé¢çš„æ¡ˆä¾‹æ˜¯ä¸€ä¸ªå…¸å‹çš„æ¥å£ä½¿ç”¨åœºæ™¯ã€‚é€šè¿‡Javaä¸­çš„ interface å…³é”®å­—å®šä¹‰äº†ä¸€ä¸ªFilter æ¥å£ï¼ŒAuthencationFilter å’Œ RetaLimitFilter æ˜¯æ¥å£çš„ä¸¤ä¸ªå®ç°ç±»ï¼Œåˆ†åˆ«å®ç°äº†å¯¹Rpcè¯·æ±‚çš„é‰´æƒå’Œé™æµçš„è¿‡æ»¤åŠŸèƒ½ã€‚ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹æ¥å£çš„ç‰¹æ€§ï¼š æ¥å£ä¸èƒ½åŒ…å«å±æ€§ï¼ˆä¹Ÿå°±æ˜¯æˆå‘˜å˜é‡ï¼‰ æ¥å£åªèƒ½ç”Ÿå‘½æ–¹æ³•ï¼Œæ–¹æ³•ä¸èƒ½åŒ…å«ä»£ç å®ç° ç±»å®ç°æ¥å£æ—¶ï¼Œå¿…é¡»å®ç°æ¥å£ä¸­ç”Ÿå‘½çš„æ‰€æœ‰æ–¹æ³•ã€‚ ç»¼ä¸Šï¼Œä»è¯­æ³•ä¸Šå¯¹æ¯”ï¼Œè¿™ä¸¤è€…æœ‰æ¯”è¾ƒå¤§çš„åŒºåˆ«ï¼Œæ¯”å¦‚æŠ½è±¡ç±»ä¸­å¯ä»¥å®šä¹‰å±æ€§ã€æ–¹æ³•çš„å®ç°ï¼Œè€Œæ¥å£ä¸­ä¸èƒ½å®šä¹‰å±æ€§ï¼Œæ–¹æ³•ä¹Ÿä¸èƒ½åŒ…å«å®ç°ç­‰ã€‚ é™¤äº†è¯­æ³•ç‰¹æ€§çš„ä¸åŒå¤–ï¼Œä»è®¾è®¡çš„è§’åº¦ï¼Œè¿™ä¸¤è€…ä¹Ÿæœ‰è¾ƒå¤§åŒºåˆ«ã€‚æŠ½è±¡ç±»æœ¬è´¨ä¸Šå°±æ˜¯ç±»ï¼Œåªä¸è¿‡æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»ï¼Œè¿™ç§ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œåªèƒ½è¢«å­ç±»ç»§æ‰¿ã€‚å±äºis-açš„å…³ç³»ã€‚æ¥å£åˆ™æ˜¯ has-a çš„å…³ç³»ï¼Œè¡¨ç¤ºå…·æœ‰æŸäº›åŠŸèƒ½ã€‚å¯¹äºæ¥å£ï¼Œæœ‰ä¸€ä¸ªæ›´å½¢è±¡çš„å«æ³•ï¼šåè®®ï¼ˆcontractï¼‰ æŠ½è±¡ç±»å’Œæ¥å£è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿä¸‹é¢æˆ‘ä»¬å…ˆæ¥æ€è€ƒä¸€ä¸ªé—®é¢˜~ æŠ½è±¡ç±»çš„å­˜åœ¨æ„ä¹‰æ˜¯ä¸ºäº†è§£å†³ä»£ç å¤ç”¨çš„é—®é¢˜ï¼ˆå¤šä¸ªå­ç±»å¯ä»¥ç»§æ‰¿æŠ½è±¡ç±»ä¸­å®šä¹‰çš„å±æ€§å“ˆæ–¹æ³•ï¼Œé¿å…åœ¨å­ç±»ä¸­ï¼Œé‡å¤ç¼–å†™ç›¸åŒçš„ä»£ç ï¼‰ã€‚ é‚£ä¹ˆï¼Œæ—¢ç„¶ç»§æ‰¿æœ¬èº«å°±èƒ½è¾¾åˆ°ä»£ç å¤ç”¨çš„ç›®çš„ï¼Œè€Œä¸”ç»§æ‰¿ä¹Ÿä¸ä¸€å®šéè¦æ±‚æ˜¯æŠ½è±¡ç±»ã€‚æˆ‘ä»¬ä¸é€‚ç”¨æŠ½è±¡ç±»ï¼Œè²Œä¼¼ä¹Ÿå¯ä»¥å®ç°ç»§æ‰¿å’Œå¤ç”¨ã€‚ä»è¿™ä¸ªè§’åº¦ä¸Šè®²ï¼Œæˆ‘ä»¬å¥½åƒå¹¶ä¸éœ€è¦æŠ½è±¡ç±»è¿™ç§è¯­æ³•å‘€ã€‚é‚£æŠ½è±¡ç±»é™¤äº†è§£å†³ä»£ç å¤ç”¨çš„é—®é¢˜ï¼Œè¿˜æœ‰å…¶ä»–å­˜åœ¨çš„æ„ä¹‰å—ï¼Ÿ è¿™é‡Œå¤§å®¶å¯ä»¥å…ˆæ€è€ƒä¸€ä¸‹å“ˆ~ æˆ‘ä»¬è¿˜æ˜¯å€Ÿç”¨ä¸Šé¢Loggerçš„ä¾‹å­ï¼Œé¦–å…ˆå¯¹ä¸Šé¢çš„æ¡ˆä¾‹å®ç°åšä¸€äº›æ”¹é€ ã€‚åœ¨æ”¹é€ ä¹‹åçš„å®ç°ä¸­ï¼ŒLoggerä¸å†æ˜¯æŠ½è±¡ç±»ï¼Œåªæ˜¯ä¸€ä¸ªæ™®é€šçš„çˆ¶ç±»ï¼Œåˆ é™¤äº†Loggerä¸­çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œæ–°å¢äº† isLoggable()æ–¹æ³•ã€‚FileLogger å’Œ MessageQueueLogger è¿˜æ˜¯ç»§æ‰¿Loggerçˆ¶ç±»å·²è¾¾åˆ°ä»£ç å¤ç”¨çš„ç›®çš„ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š /** * çˆ¶ç±»ï¼šéæŠ½è±¡ç±»ï¼Œå°±æ˜¯æ™®é€šçš„ç±» * @author yanliang * @date 9/27/2020 5:59 PM */ public class Logger &#123; private String name; private boolean enabled; private Level minPermittedLevel; public Logger(String name, boolean enabled, Level minPermittedLevel) &#123; this.name = name; this.enabled = enabled; this.minPermittedLevel = minPermittedLevel; &#125; public boolean isLoggable(Level level) &#123; return enabled &amp;&amp; (minPermittedLevel.intValue() &lt;= level.intValue()); &#125; &#125; /** * æŠ½è±¡ç±»Loggerçš„å­ç±»ï¼šè¾“å‡ºæ—¥å¿—åˆ°æ–‡ä»¶ä¸­ * @author yanliang * @date 9/28/2020 4:44 PM */ public class FileLogger extends Logger &#123; private Writer fileWriter; public FileLogger(String name, boolean enabled, Level minPermittedLevel, String filePath) throws IOException &#123; super(name, enabled, minPermittedLevel); this.fileWriter = new FileWriter(filePath); &#125; protected void log(Level level, String message) &#123; if (!isLoggable(level)) return ; // æ ¼å¼åŒ–level å’Œ messageï¼Œè¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ fileWriter.write(...); &#125; &#125; package com.yanliang.note.java.abstract_demo; import java.util.logging.Level; /** * æŠ½è±¡ç±»Loggerçš„å­ç±»ï¼šè¾“å‡ºæ—¥å¿—åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ * @author yanliang * @date 9/28/2020 6:39 PM */ public class MessageQueueLogger extends Logger &#123; private MessageQueueClient messageQueueClient; public MessageQueueLogger(String name, boolean enabled, Level minPermittedLevel, MessageQueueClient messageQueueClient) &#123; super(name, enabled, minPermittedLevel); this.messageQueueClient = messageQueueClient; &#125; protected void log(Level level, String message) &#123; if (!isLoggable(level)) return ; // æ ¼å¼åŒ–level å’Œ messageï¼Œè¾“å‡ºåˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ messageQueueClient.send(...) &#125; &#125; ä»¥ä¸Šå®ç°è™½ç„¶è¾¾åˆ°äº†ä»£ç å¤ç”¨çš„ç›®çš„ï¼ˆå¤ç”¨äº†çˆ¶ç±»ä¸­çš„å±æ€§ï¼‰ï¼Œä½†æ˜¯å´æ— æ³•ä½¿ç”¨å¤šæ€çš„ç‰¹æ€§äº†ã€‚ åƒä¸‹é¢è¿™æ ·ç¼–å†™ä»£ç å°±ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ï¼Œå› ä¸ºLoggerä¸­å¹¶æ²¡æœ‰å®šä¹‰logï¼ˆï¼‰æ–¹æ³•ã€‚ Logger logger = new FileLogger(&quot;access-log&quot;, true, Level.WARN, &quot;/user/log&quot;); logger.log(Level.ERROR, &quot;This is a test log message.&quot;); å¦‚æœæˆ‘ä»¬åœ¨çˆ¶ç±»ä¸­ï¼Œå®šä¹‰ä¸€ä¸ªç©ºçš„logï¼ˆï¼‰æ–¹æ³•ï¼Œè®©å­ç±»é‡å†™çˆ¶ç±»çš„logï¼ˆï¼‰æ–¹æ³•ï¼Œå®ç°è‡ªå·±çš„è®°å½•æ—¥å¿—é€»è¾‘ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼æ˜¯å¦èƒ½å¤Ÿè§£å†³ä¸Šé¢çš„é—®é¢˜å‘¢ï¼Ÿ å¤§å®¶å¯ä»¥å…ˆæ€è€ƒä¸‹~ è¿™ä¸ªæ€è·¯å¯ä»¥ç”¨ä½¿ç”¨ï¼Œä½†æ˜¯å¹¶ä¸ä¼˜é›…ï¼Œä¸»è¦æœ‰ä¸€ä¸‹å‡ ç‚¹åŸå› ï¼š åœ¨Loggerä¸­å®šä¹‰ä¸€ä¸ªç©ºçš„æ–¹æ³•ï¼Œä¼šå½±å“ä»£ç çš„å¯è¯»æ€§ã€‚å¦‚æœä¸ç†Ÿæ‚‰LoggerèƒŒåçš„è®¾è®¡æ€æƒ³ï¼Œåˆæ²¡æœ‰ä»£ç æ³¨é‡Šçš„è¯ï¼Œåœ¨é˜…è¯»Loggerä»£ç æ—¶å°±ä¼šæ„Ÿåˆ°ç–‘æƒ‘ï¼ˆä¸ºä»€ä¹ˆè¿™é‡Œä¼šå­˜åœ¨ä¸€ä¸ªç©ºçš„logï¼ˆï¼‰æ–¹æ³•ï¼‰ å½“åˆ›å»ºä¸€ä¸ªæ–°çš„å­ç±»ç»§æ‰¿Loggerçˆ¶ç±»æ—¶ï¼Œæœ‰æ—¶å¯èƒ½ä¼šå¿˜è®°é‡æ–°å®ç°logæ–¹æ³•ã€‚ä¹‹å‰æ˜¯åŸºäºæŠ½è±¡ç±»çš„è®¾è®¡æ€æƒ³ï¼Œç¼–è¯‘å™¨ä¼šå¼ºåˆ¶è¦æ±‚å­ç±»é‡å†™çˆ¶ç±»çš„logæ–¹æ³•ï¼Œå¦åˆ™å°±ä¼šæŠ¥ç¼–è¯‘é”™è¯¯ã€‚ Loggerå¯ä»¥è¢«å®ä¾‹åŒ–ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€è¿™ä¸ªç©ºçš„logæ–¹æ³•æœ‰å¯èƒ½ä¼šè¢«è°ƒç”¨ã€‚è¿™å°±å¢åŠ äº†ç±»è¢«è¯¯ç”¨çš„é£é™©ã€‚å½“ç„¶ï¼Œè¿™ä¸ªé—®é¢˜ å¯ä»¥é€šè¿‡è®¾ç½®ç§æœ‰çš„æ„é€ å‡½æ•°çš„æ–¹å¼æ¥è§£å†³ï¼Œä½†æ˜¯ä¸å¦‚æŠ½è±¡ç±»ä¼˜é›…ã€‚ æŠ½è±¡ç±»æ›´å¤šæ˜¯ä¸ºäº†ä»£ç å¤ç”¨ï¼Œè€Œæ¥å£æ›´ä¾§é‡äºè§£è€¦ã€‚æ¥å£æ˜¯å¯¹è¡Œä¸ºçš„ä¸€ç§æŠ½è±¡ï¼Œç›¸å½“äºä¸€ç»„åè®®æˆ–è€…å¥‘çº¦ï¼ˆå¯ç±»æ¯”APIæ¥å£ï¼‰ã€‚è°ƒç”¨è€…åªéœ€è¦å…³å¿ƒæŠ½è±¡çš„æ¥å£ï¼Œä¸éœ€è¦äº†è§£å…·ä½“çš„å®ç°ï¼Œå…·ä½“çš„å®ç°ä»£ç å¯¹è°ƒç”¨è€…é€æ˜ã€‚æ¥å£å®ç°äº†çº¦å®šå’Œå®ç°ç›¸åˆ†ç¦»ï¼Œå¯ä»¥é™ä½ä»£ç é—´çš„è€¦åˆï¼Œæé«˜ä»£ç çš„å¯æ‰©å±•æ€§ã€‚ å®é™…ä¸Šï¼Œæ¥å£æ˜¯ä¸€ä¸ªæ¯”æŠ½è±¡ç±»åº”ç”¨æ›´åŠ å¹¿æ³›ã€æ›´åŠ é‡è¦çš„çŸ¥è¯†ç‚¹ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬ç»å¸¸æåˆ°çš„ â€åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹â€œ ,å°±æ˜¯ä¸€æ¡å‡ ä¹å¤©å¤©ä¼šç”¨åˆ°çš„ï¼Œå¹¶ä¸”èƒ½æå¤§çš„æé«˜ä»£ç çš„çµæ´»æ€§ã€æ‰©å±•æ€§çš„è®¾è®¡æ€æƒ³ã€‚ å¦‚ä½•æ¨¡æ‹ŸæŠ½è±¡ç±»å’Œæ¥å£åœ¨å‰é¢åˆ—ä¸¾çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Javaçš„æ¥å£å®ç°äº†Filterè¿‡æ»¤å™¨ã€‚ä¸è¿‡ï¼Œåœ¨ C++ ä¸­åªæä¾›äº†æŠ½è±¡ç±»ï¼Œå¹¶æ²¡æœ‰æä¾›æ¥å£ï¼Œé‚£ä»ä»£ç çš„è§’åº¦ä¸Šè¯´ï¼Œæ˜¯ä¸æ˜¯å°±æ— æ³•å®ç° Filter çš„è®¾è®¡æ€è·¯äº†å‘¢ï¼Ÿ å¤§å®¶å¯ä»¥å…ˆæ€è€ƒä¸‹ ğŸ¤” ~ æˆ‘ä»¬å…ˆä¼šè®®ä¸‹æ¥å£çš„å®šä¹‰ï¼šæ¥å£ä¸­æ²¡æœ‰æˆå‘˜å˜é‡ï¼Œåªæœ‰æ–¹æ³•å£°æ˜ï¼Œæ²¡æœ‰æ–¹æ³•å®ç°ï¼Œå®ç°æ¥å£çš„ç±»å¿…é¡»å®ç°æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•ã€‚ä¸»è¦æ»¡è¶³ä»¥ä¸Šå‡ ç‚¹ä»è®¾è®¡çš„è§’åº¦ä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠä»–å«åšæ¥å£ã€‚ å®é™…ä¸Šï¼Œè¦æ»¡è¶³æ¥å£çš„è¿™äº›ç‰¹æ€§å¹¶ä¸éš¾ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹å®ç°ï¼š class Strategy &#123; public: -Strategy(); virtual void algorithm()=0; protected: Strategy(); &#125; æŠ½è±¡ç±» Strategy æ²¡æœ‰å®šä¹‰ä»»ä½•å±æ€§ï¼Œå¹¶ä¸”æ‰€æœ‰çš„æ–¹æ³•éƒ½å£°æ˜ä¸º virtual ç±»å‹ï¼ˆç­‰åŒäºJavaä¸­çš„abstractå…³é”®å­—ï¼‰ï¼Œè¿™æ ·ï¼Œæ‰€æœ‰çš„æ–¹æ³•éƒ½ä¸èƒ½æœ‰ä»£ç å®ç°ï¼Œå¹¶ä¸”æ‰€æœ‰ç»§æ‰¿äº†è¿™ä¸ªæŠ½è±¡ç±»çš„å­ç±»ï¼Œéƒ½è¦å®ç°è¿™äº›æ–¹æ³•ã€‚ä»è¯­æ³•ç‰¹æ€§ä¸Šçœ‹ï¼Œè¿™ä¸ªæŠ½è±¡ç±»å°±ç›¸å½“äºä¸€ä¸ªæ¥å£ã€‚ å¤„ç†ç”¨æŠ½è±¡ç±»æ¥æ¨¡æ‹Ÿæ¥å£å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨æ™®é€šç±»æ¥æ¨¡æ‹Ÿæ¥å£ã€‚å…·ä½“çš„Javaå®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š public class MockInterface &#123; protected MockInteface(); public void funcA() &#123; throw new MethodUnSupportedException(); &#125; &#125; æˆ‘ä»¬çŸ¥é“ç±»ä¸­çš„æ–¹æ³•å¿…é¡»åŒ…å«å®ç°ï¼Œè¿™ä¸ªä¸ç¬¦åˆæ¥å£çš„å®šä¹‰ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è®©ç±»ä¸­çš„æ–¹æ³•æŠ›å‡º MethodUnSupportedException å¼‚å¸¸ï¼Œæ¥æ¨¡æ‹Ÿä¸åŒ…å«å®ç°çš„æ¥å£ï¼Œå¹¶ä¸”å¼ºè¿«å­ç±»æ¥ç»§æ‰¿è¿™ä¸ªçˆ¶ç±»çš„æ—¶å€™ï¼Œéƒ½ä¸»åŠ¨å®ç°çˆ¶ç±»çš„æ–¹æ³•ï¼Œå¦åˆ™å°±ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºå¼‚å¸¸ã€‚ é‚£åˆå¦‚ä½•é¿å…è¿™ä¸ªç±»è¢«å®ä¾‹åŒ–å‘¢ï¼Ÿ å®é™…ä¸Šå¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¿™ä¸ªç±»çš„æ„é€ å‡½æ•°å£°æ˜ä¸º protected è®¿é—®æƒé™å°±å¯ä»¥äº†ã€‚ å¦‚ä½•å†³å®šè¯¥ç”¨æŠ½è±¡è¿˜æ˜¯æ¥å£ï¼Ÿä¸Šé¢çš„è®²è§£å¯èƒ½åç†è®ºï¼Œç°åœ¨æˆ‘ä»¬å°±ä»çœŸå®é¡¹ç›®å¼€å‘çš„è§’åº¦æ¥çœ‹ä¸‹ã€‚åœ¨ä»£ç è®¾è®¡/ç¼–ç¨‹æ—¶ï¼Œä»€ä¹ˆæ—¶å€™è¯¥ç”¨æ¥å£ï¼Ÿä»€ä¹ˆæ—¶å€™è¯¥ç”¨æŠ½è±¡ç±»ï¼Ÿ å®é™…ä¸Šï¼Œåˆ¤æ–­çš„æ ‡å‡†å¾ˆç®€å•ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ç§is-aå…³ç³»ï¼Œå¹¶ä¸”æ˜¯ä¸ºäº†è§£å†³ä»£ç å¤ç”¨çš„é—®é¢˜ï¼Œå°±ç”¨æŠ½è±¡ç±»ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ç§has-aå…³ç³»ï¼Œå¹¶ä¸”æ˜¯ä¸ºäº†è§£å†³æŠ½è±¡è€Œéä»£ç å¤ç”¨é—®é¢˜ï¼Œæˆ‘ä»¬å°±ç”¨æ¥å£ã€‚ ä»ç±»çš„ç»§æ‰¿å±‚æ¬¡æ¥çœ‹ï¼ŒæŠ½è±¡ç±»æ˜¯ä¸€ç§è‡ªä¸‹è€Œä¸Šçš„è®¾è®¡æ€è·¯ï¼Œå…ˆæœ‰å­ç±»çš„ä»£ç å¤ç”¨ï¼Œç„¶åå†æŠ½è±¡æˆä¸Šå±‚çš„çˆ¶ç±»ï¼ˆä¹Ÿå°±æ˜¯æŠ½è±¡ç±»ï¼‰ã€‚è€Œæ¥å£åˆ™ç›¸åï¼Œå®ƒæ˜¯ä¸€ç§è‡ªä¸Šè€Œä¸‹çš„è®¾è®¡æ€è·¯ï¼Œæˆ‘ä»¬åœ¨ç¼–ç¨‹çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½æ˜¯å…ˆè®¾è®¡æ¥å£ï¼Œå†å»æ€è€ƒå…·ä½“å®ç°ã€‚ å¥½äº†ï¼Œä½ æ˜¯å¦æŒæ¡äº†ä¸Šé¢çš„å†…å®¹å‘¢ã€‚ä½ å¯ä»¥é€šè¿‡ä¸€ä¸‹å‡ ä¸ªç»´åº¦æ¥å›é¡¾è‡ªæ£€ä¸€ä¸‹ï¼š æŠ½è±¡ç±»å’Œæ¥å£çš„è¯­æ³•ç‰¹æ€§ æŠ½è±¡ç±»å’Œæ¥å£å­˜åœ¨çš„æ„ä¹‰ æŠ½è±¡ç±»å’Œæ¥å£çš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›","categories":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"æ¥å£","slug":"æ¥å£","permalink":"https://gyl-coder.top/tags/%E6%8E%A5%E5%8F%A3/"},{"name":"æŠ½è±¡","slug":"æŠ½è±¡","permalink":"https://gyl-coder.top/tags/%E6%8A%BD%E8%B1%A1/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"Java é›†åˆæ€»ç»“","slug":"java/collection/all","date":"2020-07-06T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"java/collection/all/","link":"","permalink":"https://gyl-coder.top/java/collection/all/","excerpt":"é›†åˆä¸­ç”¨åˆ°çš„æ•°æ®ç»“æ„æœ‰ä»¥ä¸‹å‡ ç§ï¼š æ•°ç»„ï¼š æœ€å¸¸ç”¨çš„æ•°æ®ç»“æ„ä¹‹ä¸€ã€‚æ•°ç»„çš„ç‰¹ç‚¹æ˜¯é•¿åº¦å›ºå®šï¼Œå¯ä»¥ç”¨ä¸‹æ ‡ç´¢å¼•ï¼Œå¹¶ä¸”æ‰€æœ‰çš„å…ƒç´ çš„ç±»å‹éƒ½æ˜¯ä¸€è‡´çš„ã€‚ä½¿ç”¨æ—¶å°½é‡æŠŠæ•°ç»„å°è£…åœ¨ä¸€ä¸ªç±»é‡Œï¼Œé˜²æ­¢æ•°æ®è¢«é”™è¯¯çš„æ“ä½œå¼„ä¹±ã€‚ é“¾è¡¨ï¼š æ˜¯ä¸€ç§ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹åŒ…å«æœ‰æ•°æ®ä»¥åŠæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œåœ¨åŒå‘é“¾è¡¨é‡Œï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ªæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç”¨å•å‘é“¾è¡¨å’ŒåŒå‘é“¾è¡¨æ¥å®ç°å †æ ˆå’Œé˜Ÿåˆ—ï¼Œå› ä¸ºé“¾è¡¨çš„ä¸¤ç«¯éƒ½æ˜¯å¯ä»¥è¿›è¡Œæ’å…¥å’Œåˆ é™¤çš„åŠ¨ä½œçš„ã€‚å½“ç„¶ï¼Œä¹Ÿä¼šæœ‰åœ¨é“¾è¡¨çš„ä¸­é—´é¢‘ç¹æ’å…¥å’Œåˆ é™¤èŠ‚ç‚¹çš„åœºæ™¯ã€‚ æ ‘ï¼š æ˜¯ä¸€ç§ç”±èŠ‚ç‚¹ç»„æˆçš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«æ•°æ®å…ƒç´ ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå­èŠ‚ç‚¹ï¼Œæ¯ä¸ªå­èŠ‚ç‚¹æŒ‡å‘ä¸€ä¸ªçˆ¶èŠ‚ç‚¹å¯ä»¥è¡¨ç¤ºå±‚çº§å…³ç³»æˆ–è€…æ•°æ®å…ƒç´ çš„é¡ºåºå…³ç³»ã€‚å¦‚æœæ ‘çš„æ¯ä¸ªå­èŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ç§æ ‘è¢«ç§°ä¸ºäºŒå‰æ ‘ã€‚äºŒå‰æ ‘æ˜¯ä¸€ç§éå¸¸å¸¸ç”¨çš„æ ‘å½¢ç»“æ„ï¼Œ å› ä¸ºå®ƒçš„è¿™ç§ç»“æ„ä½¿å¾—èŠ‚ç‚¹çš„æ’å…¥å’Œåˆ é™¤éƒ½éå¸¸é«˜æ•ˆã€‚æ ‘çš„è¾¹è¡¨ç¤ºä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹çš„å¿«æ·è·¯å¾„ã€‚ å †æ ˆï¼š åªå…è®¸å¯¹æœ€åæ’å…¥çš„å…ƒç´ è¿›è¡Œæ“ä½œï¼ˆä¹Ÿå°±æ˜¯åè¿›å…ˆå‡ºï¼ŒLast In First Out â€“ LIFOï¼‰ã€‚å¦‚æœä½ ç§»é™¤äº†æ ˆé¡¶çš„å…ƒç´ ï¼Œé‚£ä¹ˆä½ å¯ä»¥æ“ä½œå€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨ã€‚è¿™ç§åè¿›å…ˆå‡ºçš„æ–¹å¼æ˜¯é€šè¿‡ä»…æœ‰çš„peek(),push()å’Œpop()è¿™å‡ ä¸ªæ–¹æ³•çš„å¼ºåˆ¶æ€§é™åˆ¶è¾¾åˆ°çš„ã€‚è¿™ç§ç»“æ„åœ¨å¾ˆå¤šåœºæ™¯ä¸‹éƒ½éå¸¸å®ç”¨ï¼Œä¾‹å¦‚è§£æåƒ(4+2)*3è¿™æ ·çš„æ•°å­¦è¡¨è¾¾å¼ï¼ŒæŠŠæºç ä¸­çš„æ–¹æ³•å’Œå¼‚å¸¸æŒ‰ç…§ä»–ä»¬å‡ºç°çš„é¡ºåºæ”¾åˆ°å †æ ˆä¸­ï¼Œæ£€æŸ¥ä½ çš„ä»£ç çœ‹çœ‹å°æ‹¬å·å’ŒèŠ±æ‹¬å·æ˜¯ä¸æ˜¯åŒ¹é…çš„ï¼Œç­‰ç­‰ã€‚ é˜Ÿåˆ—ï¼š å’Œå †æ ˆæœ‰äº›ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºåœ¨é˜Ÿåˆ—é‡Œç¬¬ä¸€ä¸ªæ’å…¥çš„å…ƒç´ ä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªè¢«åˆ é™¤çš„å…ƒç´ ï¼ˆå³æ˜¯å…ˆè¿›å…ˆå‡ºï¼‰ã€‚è¿™ç§å…ˆè¿›å…ˆå‡ºçš„ç»“æ„æ˜¯é€šè¿‡åªæä¾›peek()ï¼Œoffer()å’Œpoll()è¿™å‡ ä¸ªæ–¹æ³•æ¥è®¿é—®æ•°æ®è¿›è¡Œé™åˆ¶æ¥è¾¾åˆ°çš„ã€‚ä¾‹å¦‚ï¼Œæ’é˜Ÿç­‰å¾…å…¬äº¤è½¦ï¼Œé“¶è¡Œæˆ–è€…è¶…å¸‚é‡Œçš„ç­‰å¾…åˆ—é˜Ÿç­‰ç­‰ï¼Œéƒ½æ˜¯å¯ä»¥ç”¨é˜Ÿåˆ—æ¥è¡¨ç¤ºã€‚","text":"é›†åˆä¸­ç”¨åˆ°çš„æ•°æ®ç»“æ„æœ‰ä»¥ä¸‹å‡ ç§ï¼š æ•°ç»„ï¼š æœ€å¸¸ç”¨çš„æ•°æ®ç»“æ„ä¹‹ä¸€ã€‚æ•°ç»„çš„ç‰¹ç‚¹æ˜¯é•¿åº¦å›ºå®šï¼Œå¯ä»¥ç”¨ä¸‹æ ‡ç´¢å¼•ï¼Œå¹¶ä¸”æ‰€æœ‰çš„å…ƒç´ çš„ç±»å‹éƒ½æ˜¯ä¸€è‡´çš„ã€‚ä½¿ç”¨æ—¶å°½é‡æŠŠæ•°ç»„å°è£…åœ¨ä¸€ä¸ªç±»é‡Œï¼Œé˜²æ­¢æ•°æ®è¢«é”™è¯¯çš„æ“ä½œå¼„ä¹±ã€‚ é“¾è¡¨ï¼š æ˜¯ä¸€ç§ç”±å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”æ¯ä¸ªèŠ‚ç‚¹åŒ…å«æœ‰æ•°æ®ä»¥åŠæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ï¼Œåœ¨åŒå‘é“¾è¡¨é‡Œï¼Œè¿˜ä¼šæœ‰ä¸€ä¸ªæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç”¨å•å‘é“¾è¡¨å’ŒåŒå‘é“¾è¡¨æ¥å®ç°å †æ ˆå’Œé˜Ÿåˆ—ï¼Œå› ä¸ºé“¾è¡¨çš„ä¸¤ç«¯éƒ½æ˜¯å¯ä»¥è¿›è¡Œæ’å…¥å’Œåˆ é™¤çš„åŠ¨ä½œçš„ã€‚å½“ç„¶ï¼Œä¹Ÿä¼šæœ‰åœ¨é“¾è¡¨çš„ä¸­é—´é¢‘ç¹æ’å…¥å’Œåˆ é™¤èŠ‚ç‚¹çš„åœºæ™¯ã€‚ æ ‘ï¼š æ˜¯ä¸€ç§ç”±èŠ‚ç‚¹ç»„æˆçš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«æ•°æ®å…ƒç´ ï¼Œå¹¶ä¸”æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå­èŠ‚ç‚¹ï¼Œæ¯ä¸ªå­èŠ‚ç‚¹æŒ‡å‘ä¸€ä¸ªçˆ¶èŠ‚ç‚¹å¯ä»¥è¡¨ç¤ºå±‚çº§å…³ç³»æˆ–è€…æ•°æ®å…ƒç´ çš„é¡ºåºå…³ç³»ã€‚å¦‚æœæ ‘çš„æ¯ä¸ªå­èŠ‚ç‚¹æœ€å¤šæœ‰ä¸¤ä¸ªå¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿™ç§æ ‘è¢«ç§°ä¸ºäºŒå‰æ ‘ã€‚äºŒå‰æ ‘æ˜¯ä¸€ç§éå¸¸å¸¸ç”¨çš„æ ‘å½¢ç»“æ„ï¼Œ å› ä¸ºå®ƒçš„è¿™ç§ç»“æ„ä½¿å¾—èŠ‚ç‚¹çš„æ’å…¥å’Œåˆ é™¤éƒ½éå¸¸é«˜æ•ˆã€‚æ ‘çš„è¾¹è¡¨ç¤ºä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹çš„å¿«æ·è·¯å¾„ã€‚ å †æ ˆï¼š åªå…è®¸å¯¹æœ€åæ’å…¥çš„å…ƒç´ è¿›è¡Œæ“ä½œï¼ˆä¹Ÿå°±æ˜¯åè¿›å…ˆå‡ºï¼ŒLast In First Out â€“ LIFOï¼‰ã€‚å¦‚æœä½ ç§»é™¤äº†æ ˆé¡¶çš„å…ƒç´ ï¼Œé‚£ä¹ˆä½ å¯ä»¥æ“ä½œå€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨ã€‚è¿™ç§åè¿›å…ˆå‡ºçš„æ–¹å¼æ˜¯é€šè¿‡ä»…æœ‰çš„peek(),push()å’Œpop()è¿™å‡ ä¸ªæ–¹æ³•çš„å¼ºåˆ¶æ€§é™åˆ¶è¾¾åˆ°çš„ã€‚è¿™ç§ç»“æ„åœ¨å¾ˆå¤šåœºæ™¯ä¸‹éƒ½éå¸¸å®ç”¨ï¼Œä¾‹å¦‚è§£æåƒ(4+2)*3è¿™æ ·çš„æ•°å­¦è¡¨è¾¾å¼ï¼ŒæŠŠæºç ä¸­çš„æ–¹æ³•å’Œå¼‚å¸¸æŒ‰ç…§ä»–ä»¬å‡ºç°çš„é¡ºåºæ”¾åˆ°å †æ ˆä¸­ï¼Œæ£€æŸ¥ä½ çš„ä»£ç çœ‹çœ‹å°æ‹¬å·å’ŒèŠ±æ‹¬å·æ˜¯ä¸æ˜¯åŒ¹é…çš„ï¼Œç­‰ç­‰ã€‚ é˜Ÿåˆ—ï¼š å’Œå †æ ˆæœ‰äº›ç›¸ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºåœ¨é˜Ÿåˆ—é‡Œç¬¬ä¸€ä¸ªæ’å…¥çš„å…ƒç´ ä¹Ÿæ˜¯ç¬¬ä¸€ä¸ªè¢«åˆ é™¤çš„å…ƒç´ ï¼ˆå³æ˜¯å…ˆè¿›å…ˆå‡ºï¼‰ã€‚è¿™ç§å…ˆè¿›å…ˆå‡ºçš„ç»“æ„æ˜¯é€šè¿‡åªæä¾›peek()ï¼Œoffer()å’Œpoll()è¿™å‡ ä¸ªæ–¹æ³•æ¥è®¿é—®æ•°æ®è¿›è¡Œé™åˆ¶æ¥è¾¾åˆ°çš„ã€‚ä¾‹å¦‚ï¼Œæ’é˜Ÿç­‰å¾…å…¬äº¤è½¦ï¼Œé“¶è¡Œæˆ–è€…è¶…å¸‚é‡Œçš„ç­‰å¾…åˆ—é˜Ÿç­‰ç­‰ï¼Œéƒ½æ˜¯å¯ä»¥ç”¨é˜Ÿåˆ—æ¥è¡¨ç¤ºã€‚ æ¦‚è§ˆJava å®¹å™¨ä¸»è¦åŒ…æ‹¬ Collection å’Œ Map ä¸¤ç§ï¼ŒCollectionå­˜å‚¨ç€å¯¹è±¡çš„é›†åˆï¼Œè€ŒMapå­˜å‚¨ç€é”®å€¼å¯¹ï¼ˆä¸¤ä¸ªå¯¹è±¡ï¼‰çš„æ˜ å°„è¡¨ã€‚ Collection Set TreeSetï¼ˆæœ‰åºï¼Œå”¯ä¸€ï¼‰ï¼šåŸºäºçº¢é»‘æ ‘å®ç°ï¼Œæ”¯æŒæœ‰åºæ€§æ“ä½œï¼Œä¾‹å¦‚æ ¹æ®ä¸€ä¸ªèŒƒå›´æŸ¥æ‰¾å…ƒç´ çš„æ“ä½œã€‚ä½†æ˜¯æŸ¥æ‰¾æ•ˆç‡ä¸å¦‚ HashSetï¼ŒHashSet æŸ¥æ‰¾çš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼ŒTreeSet åˆ™ä¸º O(logN)ã€‚ HashSetï¼ˆæ— åºï¼Œå”¯ä¸€ï¼‰ï¼šåŸºäºHashmapå®ç°ï¼Œæ”¯æŒå¿«é€ŸæŸ¥æ‰¾ï¼Œä½†ä¸æ”¯æŒæœ‰åºæ€§æ“ä½œã€‚å¹¶ä¸”å¤±å»äº†å…ƒç´ çš„æ’å…¥é¡ºåºä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨ Iterator éå† HashSet å¾—åˆ°çš„ç»“æœæ˜¯ä¸ç¡®å®šçš„ã€‚ LinkedHashSetï¼šLinkedHashSet æ˜¯ HashSet çš„å­ç±»ï¼Œå¹¶ä¸”å…¶å†…éƒ¨æ˜¯é€šè¿‡ LinkedHashMap æ¥å®ç°çš„ã€‚å…·æœ‰ HashSet çš„æŸ¥æ‰¾æ•ˆç‡ï¼Œå¹¶ä¸”å†…éƒ¨ä½¿ç”¨åŒå‘é“¾è¡¨ç»´æŠ¤å…ƒç´ çš„æ’å…¥é¡ºåºã€‚ List ArrayListï¼šåŸºäºåŠ¨æ€æ•°ç»„ Object[] å®ç°ï¼Œæ”¯æŒéšæœºè®¿é—®ã€‚ Vectorï¼šå’Œ ArrayList ç±»ä¼¼ï¼Œä½†å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ LinkedListï¼šåŸºäºåŒå‘é“¾è¡¨å®ç° (JDK1.6 ä¹‹å‰ä¸ºå¾ªç¯é“¾è¡¨ï¼ŒJDK1.7 å–æ¶ˆäº†å¾ªç¯)ï¼Œåªèƒ½é¡ºåºè®¿é—®ï¼Œä½†æ˜¯å¯ä»¥å¿«é€Ÿåœ°åœ¨é“¾è¡¨ä¸­é—´æ’å…¥å’Œåˆ é™¤å…ƒç´ ã€‚ä¸ä»…å¦‚æ­¤ï¼ŒLinkedList è¿˜å¯ä»¥ç”¨ä½œæ ˆã€é˜Ÿåˆ—å’ŒåŒå‘é˜Ÿåˆ—ã€‚ Queue LinkedListï¼šå¯ä»¥ç”¨å®ƒæ¥å®ç°åŒå‘é˜Ÿåˆ—ã€‚ PriorityQueueï¼šåŸºäºå †ç»“æ„å®ç°ï¼Œå¯ä»¥ç”¨å®ƒæ¥å®ç°ä¼˜å…ˆé˜Ÿåˆ—ã€‚ Map TreeMapï¼šåŸºäºçº¢é»‘æ ‘å®ç°ã€‚ï¼ˆè‡ªå¹³è¡¡çš„æ’åºäºŒå‰æ ‘ï¼‰ HashMapï¼šJDK1.8 ä¹‹å‰ HashMap ç”±æ•°ç»„+é“¾è¡¨ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯ HashMap çš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼ˆâ€œæ‹‰é“¾æ³•â€è§£å†³å†²çªï¼‰ã€‚JDK1.8 ä»¥ååœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰ï¼ˆå°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘å‰ä¼šåˆ¤æ–­ï¼Œå¦‚æœå½“å‰æ•°ç»„çš„é•¿åº¦å°äº 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©å…ˆè¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ HashTableï¼šå’Œ HashMap ç±»ä¼¼ï¼Œä½†å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè¿™æ„å‘³ç€åŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™å…¥ HashTable ä¸ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚å®ƒæ˜¯é—ç•™ç±»ï¼Œä¸åº”è¯¥å»ä½¿ç”¨å®ƒï¼Œè€Œæ˜¯ä½¿ç”¨ ConcurrentHashMap æ¥æ”¯æŒçº¿ç¨‹å®‰å…¨ï¼ŒConcurrentHashMap çš„æ•ˆç‡ä¼šæ›´é«˜ï¼Œå› ä¸º ConcurrentHashMap å¼•å…¥äº†åˆ†æ®µé”ã€‚ LinkedHashMapï¼šLinkedHashMap ç»§æ‰¿è‡ª HashMapï¼Œæ‰€ä»¥å®ƒçš„åº•å±‚ä»ç„¶æ˜¯åŸºäºæ‹‰é“¾å¼æ•£åˆ—ç»“æ„å³ç”±æ•°ç»„å’Œé“¾è¡¨æˆ–çº¢é»‘æ ‘ç»„æˆã€‚å¦å¤–ï¼ŒLinkedHashMap åœ¨ä¸Šé¢ç»“æ„çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†ä¸€æ¡åŒå‘é“¾è¡¨æ¥ç»´æŠ¤å…ƒç´ çš„é¡ºåºï¼Œé¡ºåºä¸ºæ’å…¥é¡ºåºæˆ–è€…æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼ˆLRUï¼‰é¡ºåºã€‚ è¿­ä»£å™¨ Iterator Collection ç»§æ‰¿äº† Iterable æ¥å£ï¼Œå…¶ä¸­çš„ iterator() æ–¹æ³•èƒ½å¤Ÿäº§ç”Ÿä¸€ä¸ª Iterator å¯¹è±¡ï¼Œé€šè¿‡è¿™ä¸ªå¯¹è±¡å°±å¯ä»¥è¿­ä»£éå† Collection ä¸­çš„å…ƒç´ ã€‚ä» JDK 1.5 ä¹‹åå¯ä»¥ä½¿ç”¨ foreach æ–¹æ³•æ¥éå†å®ç°äº† Iterable æ¥å£çš„èšåˆå¯¹è±¡ã€‚ public interface Iterator&lt;E&gt; &#123; //é›†åˆä¸­æ˜¯å¦è¿˜æœ‰å…ƒç´  boolean hasNext(); //è·å¾—é›†åˆä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´  E next(); ...... &#125; Iterator å¯¹è±¡ç§°ä¸ºè¿­ä»£å™¨ï¼ˆè®¾è®¡æ¨¡å¼çš„ä¸€ç§ï¼‰ï¼Œè¿­ä»£å™¨å¯ä»¥å¯¹é›†åˆè¿›è¡Œéå†ï¼Œä½†æ¯ä¸€ä¸ªé›†åˆå†…éƒ¨çš„æ•°æ®ç»“æ„å¯èƒ½æ˜¯ä¸å°½ç›¸åŒçš„ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªé›†åˆå­˜å’Œå–éƒ½å¾ˆå¯èƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œè™½ç„¶æˆ‘ä»¬å¯ä»¥äººä¸ºåœ°åœ¨æ¯ä¸€ä¸ªç±»ä¸­å®šä¹‰ hasNext() å’Œ next() æ–¹æ³•ï¼Œä½†è¿™æ ·åšä¼šè®©æ•´ä¸ªé›†åˆä½“ç³»è¿‡äºè‡ƒè‚¿ã€‚äºæ˜¯å°±æœ‰äº†è¿­ä»£å™¨ã€‚ è¿­ä»£å™¨æ˜¯å°†è¿™æ ·çš„æ–¹æ³•æŠ½å–å‡ºæ¥å£ï¼Œç„¶ååœ¨æ¯ä¸ªç±»çš„å†…éƒ¨ï¼Œå®šä¹‰è‡ªå·±è¿­ä»£æ–¹å¼ï¼Œè¿™æ ·åšå°±è§„å®šäº†æ•´ä¸ªé›†åˆä½“ç³»çš„éå†æ–¹å¼éƒ½æ˜¯ hasNext()å’Œnext()æ–¹æ³•ï¼Œä½¿ç”¨è€…ä¸ç”¨ç®¡æ€ä¹ˆå®ç°çš„ï¼Œä¼šç”¨å³å¯ã€‚è¿­ä»£å™¨çš„å®šä¹‰ä¸ºï¼šæä¾›ä¸€ç§æ–¹æ³•è®¿é—®ä¸€ä¸ªå®¹å™¨å¯¹è±¡ä¸­å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸éœ€è¦æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚ã€‚ è¿­ä»£å™¨çš„ä½œç”¨Iterator ä¸»è¦ç”¨äºéå†é›†åˆï¼Œä»–çš„ç‰¹ç‚¹æ˜¯å®‰å…¨ã€‚å› ä¸ºå®ƒå¯ä»¥ç¡®ä¿ï¼Œå½“å‰éå†çš„é›†åˆå…ƒç´ è¢«æ›´æ”¹æ—¶ï¼ŒæŠ›å‡º ConcurrentModificationException å¼‚å¸¸ã€‚ å¦‚ä½•ä½¿ç”¨Map&lt;Integer, String&gt; map = new HashMap(); map.put(1, &quot;Java&quot;); map.put(2, &quot;C++&quot;); map.put(3, &quot;PHP&quot;); Iterator&lt;Map.Entry&lt;Integer, String&gt;&gt; iterator = map.entrySet().iterator(); while (iterator.hasNext()) &#123; Map.Entry&lt;Integer, String&gt; entry = iterator.next(); System.out.println(entry.getKey() + entry.getValue()); &#125; ListArrayListæŸ¥çœ‹ä¸“é¢˜æ–‡ç«  ArrayListæ‰©å®¹æŸ¥çœ‹ä¸“é¢˜æ–‡ç«  VectoræŸ¥çœ‹ä¸“é¢˜æ–‡ç«  LinkedListæŸ¥çœ‹ä¸“é¢˜æ–‡ç«  Arraylist å’Œ Vector çš„åŒºåˆ«? ArrayList æ˜¯ List çš„ä¸»è¦å®ç°ç±»ï¼Œåº•å±‚ä½¿ç”¨ Object[ ]å­˜å‚¨ï¼Œé€‚ç”¨äºé¢‘ç¹çš„æŸ¥æ‰¾å·¥ä½œï¼Œçº¿ç¨‹ä¸å®‰å…¨ ï¼› Vector æ˜¯ List çš„å¤è€å®ç°ç±»ï¼Œåº•å±‚ä½¿ç”¨ Object[ ]å­˜å‚¨ï¼Œçº¿ç¨‹å®‰å…¨çš„ã€‚ Arraylist ä¸ LinkedList åŒºåˆ«? æ˜¯å¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼š ArrayList å’Œ LinkedList éƒ½æ˜¯ä¸åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯ä¸ä¿è¯çº¿ç¨‹å®‰å…¨ï¼› åº•å±‚æ•°æ®ç»“æ„ï¼š Arraylist åº•å±‚ä½¿ç”¨çš„æ˜¯ Object æ•°ç»„ï¼›LinkedList åº•å±‚ä½¿ç”¨çš„æ˜¯ åŒå‘é“¾è¡¨ æ•°æ®ç»“æ„ï¼ˆJDK1.6 ä¹‹å‰ä¸ºå¾ªç¯é“¾è¡¨ï¼ŒJDK1.7 å–æ¶ˆäº†å¾ªç¯ã€‚æ³¨æ„åŒå‘é“¾è¡¨å’ŒåŒå‘å¾ªç¯é“¾è¡¨çš„åŒºåˆ«ï¼Œä¸‹é¢æœ‰ä»‹ç»åˆ°ï¼ï¼‰ æ’å…¥å’Œåˆ é™¤æ˜¯å¦å—å…ƒç´ ä½ç½®çš„å½±å“ï¼š â‘  ArrayList é‡‡ç”¨æ•°ç»„å­˜å‚¨ï¼Œæ‰€ä»¥æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦å—å…ƒç´ ä½ç½®çš„å½±å“ã€‚ æ¯”å¦‚ï¼šæ‰§è¡Œadd(E e)æ–¹æ³•çš„æ—¶å€™ï¼Œ ArrayList ä¼šé»˜è®¤åœ¨å°†æŒ‡å®šçš„å…ƒç´ è¿½åŠ åˆ°æ­¤åˆ—è¡¨çš„æœ«å°¾ï¼Œè¿™ç§æƒ…å†µæ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(1)ã€‚ä½†æ˜¯å¦‚æœè¦åœ¨æŒ‡å®šä½ç½® i æ’å…¥å’Œåˆ é™¤å…ƒç´ çš„è¯ï¼ˆadd(int index, E element)ï¼‰æ—¶é—´å¤æ‚åº¦å°±ä¸º O(n-i)ã€‚å› ä¸ºåœ¨è¿›è¡Œä¸Šè¿°æ“ä½œçš„æ—¶å€™é›†åˆä¸­ç¬¬ i å’Œç¬¬ i ä¸ªå…ƒç´ ä¹‹åçš„(n-i)ä¸ªå…ƒç´ éƒ½è¦æ‰§è¡Œå‘åä½/å‘å‰ç§»ä¸€ä½çš„æ“ä½œã€‚ â‘¡ LinkedList é‡‡ç”¨é“¾è¡¨å­˜å‚¨ï¼Œæ‰€ä»¥å¯¹äºadd(E e)æ–¹æ³•çš„æ’å…¥ï¼Œåˆ é™¤å…ƒç´ æ—¶é—´å¤æ‚åº¦ä¸å—å…ƒç´ ä½ç½®çš„å½±å“ï¼Œè¿‘ä¼¼ O(1)ï¼Œå¦‚æœæ˜¯è¦åœ¨æŒ‡å®šä½ç½®iæ’å…¥å’Œåˆ é™¤å…ƒç´ çš„è¯ï¼ˆ(add(int index, E element)ï¼‰ æ—¶é—´å¤æ‚åº¦è¿‘ä¼¼ä¸ºo(n))å› ä¸ºéœ€è¦å…ˆç§»åŠ¨åˆ°æŒ‡å®šä½ç½®å†æ’å…¥ã€‚ æ˜¯å¦æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ï¼š LinkedList ä¸æ”¯æŒé«˜æ•ˆçš„éšæœºå…ƒç´ è®¿é—®ï¼Œè€Œ ArrayList æ”¯æŒã€‚å¿«é€Ÿéšæœºè®¿é—®å°±æ˜¯é€šè¿‡å…ƒç´ çš„åºå·å¿«é€Ÿè·å–å…ƒç´ å¯¹è±¡(å¯¹åº”äºget(int index)æ–¹æ³•)ã€‚ å†…å­˜ç©ºé—´å ç”¨ï¼š ArrayList çš„ç©º é—´æµªè´¹ä¸»è¦ä½“ç°åœ¨åœ¨ list åˆ—è¡¨çš„ç»“å°¾ä¼šé¢„ç•™ä¸€å®šçš„å®¹é‡ç©ºé—´ï¼Œè€Œ LinkedList çš„ç©ºé—´èŠ±è´¹åˆ™ä½“ç°åœ¨å®ƒçš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½éœ€è¦æ¶ˆè€—æ¯” ArrayList æ›´å¤šçš„ç©ºé—´ï¼ˆå› ä¸ºè¦å­˜æ”¾ç›´æ¥åç»§å’Œç›´æ¥å‰é©±ä»¥åŠæ•°æ®ï¼‰ã€‚ MapMapä¸Listã€Setæ¥å£ä¸åŒï¼Œå®ƒæ˜¯ç”±ä¸€ç³»åˆ—é”®å€¼å¯¹ç»„æˆçš„é›†åˆï¼Œæä¾›äº†keyåˆ°Valueçš„æ˜ å°„ã€‚åŒæ—¶å®ƒä¹Ÿæ²¡æœ‰ç»§æ‰¿Collectionã€‚åœ¨Mapä¸­å®ƒä¿è¯äº†keyä¸valueä¹‹é—´çš„ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªkeyå¯¹åº”ä¸€ä¸ªvalueï¼Œæ‰€ä»¥å®ƒä¸èƒ½å­˜åœ¨ç›¸åŒçš„keyå€¼ï¼Œå½“ç„¶valueå€¼å¯ä»¥ç›¸åŒã€‚keyå¯ä»¥ä¸ºç©ºï¼Œä½†æ˜¯åªå…è®¸å‡ºç°ä¸€ä¸ªnullã€‚å®ƒçš„ä¸»è¦å®ç°ç±»æœ‰HashMapã€HashTableã€LinkedHashMapã€TreeMapã€‚ HashMapHashMap æ˜¯ Map çš„ä¸€ä¸ªå®ç°ç±»ï¼Œå®ƒä»£è¡¨çš„æ˜¯ä¸€ç§é”®å€¼å¯¹çš„æ•°æ®å­˜å‚¨å½¢å¼ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ç›´æ¥å®šä½åˆ°å®ƒçš„å€¼ï¼Œå› è€Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œä½†éå†é¡ºåºå´æ˜¯ä¸ç¡®å®šçš„ã€‚HashMapæœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºnullï¼Œå…è®¸å¤šæ¡è®°å½•çš„å€¼ä¸ºnullã€‚é‡åˆ°keyä¸ºnullçš„æ—¶å€™ï¼Œè°ƒç”¨putForNullKeyæ–¹æ³•è¿›è¡Œå¤„ç†ï¼Œè€Œå¯¹valueæ²¡æœ‰å¤„ç†ã€‚ä¸ä¿è¯æœ‰åº(æ¯”å¦‚æ’å…¥çš„é¡ºåº)ã€ä¹Ÿä¸ä¿è¯åºä¸éšæ—¶é—´å˜åŒ–ã€‚jdk 8 ä¹‹å‰ï¼Œå…¶å†…éƒ¨æ˜¯ç”±æ•°ç»„+é“¾è¡¨æ¥å®ç°çš„ï¼Œè€Œ jdk 8 å¯¹äºé“¾è¡¨é•¿åº¦è¶…è¿‡ 8 çš„é“¾è¡¨å°†è½¬å‚¨ä¸ºçº¢é»‘æ ‘ã€‚HashMapéçº¿ç¨‹å®‰å…¨ï¼Œå³ä»»ä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™HashMapï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚å¦‚æœéœ€è¦æ»¡è¶³çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ç”¨ Collectionsçš„synchronizedMapæ–¹æ³•ä½¿HashMapå…·æœ‰çº¿ç¨‹å®‰å…¨çš„èƒ½åŠ›ï¼Œæˆ–è€…ä½¿ç”¨ConcurrentHashMapã€‚hashæ•°ç»„çš„é»˜è®¤å¤§å°æ˜¯16ï¼Œè€Œä¸”å¤§å°ä¸€å®šæ˜¯2çš„æŒ‡æ•° æŸ¥çœ‹ä¸“é¢˜æ–‡ç«  HashTableHashtableå’ŒHashMapä¸€æ ·ä¹Ÿæ˜¯æ•£åˆ—è¡¨ï¼Œå­˜å‚¨å…ƒç´ ä¹Ÿæ˜¯é”®å€¼å¯¹ï¼Œåº•å±‚å®ç°æ˜¯ä¸€ä¸ªEntryæ•°ç»„+é“¾è¡¨ã€‚Hashtableç»§æ‰¿äºDictionaryç±»ï¼ˆDictionaryç±»å£°æ˜äº†æ“ä½œé”®å€¼å¯¹çš„æ¥å£æ–¹æ³•ï¼‰ï¼Œå®ç°Mapæ¥å£ï¼ˆå®šä¹‰é”®å€¼å¯¹æ¥å£ï¼‰ã€‚HashTableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ƒçš„å¤§éƒ¨åˆ†ç±»éƒ½è¢«synchronizedå…³é”®å­—ä¿®é¥°ã€‚keyå’Œvalueéƒ½ä¸å¯ä¸ºnullã€‚hashæ•°ç»„é»˜è®¤å¤§å°æ˜¯11ï¼Œæ‰©å……æ–¹å¼æ˜¯old*2+1 LinkedHashMapLinkedHashMapç»§æ‰¿è‡ªHashMapå®ç°äº†Mapæ¥å£ã€‚åŸºæœ¬å®ç°åŒHashMapä¸€æ ·ï¼ˆåº•å±‚åŸºäºæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘å®ç°ï¼‰ï¼Œä¸åŒä¹‹å¤„åœ¨äºLinkedHashMapä¿è¯äº†è¿­ä»£çš„æœ‰åºæ€§ã€‚å…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œè§£å†³äº† HashMapä¸èƒ½éšæ—¶ä¿æŒéå†é¡ºåºå’Œæ’å…¥é¡ºåºä¸€è‡´çš„é—®é¢˜ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒLinkedHashMapå¯¹è®¿é—®é¡ºåºä¹Ÿæä¾›äº†ç›¸å…³æ”¯æŒã€‚åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œè¯¥ç‰¹æ€§å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ç¼“å­˜ã€‚åœ¨å®ç°ä¸Šï¼ŒLinkedHashMapå¾ˆå¤šæ–¹æ³•ç›´æ¥ç»§æ‰¿è‡ªHashMapï¼Œä»…ä¸ºç»´æŠ¤åŒå‘é“¾è¡¨è¦†å†™äº†éƒ¨åˆ†æ–¹æ³•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒLinkedHashMapçš„è¿­ä»£é¡ºåºæ˜¯æŒ‰ç…§æ’å…¥èŠ‚ç‚¹çš„é¡ºåºã€‚ä¹Ÿå¯ä»¥é€šè¿‡æ”¹å˜accessOrderå‚æ•°çš„å€¼ï¼Œä½¿å¾—å…¶éå†é¡ºåºæŒ‰ç…§è®¿é—®é¡ºåºè¾“å‡ºã€‚ æŸ¥çœ‹ä¸“é¢˜æ–‡ç«  TreeMapTreeMapé›†åˆæ˜¯åŸºäºçº¢é»‘æ ‘ï¼ˆRed-Black treeï¼‰çš„ NavigableMapå®ç°ã€‚è¯¥é›†åˆæœ€é‡è¦çš„ç‰¹ç‚¹å°±æ˜¯å¯æ’åºï¼Œè¯¥æ˜ å°„æ ¹æ®å…¶é”®çš„è‡ªç„¶é¡ºåºè¿›è¡Œæ’åºï¼Œæˆ–è€…æ ¹æ®åˆ›å»ºæ˜ å°„æ—¶æä¾›çš„ Comparator è¿›è¡Œæ’åºï¼Œå…·ä½“å–å†³äºä½¿ç”¨çš„æ„é€ æ–¹æ³•ã€‚ SetSetæ¥å£ç»§æ‰¿äº†Collectionæ¥å£ã€‚Seté›†åˆä¸­ä¸èƒ½åŒ…å«é‡å¤çš„å…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ä½ åªéœ€å°†å…ƒç´ åŠ å…¥setä¸­ï¼Œé‡å¤çš„å…ƒç´ ä¼šè‡ªåŠ¨ç§»é™¤ã€‚æœ‰ä¸‰ç§å¸¸è§çš„Setå®ç°â€”â€”HashSet, TreeSetå’ŒLinkedHashSetã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªè®¿é—®å¿«é€Ÿçš„Setï¼Œä½ åº”è¯¥ä½¿ç”¨HashSetï¼›å½“ä½ éœ€è¦ä¸€ä¸ªæ’åºçš„Setï¼Œä½ åº”è¯¥ä½¿ç”¨TreeSetï¼›å½“ä½ éœ€è¦è®°å½•ä¸‹æ’å…¥æ—¶çš„é¡ºåºæ—¶ï¼Œä½ åº”è¯¥ä½¿ç”¨LinedHashSetã€‚ HashSetHashSetæ˜¯æ˜¯åŸºäº HashMap å®ç°çš„ï¼Œåº•å±‚é‡‡ç”¨ HashMap æ¥ä¿å­˜å…ƒç´ ,æ‰€ä»¥å®ƒä¸ä¿è¯set çš„è¿­ä»£é¡ºåºï¼›ç‰¹åˆ«æ˜¯å®ƒä¸ä¿è¯è¯¥é¡ºåºæ’ä¹…ä¸å˜ã€‚add()ã€remove()ä»¥åŠcontains()ç­‰æ–¹æ³•éƒ½æ˜¯å¤æ‚åº¦ä¸ºO(1)çš„æ–¹æ³•ã€‚ç”±äºHashMapä¸­keyä¸å¯é‡å¤ï¼Œæ‰€ä»¥HashSetå…ƒç´ ä¸å¯é‡å¤ã€‚å¯ä»¥å­˜å‚¨nullå…ƒç´ ï¼Œæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚ TreeSetTreeSetæ˜¯ä¸€ä¸ªæœ‰åºé›†ï¼ŒåŸºäºTreeMapå®ç°ï¼Œæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚TreeSetåº•å±‚é‡‡ç”¨TreeMapå­˜å‚¨ï¼Œæ„é€ å™¨å¯åŠ¨æ—¶æ–°å»ºTreeMapã€‚TreeSetå­˜å‚¨å…ƒç´ å®é™…ä¸ºTreeMapå­˜å‚¨çš„é”®å€¼å¯¹ä¸º&lt;key,PRESENT&gt;çš„key;ï¼ŒPRESENTä¸ºå›ºå®šå¯¹è±¡ï¼šprivate static final Object PRESENT = new Object().TreeSetæ”¯æŒä¸¤ç§ä¸¤ç§æ’åºæ–¹å¼ï¼Œé€šè¿‡ä¸åŒæ„é€ å™¨è°ƒç”¨å®ç° è‡ªç„¶æ’åºï¼š public TreeSet() &#123; // æ–°å»ºTreeMapï¼Œè‡ªç„¶æ’åº this(new TreeMap&lt;E,Object&gt;()); &#125; Comparatoræ’åºï¼š public TreeSet(Comparator&lt;? super E&gt; comparator) &#123; // æ–°å»ºTreeMapï¼Œä¼ å…¥è‡ªå®šä¹‰æ¯”è¾ƒå™¨comparator this(new TreeMap&lt;&gt;(comparator)); &#125; TreeSetæ”¯æŒæ­£å‘/åå‘è¿­ä»£å™¨éå†å’Œforeachéå† // é¡ºåºTreeSetï¼šè¿­ä»£å™¨å®ç° Iterator iter = set.iterator(); while (iter.hasNext()) &#123; System.out.println(iter.next()); &#125; // é¡ºåºéå†TreeSetï¼šforeachå®ç° for (Integer i : set) &#123; System.out.println(i); &#125; // é€†åºéå†TreeSetï¼šåå‘è¿­ä»£å™¨å®ç° Iterator iter1 = set.descendingIterator(); while (iter1.hasNext()) &#123; System.out.println(iter1.next()); &#125; LinkedHashSetLinkedHashSetä»‹äºHashSetå’ŒTreeSetä¹‹é—´ã€‚å“ˆå¸Œè¡¨å’Œé“¾æ¥åˆ—è¡¨å®ç°ã€‚åŸºæœ¬æ–¹æ³•çš„å¤æ‚åº¦ä¸ºO(1)ã€‚LinkedHashSet æ˜¯ Set çš„ä¸€ä¸ªå…·ä½“å®ç°ï¼Œå…¶ç»´æŠ¤ç€ä¸€ä¸ªè¿è¡Œäºæ‰€æœ‰æ¡ç›®çš„åŒé‡é“¾æ¥åˆ—è¡¨ã€‚æ­¤é“¾æ¥åˆ—è¡¨å®šä¹‰äº†è¿­ä»£é¡ºåºï¼Œè¯¥è¿­ä»£é¡ºåºå¯ä¸ºæ’å…¥é¡ºåºæˆ–æ˜¯è®¿é—®é¡ºåºã€‚LinkedHashSet ç»§æ‰¿äº HashSetï¼Œå¹¶ä¸”å…¶å†…éƒ¨æ˜¯é€šè¿‡ LinkedHashMap æ¥å®ç°çš„ã€‚æœ‰ç‚¹ç±»ä¼¼äºæˆ‘ä»¬ä¹‹å‰è¯´çš„LinkedHashMap å…¶å†…éƒ¨æ˜¯åŸºäº Hashmap å®ç°çš„ä¸€æ ·ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦è¿­ä»£çš„é¡ºåºä¸ºæ’å…¥é¡ºåºæˆ–è€…è®¿é—®é¡ºåºï¼Œé‚£ä¹ˆ LinkedHashSet æ˜¯éœ€è¦ä½ é¦–å…ˆè€ƒè™‘çš„ã€‚LinkedHashSet åº•å±‚ä½¿ç”¨ LinkedHashMap æ¥ä¿å­˜æ‰€æœ‰å…ƒç´ ï¼Œå› ä¸ºç»§æ‰¿äº HashSetï¼Œæ‰€æœ‰çš„æ–¹æ³•æ“ä½œä¸Šåˆä¸ HashSet ç›¸åŒï¼Œå› æ­¤ LinkedHashSet çš„å®ç°ä¸Šéå¸¸ç®€å•ï¼Œåªæä¾›äº†å››ä¸ªæ„é€ æ–¹æ³•ï¼Œå¹¶é€šè¿‡ä¼ é€’ä¸€ä¸ªæ ‡è¯†å‚æ•°ï¼Œè°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ï¼Œåº•å±‚æ„é€ ä¸€ä¸ª LinkedHashMap æ¥å®ç°ï¼Œåœ¨ç›¸å…³æ“ä½œä¸Šä¸çˆ¶ç±» HashSet çš„æ“ä½œç›¸åŒï¼Œç›´æ¥è°ƒç”¨çˆ¶ç±» HashSet çš„æ–¹æ³•å³å¯ã€‚ package java.util; public class LinkedHashSet&lt;E&gt; extends HashSet&lt;E&gt; implements Set&lt;E&gt;, Cloneable, java.io.Serializable &#123; private static final long serialVersionUID = -2851667679971038690L; /** * æ„é€ ä¸€ä¸ªå¸¦æœ‰æŒ‡å®šåˆå§‹å®¹é‡å’ŒåŠ è½½å› å­çš„ç©ºé“¾è¡¨å“ˆå¸Œsetã€‚ * * åº•å±‚ä¼šè°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œæ„é€ ä¸€ä¸ªæœ‰æŒ‡å®šåˆå§‹å®¹é‡å’ŒåŠ è½½å› å­çš„LinkedHashMapå®ä¾‹ã€‚ * @param initialCapacity åˆå§‹å®¹é‡ã€‚ * @param loadFactor åŠ è½½å› å­ã€‚ */ public LinkedHashSet(int initialCapacity, float loadFactor) &#123; super(initialCapacity, loadFactor, true); &#125; /** * æ„é€ ä¸€ä¸ªæŒ‡å®šåˆå§‹å®¹é‡å’Œé»˜è®¤åŠ è½½å› å­0.75çš„æ–°é“¾è¡¨å“ˆå¸Œsetã€‚ * * åº•å±‚ä¼šè°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œæ„é€ ä¸€ä¸ªæŒ‡å®šåˆå§‹å®¹é‡å’Œé»˜è®¤åŠ è½½å› å­0.75çš„LinkedHashMapå®ä¾‹ã€‚ * @param initialCapacity åˆå§‹å®¹é‡ã€‚ */ public LinkedHashSet(int initialCapacity) &#123; super(initialCapacity, .75f, true); &#125; /** * æ„é€ ä¸€ä¸ªé»˜è®¤åˆå§‹å®¹é‡16å’ŒåŠ è½½å› å­0.75çš„æ–°é“¾è¡¨å“ˆå¸Œsetã€‚ * * åº•å±‚ä¼šè°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œæ„é€ ä¸€ä¸ªé»˜è®¤åˆå§‹å®¹é‡16å’ŒåŠ è½½å› å­0.75çš„LinkedHashMapå®ä¾‹ã€‚ */ public LinkedHashSet() &#123; super(16, .75f, true); &#125; /** * æ„é€ ä¸€ä¸ªä¸æŒ‡å®šcollectionä¸­çš„å…ƒç´ ç›¸åŒçš„æ–°é“¾è¡¨å“ˆå¸Œsetã€‚ * * åº•å±‚ä¼šè°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œæ„é€ ä¸€ä¸ªè¶³ä»¥åŒ…å«æŒ‡å®šcollection * ä¸­æ‰€æœ‰å…ƒç´ çš„åˆå§‹å®¹é‡å’ŒåŠ è½½å› å­ä¸º0.75çš„LinkedHashMapå®ä¾‹ã€‚ * @param c å…¶ä¸­çš„å…ƒç´ å°†å­˜æ”¾åœ¨æ­¤setä¸­çš„collectionã€‚ */ public LinkedHashSet(Collection&lt;? extends E&gt; c) &#123; super(Math.max(2*c.size(), 11), .75f, true); addAll(c); &#125; @Override public Spliterator&lt;E&gt; spliterator() &#123; return Spliterators.spliterator(this, Spliterator.DISTINCT | Spliterator.ORDERED); &#125; &#125; é€šè¿‡è§‚å¯ŸHashMapçš„æºç æˆ‘ä»¬å¯ä»¥å‘ç°:Hash Mapçš„å‰ä¸‰ä¸ªæ„é€ å‡½æ•°ï¼Œå³è®¿é—®æƒé™ä¸ºpublicç±»å‹çš„æ„é€ å‡½æ•°å‡æ˜¯ä»¥HashMapä½œä¸ºå®ç°ã€‚è€Œä»¥LinkedHashMapä½œä¸ºå®ç°çš„æ„é€ å‡½æ•°çš„è®¿é—®æƒé™æ˜¯é»˜è®¤è®¿é—®æƒé™ï¼Œå³åŒ…å†…è®¿é—®æƒé™ã€‚ å³ï¼šåœ¨javaç¼–ç¨‹ä¸­ï¼Œé€šè¿‡newåˆ›å»ºçš„HashSetå¯¹è±¡å‡æ˜¯ä»¥HashMapä½œä¸ºå®ç°åŸºç¡€ã€‚åªæœ‰åœ¨jdkä¸­java.utilåŒ…å†…çš„æºä»£ç æ‰å¯èƒ½åˆ›å»ºä»¥LinkedHashMapä½œä¸ºå®ç°çš„HashSet(LinkedHashSetå°±æ˜¯é€šè¿‡å°è£…ä¸€ä¸ªä»¥LinkedHashMapä¸ºå®ç°çš„HashSetæ¥å®ç°çš„)ã€‚åªæœ‰åŒ…å«ä¸‰ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°æ‰æ˜¯é‡‡ç”¨çš„LinkedHashMapä½œä¸ºå®ç°ã€‚ æ— åºæ€§å’Œä¸å¯é‡å¤æ€§çš„å«ä¹‰æ˜¯ä»€ä¹ˆ1ã€ä»€ä¹ˆæ˜¯æ— åºæ€§ï¼Ÿæ— åºæ€§ä¸ç­‰äºéšæœºæ€§ ï¼Œæ— åºæ€§æ˜¯æŒ‡å­˜å‚¨çš„æ•°æ®åœ¨åº•å±‚æ•°ç»„ä¸­å¹¶éæŒ‰ç…§æ•°ç»„ç´¢å¼•çš„é¡ºåºæ·»åŠ  ï¼Œè€Œæ˜¯æ ¹æ®æ•°æ®çš„å“ˆå¸Œå€¼å†³å®šçš„ã€‚2ã€ä»€ä¹ˆæ˜¯ä¸å¯é‡å¤æ€§ï¼Ÿä¸å¯é‡å¤æ€§æ˜¯æŒ‡æ·»åŠ çš„å…ƒç´ æŒ‰ç…§ equals()åˆ¤æ–­æ—¶ ï¼Œè¿”å› falseï¼Œéœ€è¦åŒæ—¶é‡å†™ equals()æ–¹æ³•å’Œ HashCode()æ–¹æ³•ã€‚ æ¯”è¾ƒ HashSetã€LinkedHashSet å’Œ TreeSet ä¸‰è€…çš„å¼‚åŒHashSet æ˜¯ Set æ¥å£çš„ä¸»è¦å®ç°ç±» ï¼ŒHashSet çš„åº•å±‚æ˜¯ HashMapï¼Œçº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œå¯ä»¥å­˜å‚¨ null å€¼ï¼›LinkedHashSet æ˜¯ HashSet çš„å­ç±»ï¼Œèƒ½å¤ŸæŒ‰ç…§æ·»åŠ çš„é¡ºåºéå†ï¼›TreeSet åº•å±‚ä½¿ç”¨çº¢é»‘æ ‘ï¼Œèƒ½å¤ŸæŒ‰ç…§æ·»åŠ å…ƒç´ çš„é¡ºåºè¿›è¡Œéå†ï¼Œæ’åºçš„æ–¹å¼æœ‰è‡ªç„¶æ’åºå’Œå®šåˆ¶æ’åºã€‚ Setä¸­çš„å…ƒç´ ä¸èƒ½é‡å¤ï¼Œå¦‚ä½•å®ç°ï¼Ÿåœ¨Javaçš„Setä½“ç³»ä¸­ï¼Œæ ¹æ®å®ç°æ–¹å¼ä¸åŒä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ã€‚HashSetå’ŒTreeSetã€‚ TreeSet æ˜¯äºŒå‰æ ‘å®ç°çš„,Treesetä¸­çš„æ•°æ®æ˜¯è‡ªåŠ¨æ’å¥½åºçš„ï¼Œä¸å…è®¸æ”¾å…¥nullå€¼ 2ã€HashSet æ˜¯å“ˆå¸Œè¡¨å®ç°çš„,HashSetä¸­çš„æ•°æ®æ˜¯æ— åºçš„ï¼Œå¯ä»¥æ”¾å…¥nullï¼Œä½†åªèƒ½æ”¾å…¥ä¸€ä¸ªnullï¼Œä¸¤è€…ä¸­çš„å€¼éƒ½ä¸èƒ½é‡å¤ï¼Œå°±å¦‚æ•°æ®åº“ä¸­å”¯ä¸€çº¦æŸ åœ¨HashSetä¸­ï¼ŒåŸºæœ¬çš„æ“ä½œéƒ½æ˜¯æœ‰HashMapåº•å±‚å®ç°çš„ï¼Œå› ä¸ºHashSetåº•å±‚æ˜¯ç”¨HashMapå­˜å‚¨æ•°æ®çš„ã€‚å½“å‘HashSetä¸­æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œé¦–å…ˆè®¡ç®—å…ƒç´ çš„hashcodeå€¼ï¼Œç„¶åé€šè¿‡æ‰°åŠ¨è®¡ç®—å’ŒæŒ‰ä½ä¸çš„æ–¹å¼è®¡ç®—å‡ºè¿™ä¸ªå…ƒç´ çš„å­˜å‚¨ä½ç½®ï¼Œå¦‚æœè¿™ä¸ªä½ç½®ä½ç©ºï¼Œå°±å°†å…ƒç´ æ·»åŠ è¿›å»ï¼›å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™ç”¨equalsæ–¹æ³•æ¯”è¾ƒå…ƒç´ æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰å°±ä¸æ·»åŠ ï¼Œå¦åˆ™æ‰¾ä¸€ä¸ªç©ºä½æ·»åŠ ã€‚ TreeSetçš„åº•å±‚æ˜¯TreeMapçš„keySet()ï¼Œè€ŒTreeMapæ˜¯åŸºäºçº¢é»‘æ ‘å®ç°çš„ï¼Œçº¢é»‘æ ‘æ˜¯ä¸€ç§å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œå®ƒèƒ½ä¿è¯ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹çš„å·¦å³å­æ ‘çš„é«˜åº¦å·®ä¸ä¼šè¶…è¿‡è¾ƒçŸ®çš„é‚£æ£µçš„ä¸€å€ã€‚ TreeMapæ˜¯æŒ‰keyæ’åºçš„ï¼Œå…ƒç´ åœ¨æ’å…¥TreeSetæ—¶compareTo()æ–¹æ³•è¦è¢«è°ƒç”¨ï¼Œæ‰€ä»¥TreeSetä¸­çš„å…ƒç´ è¦å®ç°Comparableæ¥å£ã€‚TreeSetä½œä¸ºä¸€ç§Setï¼Œå®ƒä¸å…è®¸å‡ºç°é‡å¤å…ƒç´ ã€‚TreeSetæ˜¯ç”¨compareTo()æ¥åˆ¤æ–­é‡å¤å…ƒç´ çš„ã€‚ Setå¤§å¤šéƒ½ç”¨çš„Mapæ¥å£çš„å®ç°ç±»æ¥å®ç°çš„ï¼ˆHashSetåŸºäºHashMapå®ç°ï¼ŒTreeSetåŸºäºTreeMapå®ç°ï¼ŒLinkedHashSetåŸºäºLinkedHashMapå®ç°ï¼‰åœ¨HashMapä¸­é€šè¿‡å¦‚ä¸‹å®ç°æ¥ä¿è¯keyå€¼å”¯ä¸€ // 1. å¦‚æœkey ç›¸ç­‰ if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; // 2. ä¿®æ”¹å¯¹åº”çš„value if (e != null) &#123; // existing mapping for key V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; &#125; æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œå¦‚æœkey(ä¹Ÿå¯¹åº”çš„Seté›†åˆçš„å…ƒç´ )ç›¸ç­‰ï¼Œé‚£ä¹ˆåˆ™ä¿®æ”¹valueå€¼ã€‚è€Œåœ¨Seté›†åˆä¸­ï¼Œvalueå€¼ä»…ä»…æ˜¯ä¸€ä¸ªObjectå¯¹è±¡ç½¢äº†(è¯¥å¯¹è±¡å¯¹Setæœ¬èº«è€Œè¨€æ˜¯æ— ç”¨çš„)ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼šSeté›†åˆå¦‚æœæ·»åŠ çš„å…ƒç´ ç›¸åŒæ—¶ï¼Œæ˜¯æ ¹æœ¬æ²¡æœ‰æ’å…¥çš„(ä»…ä¿®æ”¹äº†ä¸€ä¸ªæ— ç”¨çš„valueå€¼)ã€‚ä»æºç (HashMap)ä¸­ä¹Ÿçœ‹å‡ºæ¥ï¼Œ==å’Œequals()æ–¹æ³•éƒ½æœ‰ä½¿ç”¨ï¼ comparable å’Œ Comparator çš„åŒºåˆ« comparable æ¥å£å®é™…ä¸Šæ˜¯å‡ºè‡ªjava.langåŒ… å®ƒæœ‰ä¸€ä¸ª compareTo(Object obj)æ–¹æ³•ç”¨æ¥æ’åº comparatoræ¥å£å®é™…ä¸Šæ˜¯å‡ºè‡ª java.util åŒ…å®ƒæœ‰ä¸€ä¸ªcompare(Object obj1, Object obj2)æ–¹æ³•ç”¨æ¥æ’åº ä¸€èˆ¬æˆ‘ä»¬éœ€è¦å¯¹ä¸€ä¸ªé›†åˆä½¿ç”¨è‡ªå®šä¹‰æ’åºæ—¶ï¼Œæˆ‘ä»¬å°±è¦é‡å†™compareTo()æ–¹æ³•æˆ–compare()æ–¹æ³•ï¼Œå½“æˆ‘ä»¬éœ€è¦å¯¹æŸä¸€ä¸ªé›†åˆå®ç°ä¸¤ç§æ’åºæ–¹å¼ï¼Œæ¯”å¦‚ä¸€ä¸ª song å¯¹è±¡ä¸­çš„æ­Œåå’Œæ­Œæ‰‹ååˆ†åˆ«é‡‡ç”¨ä¸€ç§æ’åºæ–¹æ³•çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™compareTo()æ–¹æ³•å’Œä½¿ç”¨è‡ªåˆ¶çš„Comparatoræ–¹æ³•æˆ–è€…ä»¥ä¸¤ä¸ª Comparator æ¥å®ç°æ­Œåæ’åºå’Œæ­Œæ˜Ÿåæ’åºï¼Œç¬¬äºŒç§ä»£è¡¨æˆ‘ä»¬åªèƒ½ä½¿ç”¨ä¸¤ä¸ªå‚æ•°ç‰ˆçš„ Collections.sort(). Comparator å®šåˆ¶æ’åº ArrayList&lt;Integer&gt; arrayList = new ArrayList&lt;Integer&gt;(); arrayList.add(-1); arrayList.add(3); arrayList.add(3); arrayList.add(-5); arrayList.add(7); arrayList.add(4); arrayList.add(-9); arrayList.add(-7); System.out.println(&quot;åŸå§‹æ•°ç»„:&quot;); System.out.println(arrayList); // void reverse(List list)ï¼šåè½¬ Collections.reverse(arrayList); System.out.println(&quot;Collections.reverse(arrayList):&quot;); System.out.println(arrayList); // void sort(List list),æŒ‰è‡ªç„¶æ’åºçš„å‡åºæ’åº Collections.sort(arrayList); System.out.println(&quot;Collections.sort(arrayList):&quot;); System.out.println(arrayList); // å®šåˆ¶æ’åºçš„ç”¨æ³• Collections.sort(arrayList, new Comparator&lt;Integer&gt;() &#123; @Override public int compare(Integer o1, Integer o2) &#123; return o2.compareTo(o1); &#125; &#125;); System.out.println(&quot;å®šåˆ¶æ’åºåï¼š&quot;); System.out.println(arrayList); OutPut : åŸå§‹æ•°ç»„: [-1, 3, 3, -5, 7, 4, -9, -7] Collections.reverse(arrayList): [-7, -9, 4, 7, -5, 3, 3, -1] Collections.sort(arrayList): [-9, -7, -5, -1, 3, 3, 4, 7] å®šåˆ¶æ’åºåï¼š [7, 4, 3, 3, -1, -5, -7, -9] é‡å†™ compareToï¼ˆï¼‰æ–¹æ³•å®ç°æŒ‰å¹´é¾„æ’åº// personå¯¹è±¡æ²¡æœ‰å®ç°Comparableæ¥å£ï¼Œæ‰€ä»¥å¿…é¡»å®ç°ï¼Œè¿™æ ·æ‰ä¸ä¼šå‡ºé”™ï¼Œæ‰å¯ä»¥ä½¿treemapä¸­çš„æ•°æ®æŒ‰é¡ºåºæ’åˆ— // å‰é¢ä¸€ä¸ªä¾‹å­çš„Stringç±»å·²ç»é»˜è®¤å®ç°äº†Comparableæ¥å£ï¼Œè¯¦ç»†å¯ä»¥æŸ¥çœ‹Stringç±»çš„APIæ–‡æ¡£ï¼Œå¦å¤–å…¶ä»– // åƒIntegerç±»ç­‰éƒ½å·²ç»å®ç°äº†Comparableæ¥å£ï¼Œæ‰€ä»¥ä¸éœ€è¦å¦å¤–å®ç°äº† public class Person implements Comparable&lt;Person&gt; &#123; private String name; private int age; public Person(String name, int age) &#123; super(); this.name = name; this.age = age; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; /** * Té‡å†™compareToæ–¹æ³•å®ç°æŒ‰å¹´é¾„æ¥æ’åº */ @Override public int compareTo(Person o) &#123; if (this.age &gt; o.getAge()) &#123; return 1; &#125; if (this.age &lt; o.getAge()) &#123; return -1; &#125; return 0; &#125; &#125; public static void main(String[] args) &#123; TreeMap&lt;Person, String&gt; pdata = new TreeMap&lt;Person, String&gt;(); pdata.put(new Person(&quot;å¼ ä¸‰&quot;, 30), &quot;zhangsan&quot;); pdata.put(new Person(&quot;æå››&quot;, 20), &quot;lisi&quot;); pdata.put(new Person(&quot;ç‹äº”&quot;, 10), &quot;wangwu&quot;); pdata.put(new Person(&quot;å°çº¢&quot;, 5), &quot;xiaohong&quot;); // å¾—åˆ°keyçš„å€¼çš„åŒæ—¶å¾—åˆ°keyæ‰€å¯¹åº”çš„å€¼ Set&lt;Person&gt; keys = pdata.keySet(); for (Person key : keys) &#123; System.out.println(key.getAge() + &quot;-&quot; + key.getName()); &#125; &#125; OutPut : 5-å°çº¢ 10-ç‹äº” 20-æå›› 30-å¼ ä¸‰ å…¶ä»–è¯´è¯´Listã€Setã€Mapçš„åŒºåˆ«List å­˜å‚¨å…ƒç´ æœ‰åºï¼Œå¯é‡å¤ã€‚Set å­˜å‚¨å…ƒç´ æ— åºï¼Œä¸å¯é‡å¤ã€‚Map ä½¿ç”¨é”®å€¼å¯¹ï¼ˆkye-valueï¼‰å­˜å‚¨ï¼Œç±»ä¼¼äºæ•°å­¦ä¸Šçš„å‡½æ•° y=f(x)ï¼Œâ€œxâ€ä»£è¡¨ keyï¼Œâ€yâ€ä»£è¡¨ valueï¼ŒKey æ˜¯æ— åºçš„ã€ä¸å¯é‡å¤çš„ï¼Œvalue æ˜¯æ— åºçš„ã€å¯é‡å¤çš„ï¼Œæ¯ä¸ªé”®æœ€å¤šæ˜ å°„åˆ°ä¸€ä¸ªå€¼ã€‚ å¦‚ä½•é€‰ç”¨é›†åˆ?ä¸»è¦æ ¹æ®é›†åˆçš„ç‰¹ç‚¹æ¥é€‰ç”¨ï¼Œæ¯”å¦‚æˆ‘ä»¬éœ€è¦æ ¹æ®é”®å€¼è·å–åˆ°å…ƒç´ å€¼æ—¶å°±é€‰ç”¨ Map æ¥å£ä¸‹çš„é›†åˆï¼Œéœ€è¦æ’åºæ—¶é€‰æ‹© TreeMap,ä¸éœ€è¦æ’åºæ—¶å°±é€‰æ‹© HashMap,éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨å°±é€‰ç”¨ ConcurrentHashMapã€‚ å½“æˆ‘ä»¬åªéœ€è¦å­˜æ”¾å…ƒç´ å€¼æ—¶ï¼Œå°±é€‰æ‹©å®ç°Collection æ¥å£çš„é›†åˆï¼Œéœ€è¦ä¿è¯å…ƒç´ å”¯ä¸€æ—¶é€‰æ‹©å®ç° Set æ¥å£çš„é›†åˆæ¯”å¦‚ TreeSet æˆ– HashSetï¼Œä¸éœ€è¦å°±é€‰æ‹©å®ç° List æ¥å£çš„æ¯”å¦‚ ArrayList æˆ– LinkedListï¼Œç„¶åå†æ ¹æ®å®ç°è¿™äº›æ¥å£çš„é›†åˆçš„ç‰¹ç‚¹æ¥é€‰ç”¨ã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨é›†åˆï¼Ÿå½“æˆ‘ä»¬éœ€è¦ä¿å­˜ä¸€ç»„ç±»å‹ç›¸åŒçš„æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥æ˜¯ç”¨ä¸€ä¸ªå®¹å™¨æ¥ä¿å­˜ï¼Œè¿™ä¸ªå®¹å™¨å°±æ˜¯æ•°ç»„ï¼Œä½†æ˜¯ï¼Œä½¿ç”¨æ•°ç»„å­˜å‚¨å¯¹è±¡å…·æœ‰ä¸€å®šçš„å¼Šç«¯ï¼Œ å› ä¸ºæˆ‘ä»¬åœ¨å®é™…å¼€å‘ä¸­ï¼Œå­˜å‚¨çš„æ•°æ®çš„ç±»å‹æ˜¯å¤šç§å¤šæ ·çš„ï¼Œäºæ˜¯ï¼Œå°±å‡ºç°äº†â€œé›†åˆâ€ï¼Œé›†åˆåŒæ ·ä¹Ÿæ˜¯ç”¨æ¥å­˜å‚¨å¤šä¸ªæ•°æ®çš„ã€‚ æ•°ç»„çš„ç¼ºç‚¹æ˜¯ä¸€æ—¦å£°æ˜ä¹‹åï¼Œé•¿åº¦å°±ä¸å¯å˜äº†ï¼›åŒæ—¶ï¼Œå£°æ˜æ•°ç»„æ—¶çš„æ•°æ®ç±»å‹ä¹Ÿå†³å®šäº†è¯¥æ•°ç»„å­˜å‚¨çš„æ•°æ®çš„ç±»å‹ï¼›è€Œä¸”ï¼Œæ•°ç»„å­˜å‚¨çš„æ•°æ®æ˜¯æœ‰åºçš„ã€å¯é‡å¤çš„ï¼Œç‰¹ç‚¹å•ä¸€ã€‚ ä½†æ˜¯é›†åˆæé«˜äº†æ•°æ®å­˜å‚¨çš„çµæ´»æ€§ï¼ŒJava é›†åˆä¸ä»…å¯ä»¥ç”¨æ¥å­˜å‚¨ä¸åŒç±»å‹ä¸åŒæ•°é‡çš„å¯¹è±¡ï¼Œè¿˜å¯ä»¥ä¿å­˜å…·æœ‰æ˜ å°„å…³ç³»çš„æ•°æ® æœ‰å“ªäº›é›†åˆæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Ÿæ€ä¹ˆè§£å†³å‘¢ï¼Ÿæˆ‘ä»¬å¸¸ç”¨çš„ Arraylist ,LinkedList,Hashmap,HashSet,TreeSet,TreeMapï¼ŒPriorityQueue éƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è§£å†³åŠæ³•å¾ˆç®€å•ï¼Œå¯ä»¥ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆæ¥ä»£æ›¿ã€‚å¦‚æœä½ è¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆçš„è¯ï¼Œ java.util.concurrent åŒ…ä¸­æä¾›äº†å¾ˆå¤šå¹¶å‘å®¹å™¨ä¾›ä½ ä½¿ç”¨ï¼š ConcurrentHashMap: å¯ä»¥çœ‹ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ HashMap CopyOnWriteArrayList:å¯ä»¥çœ‹ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ ArrayListï¼Œåœ¨è¯»å¤šå†™å°‘çš„åœºåˆæ€§èƒ½éå¸¸å¥½ï¼Œè¿œè¿œå¥½äº Vector. ConcurrentLinkedQueue:é«˜æ•ˆçš„å¹¶å‘é˜Ÿåˆ—ï¼Œä½¿ç”¨é“¾è¡¨å®ç°ã€‚å¯ä»¥çœ‹åšä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ LinkedListï¼Œè¿™æ˜¯ä¸€ä¸ªéé˜»å¡é˜Ÿåˆ—ã€‚ BlockingQueue: è¿™æ˜¯ä¸€ä¸ªæ¥å£ï¼ŒJDK å†…éƒ¨é€šè¿‡é“¾è¡¨ã€æ•°ç»„ç­‰æ–¹å¼å®ç°äº†è¿™ä¸ªæ¥å£ã€‚è¡¨ç¤ºé˜»å¡é˜Ÿåˆ—ï¼Œéå¸¸é€‚åˆç”¨äºä½œä¸ºæ•°æ®å…±äº«çš„é€šé“ã€‚ ConcurrentSkipListMap :è·³è¡¨çš„å®ç°ã€‚è¿™æ˜¯ä¸€ä¸ªMapï¼Œä½¿ç”¨è·³è¡¨çš„æ•°æ®ç»“æ„è¿›è¡Œå¿«é€ŸæŸ¥æ‰¾ã€‚ fail-fastfail-fast æœºåˆ¶æ˜¯javaé›†åˆ(Collection)ä¸­çš„ä¸€ç§é”™è¯¯æœºåˆ¶ã€‚å½“å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªé›†åˆçš„å†…å®¹è¿›è¡Œæ“ä½œæ—¶ï¼Œå°±å¯èƒ½ä¼šäº§ç”Ÿfail-fastäº‹ä»¶ã€‚ä¾‹å¦‚ï¼šå½“æŸä¸€ä¸ªçº¿ç¨‹Aé€šè¿‡iteratorå»éå†æŸé›†åˆçš„è¿‡ç¨‹ä¸­ï¼Œè‹¥è¯¥é›†åˆçš„å†…å®¹è¢«å…¶ä»–çº¿ç¨‹æ‰€æ”¹å˜äº†ï¼›é‚£ä¹ˆçº¿ç¨‹Aè®¿é—®é›†åˆæ—¶ï¼Œå°±ä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸ï¼Œäº§ç”Ÿfail-fastäº‹ä»¶ã€‚å¿«é€Ÿå¤±è´¥ï¼ˆfailâ€”fastï¼‰åœ¨ç”¨è¿­ä»£å™¨éå†ä¸€ä¸ªé›†åˆå¯¹è±¡æ—¶ï¼Œå¦‚æœéå†è¿‡ç¨‹ä¸­å¯¹é›†åˆå¯¹è±¡çš„å†…å®¹è¿›è¡Œäº†ä¿®æ”¹ï¼ˆå¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹ï¼‰ï¼Œåˆ™ä¼šæŠ›å‡ºConcurrent Modification Exceptionã€‚åŸç†ï¼šè¿­ä»£å™¨åœ¨éå†æ—¶ç›´æ¥è®¿é—®é›†åˆä¸­çš„å†…å®¹ï¼Œå¹¶ä¸”åœ¨éå†è¿‡ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ª modCount å˜é‡ã€‚é›†åˆåœ¨è¢«éå†æœŸé—´å¦‚æœå†…å®¹å‘ç”Ÿå˜åŒ–ï¼Œå°±ä¼šæ”¹å˜modCountçš„å€¼ã€‚æ¯å½“è¿­ä»£å™¨ä½¿ç”¨hashNext()/next()éå†ä¸‹ä¸€ä¸ªå…ƒç´ ä¹‹å‰ï¼Œéƒ½ä¼šæ£€æµ‹modCountå˜é‡æ˜¯å¦ä¸ºexpectedmodCountå€¼ï¼Œæ˜¯çš„è¯å°±è¿”å›éå†ï¼›å¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œç»ˆæ­¢éå†ã€‚æ³¨æ„ï¼šè¿™é‡Œå¼‚å¸¸çš„æŠ›å‡ºæ¡ä»¶æ˜¯æ£€æµ‹åˆ° modCountï¼=expectedmodCount è¿™ä¸ªæ¡ä»¶ã€‚å¦‚æœé›†åˆå‘ç”Ÿå˜åŒ–æ—¶ä¿®æ”¹modCountå€¼åˆšå¥½åˆè®¾ç½®ä¸ºäº†expectedmodCountå€¼ï¼Œåˆ™å¼‚å¸¸ä¸ä¼šæŠ›å‡ºã€‚å› æ­¤ï¼Œä¸èƒ½ä¾èµ–äºè¿™ä¸ªå¼‚å¸¸æ˜¯å¦æŠ›å‡ºè€Œè¿›è¡Œå¹¶å‘æ“ä½œçš„ç¼–ç¨‹ï¼Œè¿™ä¸ªå¼‚å¸¸åªå»ºè®®ç”¨äºæ£€æµ‹å¹¶å‘ä¿®æ”¹çš„bugã€‚åœºæ™¯ï¼šjava.utilåŒ…ä¸‹çš„é›†åˆç±»éƒ½æ˜¯å¿«é€Ÿå¤±è´¥çš„ï¼Œä¸èƒ½åœ¨å¤šçº¿ç¨‹ä¸‹å‘ç”Ÿå¹¶å‘ä¿®æ”¹ï¼ˆè¿­ä»£è¿‡ç¨‹ä¸­è¢«ä¿®æ”¹ï¼‰ã€‚å®‰å…¨å¤±è´¥ï¼ˆfailâ€”safeï¼‰é‡‡ç”¨å®‰å…¨å¤±è´¥æœºåˆ¶çš„é›†åˆå®¹å™¨ï¼Œåœ¨éå†æ—¶ä¸æ˜¯ç›´æ¥åœ¨é›†åˆå†…å®¹ä¸Šè®¿é—®çš„ï¼Œè€Œæ˜¯å…ˆå¤åˆ¶åŸæœ‰é›†åˆå†…å®¹ï¼Œåœ¨æ‹·è´çš„é›†åˆä¸Šè¿›è¡Œéå†ã€‚åŸç†ï¼šç”±äºè¿­ä»£æ—¶æ˜¯å¯¹åŸé›†åˆçš„æ‹·è´è¿›è¡Œéå†ï¼Œæ‰€ä»¥åœ¨éå†è¿‡ç¨‹ä¸­å¯¹åŸé›†åˆæ‰€ä½œçš„ä¿®æ”¹å¹¶ä¸èƒ½è¢«è¿­ä»£å™¨æ£€æµ‹åˆ°ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘Concurrent Modification Exceptionã€‚ç¼ºç‚¹ï¼šåŸºäºæ‹·è´å†…å®¹çš„ä¼˜ç‚¹æ˜¯é¿å…äº†Concurrent Modification Exceptionï¼Œä½†åŒæ ·åœ°ï¼Œè¿­ä»£å™¨å¹¶ä¸èƒ½è®¿é—®åˆ°ä¿®æ”¹åçš„å†…å®¹ï¼Œå³ï¼šè¿­ä»£å™¨éå†çš„æ˜¯å¼€å§‹éå†é‚£ä¸€åˆ»æ‹¿åˆ°çš„é›†åˆæ‹·è´ï¼Œåœ¨éå†æœŸé—´åŸé›†åˆå‘ç”Ÿçš„ä¿®æ”¹è¿­ä»£å™¨æ˜¯ä¸çŸ¥é“çš„ã€‚åœºæ™¯ï¼šjava.util.concurrentåŒ…ä¸‹çš„å®¹å™¨éƒ½æ˜¯å®‰å…¨å¤±è´¥ï¼Œå¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸‹å¹¶å‘ä½¿ç”¨ï¼Œå¹¶å‘ä¿®æ”¹ã€‚ Vectorå’ŒArrayListç›¸åŒç‚¹ï¼šè¿™ä¸¤ä¸ªç±»éƒ½å®ç°äº†Listæ¥å£ï¼Œä»–ä»¬éƒ½æ˜¯æœ‰åºçš„é›†åˆï¼ˆå‚¨å­˜æœ‰åºï¼‰ï¼Œåº•å±‚éƒ½ç”¨æ•°ç»„å®ç°ã€‚å¯ä»¥é€šè¿‡ç´¢å¼•æ¥è·å–æŸä¸ªå…ƒç´ ã€‚å…è®¸å…ƒç´ é‡å¤å’Œå‡ºç°nullå€¼ã€‚ArrayListå’ŒVectorçš„è¿­ä»£å™¨å®ç°éƒ½æ˜¯fail-fastçš„ã€‚ä¸åŒç‚¹ï¼švectoræ˜¯çº¿ç¨‹åŒæ­¥çš„ï¼Œæ‰€ä»¥å®ƒä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œarraylistæ˜¯çº¿ç¨‹å¼‚æ­¥çš„ï¼Œæ˜¯ä¸å®‰å…¨çš„ã€‚å¦‚æœä¸è€ƒè™‘åˆ°çº¿ç¨‹çš„å®‰å…¨å› ç´ ï¼Œä¸€èˆ¬ç”¨arraylistæ•ˆç‡æ¯”è¾ƒé«˜ã€‚æ‰©å®¹æ—¶ï¼Œarraylistæ‰©å®¹1.5å€ï¼Œvectoræ‰©å®¹2å€ï¼ˆæˆ–è€…æ‰©å®¹æŒ‡å®šçš„å¤§å°ï¼‰ArrayList å’ŒVectoræ˜¯é‡‡ç”¨æ•°ç»„æ–¹å¼å­˜å‚¨æ•°æ®ï¼Œæ­¤æ•°ç»„å…ƒç´ æ•°å¤§äºå®é™…å­˜å‚¨çš„æ•°æ®ä»¥ä¾¿å¢åŠ å’Œæ’å…¥å…ƒç´ ï¼Œéƒ½å…è®¸ç›´æ¥åºå·ç´¢å¼•å…ƒç´ ï¼Œä½†æ˜¯æ’å…¥æ•°æ®è¦è®¾è®¡åˆ°æ•°ç»„å…ƒç´ ç§»åŠ¨ç­‰å†…å­˜æ“ä½œï¼Œæ‰€ä»¥ç´¢å¼•æ•°æ®å¿«æ’å…¥æ•°æ®æ…¢ï¼ŒVectorç”±äºä½¿ç”¨äº†synchronizedæ–¹æ³•ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰æ‰€ä»¥æ€§èƒ½ä¸Šæ¯”ArrayListè¦å·®ï¼ŒLinkedListä½¿ç”¨åŒå‘é“¾è¡¨å®ç°å­˜å‚¨ï¼ŒæŒ‰åºå·ç´¢å¼•æ•°æ®éœ€è¦è¿›è¡Œå‘å‰æˆ–å‘åéå†ï¼Œä½†æ˜¯æ’å…¥æ•°æ®æ—¶åªéœ€è¦è®°å½•æœ¬é¡¹çš„å‰åé¡¹å³å¯ï¼Œæ‰€ä»¥æ’å…¥æ•°åº¦è¾ƒå¿«ï¼ Aarraylistå’ŒLinkedlistArrayListæ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼ŒLinkedListåŸºäºåŒå‘é“¾è¡¨å®ç°çš„ã€‚ArrayListå®ƒæ”¯æŒä»¥ä¸‹æ ‡ä½ç½®è¿›è¡Œç´¢å¼•å‡ºå¯¹åº”çš„å…ƒç´ (éšæœºè®¿é—®)ï¼Œè€ŒLinkedListåˆ™éœ€è¦éå†æ•´ä¸ªé“¾è¡¨æ¥è·å–å¯¹åº”çš„å…ƒç´ ã€‚å› æ­¤ä¸€èˆ¬æ¥è¯´ArrayListçš„è®¿é—®é€Ÿåº¦æ˜¯è¦æ¯”LinkedListè¦å¿«çš„ArrayListç”±äºæ˜¯æ•°ç»„ï¼Œå¯¹äºåˆ é™¤å’Œä¿®æ”¹è€Œè¨€æ¶ˆè€—æ˜¯æ¯”è¾ƒå¤§(å¤åˆ¶å’Œç§»åŠ¨æ•°ç»„å®ç°)ï¼ŒLinkedListæ˜¯åŒå‘é“¾è¡¨åˆ é™¤å’Œä¿®æ”¹åªéœ€è¦ä¿®æ”¹å¯¹åº”çš„æŒ‡é’ˆå³å¯ï¼Œæ¶ˆè€—æ˜¯å¾ˆå°çš„ã€‚å› æ­¤ä¸€èˆ¬æ¥è¯´LinkedListçš„å¢åˆ é€Ÿåº¦æ˜¯è¦æ¯”ArrayListè¦å¿«çš„LinkedListæ¯”ArrayListæ¶ˆè€—æ›´å¤šçš„å†…å­˜ï¼Œå› ä¸ºLinkedListä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨äº†å‰åèŠ‚ç‚¹çš„å¼•ç”¨ã€‚å¯¹äºå¢åŠ /åˆ é™¤å…ƒç´ æ“ä½œå¦‚æœå¢åˆ éƒ½æ˜¯åœ¨æœ«å°¾æ¥æ“ä½œï¼ˆæ¯æ¬¡è°ƒç”¨çš„éƒ½æ˜¯remove()å’Œadd()ï¼‰ï¼Œæ­¤æ—¶ArrayListå°±ä¸éœ€è¦ç§»åŠ¨å’Œå¤åˆ¶æ•°ç»„æ¥è¿›è¡Œæ“ä½œäº†ã€‚å¦‚æœæ•°æ®é‡æœ‰ç™¾ä¸‡çº§çš„æ—¶ï¼Œé€Ÿåº¦æ˜¯ä¼šæ¯”LinkedListè¦å¿«çš„ã€‚å¦‚æœåˆ é™¤æ“ä½œçš„ä½ç½®æ˜¯åœ¨ä¸­é—´ã€‚ç”±äºLinkedListçš„æ¶ˆè€—ä¸»è¦æ˜¯åœ¨éå†ä¸Šï¼ŒArrayListçš„æ¶ˆè€—ä¸»è¦æ˜¯åœ¨ç§»åŠ¨å’Œå¤åˆ¶ä¸Š(åº•å±‚è°ƒç”¨çš„æ˜¯arraycopy()æ–¹æ³•ï¼Œæ˜¯nativeæ–¹æ³•)ã€‚LinkedListçš„éå†é€Ÿåº¦æ˜¯è¦æ…¢äºArrayListçš„å¤åˆ¶ç§»åŠ¨é€Ÿåº¦çš„å¦‚æœæ•°æ®é‡æœ‰ç™¾ä¸‡çº§çš„æ—¶ï¼Œè¿˜æ˜¯ArrayListè¦å¿«ã€‚ å“ªäº›é›†åˆç±»æä¾›å¯¹å…ƒç´ çš„éšæœºè®¿é—®ï¼ŸArrayListã€HashMapã€TreeMapå’ŒHashTableç±»æä¾›å¯¹å…ƒç´ çš„éšæœºè®¿é—®ã€‚ Enumerationå’ŒIteratoræ¥å£çš„åŒºåˆ«Enumerationçš„é€Ÿåº¦æ˜¯Iteratorçš„ä¸¤å€ï¼Œä¹Ÿä½¿ç”¨æ›´å°‘çš„å†…å­˜ã€‚Enumerationæ˜¯éå¸¸åŸºç¡€çš„ï¼Œä¹Ÿæ»¡è¶³äº†åŸºç¡€çš„éœ€è¦ã€‚ä½†æ˜¯ï¼Œä¸Enumerationç›¸æ¯”ï¼ŒIteratoræ›´åŠ å®‰å…¨ï¼Œå› ä¸ºå½“ä¸€ä¸ªé›†åˆæ­£åœ¨è¢«éå†çš„æ—¶å€™ï¼Œå®ƒä¼šé˜»æ­¢å…¶å®ƒçº¿ç¨‹å»ä¿®æ”¹é›†åˆã€‚Iteratorçš„æ–¹æ³•åæ¯”Enumerationæ›´ç§‘å­¦Iteratoræœ‰fail-fastæœºåˆ¶ï¼Œæ¯”Enumerationæ›´å®‰å…¨Iteratorèƒ½å¤Ÿåˆ é™¤å…ƒç´ ï¼ŒEnumerationå¹¶ä¸èƒ½åˆ é™¤å…ƒç´  Iteraterå’ŒListIteratorä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Iteratoræ¥éå†Setå’ŒListé›†åˆï¼Œè€ŒListIteratoråªèƒ½éå†Listã€‚Iteratoråªå¯ä»¥å‘å‰éå†ï¼Œè€ŒLIstIteratorå¯ä»¥åŒå‘éå†ã€‚ListIteratorä»Iteratoræ¥å£ç»§æ‰¿ï¼Œç„¶åæ·»åŠ äº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æ·»åŠ ä¸€ä¸ªå…ƒç´ ã€æ›¿æ¢ä¸€ä¸ªå…ƒç´ ã€è·å–å‰é¢æˆ–åé¢å…ƒç´ çš„ç´¢å¼•ä½ç½®ã€‚ Javaä¸­HashMapçš„keyå€¼è¦æ˜¯ä¸ºç±»å¯¹è±¡åˆ™è¯¥ç±»éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Ÿéœ€è¦åŒæ—¶é‡å†™è¯¥ç±»çš„hashCode()æ–¹æ³•å’Œå®ƒçš„equals()æ–¹æ³•ã€‚ä»æºç å¯ä»¥å¾—çŸ¥ï¼Œåœ¨æ’å…¥å…ƒç´ çš„æ—¶å€™æ˜¯å…ˆç®—å‡ºè¯¥å¯¹è±¡çš„hashCodeã€‚å¦‚æœhashcodeç›¸ç­‰è¯çš„ã€‚é‚£ä¹ˆè¡¨æ˜è¯¥å¯¹è±¡æ˜¯å­˜å‚¨åœ¨åŒä¸€ä¸ªä½ç½®ä¸Šçš„ã€‚å¦‚æœè°ƒç”¨equals()æ–¹æ³•ï¼Œä¸¤ä¸ªkeyç›¸åŒï¼Œåˆ™æ›¿æ¢å…ƒç´ å¦‚æœè°ƒç”¨equals()æ–¹æ³•ï¼Œä¸¤ä¸ªkeyä¸ç›¸åŒï¼Œåˆ™è¯´æ˜è¯¥hashCodeä»…ä»…æ˜¯ç¢°å·§ç›¸åŒï¼Œæ­¤æ—¶æ˜¯æ•£åˆ—å†²çªï¼Œå°†æ–°å¢çš„å…ƒç´ æ”¾åœ¨æ¡¶å­ä¸Šé‡å†™äº†equals()æ–¹æ³•ï¼Œå°±è¦é‡å†™hashCode()çš„æ–¹æ³•ã€‚å› ä¸ºequals()è®¤å®šäº†è¿™ä¸¤ä¸ªå¯¹è±¡ç›¸åŒï¼Œè€ŒåŒä¸€ä¸ªå¯¹è±¡è°ƒç”¨hashCode()æ–¹æ³•æ—¶ï¼Œæ˜¯åº”è¯¥è¿”å›ç›¸åŒçš„å€¼çš„ï¼ HashSetä¸HashMapHashSet å®ç°äº† Set æ¥å£ï¼Œå®ƒä¸å…è®¸é›†åˆä¸­æœ‰é‡å¤çš„å€¼ï¼Œå½“æˆ‘ä»¬æåˆ° HashSet æ—¶ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯åœ¨å°†å¯¹è±¡å­˜å‚¨åœ¨ HashSet ä¹‹å‰ï¼Œè¦å…ˆç¡®ä¿å¯¹è±¡é‡å†™ equals()å’Œ hashCode()æ–¹æ³•ï¼Œè¿™æ ·æ‰èƒ½æ¯”è¾ƒå¯¹è±¡çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œä»¥ç¡®ä¿setä¸­æ²¡æœ‰å‚¨å­˜ç›¸ç­‰çš„å¯¹è±¡ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå°†ä¼šä½¿ç”¨è¿™ä¸ªæ–¹æ³•çš„é»˜è®¤å®ç°ã€‚public boolean add(Object o)æ–¹æ³•ç”¨æ¥åœ¨ Set ä¸­æ·»åŠ å…ƒç´ ï¼Œå½“å…ƒç´ å€¼é‡å¤æ—¶åˆ™ä¼šç«‹å³è¿”å› falseï¼Œå¦‚æœæˆåŠŸæ·»åŠ çš„è¯ä¼šè¿”å› trueã€‚HashMap å®ç°äº† Map æ¥å£ï¼ŒMap æ¥å£å¯¹é”®å€¼å¯¹è¿›è¡Œæ˜ å°„ã€‚Map ä¸­ä¸å…è®¸é‡å¤çš„é”®ã€‚Map æ¥å£æœ‰ä¸¤ä¸ªåŸºæœ¬çš„å®ç°ï¼ŒHashMap å’Œ TreeMapã€‚TreeMap ä¿å­˜äº†å¯¹è±¡çš„æ’åˆ—æ¬¡åºï¼Œè€Œ HashMap åˆ™ä¸èƒ½ã€‚HashMap å…è®¸é”®å’Œå€¼ä¸º nullã€‚HashMap æ˜¯é synchronized çš„ï¼Œä½† collection æ¡†æ¶æä¾›æ–¹æ³•èƒ½ä¿è¯ HashMap synchronizedï¼Œè¿™æ ·å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—® HashMap æ—¶ï¼Œèƒ½ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ›´æ”¹ Mapã€‚public Object put(Object Key,Object value)æ–¹æ³•ç”¨æ¥å°†å…ƒç´ æ·»åŠ åˆ° map ä¸­ã€‚ HashMap HashSet HashMapå®ç°äº†Mapæ¥å£ HashSetå®ç°äº†Setæ¥å£ HashMapå‚¨å­˜é”®å€¼å¯¹ HashSetä»…ä»…å­˜å‚¨å¯¹è±¡ ä½¿ç”¨put()æ–¹æ³•å°†å…ƒç´ æ”¾å…¥mapä¸­ ä½¿ç”¨add()æ–¹æ³•å°†å…ƒç´ æ”¾å…¥setä¸­ HashMapä¸­ä½¿ç”¨é”®å¯¹è±¡æ¥è®¡ç®—hashcodeå€¼ HashSetä½¿ç”¨æˆå‘˜å¯¹è±¡æ¥è®¡ç®—hashcodeå€¼ï¼Œå¯¹äºä¸¤ä¸ªå¯¹è±¡æ¥è¯´hashcodeå¯èƒ½ç›¸åŒï¼Œæ‰€ä»¥equals()æ–¹æ³•ç”¨æ¥åˆ¤æ–­å¯¹è±¡çš„ç›¸ç­‰æ€§ï¼Œå¦‚æœä¸¤ä¸ªå¯¹è±¡ä¸åŒçš„è¯ï¼Œé‚£ä¹ˆè¿”å›false hashtableä¸hashmapç›¸åŒç‚¹ï¼šå‚¨å­˜ç»“æ„å’Œå®ç°åŸºæœ¬ç›¸åŒï¼Œéƒ½æ˜¯æ˜¯å®ç°çš„Mapæ¥å£ä¸åŒç‚¹ï¼šHashTableæ˜¯åŒæ­¥çš„ï¼ŒHashMapæ˜¯éåŒæ­¥çš„ï¼Œéœ€è¦åŒæ­¥çš„æ—¶å€™å¯ä»¥ConcurrentHashMapæ–¹æ³•HashMapå…è®¸ä¸ºnullï¼ŒHashTableä¸å…è®¸ä¸ºnullç»§æ‰¿ä¸åŒï¼ŒHashMapç»§æ‰¿çš„æ˜¯AbstractMapï¼ŒHashTableç»§æ‰¿çš„æ˜¯DictionaryHashMapæä¾›å¯¹keyçš„Setè¿›è¡Œéå†ï¼Œå› æ­¤å®ƒæ˜¯fail-fastçš„ï¼Œä½†HashTableæä¾›å¯¹keyçš„Enumerationè¿›è¡Œéå†ï¼Œå®ƒä¸æ”¯æŒfail-fastã€‚HashTableæ˜¯ä¸€ä¸ªé—ç•™ç±»ï¼Œå¦‚æœéœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨æ¨èä½¿ç”¨CocurrentHashMap HashMapä¸TreeMapHashMapé€šè¿‡hashcodeå¯¹å…¶å†…å®¹è¿›è¡Œå¿«é€ŸæŸ¥æ‰¾ï¼Œè€ŒTreeMapä¸­æ‰€æœ‰çš„å…ƒç´ éƒ½ä¿æŒç€æŸç§å›ºå®šçš„é¡ºåºï¼Œå¦‚æœä½ éœ€è¦å¾—åˆ°ä¸€ä¸ªæœ‰åºçš„ç»“æœä½ å°±åº”è¯¥ä½¿ç”¨TreeMapï¼ˆHashMapä¸­å…ƒç´ çš„æ’åˆ—é¡ºåºæ˜¯ä¸å›ºå®šçš„ï¼‰ã€‚HashMapä¸­å…ƒç´ çš„æ’åˆ—é¡ºåºæ˜¯ä¸å›ºå®šçš„ï¼‰ã€‚åœ¨Map ä¸­æ’å…¥ã€åˆ é™¤å’Œå®šä½å…ƒç´ ï¼ŒHashMap æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚ä½†å¦‚æœæ‚¨è¦æŒ‰è‡ªç„¶é¡ºåºæˆ–è‡ªå®šä¹‰é¡ºåºéå†é”®ï¼Œé‚£ä¹ˆTreeMapä¼šæ›´å¥½ã€‚ä½¿ç”¨HashMapè¦æ±‚æ·»åŠ çš„é”®ç±»æ˜ç¡®å®šä¹‰äº†hashCode()å’Œ equals()çš„å®ç°ã€‚ è¿™ä¸ªTreeMapæ²¡æœ‰è°ƒä¼˜é€‰é¡¹ï¼Œå› ä¸ºè¯¥æ ‘æ€»å¤„äºå¹³è¡¡çŠ¶æ€ã€‚ é›†åˆæ¡†æ¶ä¸­çš„æ³›å‹æœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼ŸJava1.5å¼•å…¥äº†æ³›å‹ï¼Œæ‰€æœ‰çš„é›†åˆæ¥å£å’Œå®ç°éƒ½å¤§é‡åœ°ä½¿ç”¨å®ƒã€‚æ³›å‹å…è®¸æˆ‘ä»¬ä¸ºé›†åˆæä¾›ä¸€ä¸ªå¯ä»¥å®¹çº³çš„å¯¹è±¡ç±»å‹ï¼Œå› æ­¤ï¼Œå¦‚æœä½ æ·»åŠ å…¶å®ƒç±»å‹çš„ä»»ä½•å…ƒç´ ï¼Œå®ƒä¼šåœ¨ç¼–è¯‘æ—¶æŠ¥é”™ã€‚è¿™é¿å…äº†åœ¨è¿è¡Œæ—¶å‡ºç°ClassCastExceptionï¼Œå› ä¸ºä½ å°†ä¼šåœ¨ç¼–è¯‘æ—¶å¾—åˆ°æŠ¥é”™ä¿¡æ¯ã€‚æ³›å‹ä¹Ÿä½¿å¾—ä»£ç æ•´æ´ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨æ˜¾å¼è½¬æ¢å’ŒinstanceOfæ“ä½œç¬¦ã€‚å®ƒä¹Ÿç»™è¿è¡Œæ—¶å¸¦æ¥å¥½å¤„ï¼Œå› ä¸ºä¸ä¼šäº§ç”Ÿç±»å‹æ£€æŸ¥çš„å­—èŠ‚ç æŒ‡ä»¤ã€‚ comparable å’Œ comparatorçš„ä¸åŒä¹‹å¤„ï¼Ÿcomparableæ¥å£å®é™…ä¸Šæ˜¯å‡ºè‡ªjava.langåŒ…å®ƒæœ‰ä¸€ä¸ª compareTo(Object obj)æ–¹æ³•æ¥å°†objectsæ’åºcomparatoræ¥å£å®é™…ä¸Šæ˜¯å‡ºè‡ª java.util åŒ…å®ƒæœ‰ä¸€ä¸ªcompare(Object obj1, Object obj2)æ–¹æ³•æ¥å°†objectsæ’åº å¦‚ä½•ä¿è¯ä¸€ä¸ªé›†åˆçº¿ç¨‹å®‰å…¨ï¼ŸVector, Hashtable, Properties å’Œ Stack éƒ½æ˜¯åŒæ­¥çš„ç±»ï¼Œæ‰€ä»¥å®ƒä»¬éƒ½çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥è¢«ä½¿ç”¨åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨Collections.synchronizedList(list)) æ–¹æ³•ï¼Œå¯ä»¥ä¿è¯listç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ä½¿ç”¨java.util.Collections.synchronizedSet()æ–¹æ³•å¯ä»¥ä¿è¯setç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ TreeMapå’ŒTreeSetåœ¨æ’åºæ—¶å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼ŸCollectionså·¥å…·ç±»ä¸­çš„sort()æ–¹æ³•å¦‚ä½•æ¯”è¾ƒå…ƒç´ ï¼ŸTreeSetè¦æ±‚å­˜æ”¾çš„å¯¹è±¡æ‰€å±çš„ç±»å¿…é¡»å®ç°Comparableæ¥å£ï¼Œè¯¥æ¥å£æä¾›äº†æ¯”è¾ƒå…ƒç´ çš„compareTo()æ–¹æ³•ï¼Œå½“æ’å…¥å…ƒç´ æ—¶ä¼šå›è°ƒè¯¥æ–¹æ³•æ¯”è¾ƒå…ƒç´ çš„å¤§å°ã€‚TreeMapè¦æ±‚å­˜æ”¾çš„é”®å€¼å¯¹æ˜ å°„çš„é”®å¿…é¡»å®ç°Comparableæ¥å£ä»è€Œæ ¹æ®é”®å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚Collectionså·¥å…·ç±»çš„sortæ–¹æ³•æœ‰ä¸¤ç§é‡è½½çš„å½¢å¼ï¼Œç¬¬ä¸€ç§è¦æ±‚ä¼ å…¥çš„å¾…æ’åºå®¹å™¨ä¸­å­˜æ”¾çš„å¯¹è±¡æ¯”è¾ƒå®ç°Comparableæ¥å£ä»¥å®ç°å…ƒç´ çš„æ¯”è¾ƒï¼›ç¬¬äºŒç§ä¸å¼ºåˆ¶æ€§çš„è¦æ±‚å®¹å™¨ä¸­çš„å…ƒç´ å¿…é¡»å¯æ¯”è¾ƒï¼Œä½†æ˜¯è¦æ±‚ä¼ å…¥ç¬¬äºŒä¸ªå‚æ•°ï¼Œå‚æ•°æ˜¯Comparatoræ¥å£çš„å­ç±»å‹ï¼ˆéœ€è¦é‡å†™compareæ–¹æ³•å®ç°å…ƒç´ çš„æ¯”è¾ƒï¼‰ï¼Œç›¸å½“äºä¸€ä¸ªä¸´æ—¶å®šä¹‰çš„æ’åºè§„åˆ™ï¼Œå…¶å®å°±æ˜¯é€šè¿‡æ¥å£æ³¨å…¥æ¯”è¾ƒå…ƒç´ å¤§å°çš„ç®—æ³•ï¼Œä¹Ÿæ˜¯å¯¹å›è°ƒæ¨¡å¼çš„åº”ç”¨ï¼ˆJavaä¸­å¯¹å‡½æ•°å¼ç¼–ç¨‹çš„æ”¯æŒï¼‰ã€‚ ä»€ä¹ˆæ˜¯Javaä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ŸJava PriorityQueueæ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå®ƒæ˜¯Javaé›†åˆæ¡†æ¶çš„ä¸€éƒ¨åˆ†ã€‚ å®ƒæ˜¯ä¸€ä¸ªé˜Ÿåˆ—çš„å®ç°ï¼Œå…¶ä¸­å…ƒç´ çš„é¡ºåºå°†æ ¹æ®æ¯ä¸ªå…ƒç´ çš„ä¼˜å…ˆçº§æ¥å†³å®šã€‚ å®ä¾‹åŒ–PriorityQueueæ—¶ï¼Œå¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­æä¾›æ¯”è¾ƒå™¨ã€‚ è¯¥æ¯”è¾ƒå™¨å°†å†³å®šPriorityQueueé›†åˆå®ä¾‹ä¸­å…ƒç´ çš„æ’åºé¡ºåºã€‚ Java hashCodeï¼ˆï¼‰å’Œequalsï¼ˆï¼‰æ–¹æ³•ã€‚equalsï¼ˆï¼‰æ–¹æ³•ç”¨äºç¡®å®šä¸¤ä¸ªJavaå¯¹è±¡çš„ç›¸ç­‰æ€§ã€‚ å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªè‡ªå®šä¹‰ç±»æ—¶ï¼Œæˆ‘ä»¬éœ€è¦é‡å†™equalsï¼ˆï¼‰æ–¹æ³•å¹¶æä¾›ä¸€ä¸ªå®ç°ï¼Œä»¥ä¾¿å®ƒå¯ä»¥ç”¨æ¥æ‰¾åˆ°å®ƒçš„ä¸¤ä¸ªå®ä¾‹ä¹‹é—´çš„ç›¸ç­‰æ€§ã€‚ é€šè¿‡Javaè§„èŒƒï¼Œequalsï¼ˆï¼‰å’ŒhashCodeï¼ˆï¼‰ä¹‹é—´æœ‰ä¸€ä¸ªå¥‘çº¦ã€‚ å®ƒè¯´ï¼Œâ€œå¦‚æœä¸¤ä¸ªå¯¹è±¡ç›¸ç­‰ï¼Œå³obj1.equalsï¼ˆobj2ï¼‰ä¸ºtrueï¼Œé‚£ä¹ˆobj1.hashCodeï¼ˆï¼‰å’Œobj2.hashCodeï¼ˆï¼‰å¿…é¡»è¿”å›ç›¸åŒçš„æ•´æ•°â€æ— è®ºä½•æ—¶æˆ‘ä»¬é€‰æ‹©é‡å†™equalsï¼ˆï¼‰ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»é‡å†™hashCodeï¼ˆï¼‰æ–¹æ³•ã€‚ hashCodeï¼ˆï¼‰ç”¨äºè®¡ç®—ä½ç½®å­˜å‚¨åŒºå’Œkeyã€‚ Enumerationå’ŒIteratoråŒºåˆ«å‡½æ•°æ¥å£ä¸åŒ Enumerationåªæœ‰2ä¸ªå‡½æ•°æ¥å£ã€‚é€šè¿‡Enumerationï¼Œæˆ‘ä»¬åªèƒ½è¯»å–é›†åˆçš„æ•°æ®ï¼Œè€Œä¸èƒ½å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ã€‚ Iteratoråªæœ‰3ä¸ªå‡½æ•°æ¥å£ã€‚Iteratoré™¤äº†èƒ½è¯»å–é›†åˆçš„æ•°æ®ä¹‹å¤–ï¼Œä¹Ÿèƒ½æ•°æ®è¿›è¡Œåˆ é™¤æ“ä½œã€‚ Iteratoræ”¯æŒfail-fastæœºåˆ¶ï¼Œè€ŒEnumerationä¸æ”¯æŒã€‚ Enumeration æ˜¯JDK 1.0æ·»åŠ çš„æ¥å£ã€‚ä½¿ç”¨åˆ°å®ƒçš„å‡½æ•°åŒ…æ‹¬Vectorã€Hashtableç­‰ç±»ï¼Œè¿™äº›ç±»éƒ½æ˜¯JDK 1.0ä¸­åŠ å…¥çš„ï¼ŒEnumerationå­˜åœ¨çš„ç›®çš„å°±æ˜¯ä¸ºå®ƒä»¬æä¾›éå†æ¥å£ã€‚Enumerationæœ¬èº«å¹¶æ²¡æœ‰æ”¯æŒåŒæ­¥ï¼Œè€Œåœ¨Vectorã€Hashtableå®ç°Enumerationæ—¶ï¼Œæ·»åŠ äº†åŒæ­¥ã€‚ è€ŒIterator æ˜¯JDK 1.2æ‰æ·»åŠ çš„æ¥å£ï¼Œå®ƒä¹Ÿæ˜¯ä¸ºäº†HashMapã€ArrayListç­‰é›†åˆæä¾›éå†æ¥å£ã€‚Iteratoræ˜¯æ”¯æŒfail-fastæœºåˆ¶çš„ï¼šå½“å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªé›†åˆçš„å†…å®¹è¿›è¡Œæ“ä½œæ—¶ï¼Œå°±å¯èƒ½ä¼šäº§ç”Ÿfail-fastäº‹ä»¶ã€‚ æ³¨æ„ï¼šEnumerationè¿­ä»£å™¨åªèƒ½éå†Vectorã€Hashtableè¿™ç§å¤è€çš„é›†åˆï¼Œå› æ­¤é€šå¸¸ä¸è¦ä½¿ç”¨å®ƒï¼Œé™¤éåœ¨æŸäº›æç«¯æƒ…å†µä¸‹ï¼Œä¸å¾—ä¸ä½¿ç”¨Enumerationï¼Œå¦åˆ™éƒ½åº”è¯¥é€‰æ‹©Iteratorè¿­ä»£å™¨ã€‚ HashMap å’Œ ConcurrentHashMap çš„åŒºåˆ«ï¼ŸConcurrentHashMapå’ŒHashMapçš„å®ç°æ–¹å¼ä¸ä¸€æ ·ï¼Œè™½ç„¶éƒ½æ˜¯ä½¿ç”¨æ¡¶æ•°ç»„å®ç°çš„ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰åŒºåˆ«ï¼ŒConcurrentHashMapå¯¹æ¡¶æ•°ç»„è¿›è¡Œäº†åˆ†æ®µï¼Œè€ŒHashMapå¹¶æ²¡æœ‰ã€‚ ConcurrentHashMapåœ¨æ¯ä¸€ä¸ªåˆ†æ®µä¸Šéƒ½ç”¨é”è¿›è¡Œäº†ä¿æŠ¤ã€‚HashMapæ²¡æœ‰é”æœºåˆ¶ã€‚æ‰€ä»¥ï¼Œå‰è€…çº¿ç¨‹å®‰å…¨çš„ï¼Œåè€…ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ HashMapä¸­hashæ–¹æ³•çš„åŸç†https://hollischuang.github.io/toBeTopJavaer/#/basics/java-basic/hash-in-hashmap ä¸ºä»€ä¹ˆHashMapçš„é»˜è®¤å®¹é‡è®¾ç½®æˆ16https://hollischuang.github.io/toBeTopJavaer/#/basics/java-basic/hashmap-default-capacity ä¸ºä»€ä¹ˆHashMapçš„é»˜è®¤è´Ÿè½½å› å­è®¾ç½®æˆ0.75https://hollischuang.github.io/toBeTopJavaer/#/basics/java-basic/hashmap-default-loadfactor Java 8ä¸­streamç›¸å…³ç”¨æ³•https://hollischuang.github.io/toBeTopJavaer/#/basics/java-basic/stream Apacheé›†åˆå¤„ç†å·¥å…·ç±»çš„ä½¿ç”¨https://hollischuang.github.io/toBeTopJavaer/#/basics/java-basic/apache-collections","categories":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://gyl-coder.top/tags/%E9%9B%86%E5%90%88/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"LinkedHashMap åº•å±‚å®ç°åŸç†åˆ†æ","slug":"java/collection/LinkedHashMap","date":"2020-07-05T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"java/collection/LinkedHashMap/","link":"","permalink":"https://gyl-coder.top/java/collection/LinkedHashMap/","excerpt":"LinkedHashMapç»§æ‰¿è‡ªHashMapå®ç°äº†Mapæ¥å£ã€‚åŸºæœ¬å®ç°åŒHashMapä¸€æ ·ï¼Œä¸åŒä¹‹å¤„åœ¨äºLinkedHashMapä¿è¯äº†è¿­ä»£çš„æœ‰åºæ€§ã€‚å…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œè§£å†³äº† HashMapä¸èƒ½éšæ—¶ä¿æŒéå†é¡ºåºå’Œæ’å…¥é¡ºåºä¸€è‡´çš„é—®é¢˜ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒLinkedHashMapå¯¹è®¿é—®é¡ºåºä¹Ÿæä¾›äº†ç›¸å…³æ”¯æŒã€‚åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œè¯¥ç‰¹æ€§å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ç¼“å­˜ã€‚ åœ¨å®ç°ä¸Šï¼ŒLinkedHashMapå¾ˆå¤šæ–¹æ³•ç›´æ¥ç»§æ‰¿è‡ªHashMapï¼Œä»…ä¸ºç»´æŠ¤åŒå‘é“¾è¡¨è¦†å†™äº†éƒ¨åˆ†æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œè¦çœ‹æ‡‚ LinkedHashMap çš„æºç ï¼Œéœ€è¦å…ˆçœ‹æ‡‚ HashMap çš„æºç ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒLinkedHashMapçš„è¿­ä»£é¡ºåºæ˜¯æŒ‰ç…§æ’å…¥èŠ‚ç‚¹çš„é¡ºåºã€‚ä¹Ÿå¯ä»¥é€šè¿‡æ”¹å˜accessOrderå‚æ•°çš„å€¼ï¼Œä½¿å¾—å…¶éå†é¡ºåºæŒ‰ç…§è®¿é—®é¡ºåºè¾“å‡ºã€‚ è¿™é‡Œæˆ‘ä»¬åªè®¨è®ºLinkedHashMapå’ŒHashMapçš„ä¸åŒä¹‹å¤„ï¼ŒLinkedHashMapçš„å…¶ä»–æ“ä½œå’Œç‰¹æ€§å…·ä½“è¯·å‚è€ƒHashMap æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ä¸¤è€…çš„åŒºåˆ«ï¼š","text":"LinkedHashMapç»§æ‰¿è‡ªHashMapå®ç°äº†Mapæ¥å£ã€‚åŸºæœ¬å®ç°åŒHashMapä¸€æ ·ï¼Œä¸åŒä¹‹å¤„åœ¨äºLinkedHashMapä¿è¯äº†è¿­ä»£çš„æœ‰åºæ€§ã€‚å…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œè§£å†³äº† HashMapä¸èƒ½éšæ—¶ä¿æŒéå†é¡ºåºå’Œæ’å…¥é¡ºåºä¸€è‡´çš„é—®é¢˜ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒLinkedHashMapå¯¹è®¿é—®é¡ºåºä¹Ÿæä¾›äº†ç›¸å…³æ”¯æŒã€‚åœ¨ä¸€äº›åœºæ™¯ä¸‹ï¼Œè¯¥ç‰¹æ€§å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚ç¼“å­˜ã€‚ åœ¨å®ç°ä¸Šï¼ŒLinkedHashMapå¾ˆå¤šæ–¹æ³•ç›´æ¥ç»§æ‰¿è‡ªHashMapï¼Œä»…ä¸ºç»´æŠ¤åŒå‘é“¾è¡¨è¦†å†™äº†éƒ¨åˆ†æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œè¦çœ‹æ‡‚ LinkedHashMap çš„æºç ï¼Œéœ€è¦å…ˆçœ‹æ‡‚ HashMap çš„æºç ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒLinkedHashMapçš„è¿­ä»£é¡ºåºæ˜¯æŒ‰ç…§æ’å…¥èŠ‚ç‚¹çš„é¡ºåºã€‚ä¹Ÿå¯ä»¥é€šè¿‡æ”¹å˜accessOrderå‚æ•°çš„å€¼ï¼Œä½¿å¾—å…¶éå†é¡ºåºæŒ‰ç…§è®¿é—®é¡ºåºè¾“å‡ºã€‚ è¿™é‡Œæˆ‘ä»¬åªè®¨è®ºLinkedHashMapå’ŒHashMapçš„ä¸åŒä¹‹å¤„ï¼ŒLinkedHashMapçš„å…¶ä»–æ“ä½œå’Œç‰¹æ€§å…·ä½“è¯·å‚è€ƒHashMap æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ä¸¤è€…çš„åŒºåˆ«ï¼š import java.util.HashMap; import java.util.Iterator; import java.util.LinkedHashMap; import java.util.Map; public class Test04 &#123; public static void main(String[] args) &#123; Map&lt;String, String&gt; map = new LinkedHashMap&lt;String, String&gt;(); map.put(&quot;ahdjkf&quot;, &quot;1&quot;); map.put(&quot;ifjdj&quot;, &quot;2&quot;); map.put(&quot;giafdja&quot;, &quot;3&quot;); map.put(&quot;agad&quot;, &quot;4&quot;); map.put(&quot;ahdjkge&quot;, &quot;5&quot;); map.put(&quot;iegnj&quot;, &quot;6&quot;); System.out.println(&quot;LinkedHashMapçš„è¿­ä»£é¡ºåº(accessOrder=false)ï¼š&quot;); Iterator iterator = map.entrySet().iterator(); while (iterator.hasNext()) &#123; Map.Entry entry = (Map.Entry) iterator.next(); System.out.println(entry.getKey() + &quot;=&quot; + entry.getValue()); &#125; Map&lt;String, String&gt; map1 = new LinkedHashMap&lt;String, String&gt;(16,0.75f,true); map1.put(&quot;ahdjkf&quot;, &quot;1&quot;); map1.put(&quot;ifjdj&quot;, &quot;2&quot;); map1.put(&quot;giafdja&quot;, &quot;3&quot;); map1.put(&quot;agad&quot;, &quot;4&quot;); map1.put(&quot;ahdjkge&quot;, &quot;5&quot;); map1.put(&quot;iegnj&quot;, &quot;6&quot;); map1.get(&quot;ahdjkf&quot;); map1.get(&quot;ifjdj&quot;); System.out.println(&quot;LinkedHashMapçš„è¿­ä»£é¡ºåº(accessOrder=true)ï¼š&quot;); Iterator iterator1 = map1.entrySet().iterator(); while (iterator1.hasNext()) &#123; Map.Entry entry = (Map.Entry) iterator1.next(); System.out.println(entry.getKey() + &quot;=&quot; + entry.getValue()); &#125; Map&lt;String, String&gt; map2 = new HashMap&lt;&gt;(); map2.put(&quot;ahdjkf&quot;, &quot;1&quot;); map2.put(&quot;ifjdj&quot;, &quot;2&quot;); map2.put(&quot;giafdja&quot;, &quot;3&quot;); map2.put(&quot;agad&quot;, &quot;4&quot;); map2.put(&quot;ahdjkge&quot;, &quot;5&quot;); map2.put(&quot;iegnj&quot;, &quot;6&quot;); System.out.println(&quot;HashMapçš„è¿­ä»£é¡ºåºï¼š&quot;); Iterator iterator2 = map2.entrySet().iterator(); while (iterator2.hasNext()) &#123; Map.Entry aMap = (Map.Entry) iterator2.next(); System.out.println(aMap.getKey() + &quot;=&quot; + aMap.getValue()); &#125; &#125; &#125; Outputï¼š LinkedHashMapçš„è¿­ä»£é¡ºåº(accessOrder=false)ï¼š ahdjkf=1 ifjdj=2 giafdja=3 agad=4 ahdjkge=5 iegnj=6 LinkedHashMapçš„è¿­ä»£é¡ºåº(accessOrder=true)ï¼š giafdja=3 agad=4 ahdjkge=5 iegnj=6 ahdjkf=1 ifjdj=2 HashMapçš„è¿­ä»£é¡ºåºï¼š iegnj=6 giafdja=3 ifjdj=2 agad=4 ahdjkf=1 ahdjkge=5 å¯ä»¥çœ‹åˆ° LinkedHashMapåœ¨æ¯æ¬¡æ’å…¥æ•°æ®ï¼Œè®¿é—®ã€ä¿®æ”¹æ•°æ®æ—¶éƒ½ä¼šè°ƒæ•´é“¾è¡¨çš„èŠ‚ç‚¹é¡ºåºã€‚ä»¥å†³å®šè¿­ä»£æ—¶è¾“å‡ºçš„é¡ºåºã€‚ ä¸‹é¢æˆ‘ä»¬æ¥çœ‹LinkedHashMapå…·ä½“æ˜¯æ€ä¹ˆå®ç°çš„ï¼š LinkedHashMapç»§æ‰¿äº†HashMapï¼Œå†…éƒ¨é™æ€ç±»Entryç»§æ‰¿äº†HashMapçš„Entryï¼Œä½†æ˜¯LinkedHashMap.Entryå¤šäº†ä¸¤ä¸ªå­—æ®µï¼šbeforeå’Œafterï¼Œbeforeè¡¨ç¤ºåœ¨æœ¬èŠ‚ç‚¹ä¹‹å‰æ·»åŠ åˆ°LinkedHashMapçš„é‚£ä¸ªèŠ‚ç‚¹ï¼Œafterè¡¨ç¤ºåœ¨æœ¬èŠ‚ç‚¹ä¹‹åæ·»åŠ åˆ°LinkedHashMapçš„é‚£ä¸ªèŠ‚ç‚¹ï¼Œè¿™é‡Œçš„ä¹‹å‰å’Œä¹‹åæŒ‡æ—¶é—´ä¸Šçš„å…ˆåé¡ºåºã€‚ static class Entry&lt;K,V&gt; extends HashMap.Node&lt;K,V&gt; &#123; Entry&lt;K,V&gt; before, after; Entry(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; super(hash, key, value, next); &#125; &#125; åŒæ—¶ç±»é‡Œæœ‰ä¸¤ä¸ªæˆå‘˜å˜é‡headå’Œtail,åˆ†åˆ«æŒ‡å‘å†…éƒ¨åŒå‘é“¾è¡¨çš„è¡¨å¤´ã€è¡¨å°¾ã€‚ //åŒå‘é“¾è¡¨çš„å¤´ç»“ç‚¹ transient LinkedHashMap.Entry&lt;K,V&gt; head; //åŒå‘é“¾è¡¨çš„å°¾èŠ‚ç‚¹ transient LinkedHashMap.Entry&lt;K,V&gt; tail; æˆ‘ä»¬é€šè¿‡ä¸¤å¼ å›¾æ¥çœ‹ä¸‹LinkedHashMapçš„å­˜å‚¨ç»“æ„ å›¾ç‰‡æ¥è‡ªï¼šcoolblog å°†LinkedHashMapçš„accessOrderå­—æ®µè®¾ç½®ä¸ºtrueåï¼Œæ¯æ¬¡è®¿é—®å“ˆå¸Œè¡¨ä¸­çš„èŠ‚ç‚¹éƒ½å°†è¯¥èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨çš„æœ«å°¾ï¼Œè¡¨ç¤ºè¯¥èŠ‚ç‚¹æ˜¯æœ€æ–°è®¿é—®çš„èŠ‚ç‚¹ã€‚å³å¾ªç¯åŒå‘é“¾è¡¨çš„å¤´éƒ¨å­˜æ”¾çš„æ˜¯æœ€ä¹…è®¿é—®çš„èŠ‚ç‚¹æˆ–æœ€å…ˆæ’å…¥çš„èŠ‚ç‚¹ï¼Œå°¾éƒ¨ä¸ºæœ€è¿‘è®¿é—®çš„æˆ–æœ€è¿‘æ’å…¥çš„èŠ‚ç‚¹ã€‚ ç”±äºå¢åŠ äº†ä¸€ä¸ªaccessOrderå±æ€§ï¼ŒLinkedHashMapç›¸å¯¹HashMapæ¥è¯´å¢åŠ äº†ä¸€ä¸ªæ„é€ æ–¹æ³•ç”¨æ¥æ§åˆ¶è¿­ä»£é¡ºåºã€‚ final boolean accessOrder; public LinkedHashMap() &#123; super(); accessOrder = false; &#125; //æŒ‡å®šåˆå§‹åŒ–æ—¶çš„å®¹é‡ï¼Œ public LinkedHashMap(int initialCapacity) &#123; super(initialCapacity); accessOrder = false; &#125; //æŒ‡å®šåˆå§‹åŒ–æ—¶çš„å®¹é‡ï¼Œå’Œæ‰©å®¹çš„åŠ è½½å› å­ public LinkedHashMap(int initialCapacity, float loadFactor) &#123; super(initialCapacity, loadFactor); accessOrder = false; &#125; //æŒ‡å®šåˆå§‹åŒ–æ—¶çš„å®¹é‡ï¼Œå’Œæ‰©å®¹çš„åŠ è½½å› å­ï¼Œä»¥åŠè¿­ä»£è¾“å‡ºèŠ‚ç‚¹çš„é¡ºåº public LinkedHashMap(int initialCapacity, float loadFactor, boolean accessOrder) &#123; super(initialCapacity, loadFactor); this.accessOrder = accessOrder; &#125; //åˆ©ç”¨å¦ä¸€ä¸ªMap æ¥æ„å»º public LinkedHashMap(Map&lt;? extends K, ? extends V&gt; m) &#123; super(); accessOrder = false; //è¯¥æ–¹æ³•ä¸Šæ–‡åˆ†æè¿‡ï¼Œæ‰¹é‡æ’å…¥ä¸€ä¸ªmapä¸­çš„æ‰€æœ‰æ•°æ®åˆ° æœ¬é›†åˆä¸­ã€‚ putMapEntries(m, false); &#125; æ·»åŠ å…ƒç´ LinkedHashMapåœ¨æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œä¾æ—§ä½¿ç”¨çš„æ˜¯HashMapä¸­çš„putæ–¹æ³•ã€‚ä¸åŒçš„æ˜¯LinkedHashMapé‡å†™äº†newNode()æ–¹æ³•åœ¨æ¯æ¬¡æ„å»ºæ–°èŠ‚ç‚¹æ—¶ï¼Œé€šè¿‡linkNodeLast(p);å°†æ–°èŠ‚ç‚¹é“¾æ¥åœ¨å†…éƒ¨åŒå‘é“¾è¡¨çš„å°¾éƒ¨ã€‚ //å°†æ–°å¢çš„èŠ‚ç‚¹ï¼Œè¿æ¥åœ¨é“¾è¡¨çš„å°¾éƒ¨ private void linkNodeLast(LinkedHashMap.Entry&lt;K,V&gt; p) &#123; LinkedHashMap.Entry&lt;K,V&gt; last = tail; tail = p; //å¦‚æœé›†åˆä¹‹å‰æ˜¯ç©ºçš„ if (last == null) head = p; else &#123;//å°†æ–°èŠ‚ç‚¹è¿æ¥åœ¨é“¾è¡¨çš„å°¾éƒ¨ p.before = last; last.after = p; &#125; &#125; åˆ é™¤å…ƒç´ LinkedHashMapå¹¶æ²¡æœ‰é‡å†™HashMapçš„remove()æ–¹æ³•ï¼Œä½†æ˜¯ä»–é‡å†™äº†afterNodeRemoval()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯åœ¨åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼ŒåŒæ­¥å°†è¯¥èŠ‚ç‚¹ä»åŒå‘é“¾è¡¨ä¸­åˆ é™¤ã€‚è¯¥æ–¹æ³•å°†ä¼šåœ¨removeä¸­è¢«å›è°ƒã€‚ //åœ¨åˆ é™¤èŠ‚ç‚¹eæ—¶ï¼ŒåŒæ­¥å°†eä»åŒå‘é“¾è¡¨ä¸Šåˆ é™¤ void afterNodeRemoval(Node&lt;K,V&gt; e) &#123; // unlink LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; //å°†å¾…åˆ é™¤èŠ‚ç‚¹ p çš„å‰ç½®åç½®èŠ‚ç‚¹éƒ½ç½®ç©º p.before = p.after = null; //å¦‚æœå‰ç½®èŠ‚ç‚¹æ˜¯nullï¼Œåˆ™è¯´æ˜ç°åœ¨çš„å¤´ç»“ç‚¹åº”è¯¥æ˜¯åç½®èŠ‚ç‚¹a if (b == null) head = a; else//å¦åˆ™å°†å‰ç½®èŠ‚ç‚¹bçš„åç½®èŠ‚ç‚¹æŒ‡å‘a b.after = a; //åŒç†å¦‚æœåç½®èŠ‚ç‚¹æ—¶null ï¼Œåˆ™å°¾èŠ‚ç‚¹åº”æ˜¯b if (a == null) tail = b; else//å¦åˆ™æ›´æ–°åç½®èŠ‚ç‚¹açš„å‰ç½®èŠ‚ç‚¹ä¸ºb a.before = b; &#125; åˆ é™¤è¿‡ç¨‹æ€»çš„æ¥è¯´å¯ä»¥åˆ†ä¸ºä¸‰æ­¥ï¼š æ ¹æ® hash å®šä½åˆ°æ¡¶ä½ç½® éå†é“¾è¡¨æˆ–è°ƒç”¨çº¢é»‘æ ‘ç›¸å…³çš„åˆ é™¤æ–¹æ³• å›è°ƒafterNodeRemovalï¼Œä» LinkedHashMap ç»´æŠ¤çš„åŒé“¾è¡¨ä¸­ç§»é™¤è¦åˆ é™¤çš„èŠ‚ç‚¹ æ›´æ–°å…ƒç´ // æ¸…é™¤èŠ‚ç‚¹æ—¶è¦å°†å¤´å°¾èŠ‚ç‚¹ä¸€èµ·æ¸…é™¤ public void clear() &#123; super.clear(); head = tail = null; &#125; æŸ¥æ‰¾å…ƒç´ LinkedHashMapé‡å†™äº†get()å’ŒgetOrDefault()æ–¹æ³•é»˜è®¤æƒ…å†µä¸‹ï¼ŒLinkedHashMapæ˜¯æŒ‰æ’å…¥é¡ºåºç»´æŠ¤é“¾è¡¨ã€‚ä¸è¿‡å¦‚æœæˆ‘ä»¬åœ¨åˆå§‹åŒ– LinkedHashMapæ—¶ï¼ŒæŒ‡å®š accessOrderå‚æ•°ä¸º trueï¼Œå³å¯è®©å®ƒæŒ‰è®¿é—®é¡ºåºç»´æŠ¤é“¾è¡¨ã€‚è®¿é—®é¡ºåºçš„åŸç†æ˜¯ï¼Œå½“æˆ‘ä»¬è°ƒç”¨get/getOrDefault/replaceç­‰æ–¹æ³•æ—¶ï¼Œä¼šå°†è¿™äº›æ–¹æ³•è®¿é—®çš„èŠ‚ç‚¹ç§»åŠ¨åˆ°é“¾è¡¨çš„å°¾éƒ¨ã€‚ public V get(Object key) &#123; Node&lt;K,V&gt; e; if ((e = getNode(hash(key), key)) == null) return null; if (accessOrder) // å›è°ƒafterNodeAccess(Node&lt;K,V&gt; e) afterNodeAccess(e); // å°†èŠ‚ç‚¹eç§»è‡³åŒå‘é“¾è¡¨çš„å°¾éƒ¨ï¼ˆä¿è¯è¿­ä»£é¡ºåºï¼‰ return e.value; &#125; public V getOrDefault(Object key, V defaultValue) &#123; Node&lt;K,V&gt; e; if ((e = getNode(hash(key), key)) == null) return defaultValue; if (accessOrder) afterNodeAccess(e); // ä½œç”¨åŒä¸Š return e.value; &#125; void afterNodeAccess(Node&lt;K,V&gt; e) &#123; // move node to last LinkedHashMap.Entry&lt;K,V&gt; last;//åŸå°¾èŠ‚ç‚¹ //å¦‚æœaccessOrder æ˜¯true ï¼Œä¸”åŸå°¾èŠ‚ç‚¹ä¸ç­‰äºe if (accessOrder &amp;&amp; (last = tail) != e) &#123; //èŠ‚ç‚¹eå¼ºè½¬æˆåŒå‘é“¾è¡¨èŠ‚ç‚¹p LinkedHashMap.Entry&lt;K,V&gt; p = (LinkedHashMap.Entry&lt;K,V&gt;)e, b = p.before, a = p.after; //pç°åœ¨æ˜¯å°¾èŠ‚ç‚¹ï¼Œ åç½®èŠ‚ç‚¹ä¸€å®šæ˜¯null p.after = null; //å¦‚æœpçš„å‰ç½®èŠ‚ç‚¹æ˜¯nullï¼Œåˆ™pä»¥å‰æ˜¯å¤´ç»“ç‚¹ï¼Œæ‰€ä»¥æ›´æ–°ç°åœ¨çš„å¤´ç»“ç‚¹æ˜¯pçš„åç½®èŠ‚ç‚¹a if (b == null) head = a; else//å¦åˆ™æ›´æ–°pçš„å‰ç›´æ¥ç‚¹bçš„åç½®èŠ‚ç‚¹ä¸º a b.after = a; //å¦‚æœpçš„åç½®èŠ‚ç‚¹ä¸æ˜¯nullï¼Œåˆ™æ›´æ–°åç½®èŠ‚ç‚¹açš„å‰ç½®èŠ‚ç‚¹ä¸ºb if (a != null) a.before = b; else//å¦‚æœåŸæœ¬pçš„åç½®èŠ‚ç‚¹æ˜¯nullï¼Œåˆ™på°±æ˜¯å°¾èŠ‚ç‚¹ã€‚ æ­¤æ—¶ æ›´æ–°lastçš„å¼•ç”¨ä¸º pçš„å‰ç½®èŠ‚ç‚¹b last = b; if (last == null) //åŸæœ¬å°¾èŠ‚ç‚¹æ˜¯null åˆ™ï¼Œé“¾è¡¨ä¸­å°±ä¸€ä¸ªèŠ‚ç‚¹ head = p; else &#123;//å¦åˆ™ æ›´æ–° å½“å‰èŠ‚ç‚¹pçš„å‰ç½®èŠ‚ç‚¹ä¸º åŸå°¾èŠ‚ç‚¹lastï¼Œ lastçš„åç½®èŠ‚ç‚¹æ˜¯p p.before = last; last.after = p; &#125; //å°¾èŠ‚ç‚¹çš„å¼•ç”¨èµ‹å€¼æˆp tail = p; //ä¿®æ”¹modCountã€‚ ++modCount; &#125; &#125; // å› ä¸ºLinkedHashMapä¸­ç»´æŠ¤äº†ä¸€ä¸ªåŒå‘é“¾è¡¨æ‰€ä»¥ç›¸å¯¹äºHashMapä¸­çš„åŒé‡å¾ªç¯éå†è¿™ä¸ªæ–¹æ³•è¦ä¼˜åŒ–å¾ˆå¤š LinkedHashMap public boolean containsValue(Object value) &#123; for (LinkedHashMap.Entry&lt;K,V&gt; e = head; e != null; e = e.after) &#123; // é€šè¿‡åŒå‘é“¾è¡¨æ¥éå† V v = e.value; if (v == value || (value != null &amp;&amp; value.equals(v))) return true; &#125; return false; &#125; HashMap public boolean containsValue(Object value) &#123; Node&lt;K,V&gt;[] tab; V v; if ((tab = table) != null &amp;&amp; size &gt; 0) &#123; for (int i = 0; i &lt; tab.length; ++i) &#123; for (Node&lt;K,V&gt; e = tab[i]; e != null; e = e.next) &#123; if ((v = e.value) == value || (value != null &amp;&amp; value.equals(v))) return true; &#125; &#125; &#125; return false; &#125; å…¶ä»–æ–¹æ³•LinkedHashMapè¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒç¥å¥‡çš„å­˜åœ¨ã€‚ void afterNodeInsertion(boolean evict) &#123; // possibly remove eldest LinkedHashMap.Entry&lt;K,V&gt; first; // æ ¹æ®æ¡ä»¶åˆ¤æ–­æ˜¯å¦ç§»é™¤æœ€è¿‘æœ€å°‘è¢«è®¿é—®çš„èŠ‚ç‚¹ if (evict &amp;&amp; (first = head) != null &amp;&amp; removeEldestEntry(first)) &#123; K key = first.key; removeNode(hash(key), key, null, false, true); &#125; &#125; // ç§»é™¤æœ€è¿‘æœ€å°‘è¢«è®¿é—®æ¡ä»¶ä¹‹ä¸€ï¼Œé€šè¿‡è¦†ç›–æ­¤æ–¹æ³•å¯å®ç°ä¸åŒç­–ç•¥çš„ç¼“å­˜ protected boolean removeEldestEntry(Map.Entry&lt;K,V&gt; eldest) &#123; return false; &#125; ä¸Šé¢çš„æ–¹æ³•ä¸€èˆ¬ä¸ä¼šè¢«æ‰§è¡Œï¼Œä½†æ˜¯å½“æˆ‘ä»¬åŸºäº LinkedHashMap å®ç°ç¼“å­˜æ—¶ï¼Œé€šè¿‡è¦†å†™removeEldestEntryæ–¹æ³•å¯ä»¥å®ç°è‡ªå®šä¹‰ç­–ç•¥çš„ LRU ç¼“å­˜ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥æ ¹æ®èŠ‚ç‚¹æ•°é‡åˆ¤æ–­æ˜¯å¦ç§»é™¤æœ€è¿‘æœ€å°‘è¢«è®¿é—®çš„èŠ‚ç‚¹ï¼Œæˆ–è€…æ ¹æ®èŠ‚ç‚¹çš„å­˜æ´»æ—¶é—´åˆ¤æ–­æ˜¯å¦ç§»é™¤è¯¥èŠ‚ç‚¹ç­‰ã€‚ è¿­ä»£å™¨public Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet() &#123; Set&lt;Map.Entry&lt;K,V&gt;&gt; es; //è¿”å›LinkedEntrySet return (es = entrySet) == null ? (entrySet = new LinkedEntrySet()) : es; &#125; final class LinkedEntrySet extends AbstractSet&lt;Map.Entry&lt;K,V&gt;&gt; &#123; public final Iterator&lt;Map.Entry&lt;K,V&gt;&gt; iterator() &#123; return new LinkedEntryIterator(); &#125; &#125; final class LinkedEntryIterator extends LinkedHashIterator implements Iterator&lt;Map.Entry&lt;K,V&gt;&gt; &#123; public final Map.Entry&lt;K,V&gt; next() &#123; return nextNode(); &#125; &#125; abstract class LinkedHashIterator &#123; //ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ LinkedHashMap.Entry&lt;K,V&gt; next; //å½“å‰èŠ‚ç‚¹ LinkedHashMap.Entry&lt;K,V&gt; current; int expectedModCount; LinkedHashIterator() &#123; //åˆå§‹åŒ–æ—¶ï¼Œnext ä¸º LinkedHashMapå†…éƒ¨ç»´æŠ¤çš„åŒå‘é“¾è¡¨çš„æ‰å¤´ next = head; //è®°å½•å½“å‰modCountï¼Œä»¥æ»¡è¶³fail-fast expectedModCount = modCount; //å½“å‰èŠ‚ç‚¹ä¸ºnull current = null; &#125; //åˆ¤æ–­æ˜¯å¦è¿˜æœ‰next public final boolean hasNext() &#123; //å°±æ˜¯åˆ¤æ–­nextæ˜¯å¦ä¸ºnullï¼Œé»˜è®¤nextæ˜¯head è¡¨å¤´ return next != null; &#125; //nextNode() å°±æ˜¯è¿­ä»£å™¨é‡Œçš„next()æ–¹æ³• ã€‚ //è¯¥æ–¹æ³•çš„å®ç°å¯ä»¥çœ‹å‡ºï¼Œè¿­ä»£LinkedHashMapï¼Œå°±æ˜¯ä»å†…éƒ¨ç»´æŠ¤çš„åŒé“¾è¡¨çš„è¡¨å¤´å¼€å§‹å¾ªç¯è¾“å‡ºã€‚ final LinkedHashMap.Entry&lt;K,V&gt; nextNode() &#123; //è®°å½•è¦è¿”å›çš„eã€‚ LinkedHashMap.Entry&lt;K,V&gt; e = next; //åˆ¤æ–­fail-fast if (modCount != expectedModCount) throw new ConcurrentModificationException(); //å¦‚æœè¦è¿”å›çš„èŠ‚ç‚¹æ˜¯nullï¼Œå¼‚å¸¸ if (e == null) throw new NoSuchElementException(); //æ›´æ–°å½“å‰èŠ‚ç‚¹ä¸ºe current = e; //æ›´æ–°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯eçš„åç½®èŠ‚ç‚¹ next = e.after; //è¿”å›e return e; &#125; //åˆ é™¤æ–¹æ³• æœ€ç»ˆè¿˜æ˜¯è°ƒç”¨äº†HashMapçš„removeNodeæ–¹æ³• public final void remove() &#123; Node&lt;K,V&gt; p = current; if (p == null) throw new IllegalStateException(); if (modCount != expectedModCount) throw new ConcurrentModificationException(); current = null; K key = p.key; removeNode(hash(key), key, null, false, false); expectedModCount = modCount; &#125; &#125; è¯¥æ–¹æ³•çš„å®ç°å¯ä»¥çœ‹å‡ºï¼Œè¿­ä»£LinkedHashMapï¼Œå°±æ˜¯ä»å†…éƒ¨ç»´æŠ¤çš„åŒé“¾è¡¨çš„è¡¨å¤´å¼€å§‹å¾ªç¯è¾“å‡ºã€‚è€ŒåŒé“¾è¡¨èŠ‚ç‚¹çš„é¡ºåºåœ¨LinkedHashMapçš„å¢ã€åˆ ã€æ”¹ã€æŸ¥æ—¶éƒ½ä¼šæ›´æ–°ã€‚ä»¥æ»¡è¶³æŒ‰ç…§æ’å…¥é¡ºåºè¾“å‡ºï¼Œè¿˜æ˜¯è®¿é—®é¡ºåºè¾“å‡ºã€‚ æ€»ç»“åœ¨æ—¥å¸¸å¼€å‘ä¸­LinkedHashMap çš„ä½¿ç”¨é¢‘ç‡æ²¡æœ‰HashMapé«˜ï¼Œä½†å®ƒä¹Ÿä¸ªé‡è¦çš„å®ç°ã€‚åœ¨ Java é›†åˆæ¡†æ¶ä¸­ï¼ŒHashMapã€LinkedHashMap å’Œ TreeMap ä¸‰ä¸ªæ˜ å°„ç±»åŸºäºä¸åŒçš„æ•°æ®ç»“æ„ï¼Œå¹¶å®ç°äº†ä¸åŒçš„åŠŸèƒ½ã€‚HashMap åº•å±‚åŸºäºæ‹‰é“¾å¼çš„æ•£åˆ—ç»“æ„ï¼Œå¹¶åœ¨ JDK 1.8 ä¸­å¼•å…¥çº¢é»‘æ ‘ä¼˜åŒ–è¿‡é•¿é“¾è¡¨çš„é—®é¢˜ã€‚åŸºäºè¿™æ ·ç»“æ„ï¼ŒHashMap å¯æä¾›é«˜æ•ˆçš„å¢åˆ æ”¹æŸ¥æ“ä½œã€‚LinkedHashMap åœ¨å…¶ä¹‹ä¸Šï¼Œé€šè¿‡ç»´æŠ¤ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œå®ç°äº†æ•£åˆ—æ•°æ®ç»“æ„çš„æœ‰åºéå†ã€‚TreeMap åº•å±‚åŸºäºçº¢é»‘æ ‘å®ç°ï¼Œåˆ©ç”¨çº¢é»‘æ ‘çš„æ€§è´¨ï¼Œå®ç°äº†é”®å€¼å¯¹æ’åºåŠŸèƒ½ã€‚å…·ä½“å®ç°æˆ‘ä»¬ä¸‹æ¬¡åˆ†æã€‚","categories":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://gyl-coder.top/tags/%E9%9B%86%E5%90%88/"},{"name":"LinkedHashMap","slug":"LinkedHashMap","permalink":"https://gyl-coder.top/tags/LinkedHashMap/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"LinkedList åº•å±‚å®ç°åŸç†åˆ†æ","slug":"java/collection/LinkedList","date":"2020-07-04T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"java/collection/LinkedList/","link":"","permalink":"https://gyl-coder.top/java/collection/LinkedList/","excerpt":"åœ¨Java.utilåŒ…ä¸‹ ç»§æ‰¿è‡ªAbstractSequentialList å®ç° List æ¥å£ï¼Œèƒ½å¯¹å®ƒè¿›è¡Œé˜Ÿåˆ—æ“ä½œã€‚ å®ç° Deque æ¥å£ï¼Œå³èƒ½å°†LinkedListå½“ä½œåŒç«¯é˜Ÿåˆ—ä½¿ç”¨ã€‚ å®ç°äº†Cloneableæ¥å£ï¼Œå³è¦†ç›–äº†å‡½æ•°clone()ï¼Œèƒ½å…‹éš†ã€‚ å®ç°java.io.Serializableæ¥å£ï¼Œè¿™æ„å‘³ç€LinkedListæ”¯æŒåºåˆ—åŒ–ï¼Œèƒ½é€šè¿‡åºåˆ—åŒ–å»ä¼ è¾“ã€‚ å…è®¸åŒ…å«nullå€¼ è¿­ä»£å™¨å¯ä»¥å¿«é€ŸæŠ¥é”™ éçº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚æœåœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨ï¼ˆä¿®æ”¹ï¼‰ï¼Œéœ€è¦åœ¨å¤–éƒ¨ä½œåŒæ­¥å¤„ç†ã€‚ LinkedListæ˜¯ä¸€ç§å¯ä»¥åœ¨ä»»ä½•ä½ç½®è¿›è¡Œé«˜æ•ˆåœ°æ’å…¥å’Œç§»é™¤æ“ä½œçš„æœ‰åºåºåˆ—ï¼Œå®ƒæ˜¯åŸºäºåŒå‘é“¾è¡¨å®ç°çš„ã€‚å†…éƒ¨æœ‰ä¸‰ä¸ªå˜é‡ï¼Œsizeè¡¨ç¤ºé“¾è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼Œ firstæŒ‡å‘é“¾è¡¨å¤´éƒ¨ï¼ŒlastæŒ‡å‘é“¾è¡¨å°¾éƒ¨ã€‚ ç»“æ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤º","text":"åœ¨Java.utilåŒ…ä¸‹ ç»§æ‰¿è‡ªAbstractSequentialList å®ç° List æ¥å£ï¼Œèƒ½å¯¹å®ƒè¿›è¡Œé˜Ÿåˆ—æ“ä½œã€‚ å®ç° Deque æ¥å£ï¼Œå³èƒ½å°†LinkedListå½“ä½œåŒç«¯é˜Ÿåˆ—ä½¿ç”¨ã€‚ å®ç°äº†Cloneableæ¥å£ï¼Œå³è¦†ç›–äº†å‡½æ•°clone()ï¼Œèƒ½å…‹éš†ã€‚ å®ç°java.io.Serializableæ¥å£ï¼Œè¿™æ„å‘³ç€LinkedListæ”¯æŒåºåˆ—åŒ–ï¼Œèƒ½é€šè¿‡åºåˆ—åŒ–å»ä¼ è¾“ã€‚ å…è®¸åŒ…å«nullå€¼ è¿­ä»£å™¨å¯ä»¥å¿«é€ŸæŠ¥é”™ éçº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚æœåœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨ï¼ˆä¿®æ”¹ï¼‰ï¼Œéœ€è¦åœ¨å¤–éƒ¨ä½œåŒæ­¥å¤„ç†ã€‚ LinkedListæ˜¯ä¸€ç§å¯ä»¥åœ¨ä»»ä½•ä½ç½®è¿›è¡Œé«˜æ•ˆåœ°æ’å…¥å’Œç§»é™¤æ“ä½œçš„æœ‰åºåºåˆ—ï¼Œå®ƒæ˜¯åŸºäºåŒå‘é“¾è¡¨å®ç°çš„ã€‚å†…éƒ¨æœ‰ä¸‰ä¸ªå˜é‡ï¼Œsizeè¡¨ç¤ºé“¾è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼Œ firstæŒ‡å‘é“¾è¡¨å¤´éƒ¨ï¼ŒlastæŒ‡å‘é“¾è¡¨å°¾éƒ¨ã€‚ ç»“æ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤º ä¸‹é¢æ˜¯LinkedListä¸­NodeèŠ‚ç‚¹çš„å®šä¹‰ï¼ŒNodeç±»æ˜¯LinkedListçš„é™æ€å†…éƒ¨ç±»ã€‚ private static class Node&lt;E&gt; &#123; E item; // å½“å‰èŠ‚ç‚¹æ‰€å­˜æ•°æ® Node&lt;E&gt; next; // å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ Node&lt;E&gt; prev; // å½“å‰èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123; this.item = element; this.next = next; this.prev = prev; &#125; &#125; æ„é€ æ–¹æ³•ï¼ˆConstruction methodï¼‰LinkedListæä¾›äº†ä¸¤ç§ç§æ–¹å¼çš„æ„é€ å™¨ï¼Œæ„é€ ä¸€ä¸ªç©ºåˆ—è¡¨ã€ä»¥åŠæ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®šcollectionçš„å…ƒç´ çš„åˆ—è¡¨ï¼Œè¿™äº›å…ƒç´ æŒ‰ç…§è¯¥collectionçš„è¿­ä»£å™¨è¿”å›çš„é¡ºåºæ’åˆ—çš„ã€‚ public LinkedList() &#123; &#125; public LinkedList(Collection&lt;? extends E&gt; c) &#123; this(); addAll(c); // è°ƒç”¨addAllæ–¹æ³•ï¼Œæ„å»ºä¸€ä¸ªåŒ…å«æŒ‡å®šé›†åˆcçš„åˆ—è¡¨ &#125; æ·»åŠ å…ƒç´ å› ä¸ºLinkedListå³å®ç°äº†Listæ¥å£ï¼Œåˆå®ç°äº†Dequeæ¥å£ï¼Œæ‰€ä»¥LinkedListæ—¢å¯ä»¥æ·»åŠ å°†å…ƒç´ æ·»åŠ åˆ°å°¾éƒ¨ï¼Œä¹Ÿå¯ä»¥å°†å…ƒç´ æ·»åŠ åˆ°æŒ‡å®šç´¢å¼•ä½ç½®ï¼Œè¿˜å¯ä»¥æ·»åŠ æ·»åŠ æ•´ä¸ªé›†åˆï¼›å¦å¤–æ—¢å¯ä»¥åœ¨å¤´éƒ¨æ·»åŠ ï¼Œåˆå¯ä»¥åœ¨å°¾éƒ¨æ·»åŠ ã€‚ //æ·»åŠ å…ƒç´ ä½œä¸ºç¬¬ä¸€ä¸ªå…ƒç´  public void addFirst(E e) &#123; linkFirst(e); &#125; //åº—å®¶å…ƒç´ ä½œä¸ºæœ€åä¸€ä¸ªå…ƒç´  public void addLast(E e) &#123; linkLast(e); &#125; //ä½¿ç”¨å¯¹åº”å‚æ•°ä½œä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå†…éƒ¨ä½¿ç”¨ private void linkFirst(E e) &#123; final Node&lt;E&gt; f = first;//å¾—åˆ°é¦–èŠ‚ç‚¹ final Node&lt;E&gt; newNode = new Node&lt;&gt;(null, e, f);//åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ first = newNode; //æ›´æ–°é¦–èŠ‚ç‚¹ if (f == null) last = newNode; //å¦‚æœä¹‹å‰é¦–èŠ‚ç‚¹ä¸ºç©º(size==0)ï¼Œé‚£ä¹ˆå°¾èŠ‚ç‚¹å°±æ˜¯é¦–èŠ‚ç‚¹ else f.prev = newNode; //å¦‚æœä¹‹å‰é¦–èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œä¹‹å‰çš„é¦–èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ä¸ºå½“å‰é¦–èŠ‚ç‚¹ size++; //é•¿åº¦+1 modCount++; //ä¿®æ”¹æ¬¡æ•°+1 &#125; //ä½¿ç”¨å¯¹åº”å‚æ•°ä½œä¸ºå°¾èŠ‚ç‚¹ void linkLast(E e) &#123; final Node&lt;E&gt; l = last; //å¾—åˆ°å°¾èŠ‚ç‚¹ final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null);//ä½¿ç”¨å‚æ•°åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ last = newNode; //è®¾ç½®å°¾èŠ‚ç‚¹ if (l == null) first = newNode; //å¦‚æœä¹‹å‰å°¾èŠ‚ç‚¹ä¸ºç©º(size==0)ï¼Œé¦–èŠ‚ç‚¹å³å°¾èŠ‚ç‚¹ else l.next = newNode; //å¦‚æœä¹‹å‰å°¾èŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œä¹‹å‰çš„å°¾èŠ‚ç‚¹çš„åä¸€ä¸ªå°±æ˜¯å½“å‰çš„å°¾èŠ‚ç‚¹ size++; modCount++; &#125; //åœ¨éç©ºèŠ‚ç‚¹succä¹‹å‰æ’å…¥å…ƒç´ Eã€‚ void linkBefore(E e, Node&lt;E&gt; succ) &#123; final Node&lt;E&gt; pred = succ.prev;//è·å–å‰ä¸€ä¸ªèŠ‚ç‚¹ final Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, succ);//ä½¿ç”¨å‚æ•°åˆ›å»ºæ–°çš„èŠ‚ç‚¹ succ.prev = newNode;//å½“å‰èŠ‚ç‚¹æŒ‡å‘æ–°çš„èŠ‚ç‚¹ if (pred == null) first = newNode;//å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹ä¸ºnullï¼Œæ–°çš„èŠ‚ç‚¹å°±æ˜¯é¦–èŠ‚ç‚¹ else pred.next = newNode;//å¦‚æœå­˜åœ¨å‰èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå‰èŠ‚ç‚¹çš„å‘åæŒ‡å‘æ–°èŠ‚ç‚¹ size++; modCount++; &#125; //æ·»åŠ æŒ‡å®šé›†åˆçš„å…ƒç´ åˆ°åˆ—è¡¨ï¼Œé»˜è®¤ä»æœ€åå¼€å§‹æ·»åŠ  public boolean addAll(Collection&lt;? extends E&gt; c) &#123; return addAll(size, c);//sizeè¡¨ç¤ºæœ€åä¸€ä¸ªä½ç½® &#125; /* ä»æŒ‡å®šä½ç½®ï¼ˆè€Œä¸æ˜¯ä¸‹æ ‡ï¼ä¸‹æ ‡å³ç´¢å¼•ä»0å¼€å§‹ï¼Œä½ç½®å¯ä»¥çœ‹åšä»1å¼€å§‹ï¼Œå…¶å®ä¹Ÿæ˜¯0ï¼‰åé¢æ·»åŠ æŒ‡å®šé›†åˆçš„å…ƒç´ åˆ°åˆ—è¡¨ä¸­ï¼Œåªè¦æœ‰è‡³å°‘ä¸€æ¬¡æ·»åŠ å°±ä¼šè¿”å›true indexæ¢æˆpositionåº”è¯¥ä¼šæ›´å¥½ç†è§£ï¼Œæ‰€ä»¥ä¹Ÿå°±æ˜¯ä»ç´¢å¼•ä¸ºindex(position)çš„å…ƒç´ çš„å‰é¢ç´¢å¼•ä¸ºindex-1çš„åé¢æ·»åŠ ï¼ å½“ç„¶ä½ç½®å¯ä»¥ä¸º0å•Šï¼Œä¸º0çš„æ—¶å€™å°±æ˜¯ä»ä½ç½®0(è™½ç„¶å®ƒä¸å­˜åœ¨)åé¢å¼€å§‹æ·»åŠ å˜›ï¼Œæ‰€ä»¥ç†æ‰€å½“ç„¶å°±æ˜¯æ·»åŠ åˆ°ç¬¬ä¸€ä¸ªä½ç½®ï¼ˆä½ç½®1çš„å‰é¢ï¼‰çš„å‰é¢ æ¯”å¦‚åˆ—è¡¨ï¼š0 1 2 3ï¼Œå¦‚æœæ­¤å¤„index=4(å®é™…ç´¢å¼•ä¸º3)ï¼Œå°±æ˜¯åœ¨å…ƒç´ 3åé¢æ·»åŠ ï¼›å¦‚æœindex=3(å®é™…ç´¢å¼•ä¸º2)ï¼Œå°±åœ¨å…ƒç´ 2åé¢æ·»åŠ ã€‚ */ public boolean addAll(int index, Collection&lt;? extends E&gt; c) &#123; checkPositionIndex(index); //æ£€æŸ¥ç´¢å¼•æ˜¯å¦æ­£ç¡®ï¼ˆ0&lt;=index&lt;=sizeï¼‰ Object[] a = c.toArray(); //å¾—åˆ°å…ƒç´ æ•°ç»„ int numNew = a.length; //å¾—åˆ°å…ƒç´ ä¸ªæ•° if (numNew == 0) //è‹¥æ²¡æœ‰å…ƒç´ è¦æ·»åŠ ï¼Œç›´æ¥è¿”å›false return false; Node&lt;E&gt; pred, succ; if (index == size) &#123; //å¦‚æœæ˜¯åœ¨æœ«å°¾å¼€å§‹æ·»åŠ ï¼Œå½“å‰èŠ‚ç‚¹åä¸€ä¸ªèŠ‚ç‚¹åˆå§‹åŒ–ä¸ºnullï¼Œå‰ä¸€ä¸ªèŠ‚ç‚¹ä¸ºå°¾èŠ‚ç‚¹ succ = null; //è¿™é‡Œå¯ä»¥çœ‹åšnode(index)ï¼Œä¸è¿‡index=sizeäº†ï¼ˆindexæœ€å¤§åªèƒ½æ˜¯size-1ï¼‰ï¼Œæ‰€ä»¥è¿™é‡Œçš„succåªèƒ½=nullï¼Œä¹Ÿæ–¹ä¾¿åé¢åˆ¤æ–­ pred = last; &#125; else &#123; //å¦‚æœä¸æ˜¯ä»æœ«å°¾å¼€å§‹æ·»åŠ ï¼Œå½“å‰ä½ç½®çš„èŠ‚ç‚¹ä¸ºæŒ‡å®šä½ç½®çš„èŠ‚ç‚¹ï¼Œå‰ä¸€ä¸ªèŠ‚ç‚¹ä¸ºè¦æ·»åŠ çš„èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ succ = node(index); //æ·»åŠ å¥½å…ƒç´ å(æ•´ä¸ªæ–°åŠ çš„)çš„åä¸€ä¸ªèŠ‚ç‚¹ pred = succ.prev; &#125; //éå†æ•°ç»„å¹¶æ·»åŠ åˆ°åˆ—è¡¨ä¸­ for (Object o : a) &#123; @SuppressWarnings(&quot;unchecked&quot;) E e = (E) o; Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, null);//åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå‘å‰æŒ‡å‘ä¸Šé¢å¾—åˆ°çš„å‰èŠ‚ç‚¹ if (pred == null) first = newNode; //è‹¥å½“å‰èŠ‚ç‚¹ä¸ºnullï¼Œåˆ™æ–°åŠ çš„èŠ‚ç‚¹ä¸ºé¦–èŠ‚ç‚¹ else pred.next = newNode;//å¦‚æœå­˜åœ¨å‰èŠ‚ç‚¹ï¼Œå‰èŠ‚ç‚¹ä¼šå‘åæŒ‡å‘æ–°åŠ çš„èŠ‚ç‚¹ pred = newNode; //æ–°åŠ çš„èŠ‚ç‚¹æˆä¸ºå‰ä¸€ä¸ªèŠ‚ç‚¹ &#125; if (succ == null) &#123; //pred.next = null //åŠ ä¸Šè¿™å¥ä¹Ÿå¯ä»¥æ›´å¥½çš„ç†è§£ last = pred; //å¦‚æœæ˜¯ä»æœ€åå¼€å§‹æ·»åŠ çš„ï¼Œåˆ™æœ€åæ·»åŠ çš„èŠ‚ç‚¹æˆä¸ºå°¾èŠ‚ç‚¹ &#125; else &#123; pred.next = succ; //å¦‚æœä¸æ˜¯ä»æœ€åå¼€å§‹æ·»åŠ çš„ï¼Œåˆ™æœ€åæ·»åŠ çš„èŠ‚ç‚¹å‘åæŒ‡å‘ä¹‹å‰å¾—åˆ°çš„åç»­ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ succ.prev = pred; //å½“å‰ï¼Œåç»­çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿåº”æ”¹ä¸ºå‘å‰æŒ‡å‘æœ€åä¸€ä¸ªæ·»åŠ çš„èŠ‚ç‚¹ &#125; size += numNew; modCount++; return true; &#125; //å°†æŒ‡å®šçš„å…ƒç´ (E element)æ’å…¥åˆ°åˆ—è¡¨çš„æŒ‡å®šä½ç½®(index) public void add(int index, E element) &#123; checkPositionIndex(index); //index &gt;= 0 &amp;&amp; index &lt;= size if (index == size) linkLast(element); //å°¾æ’å…¥ else linkBefore(element, node(index)); //ä¸­é—´æ’å…¥ &#125; linkBeforeçš„æ·»åŠ æ­¥éª¤ï¼š åˆ›å»ºnewNodeèŠ‚ç‚¹ï¼Œå°†newNodeçš„åç»§æŒ‡é’ˆæŒ‡å‘succï¼Œå‰é©±æŒ‡é’ˆæŒ‡å‘pred å°†succçš„å‰é©±æŒ‡é’ˆæŒ‡å‘newNode æ ¹æ®predæ˜¯å¦ä¸ºnullï¼Œè¿›è¡Œä¸åŒæ“ä½œã€‚ å¦‚æœpredä¸ºnullï¼Œè¯´æ˜è¯¥èŠ‚ç‚¹æ’å…¥åœ¨å¤´èŠ‚ç‚¹ä¹‹å‰ï¼Œè¦é‡ç½®firstå¤´èŠ‚ç‚¹ å¦‚æœpredä¸ä¸ºnullï¼Œé‚£ä¹ˆç›´æ¥å°†predçš„åç»§æŒ‡é’ˆæŒ‡å‘newNodeå³å¯ addAllçš„æ·»åŠ æ­¥éª¤ï¼š æ£€æŸ¥indexç´¢å¼•èŒƒå›´ å¾—åˆ°é›†åˆæ•°æ® å¾—åˆ°æ’å…¥ä½ç½®çš„å‰é©±å’Œåç»§èŠ‚ç‚¹ éå†æ•°æ®ï¼Œå°†æ•°æ®æ’å…¥åˆ°æŒ‡å®šä½ç½® åˆ é™¤å…ƒç´ åŒæ ·çš„LinkedListä¹Ÿæä¾›äº†å¾ˆå¤šæ–¹æ³•æ¥åˆ é™¤å…ƒç´  // åˆ é™¤é¦–èŠ‚ç‚¹å¹¶è¿”å›åˆ é™¤å‰é¦–èŠ‚ç‚¹çš„å€¼ï¼Œå†…éƒ¨ä½¿ç”¨ (f == first &amp;&amp; f != null) private E unlinkFirst(Node&lt;E&gt; f) &#123; final E element = f.item; // è·å–é¦–èŠ‚ç‚¹çš„å€¼ final Node&lt;E&gt; next = f.next; // è·å–é¦–èŠ‚ç‚¹çš„åä¸€ä¸ªèŠ‚ç‚¹ f.item = null; f.next = null; // help GC first = next; // æ›´æ–°é¦–èŠ‚ç‚¹ if (next == null) //å¦‚æœä¸å­˜åœ¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™é¦–å°¾éƒ½ä¸ºnull last = null; else next.prev = null; //å¦‚æœå­˜åœ¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£å®ƒçš„å‰æŒ‡é’ˆä¸ºnull size--; modCount++; return element; &#125; // åˆ é™¤å°¾èŠ‚ç‚¹ï¼Œå¹¶è¿”å›å°¾èŠ‚ç‚¹çš„å…ƒç´  ï¼ˆassert l == last &amp;&amp; l != nullï¼‰ private E unlinkLast(Node&lt;E&gt; l) &#123; final E element = l.item;//è·å–å°¾èŠ‚ç‚¹çš„å€¼ final Node&lt;E&gt; prev = l.prev;//è·å–å°¾èŠ‚ç‚¹å‰ä¸€ä¸ªèŠ‚ç‚¹ l.item = null; l.prev = null; // help GC last = prev; //å‰ä¸€ä¸ªèŠ‚ç‚¹æˆä¸ºæ–°çš„å°¾èŠ‚ç‚¹ if (prev == null) first = null; //å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹ä¸å­˜åœ¨ï¼Œåˆ™é¦–å°¾éƒ½ä¸ºnull else prev.next = null;//å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹å­˜åœ¨ï¼Œå…ˆåæŒ‡å‘null size--; modCount++; return element; &#125; // åˆ é™¤æŒ‡å®šèŠ‚ç‚¹xå¹¶è¿”å›èŠ‚ç‚¹çš„å€¼ï¼ˆx != nullï¼‰ E unlink(Node&lt;E&gt; x) &#123; //è·å–å½“å‰å€¼å’Œå‰åèŠ‚ç‚¹ final E element = x.item; final Node&lt;E&gt; next = x.next; final Node&lt;E&gt; prev = x.prev; if (prev == null) &#123; first = next; //å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©º(å¦‚å½“å‰èŠ‚ç‚¹ä¸ºé¦–èŠ‚ç‚¹)ï¼Œåä¸€ä¸ªèŠ‚ç‚¹æˆä¸ºæ–°çš„é¦–èŠ‚ç‚¹ &#125; else &#123; prev.next = next;//å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆä»–å…ˆåæŒ‡å‘å½“å‰çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ x.prev = null; //help GC &#125; if (next == null) &#123; last = prev; //å¦‚æœåä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©º(å¦‚å½“å‰èŠ‚ç‚¹ä¸ºå°¾èŠ‚ç‚¹)ï¼Œå½“å‰èŠ‚ç‚¹å‰ä¸€ä¸ªæˆä¸ºæ–°çš„å°¾èŠ‚ç‚¹ &#125; else &#123; next.prev = prev;//å¦‚æœåä¸€ä¸ªèŠ‚ç‚¹ä¸ä¸ºç©ºï¼Œåä¸€ä¸ªèŠ‚ç‚¹å‘å‰æŒ‡å‘å½“å‰çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ x.next = null; //help GC &#125; x.item = null; //help GC size--; modCount++; return element; &#125; //åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ å¹¶è¿”å›åˆ é™¤çš„å…ƒç´  public E removeFirst() &#123; final Node&lt;E&gt; f = first;//å¾—åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ if (f == null) //å¦‚æœä¸ºç©ºï¼ŒæŠ›å‡ºå¼‚å¸¸ throw new NoSuchElementException(); return unlinkFirst(f); &#125; //åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ å¹¶è¿”å›åˆ é™¤çš„å€¼ public E removeLast() &#123; final Node&lt;E&gt; l = last;//å¾—åˆ°æœ€åä¸€ä¸ªèŠ‚ç‚¹ if (l == null) //å¦‚æœä¸ºç©ºï¼ŒæŠ›å‡ºå¼‚å¸¸ throw new NoSuchElementException(); return unlinkLast(l); &#125; åºåˆ—åŒ–æ–¹æ³•private static final long serialVersionUID = 876323262645176354L; //åºåˆ—åŒ–ï¼šå°†linkedListçš„â€œå¤§å°ï¼Œæ‰€æœ‰çš„å…ƒç´ å€¼â€éƒ½å†™å…¥åˆ°è¾“å‡ºæµä¸­ private void writeObject(java.io.ObjectOutputStream s) throws java.io.IOException &#123; s.defaultWriteObject(); s.writeInt(size); for (Node&lt;E&gt; x = first; x != null; x = x.next) s.writeObject(x.item); &#125; //ååºåˆ—åŒ–ï¼šå…ˆå°†LinkedListçš„â€œå¤§å°â€è¯»å‡ºï¼Œç„¶åå°†â€œæ‰€æœ‰çš„å…ƒç´ å€¼â€è¯»å‡º @SuppressWarnings(&quot;unchecked&quot;) private void readObject(java.io.ObjectInputStream s) throws java.io.IOException, ClassNotFoundException &#123; s.defaultReadObject(); int size = s.readInt(); for (int i = 0; i &lt; size; i++) linkLast((E)s.readObject()); //ä»¥å°¾æ’å…¥çš„æ–¹å¼ &#125; é˜Ÿåˆ—æ“ä½œ//æä¾›æ™®é€šé˜Ÿåˆ—å’ŒåŒå‘é˜Ÿåˆ—çš„åŠŸèƒ½ï¼Œå½“ç„¶ï¼Œä¹Ÿå¯ä»¥å®ç°æ ˆï¼ŒFIFOï¼ŒFILO //å‡ºé˜Ÿï¼ˆä»å‰ç«¯ï¼‰ï¼Œè·å¾—ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¸å­˜åœ¨ä¼šè¿”å›nullï¼Œä¸ä¼šåˆ é™¤å…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰ public E peek() &#123; final Node&lt;E&gt; f = first; return (f == null) ? null : f.item; &#125; //å‡ºé˜Ÿï¼ˆä»å‰ç«¯ï¼‰ï¼Œä¸åˆ é™¤å…ƒç´ ï¼Œè‹¥ä¸ºnullä¼šæŠ›å‡ºå¼‚å¸¸è€Œä¸æ˜¯è¿”å›null public E element() &#123; return getFirst(); &#125; //å‡ºé˜Ÿï¼ˆä»å‰ç«¯ï¼‰ï¼Œå¦‚æœä¸å­˜åœ¨ä¼šè¿”å›nullï¼Œå­˜åœ¨çš„è¯ä¼šè¿”å›å€¼å¹¶ç§»é™¤è¿™ä¸ªå…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰ public E poll() &#123; final Node&lt;E&gt; f = first; return (f == null) ? null : unlinkFirst(f); &#125; //å‡ºé˜Ÿï¼ˆä»å‰ç«¯ï¼‰ï¼Œå¦‚æœä¸å­˜åœ¨ä¼šæŠ›å‡ºå¼‚å¸¸è€Œä¸æ˜¯è¿”å›nullï¼Œå­˜åœ¨çš„è¯ä¼šè¿”å›å€¼å¹¶ç§»é™¤è¿™ä¸ªå…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰ public E remove() &#123; return removeFirst(); &#125; //å…¥é˜Ÿï¼ˆä»åç«¯ï¼‰ï¼Œå§‹ç»ˆè¿”å›true public boolean offer(E e) &#123; return add(e); &#125; //å…¥é˜Ÿï¼ˆä»å‰ç«¯ï¼‰ï¼Œå§‹ç»ˆè¿”å›true public boolean offerFirst(E e) &#123; addFirst(e); return true; &#125; //å…¥é˜Ÿï¼ˆä»åç«¯ï¼‰ï¼Œå§‹ç»ˆè¿”å›true public boolean offerLast(E e) &#123; addLast(e);//linkLast(e) return true; &#125; //å‡ºé˜Ÿï¼ˆä»å‰ç«¯ï¼‰ï¼Œè·å¾—ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¸å­˜åœ¨ä¼šè¿”å›nullï¼Œä¸ä¼šåˆ é™¤å…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰ public E peekFirst() &#123; final Node&lt;E&gt; f = first; return (f == null) ? null : f.item; &#125; //å‡ºé˜Ÿï¼ˆä»åç«¯ï¼‰ï¼Œè·å¾—æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä¸å­˜åœ¨ä¼šè¿”å›nullï¼Œä¸ä¼šåˆ é™¤å…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰ public E peekLast() &#123; final Node&lt;E&gt; l = last; return (l == null) ? null : l.item; &#125; //å‡ºé˜Ÿï¼ˆä»å‰ç«¯ï¼‰ï¼Œè·å¾—ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¸å­˜åœ¨ä¼šè¿”å›nullï¼Œä¼šåˆ é™¤å…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰ public E pollFirst() &#123; final Node&lt;E&gt; f = first; return (f == null) ? null : unlinkFirst(f); &#125; //å‡ºé˜Ÿï¼ˆä»åç«¯ï¼‰ï¼Œè·å¾—æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä¸å­˜åœ¨ä¼šè¿”å›nullï¼Œä¼šåˆ é™¤å…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰ public E pollLast() &#123; final Node&lt;E&gt; l = last; return (l == null) ? null : unlinkLast(l); &#125; //å…¥æ ˆï¼Œä»å‰é¢æ·»åŠ  public void push(E e) &#123; addFirst(e); &#125; //å‡ºæ ˆï¼Œè¿”å›æ ˆé¡¶å…ƒç´ ï¼Œä»å‰é¢ç§»é™¤ï¼ˆä¼šåˆ é™¤ï¼‰ public E pop() &#123; return removeFirst(); &#125; è¿­ä»£å™¨//è¿”å›è¿­ä»£å™¨ public Iterator&lt;E&gt; descendingIterator() &#123; return new DescendingIterator(); &#125; //è¿­ä»£å™¨ private class DescendingIterator implements Iterator&lt;E&gt; &#123; private final ListItr itr = new ListItr(size()); public boolean hasNext() &#123; return itr.hasPrevious(); &#125; public E next() &#123; return itr.previous(); &#125; public void remove() &#123; itr.remove(); &#125; &#125; public ListIterator&lt;E&gt; listIterator(int index) &#123; checkPositionIndex(index); return new ListItr(index); &#125; private class ListItr implements ListIterator&lt;E&gt; &#123; private Node&lt;E&gt; lastReturned; private Node&lt;E&gt; next; private int nextIndex; private int expectedModCount = modCount;//ä¿å­˜å½“å‰modCountï¼Œç¡®ä¿fail-fastæœºåˆ¶ ListItr(int index) &#123; next = (index == size) ? null : node(index);//å¾—åˆ°å½“å‰ç´¢å¼•æŒ‡å‘çš„nextèŠ‚ç‚¹ nextIndex = index; &#125; public boolean hasNext() &#123; // åˆ¤æ–­åé¢æ˜¯å¦è¿˜æœ‰å…ƒç´  return nextIndex &lt; size; &#125; public E next() &#123; //è·å–ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ checkForComodification(); if (!hasNext()) throw new NoSuchElementException(); lastReturned = next; next = next.next; nextIndex++; return lastReturned.item; &#125; public boolean hasPrevious() &#123; return nextIndex &gt; 0; &#125; //è·å–å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°†nextèŠ‚ç‚¹å‘å‰ç§» public E previous() &#123; checkForComodification(); if (!hasPrevious()) throw new NoSuchElementException(); lastReturned = next = (next == null) ? last : next.prev; nextIndex--; return lastReturned.item; &#125; public int nextIndex() &#123; return nextIndex; &#125; public int previousIndex() &#123; return nextIndex - 1; &#125; public void remove() &#123; checkForComodification(); if (lastReturned == null) throw new IllegalStateException(); Node&lt;E&gt; lastNext = lastReturned.next; unlink(lastReturned); if (next == lastReturned) next = lastNext; else nextIndex--; lastReturned = null; expectedModCount++; &#125; public void set(E e) &#123; if (lastReturned == null) throw new IllegalStateException(); checkForComodification(); lastReturned.item = e; &#125; public void add(E e) &#123; checkForComodification(); lastReturned = null; if (next == null) linkLast(e); else linkBefore(e, next); nextIndex++; expectedModCount++; &#125; public void forEachRemaining(Consumer&lt;? super E&gt; action) &#123; Objects.requireNonNull(action); while (modCount == expectedModCount &amp;&amp; nextIndex &lt; size) &#123; action.accept(next.item); lastReturned = next; next = next.next; nextIndex++; &#125; checkForComodification(); &#125; final void checkForComodification() &#123; if (modCount != expectedModCount) throw new ConcurrentModificationException(); &#125; &#125; åœ¨ListIteratorçš„æ„é€ å™¨ä¸­ï¼Œå¾—åˆ°äº†å½“å‰ä½ç½®çš„èŠ‚ç‚¹ï¼Œå°±æ˜¯å˜é‡nextã€‚next()æ–¹æ³•è¿”å›å½“å‰èŠ‚ç‚¹çš„å€¼å¹¶å°†nextæŒ‡å‘å…¶åç»§èŠ‚ç‚¹ï¼Œprevious()æ–¹æ³•è¿”å›å½“å‰èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼å¹¶å°†nextèŠ‚ç‚¹æŒ‡å‘å…¶å‰é©±èŠ‚ç‚¹ã€‚ ç”±äºNodeæ˜¯ä¸€ä¸ªåŒå‘èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿™ç”¨äº†ä¸€ä¸ªèŠ‚ç‚¹å°±å¯ä»¥å®ç°ä»å‰å‘åè¿­ä»£å’Œä»åå‘å‰è¿­ä»£ã€‚å¦å¤–åœ¨ListIteratoråˆå§‹æ—¶ï¼ŒexceptedModCountä¿å­˜äº†å½“å‰çš„modCountï¼Œå¦‚æœåœ¨è¿­ä»£æœŸé—´ï¼Œæœ‰æ“ä½œæ”¹å˜äº†é“¾è¡¨çš„åº•å±‚ç»“æ„ï¼Œé‚£ä¹ˆå†æ“ä½œè¿­ä»£å™¨çš„æ–¹æ³•æ—¶å°†ä¼šæŠ›å‡ºConcurrentModificationExceptionã€‚ å…¶ä»–æ–¹æ³•//è·å–ç¬¬ä¸€ä¸ªå…ƒç´  public E getFirst() &#123; final Node&lt;E&gt; f = first;//å¾—åˆ°é¦–èŠ‚ç‚¹ if (f == null) //å¦‚æœä¸ºç©ºï¼ŒæŠ›å‡ºå¼‚å¸¸ throw new NoSuchElementException(); return f.item; &#125; //è·å–æœ€åä¸€ä¸ªå…ƒç´  public E getLast() &#123; final Node&lt;E&gt; l = last;//å¾—åˆ°å°¾èŠ‚ç‚¹ if (l == null) //å¦‚æœä¸ºç©ºï¼ŒæŠ›å‡ºå¼‚å¸¸ throw new NoSuchElementException(); return l.item; &#125; //æ£€æŸ¥æ˜¯å¦åŒ…å«æŸä¸ªå…ƒç´ ï¼Œè¿”å›bool public boolean contains(Object o) &#123; return indexOf(o) != -1;//è¿”å›æŒ‡å®šå…ƒç´ çš„ç´¢å¼•ä½ç½®ï¼Œä¸å­˜åœ¨å°±è¿”å›-1ï¼Œç„¶åæ¯”è¾ƒè¿”å›boolå€¼ &#125; //è¿”å›åˆ—è¡¨é•¿åº¦ public int size() &#123; return size; &#125; //æ¸…ç©ºè¡¨ public void clear() &#123; // help GC for (Node&lt;E&gt; x = first; x != null; ) &#123; Node&lt;E&gt; next = x.next; x.item = null; x.next = null; x.prev = null; x = next; &#125; first = last = null; size = 0; modCount++; &#125; //è·å–æŒ‡å®šç´¢å¼•çš„èŠ‚ç‚¹çš„å€¼ public E get(int index) &#123; checkElementIndex(index); return node(index).item; &#125; //ä¿®æ”¹æŒ‡å®šç´¢å¼•çš„å€¼å¹¶è¿”å›ä¹‹å‰çš„å€¼ public E set(int index, E element) &#123; checkElementIndex(index); // æ£€æŸ¥ä¸‹æ ‡æ˜¯å¦åˆæ³• Node&lt;E&gt; x = node(index); E oldVal = x.item; x.item = element; return oldVal; &#125; //è·å–æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹ Node&lt;E&gt; node(int index) &#123; if (index &lt; (size &gt;&gt; 1)) &#123;//å¦‚æœä½ç½®ç´¢å¼•å°äºåˆ—è¡¨é•¿åº¦çš„ä¸€åŠ(æˆ–ä¸€åŠå‡ä¸€)ï¼Œä»å‰é¢å¼€å§‹éå†ï¼› Node&lt;E&gt; x = first;//index==0æ—¶ä¸ä¼šå¾ªç¯ï¼Œç›´æ¥è¿”å›first for (int i = 0; i &lt; index; i++) x = x.next; return x; &#125; else &#123; // å¦åˆ™ï¼Œä»åé¢å¼€å§‹éå† Node&lt;E&gt; x = last; for (int i = size - 1; i &gt; index; i--) x = x.prev; return x; &#125; &#125; //è·å–æŒ‡å®šå…ƒç´ ä»firstå¼€å§‹çš„ç´¢å¼•ä½ç½®ï¼Œä¸å­˜åœ¨å°±è¿”å›-1 //è¿™é‡Œä¸èƒ½æŒ‰æ¡ä»¶åŒå‘æ‰¾äº†ï¼Œæ‰€ä»¥é€šå¸¸æ ¹æ®ç´¢å¼•è·å¾—å…ƒç´ çš„é€Ÿåº¦æ¯”é€šè¿‡å…ƒç´ è·å¾—ç´¢å¼•çš„é€Ÿåº¦å¿« public int indexOf(Object o) &#123; int index = 0; if (o == null) &#123; for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123; if (x.item == null) return index; index++; &#125; &#125; else &#123; for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123; if (o.equals(x.item)) return index; index++; &#125; &#125; return -1; &#125; //è·å–æŒ‡å®šå…ƒç´ ä»firstå¼€å§‹æœ€åå‡ºç°çš„ç´¢å¼•ï¼Œä¸å­˜åœ¨å°±è¿”å›-1 //ä½†å®é™…æŸ¥æ‰¾æ˜¯ä»lastå¼€å§‹çš„ public int lastIndexOf(Object o) &#123; int index = size; if (o == null) &#123; for (Node&lt;E&gt; x = last; x != null; x = x.prev) &#123; index--; if (x.item == null) return index; &#125; &#125; else &#123; for (Node&lt;E&gt; x = last; x != null; x = x.prev) &#123; index--; if (o.equals(x.item)) return index; &#125; &#125; return -1; &#125; //è¿”å›æ­¤ LinkedListå®ä¾‹çš„æµ…æ‹·è´ public Object clone() &#123; LinkedList&lt;E&gt; clone = superClone(); clone.first = clone.last = null; clone.size = 0; clone.modCount = 0; for (Node&lt;E&gt; x = first; x != null; x = x.next) clone.add(x.item); return clone; &#125; //è¿”å›ä¸€ä¸ªåŒ…å«LinkedListä¸­æ‰€æœ‰å…ƒç´ å€¼çš„æ•°ç»„ public Object[] toArray() &#123; Object[] result = new Object[size]; int i = 0; for (Node&lt;E&gt; x = first; x != null; x = x.next) result[i++] = x.item; return result; &#125; //å¦‚æœç»™å®šçš„å‚æ•°æ•°ç»„é•¿åº¦è¶³å¤Ÿï¼Œåˆ™å°†ArrayListä¸­æ‰€æœ‰å…ƒç´ æŒ‰åºå­˜æ”¾äºå‚æ•°æ•°ç»„ä¸­ï¼Œå¹¶è¿”å› //å¦‚æœç»™å®šçš„å‚æ•°æ•°ç»„é•¿åº¦å°äºLinkedListçš„é•¿åº¦ï¼Œåˆ™è¿”å›ä¸€ä¸ªæ–°åˆ†é…çš„ã€é•¿åº¦ç­‰äºLinkedListé•¿åº¦çš„ã€åŒ…å«LinkedListä¸­æ‰€æœ‰å…ƒç´ çš„æ–°æ•°ç»„ @SuppressWarnings(&quot;unchecked&quot;) public &lt;T&gt; T[] toArray(T[] a) &#123; if (a.length &lt; size) a = (T[])java.lang.reflect.Array.newInstance( a.getClass().getComponentType(), size); int i = 0; Object[] result = a; for (Node&lt;E&gt; x = first; x != null; x = x.next) result[i++] = x.item; if (a.length &gt; size) a[size] = null; return a; &#125;","categories":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://gyl-coder.top/tags/%E9%9B%86%E5%90%88/"},{"name":"LinkedList","slug":"LinkedList","permalink":"https://gyl-coder.top/tags/LinkedList/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"Vector åº•å±‚å®ç°åŸç†åˆ†æ","slug":"java/collection/Vector","date":"2020-07-03T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"java/collection/Vector/","link":"","permalink":"https://gyl-coder.top/java/collection/Vector/","excerpt":"Vectorï¼Œä¸€ä¸ªå¯å˜é•¿çš„æ•°ç»„ï¼Œåº•å±‚å®ç°ä¸ ArrayList å¤§åŒå°å¼‚ï¼Œä½†Vectoræ˜¯åŒæ­¥çš„ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ï¼ŒVectorçš„å¾ˆå¤šæ–¹æ³•ä¹‹å‰éƒ½åŠ äº†å…³é”®å­—synchronizedï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ç”±äºVectorçš„å®ç°å’ŒArrayListçš„å®ç°å¤§åŒå°å¼‚ï¼Œè¿™é‡Œå°±ä¸å†é€ä¸€åˆ†æVectorä¸­çš„æ–¹æ³•ï¼Œä¸»è¦åˆ†æä¸€ä¸‹å’ŒArrayListä¸åŒçš„æ–¹æ³•ã€‚ é¦–å…ˆæˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹ä»¥ä¸‹Vectorä¸­å®šä¹‰çš„å˜é‡","text":"Vectorï¼Œä¸€ä¸ªå¯å˜é•¿çš„æ•°ç»„ï¼Œåº•å±‚å®ç°ä¸ ArrayList å¤§åŒå°å¼‚ï¼Œä½†Vectoræ˜¯åŒæ­¥çš„ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰ï¼ŒVectorçš„å¾ˆå¤šæ–¹æ³•ä¹‹å‰éƒ½åŠ äº†å…³é”®å­—synchronizedï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ ç”±äºVectorçš„å®ç°å’ŒArrayListçš„å®ç°å¤§åŒå°å¼‚ï¼Œè¿™é‡Œå°±ä¸å†é€ä¸€åˆ†æVectorä¸­çš„æ–¹æ³•ï¼Œä¸»è¦åˆ†æä¸€ä¸‹å’ŒArrayListä¸åŒçš„æ–¹æ³•ã€‚ é¦–å…ˆæˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹ä»¥ä¸‹Vectorä¸­å®šä¹‰çš„å˜é‡ public class Vector&lt;E&gt; extends AbstractList&lt;E&gt; implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable &#123; protected Object[] elementData; // å­˜å‚¨Vectorä¸­å…ƒç´  protected int elementCount; // Vectorä¸­çš„å…ƒç´ ä¸ªæ•° protected int capacityIncrement; // Vectorçš„å¢é•¿ç³»æ•° private static final long serialVersionUID = -2767605614048989439L; // Vectorçš„åºåˆ—ç‰ˆæœ¬å· private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8; // èƒ½å¤Ÿåˆ†é…å…ƒç´ æ•°é‡çš„æœ€å¤§å€¼ &#125; æ„é€ æ–¹æ³•Vectoræœ‰å››ä¸ªæ„é€ æ–¹æ³•ï¼Œå…¶å†…éƒ¨æœ‰ä¸¤ä¸ªé‡è¦çš„å‚æ•°ï¼Œä¸€ä¸ªæ˜¯elementCountä»£è¡¨å½“å‰å…ƒç´ ä¸ªæ•°ï¼Œä¸€ä¸ªæ˜¯capacityIncrementä»£è¡¨å½“åˆ—è¡¨å…ƒç´ æ»¡äº†ä¹‹åå¢åŠ çš„å®¹é‡ã€‚å¦‚æœä¸è®¾ç½®capacityIncrementï¼Œé‚£ä¹ˆVectorå®¹é‡æ‰©å±•æ—¶é»˜è®¤å°†æ‰©å±•ä¸¤å€ï¼Œåœ¨ArrayListæºç åˆ†æä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ArrayListåœ¨æ‰©å®¹æ—¶é»˜è®¤å°†æ‰©å±•1.5å€ã€‚ectoråˆå§‹æ—¶å®¹é‡ä¸º10ï¼Œè€ŒArrayListåˆå§‹å®¹é‡ä¸º0ã€‚ // Vectoræ„é€ å‡½æ•°ã€‚é»˜è®¤å®¹é‡æ˜¯10ã€‚ public Vector() &#123; this(10); &#125; // æŒ‡å®šVectorå®¹é‡å¤§å°çš„æ„é€ å‡½æ•° public Vector(int initialCapacity) &#123; this(initialCapacity, 0); &#125; // æŒ‡å®šVector&quot;å®¹é‡å¤§å°&quot;å’Œ&quot;å¢é•¿ç³»æ•°&quot;çš„æ„é€ å‡½æ•° public Vector(int initialCapacity, int capacityIncrement) &#123; super(); if (initialCapacity &lt; 0) throw new IllegalArgumentException(&quot;Illegal Capacity: &quot;+ initialCapacity); // æ–°å»ºä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å®¹é‡æ˜¯initialCapacity this.elementData = new Object[initialCapacity]; // è®¾ç½®å®¹é‡å¢é•¿ç³»æ•° this.capacityIncrement = capacityIncrement; &#125; // æŒ‡å®šé›†åˆçš„Vectoræ„é€ å‡½æ•°ã€‚ public Vector(Collection&lt;? extends E&gt; c) &#123; // è·å–â€œé›†åˆ(c)â€çš„æ•°ç»„ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™elementData elementData = c.toArray(); // è®¾ç½®æ•°ç»„é•¿åº¦ elementCount = elementData.length; // c.toArray might (incorrectly) not return Object[] (see 6260652) if (elementData.getClass() != Object[].class) elementData = Arrays.copyOf(elementData, elementCount, Object[].class); &#125; Vectorä¸­çš„æ„é€ å™¨å’ŒArrayListä¸­çš„åŸºæœ¬ç›¸åŒï¼Œåªä¸è¿‡Vectorä¸­å¤šäº†ä¸€ä¸ªå¯ä»¥è‡ªå®šä¹‰å¢é•¿ç³»æ•°çš„æ„é€ å™¨public Vector(int initialCapacity, int capacityIncrement) æ‰©å®¹æœºåˆ¶Vectorä¸­çš„æ·»åŠ å…ƒç´ å’ŒArrayListä¸­çš„å¤§åŒå°å¼‚ï¼Œè¿™é‡Œä¸å†å…·ä½“åˆ†æï¼Œè¿™é‡Œåªåˆ†æä¸‹Vectorçš„æ‰©å®¹æœºåˆ¶ /** * å¢åŠ vectorå®¹é‡ * å¦‚æœvectorå½“å‰å®¹é‡å°äºè‡³å°‘éœ€è¦çš„å®¹é‡ï¼Œå®ƒçš„å®¹é‡å°†å¢åŠ ã€‚ * æ–°çš„å®¹é‡å°†åœ¨æ—§çš„å®¹é‡çš„åŸºç¡€ä¸ŠåŠ ä¸ŠcapacityIncrementï¼Œé™¤écapacityIncrementå°äºç­‰äº0ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®¹é‡å°†ä¼šå¢åŠ ä¸€å€ã€‚ * å¢åŠ åï¼Œå¦‚æœæ–°çš„å®¹é‡è¿˜æ˜¯å°äºè‡³å°‘éœ€è¦çš„å®¹é‡ï¼Œé‚£å°±å°†å®¹é‡æ‰©å®¹è‡³è‡³å°‘éœ€è¦çš„å®¹é‡ã€‚ */ public synchronized void ensureCapacity(int minCapacity) &#123; if (minCapacity &gt; 0) &#123; modCount++; ensureCapacityHelper(minCapacity); &#125; &#125; /** * ensureCapacity()æ–¹æ³•çš„unsynchronizedå®ç°ã€‚ * ensureCapacity()æ˜¯åŒæ­¥çš„ï¼Œå®ƒå¯ä»¥è°ƒç”¨æœ¬æ–¹æ³•æ¥æ‰©å®¹ï¼Œè€Œä¸ç”¨æ‰¿å—åŒæ­¥å¸¦æ¥çš„æ¶ˆè€— */ private void ensureCapacityHelper(int minCapacity) &#123; // å¦‚æœè‡³å°‘éœ€è¦çš„å®¹é‡ &gt; æ•°ç»„ç¼“å†²åŒºå½“å‰çš„é•¿åº¦ï¼Œå°±è¿›è¡Œæ‰©å®¹ if (minCapacity - elementData.length &gt; 0) grow(minCapacity); &#125; /** * åˆ†æ´¾ç»™arraysçš„æœ€å¤§å®¹é‡ * ä¸ºä»€ä¹ˆè¦å‡å»8å‘¢ï¼Ÿ * å› ä¸ºæŸäº›VMä¼šåœ¨æ•°ç»„ä¸­ä¿ç•™ä¸€äº›å¤´å­—ï¼Œå°è¯•åˆ†é…è¿™ä¸ªæœ€å¤§å­˜å‚¨å®¹é‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´arrayå®¹é‡å¤§äºVMçš„limitï¼Œæœ€ç»ˆå¯¼è‡´OutOfMemoryErrorã€‚ */ private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8; /** * æ‰©å®¹ï¼Œä¿è¯vectorè‡³å°‘èƒ½å­˜å‚¨minCapacityä¸ªå…ƒç´ ã€‚ * é¦–æ¬¡æ‰©å®¹æ—¶ï¼ŒnewCapacity = oldCapacity + ((capacityIncrement &gt; 0) ?capacityIncrement : oldCapacity);å³å¦‚æœcapacityIncrement&gt;0ï¼Œå°±åŠ capacityIncrementï¼Œå¦‚æœä¸æ˜¯å°±å¢åŠ ä¸€å€ã€‚ * å¦‚æœç¬¬ä¸€æ¬¡æ‰©å®¹åï¼Œå®¹é‡è¿˜æ˜¯å°äºminCapacityï¼Œå°±ç›´æ¥å°†å®¹é‡å¢ä¸ºminCapacityã€‚ */ private void grow(int minCapacity) &#123; // è·å–å½“å‰æ•°ç»„çš„å®¹é‡ int oldCapacity = elementData.length; //è®¡ç®—ç›®æ ‡å®¹é‡ï¼Œå¦‚æœæŒ‡å®šäº†æ¯æ¬¡æ‰©å±•çš„é‡ï¼Œç›´æ¥å¢åŠ ï¼Œå¦‚æœæ²¡æœ‰å°±ç›´æ¥ç¿»å€ int newCapacity = oldCapacity + ((capacityIncrement &gt; 0) ? capacityIncrement : oldCapacity); //å¦‚æœè‡ªåŠ¨æ‰©å®¹çš„å®¹é‡æ— æ³•æ»¡è¶³ç”¨æˆ·æŒ‡å®šçš„å®¹é‡ï¼Œåˆ™ç›´æ¥æ‰©å®¹åˆ°ç”¨æˆ·æŒ‡å®šçš„å®¹é‡ if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; ///å¦‚æœæ‰©å®¹åçš„å®¹é‡å¤§äºä¸´ç•Œå€¼ï¼Œåˆ™è¿›è¡Œå¤§å®¹é‡åˆ†é… if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); elementData = Arrays.copyOf(elementData, newCapacity); &#125; // è¿›è¡Œå¤§å®¹é‡åˆ†é… private static int hugeCapacity(int minCapacity) &#123; //æ•°æ®æº¢å‡ºï¼ŒæŠ›å‡ºå¼‚å¸¸ if (minCapacity &lt; 0) // overflow throw new OutOfMemoryError(); //å¦‚æœæƒ³è¦çš„å®¹é‡å¤§äºMAX_ARRAY_SIZEï¼Œåˆ™åˆ†é…Integer.MAX_VALUEï¼Œå¦åˆ™åˆ†é…MAX_ARRAY_SIZE return (minCapacity &gt; MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE; &#125; å…¶ä»–æ–¹æ³•Vectorä¸­æ·»åŠ ä¸€ä¸ªæšä¸¾æ–¹æ³• // è¿”å›ä¸€ä¸ªæšä¸¾ç±»å‹çš„å¯¹è±¡ public Enumeration&lt;E&gt; elements() &#123; return new Enumeration&lt;E&gt;() &#123; int count = 0; public boolean hasMoreElements() &#123; // åˆ¤æ–­åé¢æ˜¯å¦è¿˜æœ‰æ•°æ® return count &lt; elementCount; &#125; public E nextElement() &#123; // è¿”å›ä¸€ä¸ªæ•°æ® synchronized (Vector.this) &#123; if (count &lt; elementCount) &#123; return elementData(count++); &#125; &#125; throw new NoSuchElementException(&quot;Vector Enumeration&quot;); &#125; &#125;; &#125; å…¶ä»–ç±»åŒæ–¹æ³•è¯·å‚è€ƒArrayListæºç åˆ†æVectorä¸ArrayListçš„æœ€å¤§åŒºåˆ«å°±æ˜¯Vectoræ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€ŒArrayListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦å¤–åŒºåˆ«è¿˜æœ‰ï¼š ArrayListä¸å¯ä»¥è®¾ç½®æ‰©å±•çš„å®¹é‡ï¼Œé»˜è®¤1.5å€ï¼›Vectorå¯ä»¥è®¾ç½®æ‰©å±•çš„å®¹é‡ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé»˜è®¤2å€ ArrayListçš„æ— å‚æ„é€ æ–¹æ³•ä¸­åˆå§‹å®¹é‡ä¸º0ï¼Œè€ŒVectorçš„æ— å‚æ„é€ æ–¹æ³•ä¸­åˆå§‹å®¹é‡ä¸º10ã€‚ ä¸‹é¢æˆ‘ä»¬å†æ¥åˆ†æä¸‹Vectorçš„å­ç±»Stackæ–¹æ³•ã€‚ StackStackç±»ä»£è¡¨æœ€å…ˆè¿›å…ˆå‡ºï¼ˆLIFOï¼‰å †æ ˆçš„å¯¹è±¡ã€‚ å®ƒæ‰©å±•äº†Vectoräº”ä¸ªæ“ä½œï¼Œå…è®¸ä¸€ä¸ªvectorè¢«è§†ä¸ºå †æ ˆã€‚äº”ä¸ªæ–¹æ³•åˆ†åˆ«æ˜¯ï¼š push() æ·»åŠ å…ƒç´ åˆ°å †æ ˆçš„é¡¶éƒ¨ pop() åˆ é™¤å †æ ˆé¡¶éƒ¨å…ƒç´  peek() æŸ¥çœ‹å †æ ˆé¡¶éƒ¨å…ƒç´  empty() åˆ¤æ–­å †æ ˆæ˜¯å¦ä¸ºç©º search() è¿”å›å…ƒç´ æ‰€åœ¨ä½ç½® package java.util; public class Stack&lt;E&gt; extends Vector&lt;E&gt; &#123; /** * Creates an empty Stack. */ public Stack() &#123; &#125; public E push(E item) &#123; addElement(item); // è°ƒç”¨vectorä¸­çš„æ–¹æ³•åœ¨æ ˆé¡¶æ·»åŠ ä¸€ä¸ªå…ƒç´  return item; &#125; public synchronized E pop() &#123; E obj; int len = size(); obj = peek(); removeElementAt(len - 1); // è°ƒç”¨vectorä¸­çš„æ–¹æ³•åˆ é™¤æ ˆé¡¶çš„å…ƒç´  return obj; &#125; public synchronized E peek() &#123; int len = size(); // è¿”å›æ ˆé¡¶å…ƒç´  if (len == 0) throw new EmptyStackException(); return elementAt(len - 1); &#125; public boolean empty() &#123; return size() == 0; &#125; public synchronized int search(Object o) &#123; int i = lastIndexOf(o); // å› ä¸ºLIFO æ‰€ä»¥é€‰æ‹©ä»åå¾€å‰éå† if (i &gt;= 0) &#123; return size() - i; &#125; return -1; &#125; /** use serialVersionUID from JDK 1.0.2 for interoperability */ private static final long serialVersionUID = 1224463164541339165L; &#125;","categories":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://gyl-coder.top/tags/%E9%9B%86%E5%90%88/"},{"name":"Vector","slug":"Vector","permalink":"https://gyl-coder.top/tags/Vector/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"ArrayListåŠ¨æ€æ‰©å®¹æœºåˆ¶","slug":"java/collection/ArrayList_grow","date":"2020-07-02T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"java/collection/ArrayList_grow/","link":"","permalink":"https://gyl-coder.top/java/collection/ArrayList_grow/","excerpt":"æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“çš„ä¾‹å­çœ‹ä¸€ä¸‹ArrayListçš„æ‰©å®¹æ•ˆæœå…ˆçœ‹ä¸€ä¸‹ArrayListçš„åˆå§‹å®¹é‡ ArrayList&lt;Integer&gt; array = new ArrayList&lt;&gt;(); Integer capacity = getCapacity(array); int size = array.size(); System.out.println(&quot;å®¹é‡ï¼š&quot;+capacity); System.out.println(&quot;å¤§å°ï¼š&quot;+size); å®¹é‡ï¼š0 å¤§å°ï¼š0 getCapacityï¼ˆï¼‰æ–¹æ³•æ˜¯ç”¨æ¥è·å–é›†åˆå®¹é‡çš„ï¼ŒArrayListé€šè¿‡ä¸€ä¸ªelementDataå¯¹è±¡æ•°ç»„å‚¨å­˜æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ArrayListçš„å®¹é‡å°±æ˜¯è¯¥æ•°ç»„çš„é•¿åº¦ã€‚æ‰€ä»¥æˆ‘ä»¬åªè¦å¾—åˆ°äº†elementDataæ•°ç»„å°±å¯ä»¥çŸ¥é“ArrayListçš„å®é™…å®¹é‡ã€‚","text":"æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå…·ä½“çš„ä¾‹å­çœ‹ä¸€ä¸‹ArrayListçš„æ‰©å®¹æ•ˆæœå…ˆçœ‹ä¸€ä¸‹ArrayListçš„åˆå§‹å®¹é‡ ArrayList&lt;Integer&gt; array = new ArrayList&lt;&gt;(); Integer capacity = getCapacity(array); int size = array.size(); System.out.println(&quot;å®¹é‡ï¼š&quot;+capacity); System.out.println(&quot;å¤§å°ï¼š&quot;+size); å®¹é‡ï¼š0 å¤§å°ï¼š0 getCapacityï¼ˆï¼‰æ–¹æ³•æ˜¯ç”¨æ¥è·å–é›†åˆå®¹é‡çš„ï¼ŒArrayListé€šè¿‡ä¸€ä¸ªelementDataå¯¹è±¡æ•°ç»„å‚¨å­˜æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ArrayListçš„å®¹é‡å°±æ˜¯è¯¥æ•°ç»„çš„é•¿åº¦ã€‚æ‰€ä»¥æˆ‘ä»¬åªè¦å¾—åˆ°äº†elementDataæ•°ç»„å°±å¯ä»¥çŸ¥é“ArrayListçš„å®é™…å®¹é‡ã€‚ ç”±äºelementDataæ˜¯ç§æœ‰çš„æ— æ³•ç›´æ¥å¾—åˆ°ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡åå°„çš„æ–¹å¼è·å–ã€‚ ä»£ç å¦‚ä¸‹ï¼š public static Integer getCapacity(ArrayList list) &#123; Integer length = null; Class c = ((Object)list).getClass(); Field f; try &#123; f = c.getDeclaredField(&quot;elementData&quot;); f.setAccessible(true); Object[] o = (Object[]) f.get(list); length = o.length; &#125; catch (NoSuchFieldException ex) &#123; Logger.getLogger(CollectionDemo.class.getName()).log(Level.SEVERE, null, ex); &#125; catch (SecurityException ex) &#123; Logger.getLogger(CollectionDemo.class.getName()).log(Level.SEVERE, null, ex); &#125; catch (IllegalArgumentException ex) &#123; Logger.getLogger(CollectionDemo.class.getName()).log(Level.SEVERE, null, ex); &#125; catch (IllegalAccessException ex) &#123; Logger.getLogger(CollectionDemo.class.getName()).log(Level.SEVERE, null, ex); &#125; return length; &#125; æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å‘ArrayListä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´  ArrayList&lt;Integer&gt; array = new ArrayList&lt;&gt;(); array.add(1); Integer capacity = getCapacity(array); int size = array.size(); System.out.println(&quot;å®¹é‡ï¼š&quot;+capacity); System.out.println(&quot;å¤§å°ï¼š&quot;+size); å®¹é‡ï¼š10 å¤§å°ï¼š1 å‘ArrayListä¸­æ·»åŠ 11ä¸ªå…ƒç´  ArrayList&lt;Integer&gt; array = new ArrayList&lt;&gt;(); for (int i = 0; i &lt; 11; i ++) &#123; array.add(i); &#125; Integer capacity = getCapacity(array); int size = array.size(); System.out.println(&quot;å®¹é‡ï¼š&quot;+capacity); System.out.println(&quot;å¤§å°ï¼š&quot;+size); å®¹é‡ï¼š15 å¤§å°ï¼š11 æˆ‘ä»¬å‘ç°ï¼Œå½“å‘arrayä¸­æ·»åŠ 11ä¸ªå…ƒç´ ä¹‹åï¼Œarrayçš„å®¹é‡æ‰©å¤§åˆ°åŸæ¥çš„1.5å€ã€‚ Why does it expansion 1.5 times? å…·ä½“ä¸ºä»€ä¹ˆï¼Œä¸‹é¢æˆ‘ä»¬çœ‹ä¸€ä¸‹æºç ï¼š /** * Appends the specified element to the end of this list. * * @param e element to be appended to this list * @return &lt;tt&gt;true&lt;/tt&gt; (as specified by &#123;@link Collection#add&#125;) */ public boolean add(E e) &#123; ensureCapacityInternal(size + 1); // Increments modCount!! elementData[size++] = e; return true; &#125; addæ–¹æ³•æ˜¯é€šè¿‡åœ¨arrayçš„å°¾éƒ¨è¿½åŠ å…ƒç´ çš„æ–¹æ³•ï¼Œæ·»åŠ æ•°æ®çš„ã€‚å…¶ä¸­ï¼Œè°ƒç”¨ensureCapacityInternalæ–¹æ³•ç”¨æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹. private void ensureCapacityInternal(int minCapacity) &#123; if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123; minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity); &#125; ensureExplicitCapacity(minCapacity); &#125; private void ensureExplicitCapacity(int minCapacity) &#123; modCount++; // overflow-conscious code if (minCapacity - elementData.length &gt; 0) grow(minCapacity); &#125; å‚æ•°ä¼ çš„æ˜¯å½“å‰éœ€è¦çš„æœ€å°å®¹é‡ï¼Œæ–¹æ³•é¦–å…ˆç¡®è®¤å½“å‰ArrayListå®ä¾‹æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™æ¯”è¾ƒæ‰€éœ€å®¹é‡å’Œé»˜è®¤å®¹é‡ï¼Œå–å…¶è¾ƒå¤§å€¼ä½œä¸ºæ‰€éœ€æœ€å°å®¹é‡å€¼ã€‚ç„¶åæ‰§è¡ŒensureExplicitCapacityè¿›ä¸€æ­¥ç¡®å®šå®¹é‡ï¼Œä»¥åŠæ˜¯å¦éœ€è¦æ‰©å®¹ã€‚å½“æ‰€éœ€æœ€å°å®¹é‡å¤§äºå½“å‰elementDataæ•°ç»„é•¿åº¦æ—¶ï¼Œè¦è¿›è¡Œæ‰©å®¹æ“ä½œã€‚modCountæ˜¯fail fastæœºåˆ¶ï¼Œä¸äº†è§£ä¹Ÿä¸å½±å“ï¼Œå¦‚æœæƒ³äº†è§£å¯ä»¥çœ‹è¿™é‡Œ,å¦‚æœminCapacityçš„å€¼å¤§äºæ·»åŠ æ•°æ®ä¹‹å‰çš„å¤§å°ï¼Œå°±è°ƒç”¨growæ–¹æ³•ï¼Œè¿›è¡Œæ‰©å®¹ï¼Œå¦åˆ™ä»€ä¹ˆä¹Ÿä¸åšã€‚ å‘ç”Ÿæ‰©å®¹çš„æ¡ä»¶æ ¹æ®ä¼ å…¥çš„æœ€å°éœ€è¦å®¹é‡minCapacityæ¥å’Œæ•°ç»„çš„å®¹é‡é•¿åº¦å¯¹æ¯”ï¼Œè‹¥minCapactityå¤§äºæˆ–ç­‰äºæ•°ç»„å®¹é‡ï¼Œåˆ™éœ€è¦è¿›è¡Œæ‰©å®¹ã€‚(å¦‚æœå®é™…å­˜å‚¨æ•°ç»„æ˜¯ç©ºæ•°ç»„ï¼Œåˆ™æœ€å°éœ€è¦å®¹é‡å°±æ˜¯é»˜è®¤å®¹é‡)ä»¥ä¸Šåªæ˜¯çœŸå®å®¹é‡å’Œæ‰€éœ€å®¹é‡çš„æ¯”è¾ƒï¼Œå…¶ç›®çš„æ˜¯è®¡ç®—å‡ºarrayçš„æœ€ç»ˆå®¹é‡ã€‚çœŸæ­£å®ç°æ‰©å®¹çš„æ–¹æ³•æ˜¯growæ–¹æ³•ã€‚ä¸‹é¢å…·ä½“æ¥äº†è§£æ‰©å®¹æœºåˆ¶çš„å¢é•¿è§„åˆ™ /** * Increases the capacity to ensure that it can hold at least the * number of elements specified by the minimum capacity argument. * * @param minCapacity the desired minimum capacity */ private void grow(int minCapacity) &#123; // overflow-conscious code int oldCapacity = elementData.length; int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1); if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); // minCapacity is usually close to size, so this is a win: elementData = Arrays.copyOf(elementData, newCapacity); &#125; è¿™é‡Œä¼ è¿‡æ¥çš„minCapacityçš„å€¼æ˜¯arrayçš„size+1 æ·»åŠ ä¸€ä¸ªå…ƒç´ ï¼Œé¦–å…ˆè®¡ç®—å½“å‰çš„arrayæ‰€éœ€æœ€å°çš„å®¹é‡å¤§å°ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ç­‰ã€‚ å½“éœ€è¦æ‰©å®¹æ—¶ï¼š å¾—åˆ°å½“å‰çš„ArrayListçš„å®¹é‡(oldCapacity)ã€‚ è®¡ç®—é™¤æ‰©å®¹åçš„æ–°å®¹é‡(newCapacity)ï¼Œå…¶å€¼(oldCapacity + (oldCapacity &gt;&gt;1))çº¦æ˜¯oldCapacity çš„1.5å€ã€‚ è¿™é‡Œé‡‡ç”¨çš„æ˜¯ç§»ä½è¿ç®—ã€‚ä¸ºä»€ä¹ˆé‡‡ç”¨è¿™ç§æ–¹æ³•å‘¢ï¼Ÿåº”è¯¥æ˜¯å‡ºäºæ•ˆç‡çš„è€ƒè™‘ã€‚ å½“newCapacityå°äºæ‰€éœ€æœ€å°å®¹é‡ï¼Œé‚£ä¹ˆå°†æ‰€éœ€æœ€å°å®¹é‡èµ‹å€¼ç»™newCapacityã€‚ newCapacityå¤§äºArrayListçš„æ‰€å…è®¸çš„æœ€å¤§å®¹é‡,å¤„ç†ã€‚è¿›è¡Œæ•°æ®çš„å¤åˆ¶ï¼Œå®Œæˆå‘ArrayListå®ä¾‹æ·»åŠ å…ƒç´ æ“ä½œã€‚ æ¯æ¬¡arrayçš„sizeåˆ°è¾¾å½“å‰çš„å®¹é‡æœ€å¤§å€¼åï¼Œå†æ’å…¥æ•°æ®å°±ä¼šé€ æˆæ‰©å®¹ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://gyl-coder.top/tags/%E9%9B%86%E5%90%88/"},{"name":"ArrayList","slug":"ArrayList","permalink":"https://gyl-coder.top/tags/ArrayList/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"ArrayList åº•å±‚å®ç°åŸç†åˆ†æ","slug":"java/collection/ArrayList","date":"2020-07-01T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"java/collection/ArrayList/","link":"","permalink":"https://gyl-coder.top/java/collection/ArrayList/","excerpt":"ArrayListæ˜¯Listæ¥å£çš„ å¯å˜æ•°ç»„çš„å®ç°ã€‚å®ç°äº†æ‰€æœ‰å¯é€‰åˆ—è¡¨æ“ä½œï¼Œå¹¶å…è®¸åŒ…æ‹¬ null åœ¨å†…çš„æ‰€æœ‰å…ƒç´ ã€‚é™¤äº†å®ç° Listæ¥å£å¤–ï¼Œæ­¤ç±»è¿˜æä¾›ä¸€äº›æ–¹æ³•æ¥æ“ä½œå†…éƒ¨ç”¨æ¥å­˜å‚¨åˆ—è¡¨çš„æ•°ç»„çš„å¤§å°ã€‚ArrayListç»§æ‰¿è‡ª AbstractListï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»å¯¹ä¸€äº›åŸºç¡€çš„listæ“ä½œåšäº†ä¸€äº›å°è£….å®ç°äº†RandomAccess æ ‡è®°æ¥å£ï¼Œè¡¨æ˜å¯ä»¥å®ç°å¿«é€Ÿéšæœºè®¿é—®.å®ç°äº†Cloneableæ¥å£çš„å®ç°è¡¨ç¤ºè¯¥å®¹å™¨å…·æœ‰Cloneå‡½æ•°æ“ä½œï¼ŒSerializableæ˜¯åºåˆ—åŒ–ã€‚ æ¯ä¸ªArrayListå®ä¾‹éƒ½æœ‰ä¸€ä¸ªå®¹é‡ï¼Œè¯¥å®¹é‡æ˜¯æŒ‡ç”¨æ¥å­˜å‚¨åˆ—è¡¨å…ƒç´ çš„æ•°ç»„çš„å¤§å°ã€‚å®ƒæ€»æ˜¯è‡³å°‘ç­‰äºåˆ—è¡¨çš„å¤§å°ã€‚éšç€å‘ArrayListä¸­ä¸æ–­æ·»åŠ å…ƒç´ ï¼Œå…¶å®¹é‡ä¹Ÿè‡ªåŠ¨å¢é•¿ã€‚è‡ªåŠ¨å¢é•¿ä¼šå¸¦æ¥æ•°æ®å‘æ–°æ•°ç»„çš„é‡æ–°æ‹·è´ï¼Œå› æ­¤ï¼Œå¦‚æœå¯é¢„çŸ¥æ•°æ®é‡çš„å¤§å°ï¼Œå°±å¯åœ¨æ„é€ ArrayListå®ä¾‹æ—¶æŒ‡å®šå…¶å®¹é‡ã€‚ åœ¨æ·»åŠ å¤§é‡å…ƒç´ å‰ï¼Œåº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥ä½¿ç”¨ensureCapacityæ“ä½œæ¥å¢åŠ ArrayListå®ä¾‹çš„å®¹é‡ï¼Œè¿™å¯ä»¥å‡å°‘é€’å¢å¼å†åˆ†é…çš„æ•°é‡ã€‚ æ³¨æ„ï¼Œæ­¤å®ç°ä¸æ˜¯åŒæ­¥çš„ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªArrayListå®ä¾‹ï¼Œè€Œå…¶ä¸­è‡³å°‘ä¸€ä¸ªçº¿ç¨‹ä»ç»“æ„ä¸Šä¿®æ”¹äº†åˆ—è¡¨ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»ä¿æŒå¤–éƒ¨åŒæ­¥ã€‚ ArrayListè¿™ä¸ªæ•°æ®ç»“æ„æ¯”è¾ƒç®€å•ï¼Œæ€»ä½“æ¥è¯´ï¼ŒArrayListåº•å±‚ç»“æ„æ˜¯æ•°ç»„ï¼Œä»–çš„å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯ä»æ•°ç»„ä¸Šé¢æ¼”å˜è€Œæ¥çš„ã€‚ ä¸‹é¢æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ArrayListä¸­çš„ä¸€äº›åˆå§‹å€¼","text":"ArrayListæ˜¯Listæ¥å£çš„ å¯å˜æ•°ç»„çš„å®ç°ã€‚å®ç°äº†æ‰€æœ‰å¯é€‰åˆ—è¡¨æ“ä½œï¼Œå¹¶å…è®¸åŒ…æ‹¬ null åœ¨å†…çš„æ‰€æœ‰å…ƒç´ ã€‚é™¤äº†å®ç° Listæ¥å£å¤–ï¼Œæ­¤ç±»è¿˜æä¾›ä¸€äº›æ–¹æ³•æ¥æ“ä½œå†…éƒ¨ç”¨æ¥å­˜å‚¨åˆ—è¡¨çš„æ•°ç»„çš„å¤§å°ã€‚ArrayListç»§æ‰¿è‡ª AbstractListï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»å¯¹ä¸€äº›åŸºç¡€çš„listæ“ä½œåšäº†ä¸€äº›å°è£….å®ç°äº†RandomAccess æ ‡è®°æ¥å£ï¼Œè¡¨æ˜å¯ä»¥å®ç°å¿«é€Ÿéšæœºè®¿é—®.å®ç°äº†Cloneableæ¥å£çš„å®ç°è¡¨ç¤ºè¯¥å®¹å™¨å…·æœ‰Cloneå‡½æ•°æ“ä½œï¼ŒSerializableæ˜¯åºåˆ—åŒ–ã€‚ æ¯ä¸ªArrayListå®ä¾‹éƒ½æœ‰ä¸€ä¸ªå®¹é‡ï¼Œè¯¥å®¹é‡æ˜¯æŒ‡ç”¨æ¥å­˜å‚¨åˆ—è¡¨å…ƒç´ çš„æ•°ç»„çš„å¤§å°ã€‚å®ƒæ€»æ˜¯è‡³å°‘ç­‰äºåˆ—è¡¨çš„å¤§å°ã€‚éšç€å‘ArrayListä¸­ä¸æ–­æ·»åŠ å…ƒç´ ï¼Œå…¶å®¹é‡ä¹Ÿè‡ªåŠ¨å¢é•¿ã€‚è‡ªåŠ¨å¢é•¿ä¼šå¸¦æ¥æ•°æ®å‘æ–°æ•°ç»„çš„é‡æ–°æ‹·è´ï¼Œå› æ­¤ï¼Œå¦‚æœå¯é¢„çŸ¥æ•°æ®é‡çš„å¤§å°ï¼Œå°±å¯åœ¨æ„é€ ArrayListå®ä¾‹æ—¶æŒ‡å®šå…¶å®¹é‡ã€‚ åœ¨æ·»åŠ å¤§é‡å…ƒç´ å‰ï¼Œåº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥ä½¿ç”¨ensureCapacityæ“ä½œæ¥å¢åŠ ArrayListå®ä¾‹çš„å®¹é‡ï¼Œè¿™å¯ä»¥å‡å°‘é€’å¢å¼å†åˆ†é…çš„æ•°é‡ã€‚ æ³¨æ„ï¼Œæ­¤å®ç°ä¸æ˜¯åŒæ­¥çš„ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªArrayListå®ä¾‹ï¼Œè€Œå…¶ä¸­è‡³å°‘ä¸€ä¸ªçº¿ç¨‹ä»ç»“æ„ä¸Šä¿®æ”¹äº†åˆ—è¡¨ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»ä¿æŒå¤–éƒ¨åŒæ­¥ã€‚ ArrayListè¿™ä¸ªæ•°æ®ç»“æ„æ¯”è¾ƒç®€å•ï¼Œæ€»ä½“æ¥è¯´ï¼ŒArrayListåº•å±‚ç»“æ„æ˜¯æ•°ç»„ï¼Œä»–çš„å¾ˆå¤šæ–¹æ³•éƒ½æ˜¯ä»æ•°ç»„ä¸Šé¢æ¼”å˜è€Œæ¥çš„ã€‚ ä¸‹é¢æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ArrayListä¸­çš„ä¸€äº›åˆå§‹å€¼ //é€šè¿‡ArrayListå®ç°çš„æ¥å£å¯çŸ¥ï¼Œå…¶æ”¯æŒéšæœºè®¿é—®ï¼Œèƒ½è¢«å…‹éš†ï¼Œæ”¯æŒåºåˆ—åŒ– public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt; implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable &#123; //åºåˆ—ç‰ˆæœ¬å· private static final long serialVersionUID = 8683452581122892189L; //é»˜è®¤åˆå§‹å®¹é‡ private static final int DEFAULT_CAPACITY = 10; //ç©ºå®ä¾‹çš„å…±äº«ç©ºæ•°ç»„å®ä¾‹ private static final Object[] EMPTY_ELEMENTDATA = &#123;&#125;; //è¢«ç”¨äºé»˜è®¤å¤§å°çš„ç©ºå®ä¾‹çš„å…±äº«æ•°ç»„å®ä¾‹ã€‚ //ä¸EMPTY_ELEMENTDATAçš„åŒºåˆ«æ˜¯ï¼šå½“æˆ‘ä»¬å‘æ•°ç»„ä¸­æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼ŒçŸ¥é“æ•°ç»„è¯¥æ‰©å……å¤šå°‘ã€‚ private static final Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;; /** * Object[]ç±»å‹çš„æ•°ç»„ï¼Œä¿å­˜äº†æ·»åŠ åˆ°ArrayListä¸­çš„å…ƒç´ ã€‚ArrayListçš„å®¹é‡æ˜¯è¯¥Object[]ç±»å‹æ•°ç»„çš„é•¿åº¦ * å½“ç¬¬ä¸€ä¸ªå…ƒç´ è¢«æ·»åŠ æ—¶ï¼Œä»»ä½•ç©ºArrayListä¸­çš„elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATAå°†ä¼šè¢« * æ‰©å……åˆ°DEFAULT_CAPACITYï¼ˆé»˜è®¤å®¹é‡ï¼‰ã€‚ */ transient Object[] elementData; //æ²¡æœ‰è¢«ç§æœ‰åŒ–æ˜¯ä¸ºäº†ç®€åŒ–å†…éƒ¨ç±»è®¿é—® // ArrayListçš„å¤§å°ï¼ˆæŒ‡å…¶æ‰€å«çš„å…ƒç´ ä¸ªæ•°ï¼‰ private int size; // è®°å½•è¢«ä¿®æ”¹çš„æ¬¡æ•° protected transient int modCount = 0; // æ•°ç»„çš„æœ€å¤§å€¼ private static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8 &#125; elementData æ˜¯â€Object[] ç±»å‹çš„æ•°ç»„â€ï¼Œå®ƒä¿å­˜äº†æ·»åŠ åˆ°ArrayListä¸­çš„å…ƒç´ ã€‚å®é™…ä¸Šï¼ŒelementDataæ˜¯ä¸ªåŠ¨æ€æ•°ç»„ï¼Œæˆ‘ä»¬èƒ½é€šè¿‡æ„é€ å‡½æ•° ArrayList(intinitialCapacity)æ¥æ‰§è¡Œå®ƒçš„åˆå§‹å®¹é‡ä¸ºinitialCapacityï¼›å¦‚æœé€šè¿‡ä¸å«å‚æ•°çš„æ„é€ å‡½æ•°ArrayList()æ¥åˆ›å»ºArrayListï¼Œåˆ™elementDataçš„å®¹é‡é»˜è®¤æ˜¯10ã€‚elementDataæ•°ç»„çš„å¤§å°ä¼šæ ¹æ®ArrayListå®¹é‡çš„å¢é•¿è€ŒåŠ¨æ€çš„å¢é•¿ã€‚ æ„é€ å‡½æ•°ArrayListæä¾›äº†ä¸‰ç§æ–¹å¼çš„æ„é€ å™¨ã€‚å¯ä»¥æ„é€ ä¸€ä¸ªé»˜è®¤åˆå§‹å®¹é‡ä¸º10çš„ç©ºåˆ—è¡¨ã€æ„é€ ä¸€ä¸ªæŒ‡å®šåˆå§‹å®¹é‡çš„ç©ºåˆ—è¡¨ä»¥åŠæ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®šcollectionçš„å…ƒç´ çš„åˆ—è¡¨ã€‚ è¿™äº›å…ƒç´ æŒ‰ç…§è¯¥collectionçš„è¿­ä»£å™¨è¿”å›çš„é¡ºåºæ’åˆ—çš„ã€‚ // æ„é€ ä¸€ä¸ªæŒ‡å®šåˆå§‹å®¹é‡çš„ç©ºåˆ—è¡¨ public ArrayList(int initialCapacity) &#123; if (initialCapacity &gt; 0) &#123; this.elementData = new Object[initialCapacity]; &#125; else if (initialCapacity == 0) &#123; this.elementData = EMPTY_ELEMENTDATA; &#125; else &#123; // å¦‚æœç»™å®šçš„åˆå§‹å®¹é‡ä¸ºè´Ÿå€¼ throw new IllegalArgumentException(&quot;Illegal Capacity: &quot;+ initialCapacity); &#125; &#125; // æ„é€ ä¸€ä¸ªé»˜è®¤åˆå§‹å®¹é‡ä¸º10çš„ç©ºåˆ—è¡¨ public ArrayList() &#123; //è¿™é‡Œå¹¶æ²¡æœ‰åˆå§‹åŒ–ï¼Œjdk 1.8ä¹‹åæ˜¯åœ¨è¿›è¡Œaddæ“ä½œååˆå§‹åŒ– this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA; &#125; // æ„é€ ä¸€ä¸ªåŒ…å«æŒ‡å®šcollectionçš„å…ƒç´ çš„åˆ—è¡¨ï¼Œè¿™äº›å…ƒç´ æŒ‰ç…§è¯¥collectionçš„è¿­ä»£å™¨è¿”å›çš„é¡ºåºæ’åˆ—çš„ public ArrayList(Collection&lt;? extends E&gt; c) &#123; elementData = c.toArray(); if ((size = elementData.length) != 0) &#123; // c.toArray()å¯èƒ½ä¸ä¼šæ­£ç¡®åœ°è¿”å›ä¸€ä¸ª Object[]æ•°ç»„ï¼Œé‚£ä¹ˆä½¿ç”¨Arrays.copyOf()æ–¹æ³• if (elementData.getClass() != Object[].class) elementData = Arrays.copyOf(elementData, size, Object[].class); &#125; else &#123; // å¦‚æœæŒ‡å®šçš„collectionä¸ºç©º this.elementData = EMPTY_ELEMENTDATA; &#125; &#125; ä½¿ç”¨æ— å‚æ„é€ å™¨ï¼Œé»˜è®¤åˆå§‹å®¹é‡ä¸ºä»€ä¹ˆæ˜¯10ï¼Ÿ åˆå§‹æ—¶ï¼šthis.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {}; size = 0; å‘æ•°ç»„ä¸­æ·»åŠ ç¬¬ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œadd(E e)æ–¹æ³•ä¸­è°ƒç”¨äº†ensureCapacityInternal(size + 1)æ–¹æ³•ï¼Œå³ensureCapacityInternal(1)ï¼› åœ¨ensureCapacityInternal(int minCapacity)æ–¹æ³•ä¸­ï¼ŒminCapacity=DEFAULT_CAPACITY=10ï¼Œç„¶åå†è°ƒç”¨ensureExplicitCapacity(minCapacity)æ–¹æ³•ï¼Œå³ensureExplicitCapacity(10)ï¼› åœ¨ensureExplicitCapacity(minCapacity)æ–¹æ³•ä¸­è°ƒç”¨grow(minCapacity)æ–¹æ³•ï¼Œå³grow(10)ï¼Œæ­¤å¤„ä¸ºçœŸæ­£å…·ä½“çš„æ•°ç»„æ‰©å®¹çš„ç®—æ³•ï¼Œåœ¨æ­¤æ–¹æ³•ä¸­ï¼Œé€šè¿‡elementData = Arrays.copyOf(elementData, 10)å…·ä½“å®ç°äº†elementDataæ•°ç»„åˆå§‹å®¹é‡ä¸º10çš„æ„é€ ã€‚ æ·»åŠ å…ƒç´ // åœ¨æ•°ç»„æœ«å°¾åŠ ä¸Šä¸€ä¸ªå…ƒç´  public boolean add(E e) &#123; ensureCapacityInternal(size + 1); // è¿›è¡Œæ‰©å®¹æ£€æŸ¥ elementData[size++] = e; return true; &#125; // åœ¨æ•°ç»„çš„æŒ‡å®šä½ç½®æ·»åŠ å…ƒç´  public void add(int index, E element) &#123; rangeCheckForAdd(index); // æ£€æŸ¥indexæ˜¯å¦è¶Šç•Œ ensureCapacityInternal(size + 1); // è¿›è¡Œæ‰©å®¹æ£€æŸ¥ // å¯¹æ•°æ®è¿›è¡Œå¤åˆ¶æ“ä½œï¼Œç©ºå‡ºindexä½ç½®ï¼Œå¹¶æ’å…¥elementï¼Œå°†æºæ•°ç»„ä¸­ä»indexä½ç½®å¼€å§‹åçš„size-indexä¸ªå…ƒç´ ç»Ÿä¸€åç§»ä¸€ä½ System.arraycopy(elementData, index, elementData, index + 1, size - index); elementData[index] = element; size++; // å…ƒç´ ä¸ªæ•°åŠ 1 &#125; // æŒ‰ç…§æŒ‡å®šcollectioné›†åˆçš„è¿­ä»£å™¨æ‰€è¿”å›çš„å…ƒç´ é¡ºåºï¼Œå°†è¯¥collectionä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°åˆ—è¡¨çš„å°¾éƒ¨ public boolean addAll(Collection&lt;? extends E&gt; c) &#123; Object[] a = c.toArray(); // å°†collectionè½¬æ¢ä¸ºæ•°ç»„ç±»å‹ int numNew = a.length; // collectionä¸­çš„å…ƒç´ ä¸ªæ•° ensureCapacityInternal(size + numNew); // è¿›è¡Œæ‰©å®¹æ£€æŸ¥ System.arraycopy(a, 0, elementData, size, numNew); // å°†æ•°ç»„a[0,...,numNew-1]å¤åˆ¶åˆ°æ•°ç»„elementData[size,...,size+numNew-1] size += numNew; return numNew != 0; &#125; // æŒ‰ç…§æŒ‡å®šcollectioné›†åˆçš„è¿­ä»£å™¨æ‰€è¿”å›çš„å…ƒç´ é¡ºåºï¼Œå°†è¯¥collectionä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°åˆ—è¡¨çš„æŒ‡å®šä½ç½® public boolean addAll(int index, Collection&lt;? extends E&gt; c) &#123; rangeCheckForAdd(index); // æ£€æŸ¥indexæ˜¯å¦è¶Šç•Œ Object[] a = c.toArray(); int numNew = a.length; ensureCapacityInternal(size + numNew); // è¿›è¡Œæ‰©å®¹æ£€æŸ¥ // å°†æ•°ç»„elementData[index,...,index+numMoved-1]å¤åˆ¶åˆ°elementData[index+numMoved,...,index+2*numMoved-1] //å°†æºæ•°ç»„ä¸­ä»indexä½ç½®å¼€å§‹çš„ånumMovedä¸ªå…ƒç´ ç»Ÿä¸€åç§»numNewä½ int numMoved = size - index; if (numMoved &gt; 0) System.arraycopy(elementData, index, elementData, index + numNew, numMoved); // å°†æ•°ç»„a[0,...,numNew-1]å¤åˆ¶åˆ°æ•°ç»„elementData[index,...,index+numNew-1]å®Œæˆæ•°æ®çš„æ’å…¥ System.arraycopy(a, 0, elementData, index, numNew); size += numNew; return numNew != 0; &#125; æ‰©å®¹ç›¸å…³// ç”¨äºè‡ªå®šä¹‰è®¾ç½®ArrayListçš„å®¹é‡ public void ensureCapacity(int minCapacity) &#123; int minExpand = (elementData != DEFAULTCAPACITY_EMPTY_ELEMENTDATA) ? 0 : DEFAULT_CAPACITY; if (minCapacity &gt; minExpand) &#123; ensureExplicitCapacity(minCapacity); &#125; &#125; // è¿›è¡Œæ‰©å®¹æ£€æŸ¥ private void ensureCapacityInternal(int minCapacity) &#123; //ç¬¬ä¸€æ¬¡addæ“ä½œåˆå§‹åŒ–ï¼Œå¦‚æœä¸ºç©ºArrayListï¼Œé‚£ä¹ˆåˆå§‹åŒ–å®¹é‡ä¸º10 if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123; minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity); &#125; //åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ ensureExplicitCapacity(minCapacity); &#125; //åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ private void ensureExplicitCapacity(int minCapacity) &#123; //modCountè¿™ä¸ªå‚æ•°è¿ç”¨åˆ°äº† fail-fast æœºåˆ¶ modCount++; if (minCapacity - elementData.length &gt; 0) grow(minCapacity); // æ‰©å®¹ &#125; // æ‰©å®¹ private void grow(int minCapacity) &#123; int oldCapacity = elementData.length; //newCapacityä¸ºä»¥å‰çš„1.5å€ int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1); if (newCapacity - minCapacity &lt; 0) newCapacity = minCapacity; //åˆ¤æ–­å®¹é‡æ˜¯å¦åˆ°è¾¾long int æœ€å¤§ä¸´ç•Œå€¼ if (newCapacity - MAX_ARRAY_SIZE &gt; 0) newCapacity = hugeCapacity(minCapacity); // å¯¹æ•°ç»„è¿›è¡Œå¤åˆ¶å¤„ç† elementData = Arrays.copyOf(elementData, newCapacity); &#125; // æ£€æŸ¥æ˜¯å¦è¶…è¿‡æœ€å¤§å®¹é‡ 0x7fffffff ï¼Œæ˜¯å¦æŠ›å‡ºå¼‚å¸¸ private static int hugeCapacity(int minCapacity) &#123; if (minCapacity &lt; 0) // overflow throw new OutOfMemoryError(); return (minCapacity &gt; MAX_ARRAY_SIZE) ? Integer.MAX_VALUE : MAX_ARRAY_SIZE; &#125; åˆ é™¤å…ƒç´ // åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´  public E remove(int index) &#123; rangeCheck(index); //æ•°ç»„è¶Šç•Œæ£€æŸ¥ modCount++; E oldValue = elementData(index); int numMoved = size - index - 1; //è®¡ç®—æ•°ç»„éœ€è¦å¤åˆ¶çš„æ•°é‡ if (numMoved &gt; 0) //å°†indexåçš„æ•°æ®éƒ½å‘å‰ç§»ä¸€ä½ System.arraycopy(elementData, index+1, elementData, index, numMoved); elementData[--size] = null; //help GC return oldValue; &#125; // åˆ é™¤æŒ‡å®šå†…å®¹çš„å…ƒç´ ï¼ˆåªåˆ é™¤ç¬¬ä¸€ä¸ªåŒ¹é…æˆåŠŸçš„ï¼‰ public boolean remove(Object o) &#123; if (o == null) &#123; for (int index = 0; index &lt; size; index++) if (elementData[index] == null) &#123; fastRemove(index); return true; &#125; &#125; else &#123; for (int index = 0; index &lt; size; index++) if (o.equals(elementData[index])) &#123; fastRemove(index); return true; &#125; &#125; return false; &#125; //æ‰¾åˆ°å¯¹åº”çš„å…ƒç´ åï¼Œåˆ é™¤ã€‚åˆ é™¤å…ƒç´ åçš„å…ƒç´ éƒ½å‘å‰ç§»åŠ¨ä¸€ä½ private void fastRemove(int index) &#123; modCount++; int numMoved = size - index - 1; if (numMoved &gt; 0) // å°†indexåé¢çš„å…ƒç´ æ•´ä½“å‘å‰ç§»åŠ¨ä¸€ä½ System.arraycopy(elementData, index+1, elementData, index, numMoved); elementData[--size] = null; // help GC &#125; //æ¸…ç©ºArrayListï¼Œå°†å…¨éƒ¨çš„å…ƒç´ è®¾ä¸ºnull public void clear() &#123; modCount++; for (int i = 0; i &lt; size; i++) // help GC elementData[i] = null; size = 0; &#125; //åˆ é™¤ArrayListä¸­ä»fromIndexåˆ°toIndexï¼ˆåŒºé—´--å·¦é—­å³å¼€ï¼‰ä¹‹é—´æ‰€æœ‰çš„å…ƒç´  protected void removeRange(int fromIndex, int toIndex) &#123; modCount++; int numMoved = size - toIndex; //éœ€å‘å‰ç§»åŠ¨çš„å…ƒç´ çš„ä¸ªæ•° System.arraycopy(elementData, toIndex, elementData, fromIndex, numMoved); // help GC int newSize = size - (toIndex-fromIndex); for (int i = newSize; i &lt; size; i++) &#123; elementData[i] = null; &#125; size = newSize; &#125; //åˆ é™¤ArrayListä¸­åŒ…å«åœ¨æŒ‡å®šå®¹å™¨cä¸­çš„æ‰€æœ‰å…ƒç´  public boolean removeAll(Collection&lt;?&gt; c) &#123; Objects.requireNonNull(c); //æ£€æŸ¥æŒ‡å®šçš„å¯¹è±¡cæ˜¯å¦ä¸ºç©º return batchRemove(c, false); &#125; //ç§»é™¤ArrayListä¸­ä¸åŒ…å«åœ¨æŒ‡å®šå®¹å™¨cä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œä¸removeAll(Collection&lt;?&gt; c)æ­£å¥½ç›¸å public boolean retainAll(Collection&lt;?&gt; c) &#123; Objects.requireNonNull(c); //æ£€æŸ¥æŒ‡å®šçš„å¯¹è±¡cæ˜¯å¦ä¸ºç©º return batchRemove(c, true); &#125; // æ ¹æ®complementçš„å€¼åˆ é™¤å…ƒç´  private boolean batchRemove(Collection&lt;?&gt; c, boolean complement) &#123; final Object[] elementData = this.elementData; int r = 0, w = 0; //è¯»å†™åŒæŒ‡é’ˆ wæ˜¯é‡æ–°å­˜å…ƒç´ æ—¶çš„ç´¢å¼•ï¼Œræ˜¯åŸæ¥çš„ç´¢å¼• boolean modified = false; try &#123; //éå†æ•°ç»„ï¼Œå¹¶æ£€æŸ¥è¿™ä¸ªé›†åˆæ˜¯å¦åŒ…å«å¯¹åº”çš„å€¼ï¼Œç§»åŠ¨è¦ä¿ç•™çš„å€¼åˆ°æ•°ç»„å‰é¢ï¼Œwæœ€åå€¼ä¸ºè¦ä¿ç•™çš„å…ƒç´ çš„æ•°é‡ //ç®€å•ç‚¹ï¼šè‹¥ä¿ç•™ï¼Œå°±å°†ç›¸åŒå…ƒç´ ç§»åŠ¨åˆ°å‰æ®µï¼›è‹¥åˆ é™¤ï¼Œå°±å°†ä¸åŒå…ƒç´ ç§»åŠ¨åˆ°å‰æ®µ for (; r &lt; size; r++) if (c.contains(elementData[r]) == complement) //åˆ¤æ–­æŒ‡å®šå®¹å™¨cä¸­æ˜¯å¦å«æœ‰elementData[r]å…ƒç´  elementData[w++] = elementData[r]; &#125;finally &#123;//ç¡®ä¿å¼‚å¸¸æŠ›å‡ºå‰çš„éƒ¨åˆ†å¯ä»¥å®ŒæˆæœŸæœ›çš„æ“ä½œï¼Œè€Œæœªè¢«éå†çš„éƒ¨åˆ†ä¼šè¢«æ¥åˆ°åé¢ //r!=sizeè¡¨ç¤ºå¯èƒ½å‡ºé”™äº†ï¼šc.contains(elementData[r])æŠ›å‡ºå¼‚å¸¸ if (r != size) &#123; System.arraycopy(elementData, r,elementData, w,size - r); w += size - r; &#125; //å¦‚æœw==sizeï¼šè¡¨ç¤ºå…¨éƒ¨å…ƒç´ éƒ½ä¿ç•™äº†ï¼Œæ‰€ä»¥ä¹Ÿå°±æ²¡æœ‰åˆ é™¤æ“ä½œå‘ç”Ÿï¼Œæ‰€ä»¥ä¼šè¿”å›falseï¼›åä¹‹ï¼Œè¿”å›trueï¼Œå¹¶æ›´æ”¹æ•°ç»„ //è€Œw!=sizeçš„æ—¶å€™ï¼Œå³ä½¿tryå—æŠ›å‡ºå¼‚å¸¸ï¼Œä¹Ÿèƒ½æ­£ç¡®å¤„ç†å¼‚å¸¸æŠ›å‡ºå‰çš„æ“ä½œï¼Œå› ä¸ºwå§‹ç»ˆä¸ºè¦ä¿ç•™çš„å‰æ®µéƒ¨åˆ†çš„é•¿åº¦ï¼Œæ•°ç»„ä¹Ÿä¸ä¼šå› æ­¤ä¹±åº if (w != size) &#123; for (int i = w; i &lt; size; i++) elementData[i] = null; modCount += size - w;//æ”¹å˜çš„æ¬¡æ•° size = w; //æ–°çš„å¤§å°ä¸ºä¿ç•™çš„å…ƒç´ çš„ä¸ªæ•° modified = true; &#125; &#125; return modified; &#125; removeAllå’ŒretainAllæ–¹æ³•ï¼šå®ç°åˆ é™¤æˆ–ä¿ç•™ArrayListä¸­åŒ…å«Collection cä¸­çš„çš„å…ƒç´ ã€‚ è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ç”¨åˆ°batchRemoveæ–¹æ³•ï¼ˆboolean complementä½¿å¾—batchRemoveæ–¹æ³•å¾—åˆ°äº†é‡ç”¨ï¼‰ ä¸‹é¢ä»¥removeAllä¸ºä¾‹ï¼Œåˆ†æbatchRemove(c, false)a. éå†elementDatab. å¦‚æœé›†åˆcä¸­åŒ…å«elementDataçš„å…ƒç´ eï¼Œå³c.contains(elementData[r])ä¸ºtrueï¼Œifä¸æˆç«‹ï¼Œifç»“æŸï¼›å¦‚æœcä¸åŒ…å«elementDataçš„å…ƒç´ eï¼Œåˆ™ifæˆç«‹ï¼Œå°†æ­¤å…ƒç´ eèµ‹å€¼ç»™elementData[w++] ï¼ˆå³elementDataä¿ç•™äº†cä¸­æ²¡æœ‰çš„å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯åˆ é™¤äº†cä¸­å­˜åœ¨çš„æ‰€æœ‰å…ƒç´ ã€‚ï¼‰c. æ‰§è¡Œfinallyd. finallyæ˜¯ä¸ç®¡tryä¸­ç»“æœå¦‚ä½•éƒ½ä¼šæ‰§è¡Œçš„ã€‚if(r!=size)ï¼Œåˆ™å°†elementDataæœªå‚åŠ æ¯”è¾ƒçš„å…ƒç´ arraycopyåˆ°elementDataåé¢ï¼›æ–°ç´¢å¼•wåŠ ä¸Šåˆšarraycopyçš„æ•°ç›®ï¼›if (w != size)ï¼Œæ­¤æ—¶wè¿˜ä¸ç­‰äºsizeï¼Œåˆ™å°†wåçš„å…ƒç´ ç§»é™¤.åªæœ‰æ‰§è¡Œäº†if (w != size)ï¼ˆäº‹å®ä¸Šåªè¦cä¸­å«æœ‰elementDataçš„å…ƒç´ ï¼Œwè‚¯å®šä¸ç­‰äºsizeï¼‰ï¼Œæ‰ä»¤modified = trueï¼Œæ‰è¯´æ˜removeæˆåŠŸï¼Œè¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚ ArrayListä¸­è¿˜æœ‰ä¸€ä¸ªç”¨äºèŠ‚çº¦æ•°ç»„å†…å­˜ç©ºé—´ï¼Œç¼©å°å®¹é‡çš„æ–¹æ³• // å› ä¸ºå®¹é‡å¸¸å¸¸ä¼šå¤§äºå®é™…å…ƒç´ çš„æ•°é‡ã€‚å†…å­˜ç´§å¼ æ—¶ï¼Œå¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•åˆ é™¤é¢„ç•™çš„ä½ç½®ï¼Œè°ƒæ•´å®¹é‡ä¸ºå…ƒç´ å®é™…æ•°é‡ã€‚ // å¦‚æœç¡®å®šä¸ä¼šå†æœ‰å…ƒç´ æ·»åŠ è¿›æ¥æ—¶ä¹Ÿå¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•æ¥èŠ‚çº¦ç©ºé—´ public void trimToSize() &#123; modCount++; // lengthæ˜¯æ•°ç»„é•¿åº¦ï¼Œsizeè¡¨ç¤ºæ•°ç»„å†…å…ƒç´ ä¸ªæ•° // size&lt;lengthé‚£ä¹ˆå°±è¯´æ˜æ•°ç»„å†…æœ‰ç©ºå…ƒç´ ï¼Œè¿›è¡Œç¼©å°å®¹é‡æ“ä½œ if (size &lt; elementData.length) &#123; elementData = (size == 0) ? EMPTY_ELEMENTDATA : Arrays.copyOf(elementData, size); &#125; &#125; å»æ‰é¢„ç•™å…ƒç´ çš„ä½ç½®ã€‚è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œæ–°æ•°ç»„ä¸å«nullï¼Œæ•°ç»„çš„sizeå’ŒelementData.lengthç›¸ç­‰ï¼Œä»¥èŠ‚çœç©ºé—´ã€‚æ­¤å‡½æ•°å¯é¿å…sizeå¾ˆå°ä½†elementData.lengthå¾ˆå¤§çš„æƒ…å†µã€‚ ArrayListä¼šæ¯æ¬¡å¢é•¿ä¼šé¢„ç”³è¯·å¤šä¸€ç‚¹ç©ºé—´ï¼Œ1.5å€ï¼Œè¿™æ ·å°±ä¼šå‡ºç°å½“size() = 10çš„æ—¶å€™ï¼ŒArrayListå·²ç»ç”³è¯·äº†15ç©ºé—´ï¼Œ trimToSizeå°±æ˜¯åˆ é™¤å¤šä½™çš„5ï¼Œåªç•™10ã€‚ æˆ–è®¸æœ‰äººä¼šæœ‰ç–‘é—®ï¼šè°ƒç”¨Arrays.copyOfå¤åˆ¶sizeé•¿åº¦çš„å…ƒç´ åˆ°elementDataï¼Œè€Œä¸”ç”±æºç çœ‹åº”è¯¥æ˜¯ä»0å¤åˆ¶åˆ°sizeå¤„ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä¹‹å‰è°ƒç”¨è¿‡add(int index, E element)å‘¢ï¼Ÿæ¯”å¦‚ï¼Œlist={1ï¼Œ2ï¼Œ3ï¼Œnullï¼Œnullï¼Œ4ï¼Œnullï¼Œnull}ï¼Œå¦‚æœè°ƒç”¨trimToSizeè¿”å›çš„åº”è¯¥æ˜¯list={1ï¼Œ2ï¼Œ3ï¼Œnull}ï¼ˆå› ä¸ºsize=4ï¼‰ã€‚å…¶å®ä¸Šé¢è¿™ç§æƒ…å†µä¸ä¼šå‘ç”Ÿçš„ï¼Œå› ä¸ºè°ƒç”¨add(int index, E element)æ—¶ï¼Œä¼šæ£€æŸ¥indexçš„åˆæ³•æ€§ï¼Œæ‰€ä»¥listçš„å…ƒç´ è‚¯å®šæ˜¯ç›¸é‚»çš„ï¼Œè€Œä¸ä¼šå‡ºç°ä¸Šè¿°è¿™ç§ä¸­é—´å‡ºç°nullçš„æƒ…å†µã€‚ ä¿®æ”¹å…ƒç´ // å°†æŒ‡å®šä½ç½®çš„å…ƒç´ æ”¹ä¸ºæŒ‡å®šçš„å€¼ public E set(int index, E element) &#123; rangeCheck(index); // æ£€æŸ¥indexæ˜¯å¦è¶Šç•Œ E oldValue = elementData(index); elementData[index] = element; return oldValue; &#125; æŸ¥æ‰¾å…ƒç´ //åˆ¤æ–­ArrayListä¸­æ˜¯å¦åŒ…å«Object(o) public boolean contains(Object o) &#123; return indexOf(o) &gt;= 0; &#125; //è¿”å›ä¸€ä¸ªå€¼åœ¨æ•°ç»„é¦–æ¬¡å‡ºç°çš„ä½ç½®ï¼Œä¼šæ ¹æ®æ˜¯å¦ä¸ºnullä½¿ç”¨ä¸åŒæ–¹å¼åˆ¤æ–­ã€‚ä¸å­˜åœ¨å°±è¿”å›-1ã€‚æ—¶é—´å¤æ‚åº¦ä¸ºO(N) public int indexOf(Object o) &#123; if (o == null) &#123; for (int i = 0; i &lt; size; i++) if (elementData[i]==null) return i; &#125; else &#123; for (int i = 0; i &lt; size; i++) if (o.equals(elementData[i])) return i; &#125; return -1; &#125; //è¿”å›ä¸€ä¸ªå€¼åœ¨æ•°ç»„æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œä¸å­˜åœ¨å°±è¿”å›-1ã€‚æ—¶é—´å¤æ‚åº¦ä¸ºO(N) public int lastIndexOf(Object o) &#123; if (o == null) &#123; for (int i = size-1; i &gt;= 0; i--) if (elementData[i]==null) return i; &#125; else &#123; for (int i = size-1; i &gt;= 0; i--) if (o.equals(elementData[i])) return i; &#125; return -1; &#125; //è¿”å›æŒ‡å®šä½ç½®çš„å€¼ï¼Œå› ä¸ºæ˜¯æ•°ç»„ï¼Œæ‰€ä»¥é€Ÿåº¦ç‰¹åˆ«å¿« @SuppressWarnings(&quot;unchecked&quot;) E elementData(int index) &#123; return (E) elementData[index]; &#125; //è¿”å›æŒ‡å®šä½ç½®çš„å€¼ï¼Œä½†æ˜¯ä¼šæ£€æŸ¥è¿™ä¸ªä½ç½®æ•°å¦è¶…å‡ºæ•°ç»„é•¿åº¦ public E get(int index) &#123; rangeCheck(index); return elementData(index); //å®è´¨ä¸Šreturn (E) elementData[index] &#125; åºåˆ—åŒ–//ä¿å­˜æ•°ç»„å®ä¾‹çš„çŠ¶æ€åˆ°ä¸€ä¸ªæµï¼ˆå³å®ƒåºåˆ—åŒ–ï¼‰ã€‚å†™å…¥è¿‡ç¨‹æ•°ç»„è¢«æ›´æ”¹ä¼šæŠ›å‡ºå¼‚å¸¸ private void writeObject(java.io.ObjectOutputStream s) throws java.io.IOException&#123; int expectedModCount = modCount; s.defaultWriteObject(); //æ‰§è¡Œé»˜è®¤çš„ååºåˆ—åŒ–/åºåˆ—åŒ–è¿‡ç¨‹ã€‚å°†å½“å‰ç±»çš„éé™æ€å’Œéç¬æ€å­—æ®µå†™å…¥æ­¤æµ // å†™å…¥å¤§å° s.writeInt(size); // æŒ‰é¡ºåºå†™å…¥æ‰€æœ‰å…ƒç´  for (int i=0; i&lt;size; i++) &#123; s.writeObject(elementData[i]); &#125; if (modCount != expectedModCount) &#123; throw new ConcurrentModificationException(); &#125; &#125; //ä¸Šé¢æ˜¯å†™ï¼Œè¿™ä¸ªå°±æ˜¯è¯»äº†ã€‚ private void readObject(java.io.ObjectInputStream s) throws java.io.IOException, ClassNotFoundException &#123; elementData = EMPTY_ELEMENTDATA; // æ‰§è¡Œé»˜è®¤çš„åºåˆ—åŒ–/ååºåˆ—åŒ–è¿‡ç¨‹ s.defaultReadObject(); // è¯»å…¥æ•°ç»„é•¿åº¦ s.readInt(); if (size &gt; 0) &#123; ensureCapacityInternal(size); Object[] a = elementData; //è¯»å…¥æ‰€æœ‰å…ƒç´  for (int i=0; i&lt;size; i++) &#123; a[i] = s.readObject(); &#125; &#125; &#125; ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰åºåˆ—åŒ–ã€ååºåˆ—åŒ–æœºåˆ¶å‘¢ï¼Ÿ ä¿å­˜å…ƒç´ çš„æ•°ç»„ elementData ä½¿ç”¨ transient ä¿®é¥°ï¼Œè¯¥å…³é”®å­—å£°æ˜æ•°ç»„é»˜è®¤ä¸ä¼šè¢«åºåˆ—åŒ–ã€‚ transient Object[] elementData; // non-private to simplify nested class access ç”±äºArrayListå®è´¨ä¸Šæ˜¯ä¸€ä¸ªåŠ¨æ€æ•°ç»„ï¼Œå¾€å¾€æ•°ç»„ä¸­ä¼šæœ‰ç©ºä½™çš„ç©ºé—´ï¼Œå¦‚æœé‡‡ç”¨é»˜è®¤çš„åºåˆ—åŒ–æœºåˆ¶ï¼Œé‚£äº›ç©ºä½™çš„ç©ºé—´ä¼šä½œä¸ºnullå†™å…¥æœ¬åœ°æ–‡ä»¶æˆ–è€…åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼Œè€—è´¹äº†ä¸å¿…è¦çš„èµ„æºã€‚æ‰€ä»¥ï¼ŒArrayListä½¿ç”¨è‡ªå®šä¹‰åºåˆ—åŒ–æœºåˆ¶ï¼Œä»…å†™å…¥ç´¢å¼•ä¸ºã€0ï¼Œsizeï¼‰çš„æœ‰æ•ˆå…ƒç´ ä»¥èŠ‚çœèµ„æº åºåˆ—åŒ–æ—¶éœ€è¦ä½¿ç”¨ ObjectOutputStream çš„ writeObject() å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµå¹¶è¾“å‡ºã€‚è€Œ writeObject() æ–¹æ³•åœ¨ä¼ å…¥çš„å¯¹è±¡å­˜åœ¨ writeObject() çš„æ—¶å€™ä¼šå»åå°„è°ƒç”¨è¯¥å¯¹è±¡çš„ writeObject() æ¥å®ç°åºåˆ—åŒ–ã€‚ååºåˆ—åŒ–ä½¿ç”¨çš„æ˜¯ ObjectInputStream çš„ readObject() æ–¹æ³•ï¼ŒåŸç†ç±»ä¼¼ã€‚ ArrayList list = new ArrayList(); ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(file)); oos.writeObject(list); è¿­ä»£å™¨//è¿”å›ListIteratorï¼Œå¼€å§‹ä½ç½®ä¸ºæŒ‡å®šå‚æ•° public ListIterator&lt;E&gt; listIterator(int index) &#123; if (index &lt; 0 || index &gt; size) throw new IndexOutOfBoundsException(&quot;Index: &quot;+index); return new ListItr(index); &#125; //è¿”å›ListIteratorï¼Œå¼€å§‹ä½ç½®ä¸º0 public ListIterator&lt;E&gt; listIterator() &#123; return new ListItr(0); &#125; //è¿”å›æ™®é€šè¿­ä»£å™¨ public Iterator&lt;E&gt; iterator() &#123; return new Itr(); &#125; //é€šç”¨çš„è¿­ä»£å™¨å®ç° private class Itr implements Iterator&lt;E&gt; &#123; int cursor; //æ¸¸æ ‡ï¼Œä¸‹ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œé»˜è®¤åˆå§‹åŒ–ä¸º0 int lastRet = -1; //ä¸Šæ¬¡è®¿é—®çš„å…ƒç´ çš„ä½ç½® int expectedModCount = modCount;//è¿­ä»£è¿‡ç¨‹ä¸å…è®¸ä¿®æ”¹æ•°ç»„ï¼Œå¦åˆ™å°±æŠ›å‡ºå¼‚å¸¸ //æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ª public boolean hasNext() &#123; return cursor != size; &#125; //ä¸‹ä¸€ä¸ªå…ƒç´  @SuppressWarnings(&quot;unchecked&quot;) public E next() &#123; checkForComodification();//æ£€æŸ¥æ•°ç»„æ˜¯å¦è¢«ä¿®æ”¹ int i = cursor; if (i &gt;= size) throw new NoSuchElementException(); Object[] elementData = ArrayList.this.elementData; if (i &gt;= elementData.length) throw new ConcurrentModificationException(); cursor = i + 1; //å‘åç§»åŠ¨æ¸¸æ ‡ return (E) elementData[lastRet = i]; //è®¾ç½®è®¿é—®çš„ä½ç½®å¹¶è¿”å›è¿™ä¸ªå€¼ &#125; //åˆ é™¤å…ƒç´  public void remove() &#123; if (lastRet &lt; 0) throw new IllegalStateException(); checkForComodification();//æ£€æŸ¥æ•°ç»„æ˜¯å¦è¢«ä¿®æ”¹ try &#123; ArrayList.this.remove(lastRet); cursor = lastRet; lastRet = -1; expectedModCount = modCount; &#125; catch (IndexOutOfBoundsException ex) &#123; throw new ConcurrentModificationException(); &#125; &#125; @Override @SuppressWarnings(&quot;unchecked&quot;) public void forEachRemaining(Consumer&lt;? super E&gt; consumer) &#123; Objects.requireNonNull(consumer); final int size = ArrayList.this.size; int i = cursor; if (i &gt;= size) &#123; return; &#125; final Object[] elementData = ArrayList.this.elementData; if (i &gt;= elementData.length) &#123; throw new ConcurrentModificationException(); &#125; while (i != size &amp;&amp; modCount == expectedModCount) &#123; consumer.accept((E) elementData[i++]); &#125; cursor = i; lastRet = i - 1; checkForComodification(); &#125; //æ£€æŸ¥æ•°ç»„æ˜¯å¦è¢«ä¿®æ”¹ final void checkForComodification() &#123; if (modCount != expectedModCount) throw new ConcurrentModificationException(); &#125; &#125; //ListIteratorè¿­ä»£å™¨å®ç° private class ListItr extends Itr implements ListIterator&lt;E&gt; &#123; ListItr(int index) &#123; super(); cursor = index; &#125; public boolean hasPrevious() &#123; return cursor != 0; &#125; public int nextIndex() &#123; return cursor; &#125; public int previousIndex() &#123; return cursor - 1; &#125; @SuppressWarnings(&quot;unchecked&quot;) public E previous() &#123; checkForComodification(); int i = cursor - 1; if (i &lt; 0) throw new NoSuchElementException(); Object[] elementData = ArrayList.this.elementData; if (i &gt;= elementData.length) throw new ConcurrentModificationException(); cursor = i; return (E) elementData[lastRet = i]; &#125; public void set(E e) &#123; if (lastRet &lt; 0) throw new IllegalStateException(); checkForComodification(); try &#123; ArrayList.this.set(lastRet, e); &#125; catch (IndexOutOfBoundsException ex) &#123; throw new ConcurrentModificationException(); &#125; &#125; public void add(E e) &#123; checkForComodification(); try &#123; int i = cursor; ArrayList.this.add(i, e); cursor = i + 1; lastRet = -1; expectedModCount = modCount; &#125; catch (IndexOutOfBoundsException ex) &#123; throw new ConcurrentModificationException(); &#125; &#125; &#125; Iteratorä¸ListIteratorçš„åŒºåˆ«ï¼š Iteratorå¯ä»¥åº”ç”¨äºæ‰€æœ‰çš„é›†åˆï¼ŒSetã€Listå’ŒMapå’Œè¿™äº›é›†åˆçš„å­ç±»å‹ã€‚è€ŒListIteratoråªèƒ½ç”¨äºListåŠå…¶å­ç±»å‹ï¼› Iteratoråªèƒ½å®ç°é¡ºåºå‘åéå†ï¼ŒListIteratorå¯å®ç°é¡ºåºå‘åéå†å’Œé€†å‘ï¼ˆé¡ºåºå‘å‰ï¼‰éå†ï¼› Iteratoråªèƒ½å®ç°removeæ“ä½œï¼ŒListIteratorå¯ä»¥å®ç°removeæ“ä½œï¼Œaddæ“ä½œï¼Œsetæ“ä½œã€‚ å…¶ä»–æ–¹æ³•//è¿”å›ArrayListçš„å¤§å°ï¼ˆå…ƒç´ ä¸ªæ•°ï¼‰ public int size() &#123; return size; &#125; //åˆ¤æ–­ArrayListæ˜¯å¦ä¸ºç©º public boolean isEmpty() &#123; return size == 0; &#125; //è¿”å›æ­¤ ArrayListå®ä¾‹çš„æµ…æ‹·è´ï¼ˆå…ƒç´ æœ¬èº«æ²¡æœ‰è¢«å¤åˆ¶ï¼Œå¤åˆ¶è¿‡ç¨‹æ•°ç»„å‘ç”Ÿæ”¹å˜ä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰ public Object clone() &#123; try &#123; ArrayList&lt;?&gt; v = (ArrayList&lt;?&gt;) super.clone(); v.elementData = Arrays.copyOf(elementData, size); v.modCount = 0; return v; &#125; catch (CloneNotSupportedException e) &#123; throw new InternalError(e); &#125; &#125; /* æµ…å…‹éš†å°±æ˜¯æˆ‘ä»¬æ‰€çœ‹åˆ°çš„Arrays.copyOfï¼Œ System.arraycopyï¼Œæ•°ç»„æ˜¯æ–°çš„ï¼Œä½†æ˜¯é‡Œé¢Nä¸ªå…ƒç´ å…¨æ˜¯å¼•ç”¨çš„æ—§çš„ã€‚ æµ…æ‹·è´(å½±å­å…‹éš†):åªå¤åˆ¶åŸºæœ¬ç±»å‹ã€‚ æ·±æ‹·è´(æ·±åº¦å…‹éš†):åŸºæœ¬ç±»+å¯¹è±¡ã€‚ */ //è¿”å›ä¸€ä¸ªåŒ…å«ArrayListä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ public Object[] toArray() &#123; return Arrays.copyOf(elementData, size); &#125; // è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œä½¿ç”¨è¿è¡Œæ—¶ç¡®å®šç±»å‹ï¼Œè¯¥æ•°ç»„åŒ…å«åœ¨è¿™ä¸ªåˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼ˆä»ç¬¬ä¸€åˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼‰ // è¿”å›çš„æ•°ç»„å®¹é‡ç”±å‚æ•°å’Œæœ¬æ•°ç»„ä¸­è¾ƒå¤§å€¼ç¡®å®š @SuppressWarnings(&quot;unchecked&quot;) public &lt;T&gt; T[] toArray(T[] a) &#123; if (a.length &lt; size) // Make a new array of a&#39;s runtime type, but my contents: return (T[]) Arrays.copyOf(elementData, size, a.getClass()); System.arraycopy(elementData, 0, a, 0, size); if (a.length &gt; size) a[size] = null; return a; &#125; ArrayListç›¸å…³é—®é¢˜Integer.MAX_VALUE - 8 è¿™é‡Œä¸ºä»€ä¹ˆè¦å‡å»8ï¼Ÿä¸»è¦æ˜¯è€ƒè™‘åˆ°ä¸åŒçš„JVM,æœ‰çš„VMä¼šåœ¨åŠ å…¥ä¸€äº›æ•°æ®å¤´,å½“æ‰©å®¹åçš„å®¹é‡å¤§äºMAX_ARRAY_SIZE,æˆ‘ä»¬ä¼šå°†æœ€å°éœ€è¦å®¹é‡å’ŒMAX_ARRAY_SIZEåšæ¯”è¾ƒ,å¦‚æœæ¯”å®ƒå¤§, åªèƒ½å–Integer.MAX_VALUE,å¦åˆ™æ˜¯Integer.MAX_VALUE -8ã€‚è¿™ä¸ªæ˜¯ä»jdk1.7å¼€å§‹æ‰æœ‰çš„ jdk1.8çš„æ— å‚æ„é€ å‡½æ•°å’Œä¹‹å‰ç‰ˆæœ¬çš„æ„é€ å‡½æ•°æœ‰ä»€ä¹ˆåŒºåˆ«?jdk1.6 public ArrayList() &#123; this(10); &#125; jdk1.7 public ArrayList() &#123; super(); this.elementData = EMPTY_ELEMENTDATA; &#125; jdk1.8 public ArrayList() &#123; this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA; &#125; å¯¹æ¯”ä¸‹å¯ä»¥çœ‹å‡ºï¼šjdk1.6çš„æ— å‚æ„é€ æ–¹æ³•ï¼ˆé»˜è®¤æ„é€ æ–¹æ³•ï¼‰æ„é€ çš„ArrayListçš„åº•å±‚æ•°ç»„elementDataå¤§å°ï¼ˆå®¹é‡ï¼‰é»˜è®¤ä¸º10ï¼›ä»1.7å¼€å§‹ï¼Œæ— å‚æ„é€ æ–¹æ³•æ„é€ çš„ArrayListçš„åº•å±‚æ•°ç»„elementDataå¤§å°é»˜è®¤ä¸º0ã€‚ javaé›†åˆç±»åœ¨jdk1.7ç‰ˆæœ¬åŸºæœ¬ä¸Šéƒ½æœ‰ä¸€ç§æ”¹åŠ¨ï¼šæ‡’åˆå§‹åŒ–ã€‚æ‡’åˆå§‹åŒ–æŒ‡çš„æ˜¯é»˜è®¤æ„é€ æ–¹æ³•æ„é€ çš„é›†åˆç±»ï¼Œå æ®å°½å¯èƒ½å°‘çš„å†…å­˜ç©ºé—´ï¼ˆå¯¹äºArrayListæ¥è¯´ï¼Œä½¿ç”¨ç©ºæ•°ç»„æ¥å æ®å°½é‡å°‘çš„ç©ºé—´ï¼Œä¸ä½¿ç”¨nullæ˜¯ä¸ºäº†é¿å…nullåˆ¤æ–­ï¼‰ï¼Œåœ¨ç¬¬ä¸€æ¬¡è¿›è¡ŒåŒ…å«æœ‰æ·»åŠ è¯­ä¹‰çš„æ“ä½œæ—¶ï¼Œæ‰è¿›è¡ŒçœŸæ­£çš„åˆå§‹åŒ–å·¥ä½œã€‚ 1.7å¼€å§‹çš„ArrayListï¼Œé»˜è®¤æ„é€ æ–¹æ³•æ„é€ çš„å®ä¾‹ï¼Œåº•å±‚æ•°ç»„æ˜¯ç©ºæ•°ç»„ï¼Œå®¹é‡ä¸º0ï¼Œåœ¨è¿›è¡Œç¬¬ä¸€æ¬¡add/addAllç­‰æ“ä½œæ—¶æ‰ä¼šçœŸæ­£ç»™åº•å±‚æ•°ç»„èµ‹éemptyçš„å€¼ã€‚å¦‚æœadd/addAllæ·»åŠ çš„å…ƒç´ å°äº10ï¼Œåˆ™æŠŠelementDataæ•°ç»„æ‰©å®¹ä¸º10ä¸ªå…ƒç´ å¤§å°ï¼Œå¦åˆ™ä½¿ç”¨åˆšå¥½åˆé€‚çš„å¤§å°ï¼ˆä¾‹å¦‚ï¼Œç¬¬ä¸€æ¬¡addAllæ·»åŠ 6ä¸ªï¼Œé‚£ä¹ˆæ‰©å®¹ä¸º10ä¸ªï¼Œç¬¬ä¸€æ¬¡æ·»åŠ å¤§äº10ä¸ªçš„ï¼Œæ¯”å¦‚24ä¸ªï¼Œæ‰©å®¹ä¸º24ä¸ªï¼Œåˆšå¥½åˆé€‚ï¼‰ 1.8ç‰ˆæœ¬ï¼Œé»˜è®¤æ„é€ çš„å®ä¾‹è¿™ä¸ªè¡Œä¸ºæ²¡æœ‰æ”¹å˜ï¼Œåªæ˜¯ç”¨çš„æ•°ç»„åå­—å˜äº†ã€‚ jdk1.6ä¸­æ‰©å®¹ç®—æ³•çš„ç¼ºé™·ï¼ˆç”±äºjdk1.7å’Œjdk1.8åœ¨æ‰©å®¹ç®—æ³•æ–¹é¢å·®åˆ«ä¸å¤§ï¼Œæ‰€ä»¥ä¸‹é¢æ²¡æœ‰ä¸¥æ ¼åŒºåˆ†ï¼‰ jdk1.6 public void ensureCapacity(int minCapacity) &#123; modCount++; int oldCapacity = elementData.length; if (minCapacity &gt; oldCapacity) &#123; Object oldData[] = elementData; int newCapacity = (oldCapacity * 3)/2 + 1; if (newCapacity &lt; minCapacity) newCapacity = minCapacity; // minCapacity is usually close to size, so this is a win: elementData = Arrays.copyOf(elementData, newCapacity); &#125; &#125; ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºjdk1.6çš„ensureCapacityæ–¹æ³•åªæ˜¯ç®€å•è¿›è¡Œäº†é€»è¾‘ä¸Šçš„æ“ä½œï¼Œæ²¡æœ‰è¿‡å¤šè€ƒè™‘intå‹æº¢å‡ºçš„é—®é¢˜ï¼Œä»1.7å¼€å§‹å¯¹è¿™ä¸ªè¿›è¡Œäº†å®Œå–„ã€‚ è€Œä¸”æ²¡è€ƒè™‘å…¥å‚minCapacityå¯èƒ½å› ä¸ºintæº¢å‡ºå˜ä¸ºè´Ÿæ•°ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥å¤–éƒ¨æ‰‹åŠ¨è°ƒç”¨ï¼Œæ‰‹åŠ¨æ‰©å®¹ä¼ å…¥è´Ÿæ•°è¿™ä¸ªè‚¯å®šæ˜¯åº”è¯¥æ‹¦æˆªæ‰çš„ã€‚ä½†æ˜¯è‡ªåŠ¨æ‰©å®¹ä¼šå› ä¸ºintæº¢å‡ºäº§ç”Ÿè´Ÿæ•°ï¼Œç¢°åˆ°è¿™ç§æƒ…å†µæ—¶åº”è¯¥ç‰¹æ®Šå¤„ç†ï¼Œè€Œä¸æ˜¯ä»€ä¹ˆéƒ½ä¸åšï¼Œç­‰ç€åé¢æŠ›å‡ºä¸€ä¸ªArrayIndexOutOfBoundsExceptionã€‚ è¿˜æœ‰å°±æ˜¯ä¸‹é¢è¿™å¥ä»£ç ä¼šé€ æˆè¿‡æ—©æº¢å‡º int newCapacity = (oldCapacity * 3)/2 + 1; è™½ç„¶ä¸Šé¢è¿™è¡Œä»£ç å’Œ1.7å¼€å§‹çš„oldCapacity + (oldCapacity &gt;&gt; 1) å·®ä¸å¤šï¼Œéƒ½æ˜¯ç›¸å½“äº1.5å€ï¼Œä½†å®é™…ä¸Šæ˜¯æœ‰åŒºåˆ«çš„ã€‚ è¿™é‡Œä¸»è¦æœ‰ä¸¤ä¸ªåŒºåˆ« ç¬¬ä¸€ä¸ªåŒºåˆ«æ˜¯jdk1.6çš„ä¹˜é™¤è¿ç®—çš„æ•°å­¦ç»“æœæ¯”åé¢ä¸€ä¸ªå¤§1æ¯”å¦‚oldCapacity=10ï¼Œ1.6çš„ç®—æ³•å¾—åˆ°16ï¼Œ1.7å¼€å§‹çš„ç®—æ³•å¾—åˆ°15ï¼Œè¿™ä¸ªå½±å“ä¸å¤§ï¼› ç¬¬äºŒä¸ªåŒºåˆ«å°±æ˜¯ä¸¤è€…åœ¨æ•°å­—æ¯”è¾ƒå¤§æ—¶è¿ç®—ç»“æœä¸ä¸€æ ·ï¼Œæ¯”å¦‚oldCapacity=10^9ï¼Œè¿™ä¸ªæ•°å’ŒInteger.MAX_VALUEä½æ•°ä¸€æ ·ï¼Œç”¨1.6çš„ç®—æ³•å¾—åˆ°çš„ä¼šæ˜¯é”™è¯¯çš„-647483647ï¼Œç”¨1.7çš„åˆ™æ˜¯æ­£ç¡®çš„1500000000ï¼Œè¿™æ—¶å€™æ˜æ˜å¯ä»¥1.5å€æ‰©å®¹ï¼Œä½†æ˜¯jdk1.6å´ç”¨çš„æ˜¯æŒ‰éœ€æ‰©å®¹ã€‚ ensureCapacityï¼ˆç§°ä¹‹ä¸ºæ‰‹åŠ¨ï¼Œæ˜¯å› ä¸ºæ­¤æ–¹æ³•æ˜¯publicçš„ï¼Œå¯ä»¥å¤–éƒ¨æ‰‹åŠ¨è°ƒç”¨ï¼‰ã€‚åœ¨1.6ç‰ˆæœ¬æ˜¯åªæœ‰è¿™ä¸ªæ‰‹åŠ¨çš„æ–¹æ³•ï¼Œå†…éƒ¨è‡ªåŠ¨æ“ä½œä¹Ÿæ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œ1.7å¼€å§‹è¿›è¡Œäº†åŒºåˆ†ï¼Œå¹¶ä¸”è¿›ä¸€æ­¥æ”¹è¿›äº†æ‰©å®¹æ“ä½œã€‚ ä»1.7å¼€å§‹å°†å†…éƒ¨æ‰©å®¹å’Œå¤–éƒ¨å¯ä»¥è°ƒç”¨çš„æ‰©å®¹æ–¹æ³•åˆ†å¼€äº†ï¼Œé€šè¿‡æºç å¯ä»¥çœ‹å‡ºï¼šå¤–éƒ¨è°ƒç”¨çš„æ‰‹åŠ¨æ‰©å®¹æ–¹æ³•ensureCapacityè¦å¤šä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ minCapacity &gt; minExpandï¼Œè¿™ä¸ªåˆ¤æ–­æ¡ä»¶æ‹¦æˆªæ‰è´Ÿæ•°çš„minCapacityï¼Œè¿™æ ·è°ƒç”¨å†…éƒ¨æ‰©å®¹ensureCapacityInternalæ–¹æ³•æ—¶ï¼ŒminCapacityä¸€å®šæ˜¯æ­£æ•°ï¼›å†…éƒ¨æ‰©å®¹æ–¹æ³•ç›´æ¥å°±ç”¨minCapacity - elementData.length &gt; 0åˆ¤æ–­ï¼Œæ­¤æ¡ä»¶å¯ä»¥æ£€æµ‹å‡ºintå‹æº¢å‡ºï¼Œç¢°åˆ°æº¢å‡ºæœ€åä¼šæŠ›å‡ºä¸€ä¸ªOOMé”™è¯¯ã€‚jdk1.7ç”¨OOMï¼Œè¿™æ¯”jdk1.6ç”¨ArrayIndexOutOfBoundsExceptionæ›´å¥½ï¼Œå› ä¸ºæ­¤æ—¶æ•°ç»„å¤§å°è¶…å‡ºäº†è™šæ‹Ÿæœºå¯¹æ•°ç»„çš„é™åˆ¶ï¼Œè™šæ‹Ÿæœºæ— æ³•å¤„ç†è¿™ç§æƒ…å†µäº†ï¼ŒæŠ›å‡ºä¸€ä¸ªERRORæ˜¯åˆç†çš„ã€‚ ä½¿ç”¨è¿™è¡Œä»£ç  newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1); è¿™è¡Œä»£ç ä¸ä»…ä»…æ˜¯ä½¿ç”¨ä½è¿ç®—åŠ å¿«æ‰§è¡Œé€Ÿåº¦ï¼Œä¸Šé¢è¯´äº†ï¼Œè¿™ç§åšæ³•æ‰æ˜¯å¯¹çš„ï¼Œæ˜¯çœŸæ­£çš„1.5å€ã€‚ä¸ä»…ä»…å› ä¸ºé‚£ä¸€ä¸ªå¤§å°çš„å·®åˆ«ï¼Œæ›´é‡è¦çš„æ˜¯é¿å…è¿‡æ—©å‡ºç°intæº¢å‡ºçš„æƒ…å†µï¼Œä¿è¯äº†å†…éƒ¨è‡ªåŠ¨æ‰©å®¹ä¼šå°½é‡æŒ‰è§„å®šçš„ç­–ç•¥æ‰§è¡Œã€‚åŒæ—¶æ•´ä¸ªæ‰©å®¹å¤„ç†æµç¨‹ä¸­å¤šå¢åŠ äº†å‡ å¤„ifåˆ¤æ–­ï¼Œå¯¹å„ç§æƒ…å†µå¤„ç†æ›´åŠ å®Œå–„ã€‚ ä¸ºä»€ä¹ˆArrayListè‡ªåŠ¨å®¹é‡æ‰©å……é€‰æ‹©æ‰©å……1.5å€ï¼Ÿè¿™ç§ç®—æ³•æ„é€ å‡ºæ¥çš„æ–°çš„æ•°ç»„é•¿åº¦çš„å¢é‡éƒ½ä¼šæ¯”ä¸Šä¸€æ¬¡å¤§( è€Œä¸”æ˜¯è¶Šæ¥è¶Šå¤§) ï¼Œé¿å…é¢‘ç¹newInstance çš„æƒ…å†µã€‚ ä¸ºä»€ä¹ˆArrayList ä¸é€‚åˆé¢‘ç¹æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Ÿç”±ä¸Šé¢åˆ†æçš„å¢åŠ åˆ é™¤æ–¹æ³•å¯ä»¥çœ‹å‡ºåœ¨ArrayListä¸­ç»å¸¸ä¼šè°ƒç”¨ System.arraycopy è¿™ä¸ªæ•ˆç‡å¾ˆä½çš„æ“ä½œæ¥å¤åˆ¶æ•°ç»„ï¼Œæ‰€ä»¥å¯¼è‡´ArrayListåœ¨æ’å…¥å’Œåˆ é™¤æ“ä½œä¸­æ•ˆç‡ä¸é«˜ã€‚ RandomAccessæ¥å£public interface RandomAccess &#123; &#125; æŸ¥çœ‹æºç æˆ‘ä»¬å‘ç°å®é™…ä¸Š RandomAccess æ¥å£ä¸­ä»€ä¹ˆéƒ½æ²¡æœ‰å®šä¹‰ã€‚æ‰€ä»¥ï¼Œåœ¨æˆ‘çœ‹æ¥ RandomAccess æ¥å£ä¸è¿‡æ˜¯ä¸€ä¸ªæ ‡è¯†ç½¢äº†ã€‚æ ‡è¯†ä»€ä¹ˆï¼Ÿ æ ‡è¯†å®ç°è¿™ä¸ªæ¥å£çš„ç±»å…·æœ‰éšæœºè®¿é—®åŠŸèƒ½ã€‚ åœ¨ binarySearchï¼ˆ) æ–¹æ³•ä¸­ï¼Œå®ƒè¦åˆ¤æ–­ä¼ å…¥çš„ list æ˜¯å¦ RamdomAccess çš„å®ä¾‹ï¼Œå¦‚æœæ˜¯ï¼Œè°ƒç”¨indexedBinarySearch()æ–¹æ³•ï¼Œå¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆè°ƒç”¨iteratorBinarySearch()æ–¹æ³• public static &lt;T&gt; int binarySearch(List&lt;? extends Comparable&lt;? super T&gt;&gt; list, T key) &#123; if (list instanceof RandomAccess || list.size()&lt;BINARYSEARCH_THRESHOLD) return Collections.indexedBinarySearch(list, key); else return Collections.iteratorBinarySearch(list, key); &#125; ArrayList å®ç°äº† RandomAccess æ¥å£ï¼Œ è€Œ LinkedList æ²¡æœ‰å®ç°ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘è§‰å¾—è¿˜æ˜¯å’Œåº•å±‚æ•°æ®ç»“æ„æœ‰å…³ï¼ArrayList åº•å±‚æ˜¯æ•°ç»„ï¼Œè€Œ LinkedList åº•å±‚æ˜¯é“¾è¡¨ã€‚æ•°ç»„å¤©ç„¶æ”¯æŒéšæœºè®¿é—®ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œæ‰€ä»¥ç§°ä¸ºå¿«é€Ÿéšæœºè®¿é—®ã€‚é“¾è¡¨éœ€è¦éå†åˆ°ç‰¹å®šä½ç½®æ‰èƒ½è®¿é—®ç‰¹å®šä½ç½®çš„å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œæ‰€ä»¥ä¸æ”¯æŒå¿«é€Ÿéšæœºè®¿é—®ã€‚ï¼ŒArrayList å®ç°äº† RandomAccess æ¥å£ï¼Œå°±è¡¨æ˜äº†ä»–å…·æœ‰å¿«é€Ÿéšæœºè®¿é—®åŠŸèƒ½ã€‚ RandomAccess æ¥å£åªæ˜¯æ ‡è¯†ï¼Œå¹¶ä¸æ˜¯è¯´ ArrayList å®ç° RandomAccess æ¥å£æ‰å…·æœ‰å¿«é€Ÿéšæœºè®¿é—®åŠŸèƒ½çš„ï¼","categories":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://gyl-coder.top/tags/%E9%9B%86%E5%90%88/"},{"name":"ArrayList","slug":"ArrayList","permalink":"https://gyl-coder.top/tags/ArrayList/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"æ‰‹å†™å®ç°IOC å’Œ AOP","slug":"spring/custom-ioc-aop","date":"2020-04-03T00:00:00.000Z","updated":"2020-12-27T04:47:15.978Z","comments":true,"path":"spring/custom-ioc-aop/","link":"","permalink":"https://gyl-coder.top/spring/custom-ioc-aop/","excerpt":"é€šè¿‡ä¸Šä¸€ç¯‡ IOC &amp; AOP è¯¦è§£ æˆ‘ä»¬äº†è§£äº† IOC å’Œ AOP è¿™ä¸¤ä¸ªæ€æƒ³ï¼Œä¸‹é¢æˆ‘ä»¬å…ˆä¸å»è€ƒè™‘Springæ˜¯å¦‚ä½•å®ç°è¿™ä¸¤ä¸ªæ€æƒ³çš„ï¼Œå…ˆé€šè¿‡ä¸€ä¸ª é“¶è¡Œè½¬è´¦ çš„æ¡ˆä¾‹ï¼Œåˆ†æä¸€ä¸‹è¯¥æ¡ˆä¾‹åœ¨ä»£ç å±‚é¢å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Ÿåˆ†æä¹‹åä½¿ç”¨æˆ‘ä»¬å·²æœ‰çš„çŸ¥è¯†æ¥è§£å†³è¿™äº›é—®é¢˜ï¼ˆç—›ç‚¹ï¼‰ã€‚ å…¶å®è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åœ¨ä¸€æ­¥æ­¥åˆ†æå¹¶æ‰‹åŠ¨å®ç° IOC å’Œ AOP ã€‚","text":"é€šè¿‡ä¸Šä¸€ç¯‡ IOC &amp; AOP è¯¦è§£ æˆ‘ä»¬äº†è§£äº† IOC å’Œ AOP è¿™ä¸¤ä¸ªæ€æƒ³ï¼Œä¸‹é¢æˆ‘ä»¬å…ˆä¸å»è€ƒè™‘Springæ˜¯å¦‚ä½•å®ç°è¿™ä¸¤ä¸ªæ€æƒ³çš„ï¼Œå…ˆé€šè¿‡ä¸€ä¸ª é“¶è¡Œè½¬è´¦ çš„æ¡ˆä¾‹ï¼Œåˆ†æä¸€ä¸‹è¯¥æ¡ˆä¾‹åœ¨ä»£ç å±‚é¢å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Ÿåˆ†æä¹‹åä½¿ç”¨æˆ‘ä»¬å·²æœ‰çš„çŸ¥è¯†æ¥è§£å†³è¿™äº›é—®é¢˜ï¼ˆç—›ç‚¹ï¼‰ã€‚ å…¶å®è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åœ¨ä¸€æ­¥æ­¥åˆ†æå¹¶æ‰‹åŠ¨å®ç° IOC å’Œ AOP ã€‚ æ¡ˆä¾‹ä»‹ç»é“¶è¡Œè½¬è´¦ï¼šè´¦æˆ·Aå‘è´¦æˆ·Bè½¬è´¦ï¼ˆè´¦æˆ·Aå‡é’±ï¼Œè´¦æˆ·BåŠ é’±ï¼‰ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œåœ¨å‰ç«¯é¡µé¢ä¸­å†™æ­»äº†ä¸¤ä¸ªè´¦æˆ·ã€‚æ¯æ¬¡åªéœ€è¦è¾“å…¥è½¬è´¦é‡‘é¢ï¼Œè¿›è¡Œè½¬è´¦æ“ä½œï¼ŒéªŒè¯åŠŸèƒ½å³å¯ã€‚ æ¡ˆä¾‹è¡¨ç»“æ„name varcher 255 ç”¨æˆ·å money int 255 è´¦æˆ·é‡‘é¢ cardNo varcher 255 é“¶è¡Œå¡å· æ¡ˆä¾‹ä»£ç è°ƒç”¨å…³ç³» æ ¸å¿ƒä»£ç @WebServlet(name=&quot;transferServlet&quot;,urlPatterns = &quot;/transferServlet&quot;) public class TransferServlet extends HttpServlet &#123; // 1. å®ä¾‹åŒ–serviceå±‚å¯¹è±¡ private TransferService transferService = new TransferServiceImpl(); @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123; doPost(req,resp); &#125; @Override protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123; // è®¾ç½®è¯·æ±‚ä½“çš„å­—ç¬¦ç¼–ç  req.setCharacterEncoding(&quot;UTF-8&quot;); String fromCardNo = req.getParameter(&quot;fromCardNo&quot;); String toCardNo = req.getParameter(&quot;toCardNo&quot;); String moneyStr = req.getParameter(&quot;money&quot;); int money = Integer.parseInt(moneyStr); Result result = new Result(); try &#123; // 2. è°ƒç”¨serviceå±‚æ–¹æ³• transferService.transfer(fromCardNo,toCardNo,money); result.setStatus(&quot;200&quot;); &#125; catch (Exception e) &#123; e.printStackTrace(); result.setStatus(&quot;201&quot;); result.setMessage(e.toString()); &#125; // å“åº” resp.setContentType(&quot;application/json;charset=utf-8&quot;); resp.getWriter().print(JsonUtils.object2Json(result)); &#125; &#125; public interface TransferService &#123; void transfer(String fromCardNo, String toCardNo, int money) throws Exception; &#125; public class TransferServiceImpl implements TransferService &#123; private AccountDao accountDao = new JdbcAccountDaoImpl(); @Override public void transfer(String fromCardNo, String toCardNo, int money) throws Exception &#123; Account from = accountDao.queryAccountByCardNo(fromCardNo); Account to = accountDao.queryAccountByCardNo(toCardNo); from.setMoney(from.getMoney()-money); to.setMoney(to.getMoney()+money); accountDao.updateAccountByCardNo(to); accountDao.updateAccountByCardNo(from); &#125; &#125; public interface AccountDao &#123; /** * é€šè¿‡å¡å·æŸ¥è¯¢è´¦æˆ· * @param cardNo * @return * @throws Exception */ Account queryAccountByCardNo(String cardNo) throws Exception; /** * æ›´æ–°è´¦æˆ·ä¿¡æ¯ * @param account * @return * @throws Exception */ int updateAccountByCardNo(Account account) throws Exception; &#125; public class JdbcAccountDaoImpl implements AccountDao &#123; @Override public Account queryAccountByCardNo(String cardNo) throws Exception &#123; //ä»è¿æ¥æ± è·å–è¿æ¥ Connection con = DruidUtils.getInstance().getConnection(); String sql = &quot;select * from account where cardNo=?&quot;; PreparedStatement preparedStatement = con.prepareStatement(sql); preparedStatement.setString(1,cardNo); ResultSet resultSet = preparedStatement.executeQuery(); Account account = new Account(); while(resultSet.next()) &#123; account.setCardNo(resultSet.getString(&quot;cardNo&quot;)); account.setName(resultSet.getString(&quot;name&quot;)); account.setMoney(resultSet.getInt(&quot;money&quot;)); &#125; resultSet.close(); preparedStatement.close(); con.close(); return account; &#125; @Override public int updateAccountByCardNo(Account account) throws Exception &#123; // ä»è¿æ¥æ± è·å–è¿æ¥ Connection con = DruidUtils.getInstance().getConnection(); String sql = &quot;update account set money=? where cardNo=?&quot;; PreparedStatement preparedStatement = con.prepareStatement(sql); preparedStatement.setInt(1,account.getMoney()); preparedStatement.setString(2,account.getCardNo()); int i = preparedStatement.executeUpdate(); preparedStatement.close(); con.close(); return i; &#125; &#125; æ¡ˆä¾‹é—®é¢˜åˆ†æ é€šè¿‡ä¸Šé¢çš„æµç¨‹åˆ†æä»¥åŠç®€è¦ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°å¦‚ä¸‹é—®é¢˜ï¼š é—®é¢˜ä¸€ï¼š new å…³é”®å­—å°† service å±‚çš„å®ç°ç±» TransferServiceImpl å’Œ Dao å±‚çš„å…·ä½“å®ç°ç±» JdbcAccountDaoImpl è€¦åˆåœ¨äº†ä¸€èµ·ï¼Œå½“éœ€è¦åˆ‡æ¢Daoå±‚å®ç°ç±»çš„æ—¶å€™å¿…é¡»è¦ä¿®æ”¹ service çš„ä»£ç ã€é‡æ–°ç¼–è¯‘ï¼Œè¿™æ ·ä¸ç¬¦åˆé¢å‘æ¥å£å¼€å‘çš„æœ€ä¼˜åŸåˆ™ã€‚ é—®é¢˜äºŒï¼š service å±‚æ²¡æœ‰äº‹åŠ¡æ§åˆ¶ï¼Œå¦‚æœè½¬è´¦è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸å¯èƒ½ä¼šå¯¼è‡´æ•°æ®é”™ä¹±ï¼Œåæœå¾ˆä¸¥é‡ï¼Œå°¤å…¶æ˜¯åœ¨é‡‘èé“¶è¡Œé¢†åŸŸã€‚ é—®é¢˜è§£å†³æ€è·¯newå…³é”®å­—è€¦åˆé—®é¢˜è§£å†³æ–¹æ¡ˆå®ä¾‹åŒ–å¯¹è±¡çš„æ–¹å¼å¤„ç† new ä¹‹å¤–ï¼Œè¿˜æœ‰ä»€ä¹ˆæŠ€æœ¯ï¼Ÿ ç­”ï¼šåå°„ï¼ˆå°†ç±»çš„æƒé™å®šç±»åé…ç½®åœ¨xmlæ–‡ä»¶ä¸­ï¼‰ é¡¹ç›®ä¸­å¾€å¾€æœ‰å¾ˆå¤šå¯¹è±¡éœ€è¦å®ä¾‹åŒ–ï¼Œè€ƒè™‘ä½¿ç”¨å·¥ç¨‹æ¨¡å¼é€šè¿‡åå°„æ¥å®ä¾‹åŒ–å¯¹è±¡ã€‚ï¼ˆå·¥å‚æ¨¡å¼æ˜¯è§£è€¦åˆéå¸¸å¥½çš„ä¸€ç§æ–¹å¼ï¼‰ ä»£ç ä¸­èƒ½å¦åªå£°æ˜æ‰€éœ€å®ä¾‹çš„æ¥å£ç±»å‹ï¼Œä¸å‡ºç°newå…³é”®å­—ï¼Œä¹Ÿä¸å‡ºç°å·¥å‚ç±»çš„å­—çœ¼ï¼Ÿ ç­”ï¼šå¯ä»¥ï¼Œå£°æ˜ä¸€ä¸ªå˜é‡å¹¶æä¾›ä¸€ä¸ªsetæ–¹æ³•ï¼Œåœ¨åå°„çš„æ—¶å€™å°†æ‰€éœ€è¦çš„å¯¹è±¡æ³¨å…¥è¿›å»ã€‚ public class TransferServiceImpl implements TransferService &#123; private AccountDao accountDao; public void setAccountDao(AccountDao accountDao) &#123; this.accountDao = accountDao; &#125; &#125; newå…³é”®å­—è€¦åˆé—®é¢˜ä»£ç æ”¹é€ é¦–å…ˆå®šä¹‰ bean.xml æ–‡ä»¶ &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt; &lt;!--è·Ÿæ ‡ç­¾beansï¼Œé‡Œé¢é…ç½®ä¸€ä¸ªåˆä¸€ä¸ªçš„beanå­æ ‡ç­¾ï¼Œæ¯ä¸€ä¸ªbeanå­æ ‡ç­¾éƒ½ä»£è¡¨ä¸€ä¸ªç±»çš„é…ç½®--&gt; &lt;beans&gt; &lt;!--idæ ‡è¯†å¯¹è±¡ï¼Œclassæ˜¯ç±»çš„å…¨é™å®šç±»å--&gt; &lt;bean id=&quot;accountDao&quot; class=&quot;com.yanliang.dao.impl.JdbcAccountDaoImpl&quot;&gt; &lt;property name=&quot;ConnectionUtils&quot; ref=&quot;connectionUtils&quot;/&gt; &lt;/bean&gt; &lt;bean id=&quot;transferService&quot; class=&quot;com.yanliang.service.impl.TransferServiceImpl&quot;&gt; &lt;!--set+ name ä¹‹åé”å®šåˆ°ä¼ å€¼çš„setæ–¹æ³•äº†ï¼Œé€šè¿‡åå°„æŠ€æœ¯å¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•ä¼ å…¥å¯¹åº”çš„å€¼--&gt; &lt;property name=&quot;AccountDao&quot; ref=&quot;accountDao&quot;&gt;&lt;/property&gt; &lt;/bean&gt; &lt;/beans&gt; å®šä¹‰BeanFactory /** * å·¥å‚ç±»ï¼Œç”Ÿäº§å¯¹è±¡ï¼ˆä½¿ç”¨åå°„æŠ€æœ¯ï¼‰ * ä»»åŠ¡ä¸€ï¼šè¯»å–è§£æxmlï¼Œé€šè¿‡åå°„æŠ€æœ¯å®ä¾‹åŒ–å¯¹è±¡å¹¶ä¸”å­˜å‚¨å¾…ç”¨ï¼ˆmapé›†åˆï¼‰ * ä»»åŠ¡äºŒï¼šå¯¹å¤–æä¾›è·å–å®ä¾‹å¯¹è±¡çš„æ¥å£ï¼ˆæ ¹æ®idè·å–ï¼‰ */ public class BeanFactory &#123; private static Map&lt;String,Object&gt; map = new HashMap&lt;&gt;(); // å­˜å‚¨å¯¹è±¡ /** * è¯»å–è§£æxmlï¼Œé€šè¿‡åå°„æŠ€æœ¯å®ä¾‹åŒ–å¯¹è±¡å¹¶ä¸”å­˜å‚¨å¾…ç”¨ï¼ˆmapé›†åˆï¼‰ */ static &#123; // åŠ è½½xml InputStream resourceAsStream = BeanFactory.class.getClassLoader().getResourceAsStream(&quot;beans.xml&quot;); // è§£æxml SAXReader saxReader = new SAXReader(); try &#123; Document document = saxReader.read(resourceAsStream); // è·å–æ ¹å…ƒç´  Element rootElement = document.getRootElement(); List&lt;Element&gt; beanList = rootElement.selectNodes(&quot;//bean&quot;); for (int i = 0; i &lt; beanList.size(); i++) &#123; Element element = beanList.get(i); // å¤„ç†æ¯ä¸ªbeanå…ƒç´ ï¼Œè·å–åˆ°è¯¥å…ƒç´ çš„id å’Œ class å±æ€§ String id = element.attributeValue(&quot;id&quot;); // accountDao String clazz = element.attributeValue(&quot;class&quot;); // com.yanliang.dao.impl.JdbcAccountDaoImpl // é€šè¿‡åå°„æŠ€æœ¯å®ä¾‹åŒ–å¯¹è±¡ Class&lt;?&gt; aClass = Class.forName(clazz); Object o = aClass.newInstance(); // å®ä¾‹åŒ–ä¹‹åçš„å¯¹è±¡ // å­˜å‚¨åˆ°mapä¸­å¾…ç”¨ map.put(id,o); &#125; // å®ä¾‹åŒ–å®Œæˆä¹‹åç»´æŠ¤å¯¹è±¡çš„ä¾èµ–å…³ç³»ï¼Œæ£€æŸ¥å“ªäº›å¯¹è±¡éœ€è¦ä¼ å€¼è¿›å…¥ï¼Œæ ¹æ®å®ƒçš„é…ç½®ï¼Œæˆ‘ä»¬ä¼ å…¥ç›¸åº”çš„å€¼ // æœ‰propertyå­å…ƒç´ çš„beanå°±æœ‰ä¼ å€¼éœ€æ±‚ List&lt;Element&gt; propertyList = rootElement.selectNodes(&quot;//property&quot;); // è§£æpropertyï¼Œè·å–çˆ¶å…ƒç´  for (int i = 0; i &lt; propertyList.size(); i++) &#123; Element element = propertyList.get(i); //&lt;property name=&quot;AccountDao&quot; ref=&quot;accountDao&quot;&gt;&lt;/property&gt; String name = element.attributeValue(&quot;name&quot;); String ref = element.attributeValue(&quot;ref&quot;); // æ‰¾åˆ°å½“å‰éœ€è¦è¢«å¤„ç†ä¾èµ–å…³ç³»çš„bean Element parent = element.getParent(); // è°ƒç”¨çˆ¶å…ƒç´ å¯¹è±¡çš„åå°„åŠŸèƒ½ String parentId = parent.attributeValue(&quot;id&quot;); Object parentObject = map.get(parentId); // éå†çˆ¶å¯¹è±¡ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œæ‰¾åˆ°&quot;set&quot; + name Method[] methods = parentObject.getClass().getMethods(); for (int j = 0; j &lt; methods.length; j++) &#123; Method method = methods[j]; if(method.getName().equalsIgnoreCase(&quot;set&quot; + name)) &#123; // è¯¥æ–¹æ³•å°±æ˜¯ setAccountDao(AccountDao accountDao) method.invoke(parentObject,map.get(ref)); &#125; &#125; // æŠŠå¤„ç†ä¹‹åçš„parentObjecté‡æ–°æ”¾åˆ°mapä¸­ map.put(parentId,parentObject); &#125; &#125; catch (DocumentException e) &#123; e.printStackTrace(); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IllegalAccessException e) &#123; e.printStackTrace(); &#125; catch (InstantiationException e) &#123; e.printStackTrace(); &#125; catch (InvocationTargetException e) &#123; e.printStackTrace(); &#125; &#125; /** * å¯¹å¤–æä¾›è·å–å®ä¾‹å¯¹è±¡çš„æ¥å£ï¼ˆæ ¹æ®idè·å–ï¼‰ * @param id * @return */ public static Object getBean(String id) &#123; return map.get(id); &#125; &#125; å¯¹è±¡çš„å®ä¾‹åŒ–å·¥ä½œäº¤ç»™BeanFactoryæ¥è¿›è¡Œä¹‹åï¼Œæˆ‘ä»¬å†å…·ä½“ä½¿ç”¨æ˜¯å°±å¯ä»¥åƒå¦‚ä¸‹è¿™æ ·äº†ï¼š @WebServlet(name=&quot;transferServlet&quot;,urlPatterns = &quot;/transferServlet&quot;) public class TransferServlet extends HttpServlet &#123; // // 1. å®ä¾‹åŒ–serviceå±‚å¯¹è±¡ // private TransferService transferService = new TransferServiceImpl(); // æ”¹é€ ä¸ºé€šè¿‡Beanå·¥ç¨‹è·å–serviceå±‚å¯¹è±¡ private TransferService transferService = (TransferService) BeanFactory.getBean(&quot;transferService&quot;); public class TransferServiceImpl implements TransferService &#123; // private AccountDao accountDao = new JdbcAccountDaoImpl(); // // æ”¹é€ ä¸ºé€šè¿‡Beanå·¥å‚è·å–å¯¹è±¡ // private AccountDao accountDao = (AccountDao) BeanFactory.getBean(&quot;accountDao&quot;); // æœ€ä½³çŠ¶æ€ private AccountDao accountDao; public void setAccountDao(AccountDao accountDao) &#123; this.accountDao = accountDao; &#125; äº‹åŠ¡æ§åˆ¶é—®é¢˜åˆ†æåœ¨è½¬è´¦çš„ä¸šåŠ¡ä»£ç ä¸­æ‰‹åŠ¨æ¨¡æ‹Ÿè½¬è´¦å¼‚å¸¸ï¼Œæ¥éªŒè¯ä¸€ä¸‹ã€‚åœ¨ä¸¤ä¸ªè´¦æˆ·çš„è½¬å…¥å’Œè½¬å‡ºä¹‹é—´æ¨¡æ‹Ÿä¸€ä¸ªåˆ†æ¯ä¸º0çš„å¼‚å¸¸ã€‚ accountDao.updateAccountByCardNo(to); int i = 1/0; accountDao.updateAccountByCardNo(from); ç„¶åå¯åŠ¨ç¨‹åºï¼Œç‚¹å‡»è½¬è´¦ï¼ˆæå¤§é›· å‘ éŸ©æ¢…æ¢…è½¬ 100 ï¿¥ï¼‰ä¹‹åï¼Œä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ã€‚ è¿™æ—¶æˆ‘ä»¬å†æŸ¥çœ‹æ•°æ®åº“ å‘ç° éŸ©æ¢…æ¢… çš„è´¦æˆ·å¢åŠ äº†100ï¿¥ï¼Œä½†æ˜¯æå¤§é›·çš„è´¦æˆ·å¹¶æ²¡æœ‰å‡å°‘ï¼ˆä¸¤ä¸ªè´¦æˆ·åŸæœ¬éƒ½æœ‰10000ï¿¥ï¼‰ã€‚ å‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› å°±æ˜¯å› ä¸ºServiceå±‚æ²¡æœ‰äº‹åŠ¡æ§åˆ¶çš„åŠŸèƒ½ï¼Œåœ¨è½¬è´¦è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼ˆè½¬å…¥å’Œè½¬å‡ºä¹‹é—´å‡ºç°å¼‚å¸¸ï¼Œè½¬å…¥å·²ç»å®Œæˆï¼Œè½¬å‡ºæ²¡æœ‰è¿›è¡Œï¼‰è¿™äº‹å°±ä¼šé€ æˆä¸Šé¢çš„é—®é¢˜ã€‚ æ•°æ®åº“çš„äº‹åŠ¡é—®é¢˜å½’æ ¹ç»“åº•æ˜¯ Connection çš„äº‹åŠ¡ connection.commit() æäº¤äº‹åŠ¡ connection.rollback() å›æ»šäº‹åŠ¡ åœ¨ä¸Šé¢é“¶è¡Œè½¬è´¦çš„æ¡ˆä¾‹ä¸­ï¼Œä¸¤æ¬¡updateæ“ä½œä½¿ç”¨çš„æ˜¯ä¸¤ä¸ªæ•°æ®åº“è¿æ¥ï¼Œè¿™æ ·çš„è¯ï¼Œè‚¯å®šå°±ä¸å±äºåŒä¸€ä¸ªäº‹åŠ¡æ§åˆ¶äº†ã€‚ è§£å†³æ€è·¯ï¼š é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¾—å‡ºé—®é¢˜çš„åŸå› æ˜¯ä¸¤æ¬¡updateä½¿ç”¨äº†ä¸¤ä¸ªä¸åŒçš„connectionè¿æ¥ã€‚é‚£ä¹ˆè¦æƒ³è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦è®©ä¸¤æ¬¡updateä½¿ç”¨åŒä¸€ä¸ªconnectionè¿æ¥ ä¸¤æ¬¡updateå±äºåŒä¸€ä¸ªçº¿ç¨‹å†…çš„æ‰§è¡Œè°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å½“å‰çº¿ç¨‹ç»‘å®šä¸€ä¸ªConnectionï¼Œå’Œå½“å‰çº¿ç¨‹æœ‰å…³ç³»çš„æ•°æ®åº“æ“ä½œéƒ½å»ä½¿ç”¨è¿™ä¸ªconnectionï¼ˆä»å½“å‰çº¿ç¨‹ä¸­è·å–ï¼Œç¬¬ä¸€æ¬¡ä½¿ç”¨è¿æ¥ï¼Œå‘ç°å½“å‰çº¿ç¨‹æ²¡æœ‰ï¼Œå°±ä»è¿æ¥æ± è·å–ä¸€ä¸ªè¿æ¥ç»‘å®šåˆ°å½“å‰çº¿ç¨‹ï¼‰ å¦ä¸€æ–¹é¢ï¼Œç›®å‰äº‹åŠ¡æ§åˆ¶æ˜¯åœ¨Daoå±‚è¿›è¡Œçš„ï¼ˆconnectionï¼‰ï¼Œæˆ‘ä»¬éœ€è¦å°†äº‹åŠ¡æ§åˆ¶æåˆ°serviceå±‚ï¼ˆserviceå±‚æ‰æ˜¯å…·ä½“æ‰§è¡Œä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹ï¼Œè¿™é‡Œå¯èƒ½ä¼šè°ƒç”¨å¤šä¸ªdaoå±‚çš„æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦å¯¹serviceå±‚çš„æ–¹æ³•è¿›è¡Œæ•´ä½“çš„äº‹åŠ¡æ§åˆ¶ï¼‰ã€‚ æœ‰äº†ä¸Šé¢ä¸¤ä¸ªæ€è·¯ï¼Œä¸‹é¢æˆ‘ä»¬è¿›è¡Œä»£ç ä¿®æ”¹ã€‚ äº‹åŠ¡æ§åˆ¶ä»£ç ä¿®æ”¹å¢åŠ  ConnectionUtils å·¥å…·ç±» /** * è·å–è¿æ¥ï¼Œå¹¶å°†è¿æ¥ä¸çº¿ç¨‹ç»‘å®š */ public class ConnectionUtils &#123; private ThreadLocal&lt;Connection&gt; threadLocal = new ThreadLocal&lt;&gt;(); // å­˜å‚¨å½“å‰çº¿ç¨‹çš„è¿æ¥ /** * ä»å½“å‰çº¿ç¨‹è·å–è¿æ¥ */ public Connection getCurrentThreadConn() throws SQLException &#123; /** * åˆ¤æ–­å½“å‰çº¿ç¨‹ä¸­æ˜¯å¦å·²ç»ç»‘å®šè¿æ¥ï¼Œå¦‚æœæ²¡æœ‰ç»‘å®šï¼Œéœ€è¦ä»è¿æ¥æ± è·å–ä¸€ä¸ªè¿æ¥ç»‘å®šåˆ°å½“å‰çº¿ç¨‹ */ Connection connection = threadLocal.get(); if(connection == null) &#123; // ä»è¿æ¥æ± æ‹¿è¿æ¥å¹¶ç»‘å®šåˆ°çº¿ç¨‹ connection = DruidUtils.getInstance().getConnection(); // ç»‘å®šåˆ°å½“å‰çº¿ç¨‹ threadLocal.set(connection); &#125; return connection; &#125; &#125; å¢åŠ  TransactionManager äº‹åŠ¡ç®¡ç†ç±» /** * äº‹åŠ¡ç®¡ç†å™¨ç±»ï¼šè´Ÿè´£æ‰‹åŠ¨äº‹åŠ¡çš„å¼€å¯ã€æäº¤ã€å›æ»š */ public class TransactionManager &#123; private ConnectionUtils connectionUtils; public void setConnectionUtils(ConnectionUtils connectionUtils) &#123; this.connectionUtils = connectionUtils; &#125; // å¼€å¯æ‰‹åŠ¨äº‹åŠ¡æ§åˆ¶ public void beginTransaction() throws SQLException &#123; connectionUtils.getCurrentThreadConn().setAutoCommit(false); &#125; // æäº¤äº‹åŠ¡ public void commit() throws SQLException &#123; connectionUtils.getCurrentThreadConn().commit(); &#125; // å›æ»šäº‹åŠ¡ public void rollback() throws SQLException &#123; connectionUtils.getCurrentThreadConn().rollback(); &#125; &#125; å¢åŠ ä»£ç†å·¥å‚ ProxyFactory /** * ä»£ç†å¯¹è±¡å·¥å‚ï¼šç”Ÿæˆä»£ç†å¯¹è±¡çš„ */ public class ProxyFactory &#123; private TransactionManager transactionManager; public void setTransactionManager(TransactionManager transactionManager) &#123; this.transactionManager = transactionManager; &#125; /** * JdkåŠ¨æ€ä»£ç† * @param obj å§”æ‰˜å¯¹è±¡ * @return ä»£ç†å¯¹è±¡ */ public Object getJdkProxy(Object obj) &#123; // è·å–ä»£ç†å¯¹è±¡ return Proxy.newProxyInstance(obj.getClass().getClassLoader(), obj.getClass().getInterfaces(), new InvocationHandler() &#123; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; Object result = null; try&#123; // å¼€å¯äº‹åŠ¡(å…³é—­äº‹åŠ¡çš„è‡ªåŠ¨æäº¤) transactionManager.beginTransaction(); result = method.invoke(obj,args); // æäº¤äº‹åŠ¡ transactionManager.commit(); &#125;catch (Exception e) &#123; e.printStackTrace(); // å›æ»šäº‹åŠ¡ transactionManager.rollback(); // æŠ›å‡ºå¼‚å¸¸ä¾¿äºä¸Šå±‚servletæ•è· throw e; &#125; return result; &#125; &#125;); &#125; /** * ä½¿ç”¨cglibåŠ¨æ€ä»£ç†ç”Ÿæˆä»£ç†å¯¹è±¡ * @param obj å§”æ‰˜å¯¹è±¡ * @return */ public Object getCglibProxy(Object obj) &#123; return Enhancer.create(obj.getClass(), new MethodInterceptor() &#123; @Override public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable &#123; Object result = null; try&#123; // å¼€å¯äº‹åŠ¡(å…³é—­äº‹åŠ¡çš„è‡ªåŠ¨æäº¤) transactionManager.beginTransaction(); result = method.invoke(obj,objects); // æäº¤äº‹åŠ¡ transactionManager.commit(); &#125;catch (Exception e) &#123; e.printStackTrace(); // å›æ»šäº‹åŠ¡ transactionManager.rollback(); // æŠ›å‡ºå¼‚å¸¸ä¾¿äºä¸Šå±‚servletæ•è· throw e; &#125; return result; &#125; &#125;); &#125; &#125; ä¿®æ”¹beans.xmlæ–‡ä»¶ &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt; &lt;!--è·Ÿæ ‡ç­¾beansï¼Œé‡Œé¢é…ç½®ä¸€ä¸ªåˆä¸€ä¸ªçš„beanå­æ ‡ç­¾ï¼Œæ¯ä¸€ä¸ªbeanå­æ ‡ç­¾éƒ½ä»£è¡¨ä¸€ä¸ªç±»çš„é…ç½®--&gt; &lt;beans&gt; &lt;!--idæ ‡è¯†å¯¹è±¡ï¼Œclassæ˜¯ç±»çš„å…¨é™å®šç±»å--&gt; &lt;bean id=&quot;accountDao&quot; class=&quot;com.yanliang.dao.impl.JdbcAccountDaoImpl&quot;&gt; &lt;property name=&quot;ConnectionUtils&quot; ref=&quot;connectionUtils&quot;/&gt; &lt;/bean&gt; &lt;bean id=&quot;transferService&quot; class=&quot;com.yanliang.service.impl.TransferServiceImpl&quot;&gt; &lt;!--set+ name ä¹‹åé”å®šåˆ°ä¼ å€¼çš„setæ–¹æ³•äº†ï¼Œé€šè¿‡åå°„æŠ€æœ¯å¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•ä¼ å…¥å¯¹åº”çš„å€¼--&gt; &lt;property name=&quot;AccountDao&quot; ref=&quot;accountDao&quot;&gt;&lt;/property&gt; &lt;/bean&gt; &lt;!--é…ç½®æ–°å¢çš„ä¸‰ä¸ªBean--&gt; &lt;bean id=&quot;connectionUtils&quot; class=&quot;com.yanliang.utils.ConnectionUtils&quot;&gt;&lt;/bean&gt; &lt;!--äº‹åŠ¡ç®¡ç†å™¨--&gt; &lt;bean id=&quot;transactionManager&quot; class=&quot;com.yanliang.utils.TransactionManager&quot;&gt; &lt;property name=&quot;ConnectionUtils&quot; ref=&quot;connectionUtils&quot;/&gt; &lt;/bean&gt; &lt;!--ä»£ç†å¯¹è±¡å·¥å‚--&gt; &lt;bean id=&quot;proxyFactory&quot; class=&quot;com.yanliang.factory.ProxyFactory&quot;&gt; &lt;property name=&quot;TransactionManager&quot; ref=&quot;transactionManager&quot;/&gt; &lt;/bean&gt; &lt;/beans&gt; ä¿®æ”¹ JdbcAccountDaoImplçš„å®ç° public class JdbcAccountDaoImpl implements AccountDao &#123; private ConnectionUtils connectionUtils; public void setConnectionUtils(ConnectionUtils connectionUtils) &#123; this.connectionUtils = connectionUtils; &#125; @Override public Account queryAccountByCardNo(String cardNo) throws Exception &#123; //ä»è¿æ¥æ± è·å–è¿æ¥ // Connection con = DruidUtils.getInstance().getConnection(); // æ”¹é€ ä¸ºï¼šä»å½“å‰çº¿ç¨‹å½“ä¸­è·å–ç»‘å®šçš„connectionè¿æ¥ Connection con = connectionUtils.getCurrentThreadConn(); String sql = &quot;select * from account where cardNo=?&quot;; PreparedStatement preparedStatement = con.prepareStatement(sql); preparedStatement.setString(1,cardNo); ResultSet resultSet = preparedStatement.executeQuery(); Account account = new Account(); while(resultSet.next()) &#123; account.setCardNo(resultSet.getString(&quot;cardNo&quot;)); account.setName(resultSet.getString(&quot;name&quot;)); account.setMoney(resultSet.getInt(&quot;money&quot;)); &#125; resultSet.close(); preparedStatement.close(); // con.close(); return account; &#125; @Override public int updateAccountByCardNo(Account account) throws Exception &#123; // ä»è¿æ¥æ± è·å–è¿æ¥ // Connection con = DruidUtils.getInstance().getConnection(); // æ”¹é€ ä¸ºï¼šä»å½“å‰çº¿ç¨‹å½“ä¸­è·å–ç»‘å®šçš„connectionè¿æ¥ Connection con = connectionUtils.getCurrentThreadConn(); String sql = &quot;update account set money=? where cardNo=?&quot;; PreparedStatement preparedStatement = con.prepareStatement(sql); preparedStatement.setInt(1,account.getMoney()); preparedStatement.setString(2,account.getCardNo()); int i = preparedStatement.executeUpdate(); preparedStatement.close(); // con.close(); return i; &#125; &#125; ä¿®æ”¹ TransferServlet @WebServlet(name=&quot;transferServlet&quot;,urlPatterns = &quot;/transferServlet&quot;) public class TransferServlet extends HttpServlet &#123; // // 1. å®ä¾‹åŒ–serviceå±‚å¯¹è±¡ // private TransferService transferService = new TransferServiceImpl(); // æ”¹é€ ä¸ºé€šè¿‡Beanå·¥ç¨‹è·å–serviceå±‚å¯¹è±¡ // private TransferService transferService = (TransferService) BeanFactory.getBean(&quot;transferService&quot;); // ä»å·¥ç¨‹è·å–å§”æ‰˜å¯¹è±¡ï¼ˆå§”æ‰˜å¯¹è±¡å¢å¼ºäº†äº‹åŠ¡æ§åˆ¶çš„åŠŸèƒ½ï¼‰ private ProxyFactory proxyFactory = (ProxyFactory) BeanFactory.getBean(&quot;proxyFactory&quot;); private TransferService transferService = (TransferService) proxyFactory.getProxy(BeanFactory.getBean(&quot;transferService&quot;)) ; @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123; doPost(req,resp); &#125; @Override protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123; // è®¾ç½®è¯·æ±‚ä½“çš„å­—ç¬¦ç¼–ç  req.setCharacterEncoding(&quot;UTF-8&quot;); String fromCardNo = req.getParameter(&quot;fromCardNo&quot;); String toCardNo = req.getParameter(&quot;toCardNo&quot;); String moneyStr = req.getParameter(&quot;money&quot;); int money = Integer.parseInt(moneyStr); Result result = new Result(); try &#123; // 2. è°ƒç”¨serviceå±‚æ–¹æ³• transferService.transfer(fromCardNo,toCardNo,money); result.setStatus(&quot;200&quot;); &#125; catch (Exception e) &#123; e.printStackTrace(); result.setStatus(&quot;201&quot;); result.setMessage(e.toString()); &#125; // å“åº” resp.setContentType(&quot;application/json;charset=utf-8&quot;); resp.getWriter().print(JsonUtils.object2Json(result)); &#125; &#125; æ”¹é€ å®Œä¹‹åï¼Œæˆ‘ä»¬å†æ¬¡è¿›è¡Œæµ‹è¯•ï¼Œè¿™æ—¶ä¼šå‘ç°å½“è½¬è´¦è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯æ˜¯ï¼Œäº‹åŠ¡èƒ½å¤ŸæˆåŠŸçš„è¢«æ§åˆ¶ä½ï¼ˆè½¬å‡ºè´¦æˆ·ä¸ä¼šå°‘é’±ï¼Œè½¬å…¥è´¦æˆ·ä¸ä¼šå¤šé’±ï¼‰ã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä»£ç†çš„æ–¹å¼æ¥å®ç°äº‹åŠ¡æ§åˆ¶ï¼Ÿè¿™é‡Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä»£ç†çš„æ–¹å¼æ¥å®ç°äº‹åŠ¡æ§åˆ¶ï¼Ÿ å¦‚æœæ²¡æœ‰ä½¿ç”¨ä»£ç†çš„æ–¹å¼ï¼Œæˆ‘ä»¬è¦å‘å®ç°äº‹åŠ¡æ§åˆ¶è¿™éœ€è¦å°†ï¼Œäº‹åŠ¡æ§åˆ¶çš„ç›¸å…³ä»£ç å†™åœ¨serviceå±‚çš„TransferServiceImpl å…·ä½“å®ç°ä¸­ã€‚ public class TransferServiceImpl implements TransferService &#123; // æœ€ä½³çŠ¶æ€ private AccountDao accountDao; // æ„é€ å‡½æ•°ä¼ å€¼/setæ–¹æ³•ä¼ å€¼ public void setAccountDao(AccountDao accountDao) &#123; this.accountDao = accountDao; &#125; @Override public void transfer(String fromCardNo, String toCardNo, int money) throws Exception &#123; try&#123; // å¼€å¯äº‹åŠ¡(å…³é—­äº‹åŠ¡çš„è‡ªåŠ¨æäº¤) TransactionManager.getInstance().beginTransaction();*/ Account from = accountDao.queryAccountByCardNo(fromCardNo); Account to = accountDao.queryAccountByCardNo(toCardNo); from.setMoney(from.getMoney()-money); to.setMoney(to.getMoney()+money); accountDao.updateAccountByCardNo(to); // æ¨¡æ‹Ÿå¼‚å¸¸ int c = 1/0; accountDao.updateAccountByCardNo(from); // æäº¤äº‹åŠ¡ TransactionManager.getInstance().commit(); &#125;catch (Exception e) &#123; e.printStackTrace(); // å›æ»šäº‹åŠ¡ TransactionManager.getInstance().rollback(); // æŠ›å‡ºå¼‚å¸¸ä¾¿äºä¸Šå±‚servletæ•è· throw e; &#125; &#125; &#125; è¿™æ ·çš„è¯ï¼Œäº‹åŠ¡æ§åˆ¶å’Œå…·ä½“çš„ä¸šåŠ¡ä»£ç å°±è€¦åˆåœ¨äº†ä¸€èµ·ï¼Œå¦‚æœæœ‰å¤šä¸ªæ–¹æ³•éƒ½éœ€è¦å®ç°äº‹åŠ¡æ§åˆ¶çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸ªä¸šåŠ¡æ–¹æ³•æ˜¯éƒ½æ·»åŠ ä¸Šè¿™äº›ä»£ç ã€‚è¿™æ ·å°†ä¼šå‡ºç°å¤§é‡çš„é‡å¤ä»£ç ã€‚æ‰€ä»¥è¿™é‡Œä½¿ç”¨äº† AOP çš„æ€æƒ³é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼å®ç°äº†äº‹åŠ¡æ§åˆ¶ã€‚ ä¸‹è½½æºç https://github.com/gyl-coder/ISpring-IOC-AOP/tree/feat-init","categories":[{"name":"Spring","slug":"Spring","permalink":"https://gyl-coder.top/categories/Spring/"}],"tags":[{"name":"åŠ¨æ€ä»£ç†","slug":"åŠ¨æ€ä»£ç†","permalink":"https://gyl-coder.top/tags/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"},{"name":"Spring","slug":"Spring","permalink":"https://gyl-coder.top/tags/Spring/"},{"name":"IOC","slug":"IOC","permalink":"https://gyl-coder.top/tags/IOC/"},{"name":"AOP","slug":"AOP","permalink":"https://gyl-coder.top/tags/AOP/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.github.io"}},{"title":"åŠ¨æ€ä»£ç†åŸç†å‰–æ","slug":"java/dynamic-proxy","date":"2020-04-02T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"java/dynamic-proxy/","link":"","permalink":"https://gyl-coder.top/java/dynamic-proxy/","excerpt":"åŠ¨æ€ä»£ç†çš„å¸¸ç”¨å®ç°æ–¹å¼æ˜¯åå°„ã€‚åå°„æœºåˆ¶æ˜¯ Java è¯­è¨€æä¾›çš„ä¸€ç§åŸºç¡€åŠŸèƒ½ï¼Œèµ‹äºˆç¨‹åºåœ¨è¿è¡Œæ—¶è‡ªçœï¼ˆintrospectï¼Œå®˜æ–¹ç”¨è¯­ï¼‰çš„èƒ½åŠ›ã€‚é€šè¿‡åå°„æˆ‘ä»¬å¯ä»¥ç›´æ¥æ“ä½œç±»æˆ–è€…å¯¹è±¡ï¼Œæ¯”å¦‚è·å–æŸä¸ªå¯¹è±¡çš„ç±»å®šä¹‰ï¼Œè·å–ç±»å£°æ˜çš„å±æ€§å’Œæ–¹æ³•ï¼Œè°ƒç”¨æ–¹æ³•æˆ–è€…æ„é€ å¯¹è±¡ï¼Œç”šè‡³å¯ä»¥è¿è¡Œæ—¶ä¿®æ”¹ç±»å®šä¹‰ã€‚ åŠ¨æ€ä»£ç†æ˜¯ä¸€ç§æ–¹ä¾¿è¿è¡Œæ—¶åŠ¨æ€æ„å»ºä»£ç†ã€åŠ¨æ€å¤„ç†ä»£ç†æ–¹æ³•è°ƒç”¨çš„æœºåˆ¶ï¼Œå¾ˆå¤šåœºæ™¯éƒ½æ˜¯åˆ©ç”¨ç±»ä¼¼æœºåˆ¶åšåˆ°çš„ï¼Œæ¯”å¦‚ç”¨æ¥åŒ…è£… RPC è°ƒç”¨ã€é¢å‘åˆ‡é¢çš„ç¼–ç¨‹ï¼ˆAOPï¼‰ã€‚ JDK è‡ªèº«æä¾›çš„åŠ¨æ€ä»£ç†ï¼Œå°±æ˜¯ä¸»è¦åˆ©ç”¨äº†ä¸Šé¢æåˆ°çš„åå°„æœºåˆ¶ã€‚ä½†åŠ¨æ€ä»£ç†ä¸æ­¢æœ‰åå°„ä¸€ç§å®ç°æ–¹å¼ï¼Œè¿˜æœ‰å…¶ä»–çš„å®ç°æ–¹å¼ï¼Œæ¯”å¦‚åˆ©ç”¨ä¼ è¯´ä¸­æ›´é«˜æ€§èƒ½çš„å­—èŠ‚ç æ“ä½œæœºåˆ¶ï¼Œç±»ä¼¼ ASMã€cglibï¼ˆåŸºäº ASMï¼Œä¸€ä¸ª Java å­—èŠ‚ç æ“ä½œæ¡†æ¶ï¼‰ã€Javassist ç­‰ã€‚ç®€å•æ¥è¯´ï¼ŒåŠ¨æ€ä»£ç†æ˜¯ä¸€ç§è¡Œä¸ºæ–¹å¼ï¼Œè€Œåå°„æˆ– ASM åªæ˜¯å®ƒçš„ä¸€ç§å®ç°æ‰‹æ®µè€Œå·²ã€‚","text":"åŠ¨æ€ä»£ç†çš„å¸¸ç”¨å®ç°æ–¹å¼æ˜¯åå°„ã€‚åå°„æœºåˆ¶æ˜¯ Java è¯­è¨€æä¾›çš„ä¸€ç§åŸºç¡€åŠŸèƒ½ï¼Œèµ‹äºˆç¨‹åºåœ¨è¿è¡Œæ—¶è‡ªçœï¼ˆintrospectï¼Œå®˜æ–¹ç”¨è¯­ï¼‰çš„èƒ½åŠ›ã€‚é€šè¿‡åå°„æˆ‘ä»¬å¯ä»¥ç›´æ¥æ“ä½œç±»æˆ–è€…å¯¹è±¡ï¼Œæ¯”å¦‚è·å–æŸä¸ªå¯¹è±¡çš„ç±»å®šä¹‰ï¼Œè·å–ç±»å£°æ˜çš„å±æ€§å’Œæ–¹æ³•ï¼Œè°ƒç”¨æ–¹æ³•æˆ–è€…æ„é€ å¯¹è±¡ï¼Œç”šè‡³å¯ä»¥è¿è¡Œæ—¶ä¿®æ”¹ç±»å®šä¹‰ã€‚ åŠ¨æ€ä»£ç†æ˜¯ä¸€ç§æ–¹ä¾¿è¿è¡Œæ—¶åŠ¨æ€æ„å»ºä»£ç†ã€åŠ¨æ€å¤„ç†ä»£ç†æ–¹æ³•è°ƒç”¨çš„æœºåˆ¶ï¼Œå¾ˆå¤šåœºæ™¯éƒ½æ˜¯åˆ©ç”¨ç±»ä¼¼æœºåˆ¶åšåˆ°çš„ï¼Œæ¯”å¦‚ç”¨æ¥åŒ…è£… RPC è°ƒç”¨ã€é¢å‘åˆ‡é¢çš„ç¼–ç¨‹ï¼ˆAOPï¼‰ã€‚ JDK è‡ªèº«æä¾›çš„åŠ¨æ€ä»£ç†ï¼Œå°±æ˜¯ä¸»è¦åˆ©ç”¨äº†ä¸Šé¢æåˆ°çš„åå°„æœºåˆ¶ã€‚ä½†åŠ¨æ€ä»£ç†ä¸æ­¢æœ‰åå°„ä¸€ç§å®ç°æ–¹å¼ï¼Œè¿˜æœ‰å…¶ä»–çš„å®ç°æ–¹å¼ï¼Œæ¯”å¦‚åˆ©ç”¨ä¼ è¯´ä¸­æ›´é«˜æ€§èƒ½çš„å­—èŠ‚ç æ“ä½œæœºåˆ¶ï¼Œç±»ä¼¼ ASMã€cglibï¼ˆåŸºäº ASMï¼Œä¸€ä¸ª Java å­—èŠ‚ç æ“ä½œæ¡†æ¶ï¼‰ã€Javassist ç­‰ã€‚ç®€å•æ¥è¯´ï¼ŒåŠ¨æ€ä»£ç†æ˜¯ä¸€ç§è¡Œä¸ºæ–¹å¼ï¼Œè€Œåå°„æˆ– ASM åªæ˜¯å®ƒçš„ä¸€ç§å®ç°æ‰‹æ®µè€Œå·²ã€‚ JDK Proxy å’Œ CGLib çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š JDK Proxy æ˜¯ Java è¯­è¨€è‡ªå¸¦çš„åŠŸèƒ½ï¼Œæ— éœ€é€šè¿‡åŠ è½½ç¬¬ä¸‰æ–¹ç±»å®ç°ï¼› Java å¯¹ JDK Proxy æä¾›äº†ç¨³å®šçš„æ”¯æŒï¼Œå¹¶ä¸”ä¼šæŒç»­çš„å‡çº§å’Œæ›´æ–° JDK Proxyï¼Œä¾‹å¦‚ Java 8 ç‰ˆæœ¬ä¸­çš„ JDK Proxy æ€§èƒ½ç›¸æ¯”äºä¹‹å‰ç‰ˆæœ¬æå‡äº†å¾ˆå¤šï¼› JDK Proxy æ˜¯é€šè¿‡æ‹¦æˆªå™¨åŠ åå°„çš„æ–¹å¼å®ç°çš„ï¼› JDK Proxy åªèƒ½ä»£ç†ç»§æ‰¿æ¥å£çš„ç±»ï¼› JDK Proxy å®ç°å’Œè°ƒç”¨èµ·æ¥æ¯”è¾ƒç®€å•ï¼› CGLib æ˜¯ç¬¬ä¸‰æ–¹æä¾›çš„å·¥å…·ï¼ŒåŸºäº ASM å®ç°çš„ï¼Œæ€§èƒ½æ¯”è¾ƒé«˜ï¼› CGLib æ— éœ€é€šè¿‡æ¥å£æ¥å®ç°ï¼Œå®ƒæ˜¯é€šè¿‡å®ç°å­ç±»çš„æ–¹å¼æ¥å®Œæˆè°ƒç”¨çš„ã€‚ ä»€ä¹ˆæ˜¯é™æ€ä»£ç†é™æ€ä»£ç†æ˜¯ä»£ç†ç±»åœ¨ç¼–è¯‘æœŸé—´å°±åˆ›å»ºå¥½äº†ï¼Œä¸æ˜¯ç¼–è¯‘å™¨ç”Ÿæˆçš„ä»£ç†ç±»ï¼Œè€Œæ˜¯æ‰‹åŠ¨åˆ›å»ºçš„ç±»ã€‚åœ¨ç¼–è¯‘æ—¶å°±å·²ç»å°†æ¥å£ï¼Œè¢«ä»£ç†ç±»ï¼Œä»£ç†ç±»ç­‰ç¡®å®šä¸‹æ¥ã€‚ï¼Œè½¯ä»¶è®¾è®¡ä¸­æ‰€æŒ‡çš„ä»£ç†ä¸€èˆ¬æ˜¯æŒ‡é™æ€ä»£ç†ï¼Œä¹Ÿå°±æ˜¯åœ¨ä»£ç ä¸­æ˜¾å¼æŒ‡å®šçš„ä»£ç†ã€‚ ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹ï¼Œæ¥äº†è§£ä¸‹é™æ€ä»£ç†ã€‚ /** * é™æ€ä»£ç†ç±»æ¥å£, å§”æ‰˜ç±»å’Œä»£ç†ç±»éƒ½éœ€è¦å®ç°çš„æ¥å£è§„èŒƒã€‚ * å®šä¹‰äº†ä¸€ä¸ªçŒ«ç§‘åŠ¨ç‰©çš„ä¸¤ä¸ªè¡Œä¸ºæ¥å£ï¼Œåƒä¸œè¥¿ï¼Œå¥”è·‘ã€‚ * ä½œä¸ºä»£ç†ç±» å’Œå§”æ‰˜ç±»ä¹‹é—´çš„çº¦æŸæ¥å£ */ public interface Cat &#123; public String eatFood(String foodName); public boolean running(); &#125; /** * ç‹®å­ å®ç°äº†çŒ«ç§‘åŠ¨ç‰©æ¥å£Catï¼Œ å¹¶å®ç°äº†å…·ä½“çš„è¡Œä¸ºã€‚ä½œä¸ºå§”æ‰˜ç±»å®ç° */ public class Lion implements Cat &#123; private String name; private int runningSpeed; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getRunningSpeed() &#123; return runningSpeed; &#125; public void setRunningSpeed(int runningSpeed) &#123; this.runningSpeed = runningSpeed; &#125; public Lion() &#123; &#125; @Override public String eatFood(String foodName) &#123; String eat = this.name + &quot; Lion eat food. foodName = &quot; + foodName; System.out.println(eat); return eat; &#125; @Override public boolean running() &#123; System.out.println(this.name + &quot; Lion is running . Speed :&quot; + this.runningSpeed); return false; &#125; &#125; ä»£ç†ç±»è§’è‰²(FeederProxy) /** * é¥²å…»å‘˜ å®ç°Catæ¥å£ï¼Œä½œä¸ºé™æ€ä»£ç†ç±»å®ç°ã€‚ä»£ç†ç‹®å­çš„è¡Œä¸ºã€‚ * ä»£ç†ç±»ä¸­å¯ä»¥æ–°å¢ä¸€äº›å…¶ä»–è¡Œä¸ºï¼Œåœ¨å®è·µä¸­ä¸»è¦åšçš„æ˜¯å‚æ•°æ ¡éªŒçš„åŠŸèƒ½ã€‚ */ public class FeederProxy implements Cat &#123; private Cat cat; public FeederProxy()&#123;&#125; public FeederProxy(Cat cat) &#123; if (cat instanceof Cat) &#123; this.cat = cat; &#125; &#125; public void setCat(Cat cat) &#123; if (cat instanceof Cat) &#123; this.cat = cat; &#125; &#125; @Override public String eatFood(String foodName) &#123; System.out.println(&quot;proxy Lion exec eatFood &quot;); return cat.eatFood(foodName); &#125; @Override public boolean running() &#123; System.out.println(&quot;proxy Lion exec running.&quot;); return cat.running(); &#125; &#125; é™æ€ä»£ç†ç±»æµ‹è¯• /** * é™æ€ä»£ç†ç±»æµ‹è¯• */ public class staticProxyTest &#123; public static void main(String[] args) &#123; Lion lion = new Lion(); lion.setName(&quot;ç‹®å­ å°ç‹&quot;); lion.setRunningSpeed(100); /** * new é™æ€ä»£ç†ç±»ï¼Œé™æ€ä»£ç†ç±»åœ¨ç¼–è¯‘å‰å·²ç»åˆ›å»ºå¥½äº†ï¼Œå’ŒåŠ¨æ€ä»£ç†çš„æœ€å¤§åŒºåˆ«ç‚¹ */ Cat proxy = new FeederProxy(lion); System.out.println(Thread.currentThread().getName()+&quot; -- &quot; + proxy.eatFood(&quot;æ°´ç‰›&quot;)); proxy.running(); &#125; &#125; é™æ€ä»£ç†å¾ˆå¥½çš„è¯ é‡Šäº†ä»£ç†è®¾è®¡æ¨¡å¼ï¼Œä»£ç†æ¨¡å¼æœ€ä¸»è¦çš„å°±æ˜¯æœ‰ä¸€ä¸ªå…¬å…±æ¥å£ï¼ˆCatï¼‰ï¼Œä¸€ä¸ªå§”æ‰˜ç±»ï¼ˆLionï¼‰ï¼Œä¸€ä¸ªä»£ç†ç±»ï¼ˆFeederProxyï¼‰,ä»£ç†ç±»æŒæœ‰å§”æ‰˜ç±»çš„å®ä¾‹ï¼Œä»£ä¸ºæ‰§è¡Œå…·ä½“ç±»å®ä¾‹æ–¹æ³•ã€‚ ä»£ç†æ¨¡å¼å°±æ˜¯åœ¨è®¿é—®å®é™…å¯¹è±¡æ—¶å¼•å…¥ä¸€å®šç¨‹åº¦çš„é—´æ¥æ€§ï¼Œå› ä¸ºè¿™ç§é—´æ¥æ€§ï¼Œå¯ä»¥é™„åŠ å¤šç§ç”¨é€”ã€‚è¿™é‡Œçš„é—´æ¥æ€§å°±æ˜¯æŒ‡å®¢æˆ·ç«¯ä¸ç›´æ¥è°ƒç”¨å®é™…å¯¹è±¡çš„æ–¹æ³•ï¼Œå®¢æˆ·ç«¯ä¾èµ–å…¬å…±æ¥å£å¹¶ä½¿ç”¨ä»£ç†ç±»ã€‚ é‚£ä¹ˆæˆ‘ä»¬åœ¨ä»£ç†è¿‡ç¨‹ä¸­å°±å¯ä»¥åŠ ä¸Šä¸€äº›å…¶ä»–ç”¨é€”ã€‚ å°±è¿™ä¸ªä¾‹å­æ¥è¯´åœ¨ eatFood æ–¹æ³•è°ƒç”¨ä¸­ï¼Œä»£ç†ç±»åœ¨è°ƒç”¨å…·ä½“å®ç°ç±»ä¹‹å‰æ·»åŠ System.out.println(â€œproxy Lion exec eatFood â€œ);è¯­å¥ å°±æ˜¯æ·»åŠ é—´æ¥æ€§å¸¦æ¥çš„æ”¶ç›Šã€‚ä»£ç†ç±»å­˜åœ¨çš„æ„ä¹‰æ˜¯ä¸ºäº†å¢åŠ ä¸€äº›å…¬å…±çš„é€»è¾‘ä»£ç ã€‚ é™æ€ä»£ç†çš„ç¼ºé™· ä»£ç†ç±»å’Œå§”æ‰˜ç±»å®ç°äº†ç›¸åŒçš„æ¥å£ï¼Œä»£ç†ç±»é€šè¿‡å§”æ‰˜ç±»å®ç°äº†ç›¸åŒçš„æ–¹æ³•ã€‚è¿™æ ·å°±å‡ºç°äº†å¤§é‡çš„ä»£ç é‡å¤ã€‚å¦‚æœæ¥å£å¢åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œé™¤äº†æ‰€æœ‰å®ç°ç±»éœ€è¦å®ç°è¿™ä¸ªæ–¹æ³•å¤–ï¼Œæ‰€æœ‰ä»£ç†ç±»ä¹Ÿéœ€è¦å®ç°æ­¤æ–¹æ³•ã€‚å¢åŠ äº†ä»£ç ç»´æŠ¤çš„å¤æ‚åº¦ã€‚ ä»£ç†å¯¹è±¡åªæœåŠ¡äºä¸€ç§ç±»å‹çš„å¯¹è±¡ï¼Œå¦‚æœè¦æœåŠ¡å¤šç±»å‹çš„å¯¹è±¡ã€‚åŠ¿å¿…è¦ä¸ºæ¯ä¸€ç§å¯¹è±¡éƒ½è¿›è¡Œä»£ç†ï¼Œé™æ€ä»£ç†åœ¨ç¨‹åºè§„æ¨¡ç¨å¤§æ—¶å°±æ— æ³•èƒœä»»äº†ã€‚ é™æ€ä»£ç†ä¸€ä¸ªä»£ç†åªèƒ½ä»£ç†ä¸€ç§ç±»å‹ï¼Œè€Œä¸”æ˜¯åœ¨ç¼–è¯‘å™¨å°±å·²ç»ç¡®å®šè¢«ä»£ç†çš„å¯¹è±¡ã€‚ JDK Proxy å’Œ CGLib çš„ä½¿ç”¨æ ·ä¾‹JDK Proxy åŠ¨æ€ä»£ç†å®ç°","categories":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"åŠ¨æ€ä»£ç†","slug":"åŠ¨æ€ä»£ç†","permalink":"https://gyl-coder.top/tags/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"try catch finallyæ‰§è¡Œé¡ºåº","slug":"java/try_catch_finally","date":"2020-04-02T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"java/try_catch_finally/","link":"","permalink":"https://gyl-coder.top/java/try_catch_finally/","excerpt":"é¦–å…ˆåœ¨finallyå’Œtryä¸­å¯¹æ•°æ®çš„æ“ä½œæ—¶æ•°æ®åˆ†ä¸º åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹ï¼Œä»–ä»¬å­˜æ”¾çš„åœ°æ–¹ä¹Ÿä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯æ ˆåŒºå¦ä¸€ä¸ªæ˜¯åœ¨å †åŒºã€‚","text":"é¦–å…ˆåœ¨finallyå’Œtryä¸­å¯¹æ•°æ®çš„æ“ä½œæ—¶æ•°æ®åˆ†ä¸º åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹ï¼Œä»–ä»¬å­˜æ”¾çš„åœ°æ–¹ä¹Ÿä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯æ ˆåŒºå¦ä¸€ä¸ªæ˜¯åœ¨å †åŒºã€‚ finallyä¸­æ²¡æœ‰return public class Main &#123; private static int a=2; public static void main(String[] args) &#123; System.out.println(&quot;testè¾“å‡ºçš„ç»“æœ &quot;+test()); System.out.println(&quot;main è‡ªåŠ å a=&quot;+(a++)); &#125; private static int test()&#123; try &#123; a+=3; System.out.println(&quot;try a=&quot;+a); return a; &#125;catch (Exception e)&#123; &#125;finally &#123; ++a; System.out.println(&quot;finally a=&quot;+a); &#125; &#125; è¾“å‡ºç»“æœ: try a=5finally a=6testè¾“å‡ºçš„ç»“æœ 5main a=6 ç»“è®º: å¯è§æ–¹æ³•testçš„è¿”å›å€¼ä¸å—finallyä¸­çš„å½±å“ï¼Œä½†æ˜¯å˜é‡aè¿˜æ˜¯å—åˆ°äº†å½±å“ï¼Œå€¼æ”¹å˜äº†ï¼Œè¿”å›å€¼æ˜¯å­˜æ”¾åœ¨æ ˆä¸­çš„ï¼Œreturnæ˜¯å°± å·²ç»æŠŠè¿”å›å€¼å‹å…¥æ ˆäº†ï¼Œç›¸å½“äºä¸€ä¸ªä¸´æ—¶å˜é‡ã€‚åœ¨finallyä¸­å¹¶ä¸ä¼šå½±å“è¿”å›å€¼ finallyä¸­åŠ å…¥returnpublic class Main &#123; private static int a=2; public static void main(String[] args) &#123; System.out.println(&quot;testè¾“å‡ºçš„ç»“æœ &quot;+test()); System.out.println(&quot;main è‡ªåŠ å a=&quot;+(a++)); &#125; private static int test()&#123; try &#123; a+=3; System.out.println(&quot;try a=&quot;+a); return a; &#125;catch (Exception e)&#123; &#125;finally &#123; ++a; System.out.println(&quot;finally a=&quot;+a); return a; &#125; &#125; è¾“å‡ºç»“æœ: try a=5finally a=6testè¾“å‡ºçš„ç»“æœ 6main a=6 ç»“è®º: æ­¤æ—¶testæ–¹æ³•çš„è¿”å›å€¼æ˜¯6å’Œaçš„å€¼ç›¸ç­‰ï¼Œ åœ¨try,catchä¸­çš„è¿”å›å€¼å¯ä»¥å‘ç°è¢«finallyçš„è¿”å›å€¼ç»™å±è”½äº†ï¼Œæ‰€ä»¥å¦‚æœfinallyä¸­ æœ‰returnåˆ™ä¼šå±è”½å½“å‰æ–¹æ³•ä¸­çš„è¿”å›å€¼ ç°åœ¨å¯¹å¼•ç”¨å˜é‡è¿›è¡Œåˆ†æfinallyä¸­æ²¡æœ‰return public class Main &#123; private static List&lt;String&gt; list=new ArrayList&lt;&gt;(); public static void main(String[] args) &#123; System.out.println(&quot;testè¾“å‡ºçš„ç»“æœ &quot;+test()); System.out.println(&quot;main list=&quot;+list.toString()); &#125; private static List test()&#123; try &#123; list.add(&quot;33&quot;); System.out.println(&quot;try list=&quot;+list.toString()); return list; &#125;catch (Exception e)&#123; &#125;finally &#123; list.add(&quot;66&quot;); System.out.println(&quot;finally list=&quot;+list.toString()); &#125; return null; &#125; &#125; è¾“å‡ºç»“æœ: try list=[33]finally list=[33, 66]testè¾“å‡ºçš„ç»“æœ [33, 66]main list=[33, 66] ç»“è®º: é€šè¿‡ç»“æœå¯ä»¥çŸ¥é“ testçš„è¿”å›å€¼å†…å®¹ä¹Ÿæ˜¯è·Ÿé›†åˆlistä¸€æ ·çš„ï¼Œ å› ä¸ºlistæ˜¯å¼•ç”¨ç±»å‹æ‰€ä»¥å †åŒºä¸­å­˜æ”¾äº†å†…å­˜åœ°å€ï¼Œåœ¨finallyå¯¹å€¼ è¿›è¡Œæ”¹å˜æ—¶è¿˜æ˜¯åªæƒ³åŒä¸€ä¸ªåœ°å€ï¼Œåªæ˜¯åœ°å€çš„å†…å®¹å˜åŒ–äº† 2 finallyä¸­æœ‰return ã€ è¾“å‡ºå€¼: try list=[33]finally list=[33, 66]testè¾“å‡ºçš„ç»“æœ [33, 66]main list=[33, 66] ç»“è®º:å¯è§å¼•ç”¨ç±»å‹æ—¶finallyæœ‰æ²¡æœ‰returnéƒ½ä¼šå¯¹å½“å‰æ–¹æ³•çš„è¿”å›å€¼äº§ç”Ÿå½±å“","categories":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"try-catch","slug":"try-catch","permalink":"https://gyl-coder.top/tags/try-catch/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"IOC & AOP è¯¦è§£","slug":"spring/spring-ioc-aop","date":"2020-04-02T00:00:00.000Z","updated":"2020-12-27T04:47:15.978Z","comments":true,"path":"spring/spring-ioc-aop/","link":"","permalink":"https://gyl-coder.top/spring/spring-ioc-aop/","excerpt":"ä¸‹é¢ä»ä»¥ä¸‹å‡ ä¸ªé—®é¢˜å±•å¼€å¯¹ IOC &amp; AOP çš„è§£é‡Š ä»€ä¹ˆæ˜¯IOCï¼Ÿ IOCè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ IOC å’Œ DI çš„åŒºåˆ«ï¼Ÿ ä»€ä¹ˆæ˜¯AOPï¼Ÿ AOPè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ AOPä¸ºä»€ä¹ˆå«åšåˆ‡é¢å˜æˆï¼Ÿ é¦–å…ˆå£°æ˜ï¼š IOC &amp; AOP ä¸æ˜¯Springæå‡ºæ¥çš„ï¼Œå®ƒä»¬åœ¨Springä¹‹å‰å…¶å®å·²ç»å­˜åœ¨äº†ï¼Œåªä¸è¿‡å½“æ—¶æ›´åŠ åå‘äºç†è®ºã€‚ Spring åœ¨æŠ€æœ¯å±‚æ¬¡å°†è¿™ä¸¤ä¸ªæ€æƒ³è¿›è¡Œäº†å¾ˆå¥½çš„å®ç°ã€‚","text":"ä¸‹é¢ä»ä»¥ä¸‹å‡ ä¸ªé—®é¢˜å±•å¼€å¯¹ IOC &amp; AOP çš„è§£é‡Š ä»€ä¹ˆæ˜¯IOCï¼Ÿ IOCè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ IOC å’Œ DI çš„åŒºåˆ«ï¼Ÿ ä»€ä¹ˆæ˜¯AOPï¼Ÿ AOPè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ AOPä¸ºä»€ä¹ˆå«åšåˆ‡é¢å˜æˆï¼Ÿ é¦–å…ˆå£°æ˜ï¼š IOC &amp; AOP ä¸æ˜¯Springæå‡ºæ¥çš„ï¼Œå®ƒä»¬åœ¨Springä¹‹å‰å…¶å®å·²ç»å­˜åœ¨äº†ï¼Œåªä¸è¿‡å½“æ—¶æ›´åŠ åå‘äºç†è®ºã€‚ Spring åœ¨æŠ€æœ¯å±‚æ¬¡å°†è¿™ä¸¤ä¸ªæ€æƒ³è¿›è¡Œäº†å¾ˆå¥½çš„å®ç°ã€‚ ä»€ä¹ˆæ˜¯ IOC IOC ï¼ˆInversion of control ï¼‰ æ§åˆ¶åè½¬/åè½¬æ§åˆ¶ã€‚å®ƒæ˜¯ä¸€ç§ æ€æƒ³ ä¸æ˜¯ä¸€ä¸ªæŠ€æœ¯å®ç°ã€‚æè¿°çš„æ˜¯ï¼šJava å¼€å‘é¢†åŸŸå¯¹è±¡çš„åˆ›å»ºä»¥åŠç®¡ç†çš„é—®é¢˜ã€‚ ä¾‹å¦‚ï¼šç°æœ‰ ç±»Aä¾èµ–äºç±»B ä¼ ç»Ÿçš„å¼€å‘æ–¹å¼ï¼šå¾€å¾€æ˜¯åœ¨ç±»Aä¸­æ‰‹åŠ¨é€šè¿‡ new å…³é”®å­—æ¥ new ä¸€ä¸ªBçš„å¯¹è±¡å‡ºæ¥ ä½¿ç”¨IOCæ€æƒ³çš„å¼€å‘æ–¹å¼ï¼š ä¸é€šè¿‡new å…³é”®å­—æ¥åˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡ IOCå®¹å™¨ (Spring æ¡†æ¶) æ¥å¸®åŠ©æˆ‘ä»¬å®ä¾‹åŒ–å¯¹è±¡ã€‚æˆ‘ä»¬éœ€è¦å“ªä¸ªå¯¹è±¡ï¼Œç›´æ¥ä»IOCå®¹å™¨é‡Œé¢è¿‡å»å³å¯ã€‚ ä»ä»¥ä¸Šä¸¤ç§å¼€å‘æ–¹å¼çš„å¯¹æ¯”æ¥çœ‹ï¼šæˆ‘ä»¬ â€œä¸§å¤±äº†ä¸€ä¸ªæƒåŠ›â€ (åˆ›å»ºã€ç®¡ç†å¯¹è±¡çš„æƒåŠ›)ï¼Œä»è€Œä¹Ÿå¾—åˆ°äº†ä¸€ä¸ªå¥½å¤„ï¼ˆä¸ç”¨å†è€ƒè™‘å¯¹è±¡çš„åˆ›å»ºã€ç®¡ç†ç­‰ä¸€ç³»åˆ—çš„äº‹æƒ…ï¼‰ ä¸ºä»€ä¹ˆå«æ§åˆ¶åè½¬æ§åˆ¶ï¼š æŒ‡çš„æ˜¯å¯¹è±¡åˆ›å»ºï¼ˆå®ä¾‹åŒ–ã€ç®¡ç†ï¼‰çš„æƒåŠ› åè½¬ï¼š æ§åˆ¶æƒäº¤ç»™å¤–éƒ¨ç¯å¢ƒï¼ˆSpringæ¡†æ¶ã€IOCå®¹å™¨ï¼‰ IOC è§£å†³äº†ä»€ä¹ˆé—®é¢˜IOC ä¸»è¦è§£å†³çš„æ˜¯å¯¹è±¡ä¹‹é—´çš„è€¦åˆé—®é¢˜ã€‚ ä¾‹å¦‚ï¼šç°æœ‰ä¸€ä¸ªé’ˆå¯¹Userçš„æ“ä½œï¼Œåˆ©ç”¨ Service å’Œ Dao ä¸¤å±‚ç»“æ„è¿›è¡Œå¼€å‘ åœ¨æ²¡æœ‰ä½¿ç”¨IOCæ€æƒ³çš„æƒ…å†µä¸‹ï¼ŒService å±‚æƒ³è¦ä½¿ç”¨ Daoå±‚çš„å…·ä½“å®ç°çš„è¯ï¼Œéœ€è¦é€šè¿‡ new å…³é”®å­—åœ¨UserServiceImpl ä¸­æ‰‹åŠ¨ newå‡º IUserDao çš„å…·ä½“å®ç°ç±» UserDaoImplï¼ˆä¸èƒ½ç›´æ¥newæ¥å£ç±»ï¼‰ã€‚ å¾ˆå®Œç¾ï¼Œè¿™ç§æ–¹å¼ä¹Ÿæ˜¯å¯ä»¥å®ç°çš„ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹å¦‚ä¸‹åœºæ™¯ï¼šå¼€å‘è¿‡ç¨‹ä¸­çªç„¶æ¥åˆ°ä¸€ä¸ªæ–°çš„éœ€æ±‚ï¼Œé’ˆå¯¹å¯¹IUserDao æ¥å£å¼€å‘å‡ºå¦ä¸€ä¸ªå…·ä½“å®ç°ç±»ã€‚å› ä¸ºServerå±‚ä¾èµ–äº†IUserDaoçš„å…·ä½“å®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿®æ”¹UserServiceImplä¸­newçš„å¯¹è±¡ã€‚å¦‚æœåªæœ‰ä¸€ä¸ªç±»å¼•ç”¨äº†IUserDaoçš„å…·ä½“å®ç°ï¼Œå¯èƒ½è§‰å¾—è¿˜å¥½ï¼Œä¿®æ”¹èµ·æ¥ä¹Ÿä¸æ˜¯å¾ˆè´¹åŠ›æ°”ï¼Œä½†æ˜¯å¦‚æœæœ‰è®¸è®¸å¤šå¤šçš„åœ°æ–¹éƒ½å¼•ç”¨äº†IUserDaoçš„å…·ä½“å®ç°çš„è¯ï¼Œä¸€æ—¦éœ€è¦æ›´æ¢IUserDaoçš„å®ç°æ–¹å¼ï¼Œé‚£ä¿®æ”¹èµ·æ¥å°†ä¼šéå¸¸çš„å¤´ç–¼ã€‚ ä½¿ç”¨IOCçš„æ€æƒ³ï¼Œæˆ‘ä»¬å°†å¯¹è±¡çš„æ§åˆ¶æƒï¼ˆåˆ›å»ºã€ç®¡ç†ï¼‰äº¤æœ‰IOCå®¹å™¨å»ç®¡ç†ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™ç›´æ¥å‘IOCå®¹å™¨ â€œè¦â€ å°±å¯ä»¥äº† IOC å’Œ DI çš„åŒºåˆ«IOC å’Œ DI æè¿°çš„æ˜¯åŒä¸€ä»¶äº‹æƒ…ï¼ˆå¯¹è±¡å®ä¾‹åŒ–ä»¥åŠä¾èµ–å…³ç³»çš„ç»´æŠ¤ï¼‰ï¼Œåªä¸è¿‡è§’åº¦ä¸åŒã€‚ IOC ï¼ˆInversion of control ï¼‰ æ§åˆ¶åè½¬/åè½¬æ§åˆ¶ã€‚æ˜¯ç«™åœ¨å¯¹è±¡çš„è§’åº¦ï¼Œå¯¹è±¡å®ä¾‹åŒ–ä»¥åŠç®¡ç†çš„æƒé™ï¼ˆåè½¬ï¼‰äº¤ç»™äº†å®¹å™¨ã€‚ DI ï¼ˆDependancy Injectionï¼‰ä¾èµ–æ³¨å…¥ã€‚æ˜¯ç«™åœ¨å®¹å™¨çš„è§’åº¦ï¼Œå®¹å™¨ä¼šæŠŠå¯¹è±¡ä¾èµ–çš„å…¶ä»–å¯¹è±¡æ³¨å…¥ï¼ˆé€è¿›å»ï¼‰ã€‚ä¾‹å¦‚ï¼šå¯¹è±¡A å®ä¾‹åŒ–è¿‡ç¨‹ä¸­å› ä¸ºå£°æ˜äº†ä¸€ä¸ªBç±»å‹çš„å±æ€§ï¼Œé‚£ä¹ˆå°±éœ€è¦å®¹å™¨æŠŠBå¯¹è±¡æ³¨å…¥åˆ°Aä¸­ã€‚ ä»€ä¹ˆæ˜¯AOPAOPï¼šAspect oriented programming é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ŒAOPæ˜¯ OOPï¼ˆé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰çš„ä¸€ç§å»¶ç»­ï¼Œä¸‹é¢æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªOOPçš„ä¾‹å­ã€‚ ä¾‹å¦‚ï¼šç°æœ‰ä¸‰ä¸ªç±»ï¼ŒHorseã€Pigã€Dogï¼Œè¿™ä¸‰ä¸ªç±»ä¸­éƒ½æœ‰ eat å’Œ run ä¸¤ä¸ªæ–¹æ³•ã€‚ é€šè¿‡OOPæ€æƒ³ä¸­çš„ç»§æ‰¿ï¼Œæˆ‘ä»¬å¯ä»¥æå–å‡ºä¸€ä¸ª Animal çš„çˆ¶ç±»ï¼Œç„¶åå°† eat å’Œ run æ–¹æ³•æ”¾å…¥çˆ¶ç±»ä¸­ï¼ŒHorseã€Pigã€Dogé€šè¿‡ç»§æ‰¿Animalç±»å³å¯è‡ªåŠ¨è·å¾— eat å’Œ run æ–¹æ³•ã€‚è¿™æ ·å°†ä¼šå°‘äº›å¾ˆå¤šé‡å¤çš„ä»£ç ã€‚ OOPç¼–ç¨‹æ€æƒ³å¯ä»¥è§£å†³å¤§éƒ¨åˆ†çš„ä»£ç é‡å¤é—®é¢˜ã€‚ä½†æ˜¯æœ‰ä¸€äº›é—®é¢˜æ˜¯å¤„ç†ä¸äº†çš„ã€‚æ¯”å¦‚åœ¨çˆ¶ç±»Animal ä¸­çš„å¤šä¸ªæ–¹æ³•çš„ç›¸åŒä½ç½®å‡ºç°äº†é‡å¤çš„ä»£ç ï¼ŒOOPå°±è§£å†³ä¸äº†ã€‚ /** * åŠ¨ç‰©çˆ¶ç±» */ public class Animal &#123; /** èº«é«˜ */ private String height; /** ä½“é‡ */ private double weight; public void eat() &#123; // æ€§èƒ½ç›‘æ§ä»£ç  long start = System.currentTimeMillis(); // ä¸šåŠ¡é€»è¾‘ä»£ç  System.out.println(&quot;I can eat...&quot;); // æ€§èƒ½ç›‘æ§ä»£ç  System.out.println(&quot;æ‰§è¡Œæ—¶é•¿ï¼š&quot; + (System.currentTimeMillis() - start)/1000f + &quot;s&quot;); &#125; public void run() &#123; // æ€§èƒ½ç›‘æ§ä»£ç  long start = System.currentTimeMillis(); // ä¸šåŠ¡é€»è¾‘ä»£ç  System.out.println(&quot;I can run...&quot;); // æ€§èƒ½ç›‘æ§ä»£ç  System.out.println(&quot;æ‰§è¡Œæ—¶é•¿ï¼š&quot; + (System.currentTimeMillis() - start)/1000f + &quot;s&quot;); &#125; &#125; è¿™éƒ¨åˆ†é‡å¤çš„ä»£ç ï¼Œä¸€èˆ¬ç»Ÿç§°ä¸º æ¨ªåˆ‡é€»è¾‘ä»£ç ã€‚ æ¨ªåˆ‡é€»è¾‘ä»£ç å­˜åœ¨çš„é—®é¢˜ï¼š ä»£ç é‡å¤é—®é¢˜ æ¨ªåˆ‡é€»è¾‘ä»£ç å’Œä¸šåŠ¡ä»£ç æ··æ‚åœ¨ä¸€èµ·ï¼Œä»£ç è‡ƒè‚¿ï¼Œä¸å˜ç»´æŠ¤ AOP å°±æ˜¯ç”¨æ¥è§£å†³è¿™äº›é—®é¢˜çš„ AOP å¦è¾Ÿè¹Šå¾„ï¼Œæå‡ºæ¨ªå‘æŠ½å–æœºåˆ¶ï¼Œå°†æ¨ªåˆ‡é€»è¾‘ä»£ç å’Œä¸šåŠ¡é€»è¾‘ä»£ç åˆ†ç¦» ä»£ç æ‹†åˆ†æ¯”è¾ƒå®¹æ˜“ï¼Œéš¾çš„æ˜¯å¦‚ä½•åœ¨ä¸æ”¹å˜åŸæœ‰ä¸šåŠ¡é€»è¾‘çš„æƒ…å†µä¸‹ï¼Œæ‚„æ— å£°æ¯çš„å°†æ¨ªå‘é€»è¾‘ä»£ç åº”ç”¨åˆ°åŸæœ‰çš„ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œè¾¾åˆ°å’ŒåŸæ¥ä¸€æ ·çš„æ•ˆæœã€‚ AOPè§£å†³äº†ä»€ä¹ˆé—®é¢˜é€šè¿‡ä¸Šé¢çš„åˆ†æå¯ä»¥å‘ç°ï¼ŒAOPä¸»è¦ç”¨æ¥è§£å†³ï¼šåœ¨ä¸æ”¹å˜åŸæœ‰ä¸šåŠ¡é€»è¾‘çš„æƒ…å†µä¸‹ï¼Œå¢å¼ºæ¨ªåˆ‡é€»è¾‘ä»£ç ï¼Œæ ¹æœ¬ä¸Šè§£è€¦åˆï¼Œé¿å…æ¨ªåˆ‡é€»è¾‘ä»£ç é‡å¤ã€‚ AOPä¸ºä»€ä¹ˆå«é¢å‘åˆ‡é¢ç¼–ç¨‹åˆ‡ï¼š æŒ‡çš„æ˜¯æ¨ªåˆ‡é€»è¾‘ï¼ŒåŸæœ‰ä¸šåŠ¡é€»è¾‘ä»£ç ä¸åŠ¨ï¼Œåªèƒ½æ“ä½œæ¨ªåˆ‡é€»è¾‘ä»£ç ï¼Œæ‰€ä»¥é¢å‘æ¨ªåˆ‡é€»è¾‘ é¢ï¼š æ¨ªåˆ‡é€»è¾‘ä»£ç å¾€å¾€è¦å½±å“çš„æ˜¯å¾ˆå¤šä¸ªæ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•å¦‚åŒä¸€ä¸ªç‚¹ï¼Œå¤šä¸ªç‚¹æ„æˆä¸€ä¸ªé¢ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªé¢çš„æ¦‚å¿µ","categories":[{"name":"Spring","slug":"Spring","permalink":"https://gyl-coder.top/categories/Spring/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://gyl-coder.top/tags/Spring/"},{"name":"IOC","slug":"IOC","permalink":"https://gyl-coder.top/tags/IOC/"},{"name":"AOP","slug":"AOP","permalink":"https://gyl-coder.top/tags/AOP/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.github.io"}},{"title":"Settings.xml è¯¦è§£","slug":"java/settings","date":"2020-04-02T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"java/settings/","link":"","permalink":"https://gyl-coder.top/java/settings/","excerpt":"ä» settings.xml çš„æ–‡ä»¶åå°±å¯ä»¥çœ‹å‡ºï¼Œå®ƒæ˜¯ç”¨æ¥è®¾ç½® maven å‚æ•°çš„é…ç½®æ–‡ä»¶ã€‚settings.xml ä¸­åŒ…å«ç±»ä¼¼æœ¬åœ°ä»“å‚¨ä½ç½®ã€ä¿®æ”¹è¿œç¨‹ä»“å‚¨æœåŠ¡å™¨ã€è®¤è¯ä¿¡æ¯ç­‰é…ç½®ã€‚ settings.xml æ˜¯mavençš„å…¨å±€é…ç½®æ–‡ä»¶ã€‚ pom.xml æ–‡ä»¶æ˜¯æœ¬åœ°é¡¹ç›®é…ç½®æ–‡ä»¶ã€‚","text":"ä» settings.xml çš„æ–‡ä»¶åå°±å¯ä»¥çœ‹å‡ºï¼Œå®ƒæ˜¯ç”¨æ¥è®¾ç½® maven å‚æ•°çš„é…ç½®æ–‡ä»¶ã€‚settings.xml ä¸­åŒ…å«ç±»ä¼¼æœ¬åœ°ä»“å‚¨ä½ç½®ã€ä¿®æ”¹è¿œç¨‹ä»“å‚¨æœåŠ¡å™¨ã€è®¤è¯ä¿¡æ¯ç­‰é…ç½®ã€‚ settings.xml æ˜¯mavençš„å…¨å±€é…ç½®æ–‡ä»¶ã€‚ pom.xml æ–‡ä»¶æ˜¯æœ¬åœ°é¡¹ç›®é…ç½®æ–‡ä»¶ã€‚ settings.xml æ–‡ä»¶ä½ç½®settings.xml æ–‡ä»¶ä¸€èˆ¬ä½äºä¸¤ä¸ªä½ç½®ï¼š å…¨å±€é…ç½® ${maven.home}/conf/settings.xml ç”¨æˆ·é…ç½® ${user.home}/.m2/settings.xml æ³¨æ„ï¼šç”¨æˆ·é…ç½®ä¼˜å…ˆäºå…¨å±€é…ç½®ã€‚$&#123;user.home&#125; å’Œå’Œæ‰€æœ‰å…¶ä»–ç³»ç»Ÿå±æ€§åªèƒ½åœ¨ 3.0+ç‰ˆæœ¬ä¸Šä½¿ç”¨ã€‚ é…ç½®ä¼˜å…ˆçº§ é‡è¦ï¼šå±€éƒ¨é…ç½®ä¼˜å…ˆäºå…¨å±€é…ç½® é…ç½®ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼špom.xml &gt; user settings &gt; global settings å¦‚æœè¿™äº›æ–‡ä»¶åŒæ—¶å­˜åœ¨ï¼Œåœ¨åº”ç”¨é…ç½®æ—¶ï¼Œä¼šåˆå¹¶å®ƒä»¬çš„å†…å®¹ï¼Œå¦‚æœæœ‰é‡å¤çš„é…ç½®ï¼Œä¼˜å…ˆçº§é«˜çš„é…ç½®ä¼šè¦†ç›–ä¼˜å…ˆçº§ä½çš„ã€‚ settings.xml å…ƒç´ è¯¦è§£é¡¶çº§å…ƒç´ æ¦‚è§ˆ&lt;settings xmlns=&quot;http://maven.apache.org/SETTINGS/1.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.0.0 https://maven.apache.org/xsd/settings-1.0.0.xsd&quot;&gt; &lt;localRepository/&gt; &lt;interactiveMode/&gt; &lt;usePluginRegistry/&gt; &lt;offline/&gt; &lt;pluginGroups/&gt; &lt;servers/&gt; &lt;mirrors/&gt; &lt;proxies/&gt; &lt;profiles/&gt; &lt;activeProfiles/&gt; &lt;/settings&gt; LocalRepositoryä½œç”¨ï¼šè¯¥å€¼è¡¨ç¤ºæ„å»ºç³»ç»Ÿæœ¬åœ°ä»“åº“çš„è·¯å¾„ã€‚ é»˜è®¤å€¼ï¼š~/.m2/repository &lt;localRepository&gt;$&#123;user.home&#125;/.m2/repository&lt;/localRepository&gt; InteractiveModeä½œç”¨ï¼šè¡¨ç¤º maven æ˜¯å¦éœ€è¦å’Œç”¨æˆ·äº¤äº’ä»¥è·å¾—è¾“å…¥ã€‚ å¦‚æœ maven éœ€è¦å’Œç”¨æˆ·äº¤äº’ä»¥è·å¾—è¾“å…¥ï¼Œåˆ™è®¾ç½®æˆ trueï¼Œåä¹‹åˆ™åº”ä¸º falseã€‚é»˜è®¤ä¸º trueã€‚ &lt;interactiveMode&gt;true&lt;/interactiveMode&gt; UsePluginRegistryä½œç”¨ï¼šmaven æ˜¯å¦éœ€è¦ä½¿ç”¨ plugin-registry.xml æ–‡ä»¶æ¥ç®¡ç†æ’ä»¶ç‰ˆæœ¬ã€‚ å¦‚æœéœ€è¦è®© maven ä½¿ç”¨æ–‡ä»¶~/.m2/plugin-registry.xml æ¥ç®¡ç†æ’ä»¶ç‰ˆæœ¬ï¼Œåˆ™è®¾ä¸º trueã€‚é»˜è®¤ä¸º falseã€‚ &lt;usePluginRegistry&gt;false&lt;/usePluginRegistry&gt; Offlineä½œç”¨ï¼šè¡¨ç¤º maven æ˜¯å¦éœ€è¦åœ¨ç¦»çº¿æ¨¡å¼ä¸‹è¿è¡Œã€‚ å¦‚æœæ„å»ºç³»ç»Ÿéœ€è¦åœ¨ç¦»çº¿æ¨¡å¼ä¸‹è¿è¡Œï¼Œåˆ™ä¸º trueï¼Œé»˜è®¤ä¸º falseã€‚ å½“ç”±äºç½‘ç»œè®¾ç½®åŸå› æˆ–è€…å®‰å…¨å› ç´ ï¼Œæ„å»ºæœåŠ¡å™¨ä¸èƒ½è¿æ¥è¿œç¨‹ä»“åº“çš„æ—¶å€™ï¼Œè¯¥é…ç½®å°±ååˆ†æœ‰ç”¨ã€‚ &lt;offline&gt;false&lt;/offline&gt; PluginGroupsä½œç”¨ï¼šå½“æ’ä»¶çš„ç»„ç»‡ idï¼ˆgroupIdï¼‰æ²¡æœ‰æ˜¾å¼æä¾›æ—¶ï¼Œä¾›æœå¯»æ’ä»¶ç»„ç»‡ Idï¼ˆgroupIdï¼‰çš„åˆ—è¡¨ã€‚ è¯¥å…ƒç´ åŒ…å«ä¸€ä¸ª pluginGroup å…ƒç´ åˆ—è¡¨ï¼Œæ¯ä¸ªå­å…ƒç´ åŒ…å«äº†ä¸€ä¸ªç»„ç»‡ Idï¼ˆgroupIdï¼‰ã€‚ å½“æˆ‘ä»¬ä½¿ç”¨æŸä¸ªæ’ä»¶ï¼Œå¹¶ä¸”æ²¡æœ‰åœ¨å‘½ä»¤è¡Œä¸ºå…¶æä¾›ç»„ç»‡ Idï¼ˆgroupIdï¼‰çš„æ—¶å€™ï¼ŒMaven å°±ä¼šä½¿ç”¨è¯¥åˆ—è¡¨ã€‚é»˜è®¤æƒ…å†µä¸‹è¯¥åˆ—è¡¨åŒ…å«äº† org.apache.maven.plugins å’Œ org.codehaus.mojoã€‚ &lt;settings xmlns=&quot;http://maven.apache.org/SETTINGS/1.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.0.0 https://maven.apache.org/xsd/settings-1.0.0.xsd&quot;&gt; ... &lt;pluginGroups&gt; &lt;!--pluginçš„ç»„ç»‡Idï¼ˆgroupIdï¼‰ --&gt; &lt;pluginGroup&gt;org.codehaus.mojo&lt;/pluginGroup&gt; &lt;/pluginGroups&gt; ... &lt;/settings&gt; Serversä½œç”¨ï¼šä¸€èˆ¬ï¼Œä»“åº“çš„ä¸‹è½½å’Œéƒ¨ç½²æ˜¯åœ¨ pom.xml æ–‡ä»¶ä¸­çš„ repositories å’Œ distributionManagement å…ƒç´ ä¸­å®šä¹‰çš„ã€‚ç„¶è€Œï¼Œä¸€èˆ¬ç±»ä¼¼ç”¨æˆ·åã€å¯†ç ï¼ˆæœ‰äº›ä»“åº“è®¿é—®æ˜¯éœ€è¦å®‰å…¨è®¤è¯çš„ï¼‰ç­‰ä¿¡æ¯ä¸åº”è¯¥åœ¨ pom.xml æ–‡ä»¶ä¸­é…ç½®ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥é…ç½®åœ¨ settings.xml ä¸­ã€‚ &lt;settings xmlns=&quot;http://maven.apache.org/SETTINGS/1.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.0.0 https://maven.apache.org/xsd/settings-1.0.0.xsd&quot;&gt; ... &lt;!--é…ç½®æœåŠ¡ç«¯çš„ä¸€äº›è®¾ç½®ã€‚ä¸€äº›è®¾ç½®å¦‚å®‰å…¨è¯ä¹¦ä¸åº”è¯¥å’Œpom.xmlä¸€èµ·åˆ†å‘ã€‚è¿™ç§ç±»å‹çš„ä¿¡æ¯åº”è¯¥å­˜åœ¨äºæ„å»ºæœåŠ¡å™¨ä¸Šçš„settings.xmlæ–‡ä»¶ä¸­ã€‚ --&gt; &lt;servers&gt; &lt;!--æœåŠ¡å™¨å…ƒç´ åŒ…å«é…ç½®æœåŠ¡å™¨æ—¶éœ€è¦çš„ä¿¡æ¯ --&gt; &lt;server&gt; &lt;!--è¿™æ˜¯serverçš„idï¼ˆæ³¨æ„ä¸æ˜¯ç”¨æˆ·ç™»é™†çš„idï¼‰ï¼Œè¯¥idä¸distributionManagementä¸­repositoryå…ƒç´ çš„idç›¸åŒ¹é…ã€‚ --&gt; &lt;id&gt;server001&lt;/id&gt; &lt;!--é‰´æƒç”¨æˆ·åã€‚é‰´æƒç”¨æˆ·åå’Œé‰´æƒå¯†ç è¡¨ç¤ºæœåŠ¡å™¨è®¤è¯æ‰€éœ€è¦çš„ç™»å½•åå’Œå¯†ç ã€‚ --&gt; &lt;username&gt;my_login&lt;/username&gt; &lt;!--é‰´æƒå¯†ç  ã€‚é‰´æƒç”¨æˆ·åå’Œé‰´æƒå¯†ç è¡¨ç¤ºæœåŠ¡å™¨è®¤è¯æ‰€éœ€è¦çš„ç™»å½•åå’Œå¯†ç ã€‚å¯†ç åŠ å¯†åŠŸèƒ½å·²è¢«æ·»åŠ åˆ°2.1.0 +ã€‚è¯¦æƒ…è¯·è®¿é—®å¯†ç åŠ å¯†é¡µé¢ --&gt; &lt;password&gt;my_password&lt;/password&gt; &lt;!--é‰´æƒæ—¶ä½¿ç”¨çš„ç§é’¥ä½ç½®ã€‚å’Œå‰ä¸¤ä¸ªå…ƒç´ ç±»ä¼¼ï¼Œç§é’¥ä½ç½®å’Œç§é’¥å¯†ç æŒ‡å®šäº†ä¸€ä¸ªç§é’¥çš„è·¯å¾„ï¼ˆé»˜è®¤æ˜¯$&#123;user.home&#125;/.ssh/id_dsaï¼‰ä»¥åŠå¦‚æœéœ€è¦çš„è¯ï¼Œä¸€ä¸ªå¯†è¯­ã€‚å°†æ¥passphraseå’Œpasswordå…ƒç´ å¯èƒ½ä¼šè¢«æå–åˆ°å¤–éƒ¨ï¼Œä½†ç›®å‰å®ƒä»¬å¿…é¡»åœ¨settings.xmlæ–‡ä»¶ä»¥çº¯æ–‡æœ¬çš„å½¢å¼å£°æ˜ã€‚ --&gt; &lt;privateKey&gt;$&#123;usr.home&#125;/.ssh/id_dsa&lt;/privateKey&gt; &lt;!--é‰´æƒæ—¶ä½¿ç”¨çš„ç§é’¥å¯†ç ã€‚ --&gt; &lt;passphrase&gt;some_passphrase&lt;/passphrase&gt; &lt;!--æ–‡ä»¶è¢«åˆ›å»ºæ—¶çš„æƒé™ã€‚å¦‚æœåœ¨éƒ¨ç½²çš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ªä»“åº“æ–‡ä»¶æˆ–è€…ç›®å½•ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ä½¿ç”¨æƒé™ï¼ˆpermissionï¼‰ã€‚è¿™ä¸¤ä¸ªå…ƒç´ åˆæ³•çš„å€¼æ˜¯ä¸€ä¸ªä¸‰ä½æ•°å­—ï¼Œå…¶å¯¹åº”äº†unixæ–‡ä»¶ç³»ç»Ÿçš„æƒé™ï¼Œå¦‚664ï¼Œæˆ–è€…775ã€‚ --&gt; &lt;filePermissions&gt;664&lt;/filePermissions&gt; &lt;!--ç›®å½•è¢«åˆ›å»ºæ—¶çš„æƒé™ã€‚ --&gt; &lt;directoryPermissions&gt;775&lt;/directoryPermissions&gt; &lt;/server&gt; &lt;/servers&gt; ... &lt;/settings&gt; Mirrorsä½œç”¨ï¼šä¸ºä»“åº“åˆ—è¡¨é…ç½®çš„ä¸‹è½½é•œåƒåˆ—è¡¨ã€‚ &lt;settings xmlns=&quot;http://maven.apache.org/SETTINGS/1.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.0.0 https://maven.apache.org/xsd/settings-1.0.0.xsd&quot;&gt; ... &lt;mirrors&gt; &lt;!-- ç»™å®šä»“åº“çš„ä¸‹è½½é•œåƒã€‚ --&gt; &lt;mirror&gt; &lt;!-- è¯¥é•œåƒçš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚idç”¨æ¥åŒºåˆ†ä¸åŒçš„mirrorå…ƒç´ ã€‚ --&gt; &lt;id&gt;planetmirror.com&lt;/id&gt; &lt;!-- é•œåƒåç§° --&gt; &lt;name&gt;PlanetMirror Australia&lt;/name&gt; &lt;!-- è¯¥é•œåƒçš„URLã€‚æ„å»ºç³»ç»Ÿä¼šä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¯¥URLï¼Œè€Œéä½¿ç”¨é»˜è®¤çš„æœåŠ¡å™¨URLã€‚ --&gt; &lt;url&gt;http://downloads.planetmirror.com/pub/maven2&lt;/url&gt; &lt;!-- è¢«é•œåƒçš„æœåŠ¡å™¨çš„idã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬è¦è®¾ç½®äº†ä¸€ä¸ªMavenä¸­å¤®ä»“åº“ï¼ˆhttp://repo.maven.apache.org/maven2/ï¼‰çš„é•œåƒï¼Œå°±éœ€è¦å°†è¯¥å…ƒç´ è®¾ç½®æˆcentralã€‚è¿™å¿…é¡»å’Œä¸­å¤®ä»“åº“çš„id centralå®Œå…¨ä¸€è‡´ã€‚ --&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;/mirror&gt; &lt;/mirrors&gt; ... &lt;/settings&gt; Proxiesä½œç”¨ï¼šç”¨æ¥é…ç½®ä¸åŒçš„ä»£ç†ã€‚ &lt;settings xmlns=&quot;http://maven.apache.org/SETTINGS/1.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.0.0 https://maven.apache.org/xsd/settings-1.0.0.xsd&quot;&gt; ... &lt;proxies&gt; &lt;!--ä»£ç†å…ƒç´ åŒ…å«é…ç½®ä»£ç†æ—¶éœ€è¦çš„ä¿¡æ¯ --&gt; &lt;proxy&gt; &lt;!--ä»£ç†çš„å”¯ä¸€å®šä¹‰ç¬¦ï¼Œç”¨æ¥åŒºåˆ†ä¸åŒçš„ä»£ç†å…ƒç´ ã€‚ --&gt; &lt;id&gt;myproxy&lt;/id&gt; &lt;!--è¯¥ä»£ç†æ˜¯å¦æ˜¯æ¿€æ´»çš„é‚£ä¸ªã€‚trueåˆ™æ¿€æ´»ä»£ç†ã€‚å½“æˆ‘ä»¬å£°æ˜äº†ä¸€ç»„ä»£ç†ï¼Œè€ŒæŸä¸ªæ—¶å€™åªéœ€è¦æ¿€æ´»ä¸€ä¸ªä»£ç†çš„æ—¶å€™ï¼Œè¯¥å…ƒç´ å°±å¯ä»¥æ´¾ä¸Šç”¨å¤„ã€‚ --&gt; &lt;active&gt;true&lt;/active&gt; &lt;!--ä»£ç†çš„åè®®ã€‚ åè®®://ä¸»æœºå:ç«¯å£ï¼Œåˆ†éš”æˆç¦»æ•£çš„å…ƒç´ ä»¥æ–¹ä¾¿é…ç½®ã€‚ --&gt; &lt;protocol&gt;http&lt;/protocol&gt; &lt;!--ä»£ç†çš„ä¸»æœºåã€‚åè®®://ä¸»æœºå:ç«¯å£ï¼Œåˆ†éš”æˆç¦»æ•£çš„å…ƒç´ ä»¥æ–¹ä¾¿é…ç½®ã€‚ --&gt; &lt;host&gt;proxy.somewhere.com&lt;/host&gt; &lt;!--ä»£ç†çš„ç«¯å£ã€‚åè®®://ä¸»æœºå:ç«¯å£ï¼Œåˆ†éš”æˆç¦»æ•£çš„å…ƒç´ ä»¥æ–¹ä¾¿é…ç½®ã€‚ --&gt; &lt;port&gt;8080&lt;/port&gt; &lt;!--ä»£ç†çš„ç”¨æˆ·åï¼Œç”¨æˆ·åå’Œå¯†ç è¡¨ç¤ºä»£ç†æœåŠ¡å™¨è®¤è¯çš„ç™»å½•åå’Œå¯†ç ã€‚ --&gt; &lt;username&gt;proxyuser&lt;/username&gt; &lt;!--ä»£ç†çš„å¯†ç ï¼Œç”¨æˆ·åå’Œå¯†ç è¡¨ç¤ºä»£ç†æœåŠ¡å™¨è®¤è¯çš„ç™»å½•åå’Œå¯†ç ã€‚ --&gt; &lt;password&gt;somepassword&lt;/password&gt; &lt;!--ä¸è¯¥è¢«ä»£ç†çš„ä¸»æœºååˆ—è¡¨ã€‚è¯¥åˆ—è¡¨çš„åˆ†éš”ç¬¦ç”±ä»£ç†æœåŠ¡å™¨æŒ‡å®šï¼›ä¾‹å­ä¸­ä½¿ç”¨äº†ç«–çº¿åˆ†éš”ç¬¦ï¼Œä½¿ç”¨é€—å·åˆ†éš”ä¹Ÿå¾ˆå¸¸è§ã€‚ --&gt; &lt;nonProxyHosts&gt;*.google.com|ibiblio.org&lt;/nonProxyHosts&gt; &lt;/proxy&gt; &lt;/proxies&gt; ... &lt;/settings&gt; Profilesä½œç”¨ï¼šæ ¹æ®ç¯å¢ƒå‚æ•°æ¥è°ƒæ•´æ„å»ºé…ç½®çš„åˆ—è¡¨ã€‚ settings.xml ä¸­çš„ profile å…ƒç´ æ˜¯ pom.xml ä¸­ profile å…ƒç´ çš„è£å‰ªç‰ˆæœ¬ã€‚ å®ƒåŒ…å«äº†idã€activationã€repositoriesã€pluginRepositories å’Œ properties å…ƒç´ ã€‚è¿™é‡Œçš„ profile å…ƒç´ åªåŒ…å«è¿™äº”ä¸ªå­å…ƒç´ æ˜¯å› ä¸ºè¿™é‡Œåªå…³å¿ƒæ„å»ºç³»ç»Ÿè¿™ä¸ªæ•´ä½“ï¼ˆè¿™æ­£æ˜¯ settings.xml æ–‡ä»¶çš„è§’è‰²å®šä½ï¼‰ï¼Œè€Œéå•ç‹¬çš„é¡¹ç›®å¯¹è±¡æ¨¡å‹è®¾ç½®ã€‚å¦‚æœä¸€ä¸ª settings.xml ä¸­çš„ profile è¢«æ¿€æ´»ï¼Œå®ƒçš„å€¼ä¼šè¦†ç›–ä»»ä½•å…¶å®ƒå®šä¹‰åœ¨ pom.xml ä¸­å¸¦æœ‰ç›¸åŒ id çš„ profileã€‚ &lt;settings xmlns=&quot;http://maven.apache.org/SETTINGS/1.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/SETTINGS/1.0.0 https://maven.apache.org/xsd/settings-1.0.0.xsd&quot;&gt; ... &lt;profiles&gt; &lt;profile&gt; &lt;!-- profileçš„å”¯ä¸€æ ‡è¯† --&gt; &lt;id&gt;test&lt;/id&gt; &lt;!-- è‡ªåŠ¨è§¦å‘profileçš„æ¡ä»¶é€»è¾‘ --&gt; &lt;activation /&gt; &lt;!-- æ‰©å±•å±æ€§åˆ—è¡¨ --&gt; &lt;properties /&gt; &lt;!-- è¿œç¨‹ä»“åº“åˆ—è¡¨ --&gt; &lt;repositories /&gt; &lt;!-- æ’ä»¶ä»“åº“åˆ—è¡¨ --&gt; &lt;pluginRepositories /&gt; &lt;/profile&gt; &lt;/profiles&gt; ... &lt;/settings&gt; Activationä½œç”¨ï¼šè‡ªåŠ¨è§¦å‘ profile çš„æ¡ä»¶é€»è¾‘ã€‚ å¦‚ pom.xml ä¸­çš„ profile ä¸€æ ·ï¼Œprofile çš„ä½œç”¨åœ¨äºå®ƒèƒ½å¤Ÿåœ¨æŸäº›ç‰¹å®šçš„ç¯å¢ƒä¸­è‡ªåŠ¨ä½¿ç”¨æŸäº›ç‰¹å®šçš„å€¼ï¼›è¿™äº›ç¯å¢ƒé€šè¿‡ activation å…ƒç´ æŒ‡å®šã€‚activation å…ƒç´ å¹¶ä¸æ˜¯æ¿€æ´» profile çš„å”¯ä¸€æ–¹å¼ã€‚settings.xml æ–‡ä»¶ä¸­çš„ activeProfile å…ƒç´ å¯ä»¥åŒ…å« profile çš„ idã€‚profile ä¹Ÿå¯ä»¥é€šè¿‡åœ¨å‘½ä»¤è¡Œï¼Œä½¿ç”¨ -P æ ‡è®°å’Œé€—å·åˆ†éš”çš„åˆ—è¡¨æ¥æ˜¾å¼çš„æ¿€æ´»ï¼ˆå¦‚ï¼Œ-P testï¼‰ã€‚ &lt;activation&gt; &lt;!--profileé»˜è®¤æ˜¯å¦æ¿€æ´»çš„æ ‡è¯† --&gt; &lt;activeByDefault&gt;false&lt;/activeByDefault&gt; &lt;!--å½“åŒ¹é…çš„jdkè¢«æ£€æµ‹åˆ°ï¼Œprofileè¢«æ¿€æ´»ã€‚ä¾‹å¦‚ï¼Œ1.4æ¿€æ´»JDK1.4ï¼Œ1.4.0_2ï¼Œè€Œ!1.4æ¿€æ´»æ‰€æœ‰ç‰ˆæœ¬ä¸æ˜¯ä»¥1.4å¼€å¤´çš„JDKã€‚ --&gt; &lt;jdk&gt;1.5&lt;/jdk&gt; &lt;!--å½“åŒ¹é…çš„æ“ä½œç³»ç»Ÿå±æ€§è¢«æ£€æµ‹åˆ°ï¼Œprofileè¢«æ¿€æ´»ã€‚oså…ƒç´ å¯ä»¥å®šä¹‰ä¸€äº›æ“ä½œç³»ç»Ÿç›¸å…³çš„å±æ€§ã€‚ --&gt; &lt;os&gt; &lt;!--æ¿€æ´»profileçš„æ“ä½œç³»ç»Ÿçš„åå­— --&gt; &lt;name&gt;Windows XP&lt;/name&gt; &lt;!--æ¿€æ´»profileçš„æ“ä½œç³»ç»Ÿæ‰€å±å®¶æ—(å¦‚ &#39;windows&#39;) --&gt; &lt;family&gt;Windows&lt;/family&gt; &lt;!--æ¿€æ´»profileçš„æ“ä½œç³»ç»Ÿä½“ç³»ç»“æ„ --&gt; &lt;arch&gt;x86&lt;/arch&gt; &lt;!--æ¿€æ´»profileçš„æ“ä½œç³»ç»Ÿç‰ˆæœ¬ --&gt; &lt;version&gt;5.1.2600&lt;/version&gt; &lt;/os&gt; &lt;!--å¦‚æœMavenæ£€æµ‹åˆ°æŸä¸€ä¸ªå±æ€§ï¼ˆå…¶å€¼å¯ä»¥åœ¨POMä¸­é€šè¿‡$&#123;name&#125;å¼•ç”¨ï¼‰ï¼Œå…¶æ‹¥æœ‰å¯¹åº”çš„name = å€¼ï¼ŒProfileå°±ä¼šè¢«æ¿€æ´»ã€‚å¦‚æœå€¼å­—æ®µæ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆå­˜åœ¨å±æ€§åç§°å­—æ®µå°±ä¼šæ¿€æ´»profileï¼Œå¦åˆ™æŒ‰åŒºåˆ†å¤§å°å†™æ–¹å¼åŒ¹é…å±æ€§å€¼å­—æ®µ --&gt; &lt;property&gt; &lt;!--æ¿€æ´»profileçš„å±æ€§çš„åç§° --&gt; &lt;name&gt;mavenVersion&lt;/name&gt; &lt;!--æ¿€æ´»profileçš„å±æ€§çš„å€¼ --&gt; &lt;value&gt;2.0.3&lt;/value&gt; &lt;/property&gt; &lt;!--æä¾›ä¸€ä¸ªæ–‡ä»¶åï¼Œé€šè¿‡æ£€æµ‹è¯¥æ–‡ä»¶çš„å­˜åœ¨æˆ–ä¸å­˜åœ¨æ¥æ¿€æ´»profileã€‚missingæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æ¿€æ´»profileã€‚å¦ä¸€æ–¹é¢ï¼Œexistsåˆ™ä¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™æ¿€æ´»profileã€‚ --&gt; &lt;file&gt; &lt;!--å¦‚æœæŒ‡å®šçš„æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™æ¿€æ´»profileã€‚ --&gt; &lt;exists&gt;$&#123;basedir&#125;/file2.properties&lt;/exists&gt; &lt;!--å¦‚æœæŒ‡å®šçš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™æ¿€æ´»profileã€‚ --&gt; &lt;missing&gt;$&#123;basedir&#125;/file1.properties&lt;/missing&gt; &lt;/file&gt; &lt;/activation&gt; æ³¨ï¼šåœ¨ maven å·¥ç¨‹çš„ pom.xml æ‰€åœ¨ç›®å½•ä¸‹æ‰§è¡Œ mvn help:active-profiles å‘½ä»¤å¯ä»¥æŸ¥çœ‹ä¸­å¤®ä»“å‚¨çš„ profile æ˜¯å¦åœ¨å·¥ç¨‹ä¸­ç”Ÿæ•ˆã€‚ propertiesä½œç”¨ï¼šå¯¹åº”profileçš„æ‰©å±•å±æ€§åˆ—è¡¨ã€‚ maven å±æ€§å’Œ ant ä¸­çš„å±æ€§ä¸€æ ·ï¼Œå¯ä»¥ç”¨æ¥å­˜æ”¾ä¸€äº›å€¼ã€‚è¿™äº›å€¼å¯ä»¥åœ¨ pom.xml ä¸­çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨æ ‡è®°${X}æ¥ä½¿ç”¨ï¼Œè¿™é‡Œ X æ˜¯æŒ‡å±æ€§çš„åç§°ã€‚å±æ€§æœ‰äº”ç§ä¸åŒçš„å½¢å¼ï¼Œå¹¶ä¸”éƒ½èƒ½åœ¨ settings.xml æ–‡ä»¶ä¸­è®¿é—®ã€‚ &lt;!-- 1. env.X: åœ¨ä¸€ä¸ªå˜é‡å‰åŠ ä¸Š&quot;env.&quot;çš„å‰ç¼€ï¼Œä¼šè¿”å›ä¸€ä¸ªshellç¯å¢ƒå˜é‡ã€‚ä¾‹å¦‚,&quot;env.PATH&quot;æŒ‡ä»£äº†$pathç¯å¢ƒå˜é‡ï¼ˆåœ¨Windowsä¸Šæ˜¯%PATH%ï¼‰ã€‚ 2. project.xï¼šæŒ‡ä»£äº†POMä¸­å¯¹åº”çš„å…ƒç´ å€¼ã€‚ä¾‹å¦‚: &lt;project&gt;&lt;version&gt;1.0&lt;/version&gt;&lt;/project&gt;é€šè¿‡$&#123;project.version&#125;è·å¾—versionçš„å€¼ã€‚ 3. settings.x: æŒ‡ä»£äº†settings.xmlä¸­å¯¹åº”å…ƒç´ çš„å€¼ã€‚ä¾‹å¦‚ï¼š&lt;settings&gt;&lt;offline&gt;false&lt;/offline&gt;&lt;/settings&gt;é€šè¿‡ $&#123;settings.offline&#125;è·å¾—offlineçš„å€¼ã€‚ 4. Java System Properties: æ‰€æœ‰å¯é€šè¿‡java.lang.System.getProperties()è®¿é—®çš„å±æ€§éƒ½èƒ½åœ¨POMä¸­ä½¿ç”¨è¯¥å½¢å¼è®¿é—®ï¼Œä¾‹å¦‚ $&#123;java.home&#125;ã€‚ 5. x: åœ¨&lt;properties/&gt;å…ƒç´ ä¸­ï¼Œæˆ–è€…å¤–éƒ¨æ–‡ä»¶ä¸­è®¾ç½®ï¼Œä»¥$&#123;someVar&#125;çš„å½¢å¼ä½¿ç”¨ã€‚ --&gt; &lt;properties&gt; &lt;user.install&gt;$&#123;user.home&#125;/our-project&lt;/user.install&gt; &lt;/properties&gt; æ³¨ï¼šå¦‚æœè¯¥ profile è¢«æ¿€æ´»ï¼Œåˆ™å¯ä»¥åœ¨pom.xmlä¸­ä½¿ç”¨${user.install}ã€‚ Repositoriesä½œç”¨ï¼šè¿œç¨‹ä»“åº“åˆ—è¡¨ï¼Œå®ƒæ˜¯ maven ç”¨æ¥å¡«å……æ„å»ºç³»ç»Ÿæœ¬åœ°ä»“åº“æ‰€ä½¿ç”¨çš„ä¸€ç»„è¿œç¨‹ä»“åº“ã€‚ &lt;repositories&gt; &lt;!--åŒ…å«éœ€è¦è¿æ¥åˆ°è¿œç¨‹ä»“åº“çš„ä¿¡æ¯ --&gt; &lt;repository&gt; &lt;!--è¿œç¨‹ä»“åº“å”¯ä¸€æ ‡è¯† --&gt; &lt;id&gt;codehausSnapshots&lt;/id&gt; &lt;!--è¿œç¨‹ä»“åº“åç§° --&gt; &lt;name&gt;Codehaus Snapshots&lt;/name&gt; &lt;!--å¦‚ä½•å¤„ç†è¿œç¨‹ä»“åº“é‡Œå‘å¸ƒç‰ˆæœ¬çš„ä¸‹è½½ --&gt; &lt;releases&gt; &lt;!--trueæˆ–è€…falseè¡¨ç¤ºè¯¥ä»“åº“æ˜¯å¦ä¸ºä¸‹è½½æŸç§ç±»å‹æ„ä»¶ï¼ˆå‘å¸ƒç‰ˆï¼Œå¿«ç…§ç‰ˆï¼‰å¼€å¯ã€‚ --&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;!--è¯¥å…ƒç´ æŒ‡å®šæ›´æ–°å‘ç”Ÿçš„é¢‘ç‡ã€‚Mavenä¼šæ¯”è¾ƒæœ¬åœ°POMå’Œè¿œç¨‹POMçš„æ—¶é—´æˆ³ã€‚è¿™é‡Œçš„é€‰é¡¹æ˜¯ï¼šalwaysï¼ˆä¸€ç›´ï¼‰ï¼Œdailyï¼ˆé»˜è®¤ï¼Œæ¯æ—¥ï¼‰ï¼Œintervalï¼šXï¼ˆè¿™é‡ŒXæ˜¯ä»¥åˆ†é’Ÿä¸ºå•ä½çš„æ—¶é—´é—´éš”ï¼‰ï¼Œæˆ–è€…neverï¼ˆä»ä¸ï¼‰ã€‚ --&gt; &lt;updatePolicy&gt;always&lt;/updatePolicy&gt; &lt;!--å½“MavenéªŒè¯æ„ä»¶æ ¡éªŒæ–‡ä»¶å¤±è´¥æ—¶è¯¥æ€ä¹ˆåš-ignoreï¼ˆå¿½ç•¥ï¼‰ï¼Œfailï¼ˆå¤±è´¥ï¼‰ï¼Œæˆ–è€…warnï¼ˆè­¦å‘Šï¼‰ã€‚ --&gt; &lt;checksumPolicy&gt;warn&lt;/checksumPolicy&gt; &lt;/releases&gt; &lt;!--å¦‚ä½•å¤„ç†è¿œç¨‹ä»“åº“é‡Œå¿«ç…§ç‰ˆæœ¬çš„ä¸‹è½½ã€‚æœ‰äº†releaseså’Œsnapshotsè¿™ä¸¤ç»„é…ç½®ï¼ŒPOMå°±å¯ä»¥åœ¨æ¯ä¸ªå•ç‹¬çš„ä»“åº“ä¸­ï¼Œä¸ºæ¯ç§ç±»å‹çš„æ„ä»¶é‡‡å–ä¸åŒçš„ç­–ç•¥ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½æœ‰äººä¼šå†³å®šåªä¸ºå¼€å‘ç›®çš„å¼€å¯å¯¹å¿«ç…§ç‰ˆæœ¬ä¸‹è½½çš„æ”¯æŒã€‚å‚è§repositories/repository/releaseså…ƒç´  --&gt; &lt;snapshots&gt; &lt;enabled /&gt; &lt;updatePolicy /&gt; &lt;checksumPolicy /&gt; &lt;/snapshots&gt; &lt;!--è¿œç¨‹ä»“åº“URLï¼ŒæŒ‰protocol://hostname/pathå½¢å¼ --&gt; &lt;url&gt;http://snapshots.maven.codehaus.org/maven2&lt;/url&gt; &lt;!--ç”¨äºå®šä½å’Œæ’åºæ„ä»¶çš„ä»“åº“å¸ƒå±€ç±»å‹-å¯ä»¥æ˜¯defaultï¼ˆé»˜è®¤ï¼‰æˆ–è€…legacyï¼ˆé—ç•™ï¼‰ã€‚Maven 2ä¸ºå…¶ä»“åº“æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„å¸ƒå±€ï¼›ç„¶è€Œï¼ŒMaven 1.xæœ‰ä¸€ç§ä¸åŒçš„å¸ƒå±€ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥å…ƒç´ æŒ‡å®šå¸ƒå±€æ˜¯defaultï¼ˆé»˜è®¤ï¼‰è¿˜æ˜¯legacyï¼ˆé—ç•™ï¼‰ã€‚ --&gt; &lt;layout&gt;default&lt;/layout&gt; &lt;/repository&gt; &lt;/repositories&gt; pluginRepositoriesä½œç”¨ï¼šå‘ç°æ’ä»¶çš„è¿œç¨‹ä»“åº“åˆ—è¡¨ã€‚ å’Œ repository ç±»ä¼¼ï¼Œåªæ˜¯ repository æ˜¯ç®¡ç† jar åŒ…ä¾èµ–çš„ä»“åº“ï¼ŒpluginRepositories åˆ™æ˜¯ç®¡ç†æ’ä»¶çš„ä»“åº“ã€‚maven æ’ä»¶æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æ„ä»¶ã€‚ç”±äºè¿™ä¸ªåŸå› ï¼Œæ’ä»¶ä»“åº“ç‹¬ç«‹äºå…¶å®ƒä»“åº“ã€‚pluginRepositories å…ƒç´ çš„ç»“æ„å’Œ repositories å…ƒç´ çš„ç»“æ„ç±»ä¼¼ã€‚æ¯ä¸ª pluginRepository å…ƒç´ æŒ‡å®šä¸€ä¸ª Maven å¯ä»¥ç”¨æ¥å¯»æ‰¾æ–°æ’ä»¶çš„è¿œç¨‹åœ°å€ã€‚ pluginRepositoriespluginRepositoryreleasesenabledupdatePolicychecksumPolicyreleasessnapshotsenabledupdatePolicychecksumPolicysnapshotsidnameurllayoutpluginRepositorypluginRepositories ActiveProfilesä½œç”¨ï¼šæ‰‹åŠ¨æ¿€æ´» profiles çš„åˆ—è¡¨ï¼ŒæŒ‰ç…§profileè¢«åº”ç”¨çš„é¡ºåºå®šä¹‰activeProfileã€‚ è¯¥å…ƒç´ åŒ…å«äº†ä¸€ç»„ activeProfile å…ƒç´ ï¼Œæ¯ä¸ª activeProfile éƒ½å«æœ‰ä¸€ä¸ª profile idã€‚ä»»ä½•åœ¨ activeProfile ä¸­å®šä¹‰çš„ profile idï¼Œä¸è®ºç¯å¢ƒè®¾ç½®å¦‚ä½•ï¼Œå…¶å¯¹åº”çš„ profile éƒ½ä¼šè¢«æ¿€æ´»ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…çš„ profileï¼Œåˆ™ä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿã€‚ ä¾‹å¦‚ï¼Œenv-test æ˜¯ä¸€ä¸ª activeProfileï¼Œåˆ™åœ¨ pom.xmlï¼ˆæˆ–è€… profile.xmlï¼‰ä¸­å¯¹åº” id çš„ profile ä¼šè¢«æ¿€æ´»ã€‚å¦‚æœè¿è¡Œè¿‡ç¨‹ä¸­æ‰¾ä¸åˆ°è¿™æ ·ä¸€ä¸ª profileï¼ŒMaven åˆ™ä¼šåƒå¾€å¸¸ä¸€æ ·è¿è¡Œã€‚ settingsactiveProfilesactiveProfileactiveProfileactiveProfilessettings","categories":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"Settings","slug":"Settings","permalink":"https://gyl-coder.top/tags/Settings/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"MyBatis å…¥é—¨","slug":"mybatis/mybatis-beginner","date":"2020-03-30T00:00:00.000Z","updated":"2020-12-27T04:47:15.978Z","comments":true,"path":"mybatis/mybatis-beginner/","link":"","permalink":"https://gyl-coder.top/mybatis/mybatis-beginner/","excerpt":"MyBatis æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„åŸºäº ORM çš„åŠè‡ªåŠ¨è½»é‡çº§æŒä¹…å±‚æ¡†æ¶ã€‚å®ƒæ”¯æŒå®šåˆ¶åŒ–SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„ã€‚MyBatis é¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†ã€‚MyBatis å¯ä»¥ä½¿ç”¨ç®€å•çš„ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸç”Ÿç±»å‹ã€æ¥å£å’Œ Java çš„POJOï¼ˆPlain Old Java Objectsï¼Œæ™®é€šè€å¼Java å¯¹è±¡ï¼‰ä¸ºæ•°æ®åº“çš„è®°å½•ã€‚ MyBatis åŸæœ¬æ˜¯Apache çš„ä¸€ä¸ªå¼€æºé¡¹ç›®IBatisï¼Œ2010å¹´6æœˆè¿™ä¸ªé¡¹ç›®ç”± Apache Software Foundation è¿ç§»åˆ°äº† Google Codeï¼Œéšåæ›´åä¸º MyBatis ã€‚ iBatis ä¸€è¯æ¥æºäº â€œinternetâ€ å’Œ â€œabatisâ€ çš„ç»„åˆï¼Œæ˜¯ä¸€ä¸ªåŸºäºJavaçš„æŒä¹…å±‚æ¡†æ¶ã€‚ å®˜ç½‘åœ°å€https://mybatis.org/mybatis-3/","text":"MyBatis æ˜¯ä¸€æ¬¾ä¼˜ç§€çš„åŸºäº ORM çš„åŠè‡ªåŠ¨è½»é‡çº§æŒä¹…å±‚æ¡†æ¶ã€‚å®ƒæ”¯æŒå®šåˆ¶åŒ–SQLã€å­˜å‚¨è¿‡ç¨‹ä»¥åŠé«˜çº§æ˜ å°„ã€‚MyBatis é¿å…äº†å‡ ä¹æ‰€æœ‰çš„ JDBC ä»£ç å’Œæ‰‹åŠ¨è®¾ç½®å‚æ•°ä»¥åŠè·å–ç»“æœé›†ã€‚MyBatis å¯ä»¥ä½¿ç”¨ç®€å•çš„ XML æˆ–æ³¨è§£æ¥é…ç½®å’Œæ˜ å°„åŸç”Ÿç±»å‹ã€æ¥å£å’Œ Java çš„POJOï¼ˆPlain Old Java Objectsï¼Œæ™®é€šè€å¼Java å¯¹è±¡ï¼‰ä¸ºæ•°æ®åº“çš„è®°å½•ã€‚ MyBatis åŸæœ¬æ˜¯Apache çš„ä¸€ä¸ªå¼€æºé¡¹ç›®IBatisï¼Œ2010å¹´6æœˆè¿™ä¸ªé¡¹ç›®ç”± Apache Software Foundation è¿ç§»åˆ°äº† Google Codeï¼Œéšåæ›´åä¸º MyBatis ã€‚ iBatis ä¸€è¯æ¥æºäº â€œinternetâ€ å’Œ â€œabatisâ€ çš„ç»„åˆï¼Œæ˜¯ä¸€ä¸ªåŸºäºJavaçš„æŒä¹…å±‚æ¡†æ¶ã€‚ å®˜ç½‘åœ°å€https://mybatis.org/mybatis-3/ ä¸Šé¢ç®€å•ä»‹ç»äº†ä¸€ä¸‹ MyBatis ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹MyBatis çš„ä¼˜åŠ¿ MyBatis çš„ä¼˜åŠ¿&amp;åŠ£åŠ¿ä¼˜åŠ¿æˆ‘è®¤ä¸º MyBatis æœ‰ä»¥ä¸‹å‡ ç‚¹ä¼˜åŠ¿ ç®€å•æ˜“å­¦ MyBatis æœ¬èº«ä½“ç§¯è¾ƒå°ä¸”æ²¡æœ‰ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œä½¿ç”¨èµ·æ¥ç®€å•å®¹æ˜“ä¸Šæ‰‹ã€‚æºç ä¹Ÿæ¯”è¾ƒå®¹æ˜“çœ‹æ‡‚ è¾¹ç•Œæ¸…æ™° MyBatis æ˜¯ä¸€ä¸ªåŠè‡ªåŠ¨åŒ–çš„æŒä¹…å±‚æ¡†æ¶ï¼ŒSql å’Œ Javaä»£ç åˆ†å¼€ï¼ŒåŠŸèƒ½è¾¹ç•Œè¾ƒä¸ºæ¸…æ™°ã€‚ä¸€ä¸ªä¸“æ³¨ä¸šåŠ¡ï¼Œä¸€ä¸ªä¸“æ³¨æ•°æ®ã€‚ ä»£ç é‡ç›¸å¯¹è¾ƒå°‘ å› ä¸ºMyBatisæ ¸å¿ƒæ˜¯å¯¹JDBCä»£ç çš„å°è£…ï¼Œé¿å…å¼€å‘äººå‘˜å†™å¤§é‡é‡å¤çš„ä»£ç ã€‚ åŠ£åŠ¿ ä¾èµ–SQL è¦æ±‚å¼€å‘äººå‘˜æœ‰ä¸€å®šçš„SQL åŠŸåº• SQL è¯­å¥çš„ç¼–å†™å·¥ä½œé‡å¤§ï¼ˆè¡¨å¤šï¼Œè¡¨ç»“æ„å¤æ‚æ—¶ï¼‰ æ•°æ®åº“ç§»æ¤æ€§å·®ï¼ˆé’ˆå¯¹ä¸åŒçš„æ•°æ®åº“SQL æœ‰å·®å¼‚ï¼‰ MyBatis åŸºæœ¬åº”ç”¨å¼€å‘æ­¥éª¤å¦‚æœè¦åœ¨å·¥ç¨‹ä¸­ä½¿ç”¨MyBatis åŸºæœ¬æµç¨‹å¦‚ä¸‹ï¼š åœ¨pom æ–‡ä»¶ä¸­æ·»åŠ Mybatis çš„ä¾èµ– åˆ›å»ºè¡¨ç»“æ„ ç¼–å†™è¡¨ç»“æ„æ‰€å¯¹åº”çš„å®ä½“ç±» xxx.java ç¼–å†™å¯¹åº”å®ä½“ç±»çš„æ˜ å°„æ–‡ä»¶ xxxMapper.xml ç¼–å†™MyBatis çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ SqlMapConfig.xml ç¼–å†™æµ‹è¯•ç±» ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä½¿ç”¨MyBatis å¯¹ä¸€ä¸ªUser å®ä½“è¿›è¡ŒCRUD æ“ä½œã€‚ å¼•å…¥ç›¸å…³ä¾èµ–åœ¨å·¥ç¨‹æ‰€åœ¨çš„ pom æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹ä¾èµ– &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;maven.compiler.encoding&gt;UTF-8&lt;/maven.compiler.encoding&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;!--mybatis ä¾èµ–--&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;3.4.5&lt;/version&gt; &lt;/dependency&gt; &lt;!--mysql ä¾èµ–--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;version&gt;5.1.6&lt;/version&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;!-- å•å…ƒæµ‹è¯•ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;4.12&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;/dependencies&gt; åˆ›å»ºUser è¡¨ç»“æ„åœ¨æ•°æ®åº“ä¸­å»ºç«‹ä¸€ä¸ªç®€å•çš„User è¡¨ç»“æ„ å­—æ®µå å­—æ®µç±»å‹ é•¿åº¦ id int 11 username varchar 50 password varchar 50 ç¼–å†™User å®ä½“è¿™é‡Œä¸ºäº†å‡å°‘ä»£ç é‡ï¼Œå¼•å…¥äº† lombok @Getter @Setter @ToString public class User &#123; /** ç”¨æˆ·Id */ private int id; /** ç”¨æˆ·å */ private String username; /** ç”¨æˆ·å¯†ç  */ private String password; &#125; ç¼–å†™UserMapper æ˜ å°„æ–‡ä»¶&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt; &lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt; &lt;mapper namespace=&quot;com.yanliang.mockTest.dao.IUserDao&quot;&gt; &lt;!-- æŸ¥è¯¢æ‰€æœ‰ --&gt; &lt;select id=&quot;selectList&quot; resultType=&quot;com.yanliang.mockTest.User&quot;&gt; select * from user &lt;/select&gt; &lt;!-- æŸ¥è¯¢å•ä¸ªå¯¹è±¡ --&gt; &lt;select id=&quot;selectOne&quot; resultType=&quot;com.yanliang.mockTest.User&quot; paramterType=&quot;com.yanliang.mockTest.User&quot;&gt; select * from user where id = #&#123;id&#125; and username = #&#123;username&#125; &lt;/select&gt; &lt;!-- æ’å…¥--&gt; &lt;insert id=&quot;insert&quot; parameterType=&quot;com.yanliang.mockTest.User&quot;&gt; insert into user values ( #&#123;id&#125;, #&#123;username&#125; ) &lt;/insert&gt; &lt;!-- åˆ é™¤--&gt; &lt;delete id=&quot;delete&quot; parameterType=&quot;java.lang.Integer&quot;&gt; delete from user where id = #&#123;id&#125; &lt;/delete&gt; &lt;!-- æ›´æ–°--&gt; &lt;update id=&quot;update&quot; parameterType=&quot;com.yanliang.mockTest.User&quot;&gt; update user set username = #&#123;username&#125; where id = #&#123;id&#125; &lt;/update&gt; &lt;/mapper&gt;","categories":[{"name":"Mybatis","slug":"Mybatis","permalink":"https://gyl-coder.top/categories/Mybatis/"}],"tags":[{"name":"Mybatis","slug":"Mybatis","permalink":"https://gyl-coder.top/tags/Mybatis/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.github.io"}},{"title":"HashMap åº•å±‚å®ç°åŸç†åˆ†æ","slug":"java/collection/HashMapAnalysis","date":"2020-03-23T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"java/collection/HashMapAnalysis/","link":"","permalink":"https://gyl-coder.top/java/collection/HashMapAnalysis/","excerpt":"HashMap æ˜¯ Map çš„ä¸€ä¸ªå®ç°ç±»ï¼Œå®ƒä»£è¡¨çš„æ˜¯ä¸€ç§é”®å€¼å¯¹çš„æ•°æ®å­˜å‚¨å½¢å¼ã€‚ å¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ç›´æ¥å®šä½åˆ°å®ƒçš„å€¼ï¼Œå› è€Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œä½†éå†é¡ºåºå´æ˜¯ä¸ç¡®å®šçš„ã€‚ HashMapæœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºnullï¼Œå…è®¸å¤šæ¡è®°å½•çš„å€¼ä¸ºnullã€‚ä¸ä¿è¯æœ‰åº (æ¯”å¦‚æ’å…¥çš„é¡ºåº)ã€ä¹Ÿä¸ä¿è¯åºä¸éšæ—¶é—´å˜åŒ–ã€‚ jdk 8 ä¹‹å‰ï¼Œå…¶å†…éƒ¨æ˜¯ç”± æ•°ç»„ + é“¾è¡¨ æ¥å®ç°çš„ï¼Œè€Œ jdk 8 å¯¹äºé“¾è¡¨é•¿åº¦è¶…è¿‡ 8 çš„é“¾è¡¨å°†è½¬å‚¨ä¸º çº¢é»‘æ ‘ã€‚ HashMapéçº¿ç¨‹å®‰å…¨ï¼Œå³ä»»ä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™HashMapï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚å¦‚æœéœ€è¦æ»¡è¶³çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ç”¨ Collectionsçš„synchronizedMapæ–¹æ³•ä½¿HashMapå…·æœ‰çº¿ç¨‹å®‰å…¨çš„èƒ½åŠ›ï¼Œæˆ–è€…ä½¿ç”¨ConcurrentHashMapã€‚ HashMapæ˜¯ æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ï¼ˆJDK1.8 å¢åŠ äº†çº¢é»‘æ ‘éƒ¨åˆ†ï¼‰å®ç°çš„ã€‚JDK 1.8 ä¹‹æ‰€ä»¥æ·»åŠ çº¢é»‘æ ‘æ˜¯å› ä¸ºä¸€æ—¦é“¾è¡¨è¿‡é•¿ï¼Œä¼šä¸¥é‡å½±å“ HashMap çš„æ€§èƒ½ï¼Œè€Œçº¢é»‘æ ‘å…·æœ‰å¿«é€Ÿå¢åˆ æ”¹æŸ¥çš„ç‰¹ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆçš„è§£å†³é“¾è¡¨è¿‡é•¿æ—¶æ“ä½œæ¯”è¾ƒæ…¢çš„é—®é¢˜ã€‚","text":"HashMap æ˜¯ Map çš„ä¸€ä¸ªå®ç°ç±»ï¼Œå®ƒä»£è¡¨çš„æ˜¯ä¸€ç§é”®å€¼å¯¹çš„æ•°æ®å­˜å‚¨å½¢å¼ã€‚ å¤§å¤šæ•°æƒ…å†µä¸‹å¯ä»¥ç›´æ¥å®šä½åˆ°å®ƒçš„å€¼ï¼Œå› è€Œå…·æœ‰å¾ˆå¿«çš„è®¿é—®é€Ÿåº¦ï¼Œä½†éå†é¡ºåºå´æ˜¯ä¸ç¡®å®šçš„ã€‚ HashMapæœ€å¤šåªå…è®¸ä¸€æ¡è®°å½•çš„é”®ä¸ºnullï¼Œå…è®¸å¤šæ¡è®°å½•çš„å€¼ä¸ºnullã€‚ä¸ä¿è¯æœ‰åº (æ¯”å¦‚æ’å…¥çš„é¡ºåº)ã€ä¹Ÿä¸ä¿è¯åºä¸éšæ—¶é—´å˜åŒ–ã€‚ jdk 8 ä¹‹å‰ï¼Œå…¶å†…éƒ¨æ˜¯ç”± æ•°ç»„ + é“¾è¡¨ æ¥å®ç°çš„ï¼Œè€Œ jdk 8 å¯¹äºé“¾è¡¨é•¿åº¦è¶…è¿‡ 8 çš„é“¾è¡¨å°†è½¬å‚¨ä¸º çº¢é»‘æ ‘ã€‚ HashMapéçº¿ç¨‹å®‰å…¨ï¼Œå³ä»»ä¸€æ—¶åˆ»å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å†™HashMapï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®çš„ä¸ä¸€è‡´ã€‚å¦‚æœéœ€è¦æ»¡è¶³çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥ç”¨ Collectionsçš„synchronizedMapæ–¹æ³•ä½¿HashMapå…·æœ‰çº¿ç¨‹å®‰å…¨çš„èƒ½åŠ›ï¼Œæˆ–è€…ä½¿ç”¨ConcurrentHashMapã€‚ HashMapæ˜¯ æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ï¼ˆJDK1.8 å¢åŠ äº†çº¢é»‘æ ‘éƒ¨åˆ†ï¼‰å®ç°çš„ã€‚JDK 1.8 ä¹‹æ‰€ä»¥æ·»åŠ çº¢é»‘æ ‘æ˜¯å› ä¸ºä¸€æ—¦é“¾è¡¨è¿‡é•¿ï¼Œä¼šä¸¥é‡å½±å“ HashMap çš„æ€§èƒ½ï¼Œè€Œçº¢é»‘æ ‘å…·æœ‰å¿«é€Ÿå¢åˆ æ”¹æŸ¥çš„ç‰¹ç‚¹ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆçš„è§£å†³é“¾è¡¨è¿‡é•¿æ—¶æ“ä½œæ¯”è¾ƒæ…¢çš„é—®é¢˜ã€‚ å­˜å‚¨ç»“æ„ä¸‹é¢æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ HashMap å†…éƒ¨æ‰€ç”¨åˆ°çš„å­˜å‚¨ç»“æ„ static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final int hash; final K key; V value; Node&lt;K,V&gt; next; Node(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.value = value; this.next = next; &#125; public final K getKey() &#123; return key; &#125; public final V getValue() &#123; return value; &#125; public final String toString() &#123; return key + &quot;=&quot; + value; &#125; public final int hashCode() &#123; return Objects.hashCode(key) ^ Objects.hashCode(value); &#125; public final V setValue(V newValue) &#123; V oldValue = value; value = newValue; return oldValue; &#125; public final boolean equals(Object o) &#123; if (o == this) return true; if (o instanceof Map.Entry) &#123; Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o; if (Objects.equals(key, e.getKey()) &amp;&amp; Objects.equals(value, e.getValue())) return true; &#125; return false; &#125; &#125; å¯ä»¥çœ‹å‡ºæ¯ä¸ªå“ˆå¸Œæ¡¶ä¸­åŒ…å«äº†å››ä¸ªå­—æ®µï¼šhashã€keyã€valueã€nextï¼Œå…¶ä¸­ next è¡¨ç¤ºé“¾è¡¨çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚ Nodeæ˜¯HashMapçš„ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œå®ç°äº† Map.Entry æ¥å£ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ˜ å°„ (é”®å€¼å¯¹)ã€‚ æœ‰æ—¶ä¸¤ä¸ªkeyä¼šå®šä½åˆ°ç›¸åŒçš„ä½ç½®ï¼Œè¡¨ç¤ºå‘ç”Ÿäº† Hash ç¢°æ’ã€‚å½“ç„¶Hashç®—æ³•è®¡ç®—ç»“æœè¶Šåˆ†æ•£å‡åŒ€ï¼ŒHashç¢°æ’çš„æ¦‚ç‡å°±è¶Šå°ï¼Œmapçš„å­˜å–æ•ˆç‡å°±ä¼šè¶Šé«˜ã€‚ HashMapç±»ä¸­æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„å­—æ®µï¼Œå°±æ˜¯ Node[] tableï¼Œå³å“ˆå¸Œæ¡¶æ•°ç»„ã€‚å¦‚æœå“ˆå¸Œæ¡¶æ•°ç»„å¾ˆå¤§ï¼Œå³ä½¿è¾ƒå·®çš„Hashç®—æ³•ä¹Ÿä¼šæ¯”è¾ƒåˆ†æ•£ï¼Œå¦‚æœå“ˆå¸Œæ¡¶æ•°ç»„æ•°ç»„å¾ˆå°ï¼Œå³ä½¿å¥½çš„Hashç®—æ³•ä¹Ÿä¼šå‡ºç°è¾ƒå¤šç¢°æ’ã€‚ æ‰€ä»¥å°±éœ€è¦åœ¨ç©ºé—´æˆæœ¬å’Œæ—¶é—´æˆæœ¬ä¹‹é—´æƒè¡¡ï¼Œå…¶å®å°±æ˜¯åœ¨æ ¹æ®å®é™…æƒ…å†µç¡®å®šå“ˆå¸Œæ¡¶æ•°ç»„çš„å¤§å°ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šè®¾è®¡å¥½çš„hashç®—æ³•å‡å°‘ Hash ç¢°æ’ã€‚é‚£ä¹ˆé€šè¿‡ä»€ä¹ˆæ–¹å¼æ¥æ§åˆ¶ map ä½¿å¾— Hash ç¢°æ’çš„æ¦‚ç‡åˆå°ï¼Œå“ˆå¸Œæ¡¶æ•°ç»„ï¼ˆNode[] tableï¼‰å ç”¨ç©ºé—´åˆå°‘å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯å¥½çš„ Hash ç®—æ³•å’Œæ‰©å®¹æœºåˆ¶ã€‚ ä¸Šé¢å¤§ä½“ä»‹ç»äº† HashMap çš„ç»„æˆç»“æ„ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€äº›å…³äº HashMap çš„æ ¸å¿ƒé—®é¢˜ã€‚ HashMap ä¸­çš„hashç®—æ³•å¦‚ä½•å®ç°ï¼Ÿ JDK1.8HashMapæ‰©å®¹æ—¶åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿ åŠ è½½å› å­ä¸ºä»€ä¹ˆæ˜¯0.75ï¼Ÿ å½“æœ‰å“ˆå¸Œå†²çªæ—¶ï¼ŒHashMapæ˜¯å¦‚ä½•æŸ¥æ‰¾å¹¶ç¡®è®¤å…ƒç´ çš„ï¼ŸHashMapæºç ä¸­æœ‰å“ªäº›é‡è¦çš„æ–¹æ³•ï¼Ÿ HashMap æºç ä¸­æœ‰å“ªäº›é‡è¦çš„æ–¹æ³•ï¼Ÿ æˆå‘˜å˜é‡ä¸è¿‡åœ¨è¿™ä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸‹ hashmap ä¸­çš„å˜é‡ // HashMap åˆå§‹åŒ–é•¿åº¦ static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // HashMap æœ€å¤§é•¿åº¦ static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30; // é»˜è®¤çš„åŠ è½½å› å­ ï¼ˆæ‰©å®¹å› å­ï¼‰ static final float DEFAULT_LOAD_FACTOR = 0.75f; // å½“é“¾è¡¨é•¿åº¦å¤§äºæ­¤å€¼ä¸”å®¹é‡å¤§äº64æ—¶ static final int TREEIFY_THRESHOLD = 8; // è½¬æ¢é“¾è¡¨çš„ä¸´ç•Œå€¼ï¼Œå½“å…ƒç´ å°äºæ­¤å€¼æ—¶ï¼Œå°†çº¢é»‘æ ‘è½¬æ¢ä¸ºé“¾è¡¨ç»“æ„ static final int UNTREEIFY_THRESHOLD = 6; // æœ€å°æ•°å®¹é‡ static final int MIN_TREEIFY_CAPACITY = 64; transient Node&lt;K,V&gt;[] table; transient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet; transient int size; transient int modCount; int threshold; final float loadFactor; åœ¨ HashMap ä¸­æœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„å‚æ•°ï¼Œå®¹é‡ (Capacity) å’Œè´Ÿè½½å› å­(Load factor) Capacityå°±æ˜¯bucketsçš„æ•°ç›®ï¼ŒLoad factorå°±æ˜¯bucketså¡«æ»¡ç¨‹åº¦çš„æœ€å¤§æ¯”ä¾‹ã€‚å¦‚æœå¯¹è¿­ä»£æ€§èƒ½è¦æ±‚å¾ˆé«˜çš„è¯ä¸è¦æŠŠcapacityè®¾ç½®è¿‡å¤§ï¼Œä¹Ÿä¸è¦æŠŠload factorè®¾ç½®è¿‡å°ã€‚å½“bucketå¡«å……çš„æ•°ç›®ï¼ˆå³ hashmap ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼‰å¤§äºcapacity*load factoræ—¶å°±éœ€è¦è°ƒæ•´ buckets çš„æ•°ç›®ä¸ºå½“å‰çš„ 2 å€ã€‚ HashMap ä¸­çš„hashç®—æ³•å¦‚ä½•å®ç°ï¼Ÿstatic final int hash(Object key) &#123; int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16); &#125; static int indexFor(int h, int length) &#123; return h &amp; (length-1); &#125; indexFor æ˜¯ jdk1.7 çš„æºç ï¼Œjdk1.8 æ²¡æœ‰è¿™ä¸ªæ–¹æ³•ä½†æ˜¯ jdk1.8 ä¹Ÿæ˜¯é€šè¿‡å–æ¨¡è¿ç®—æ¥è®¡ç®—çš„ è¿™é‡Œçš„ Hash ç®—æ³•æœ¬è´¨ä¸Šå°±æ˜¯ä¸‰æ­¥ï¼š å– key çš„ hashCode å€¼ é«˜ä½è¿ç®— å–æ¨¡è¿ç®— å¯¹äºä»»æ„ç»™å®šçš„å¯¹è±¡ï¼Œåªè¦å®ƒçš„hashCode()è¿”å›å€¼ç›¸åŒï¼Œé‚£ä¹ˆç¨‹åºè°ƒç”¨æ–¹æ³•ä¸€æ‰€è®¡ç®—å¾—åˆ°çš„Hashç å€¼æ€»æ˜¯ç›¸åŒçš„ã€‚æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æŠŠhashå€¼å¯¹æ•°ç»„é•¿åº¦å–æ¨¡è¿ç®—ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå…ƒç´ çš„åˆ†å¸ƒç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå‡åŒ€çš„ã€‚ä½†æ˜¯ï¼Œæ¨¡è¿ç®—çš„æ¶ˆè€—è¿˜æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨ &amp; ä½è¿ç®—æ¥ä¼˜åŒ–æ•ˆç‡ã€‚ è¿™ä¸ªæ–¹æ³•éå¸¸å·§å¦™ï¼Œå®ƒé€šè¿‡h &amp; (table.length -1)æ¥å¾—åˆ°è¯¥å¯¹è±¡çš„ä¿å­˜ä½ï¼Œè€ŒHashMapåº•å±‚æ•°ç»„çš„é•¿åº¦æ€»æ˜¯ 2 çš„ n æ¬¡æ–¹ï¼Œè¿™æ˜¯HashMapåœ¨é€Ÿåº¦ä¸Šçš„ä¼˜åŒ–ã€‚å½“ length æ€»æ˜¯ 2 çš„ n æ¬¡æ–¹æ—¶ï¼Œh&amp; (length-1)è¿ç®—ç­‰ä»·äºå¯¹ length å–æ¨¡ï¼Œä¹Ÿå°±æ˜¯h%lengthï¼Œä½†æ˜¯ &amp; æ¯” % å…·æœ‰æ›´é«˜çš„æ•ˆç‡ã€‚ åœ¨JDK1.8çš„å®ç°ä¸­ï¼Œä¼˜åŒ–äº†é«˜ä½è¿ç®—çš„ç®—æ³•ï¼Œé€šè¿‡hashCode()çš„é«˜ 16 ä½å¼‚æˆ–ä½ 16 ä½å®ç°çš„ï¼š(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)ï¼Œä¸»è¦æ˜¯ä»é€Ÿåº¦ã€åŠŸæ•ˆã€è´¨é‡æ¥è€ƒè™‘çš„ï¼Œè¿™ä¹ˆåšå¯ä»¥ Node æ•°ç»„ table çš„ length æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½ä¿è¯è€ƒè™‘åˆ°é«˜ä½ Bit éƒ½å‚ä¸åˆ° Hash çš„è®¡ç®—ä¸­ï¼ŒåŒæ—¶ä¸ä¼šæœ‰å¤ªå¤§çš„å¼€é”€ã€‚ JDK1.8HashMapæ‰©å®¹æ—¶åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿæ‰©å®¹ (resize) å°±æ˜¯é‡æ–°è®¡ç®—å®¹é‡ï¼Œå‘HashMapå¯¹è±¡é‡Œä¸åœçš„æ·»åŠ å…ƒç´ ï¼Œè€ŒHashMapå¯¹è±¡å†…éƒ¨çš„æ•°ç»„æ— æ³•è£…è½½æ›´å¤šçš„å…ƒç´ æ—¶ï¼Œå¯¹è±¡å°±éœ€è¦æ‰©å¤§æ•°ç»„çš„é•¿åº¦ï¼Œä»¥ä¾¿èƒ½è£…å…¥æ›´å¤šçš„å…ƒç´ ã€‚ å½“ç„¶Javaé‡Œçš„æ•°ç»„æ˜¯æ— æ³•è‡ªåŠ¨æ‰©å®¹çš„ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªæ–°çš„æ•°ç»„ä»£æ›¿å·²æœ‰çš„å®¹é‡å°çš„æ•°ç»„ï¼Œå°±åƒæˆ‘ä»¬ç”¨ä¸€ä¸ªå°æ¡¶è£…æ°´ï¼Œå¦‚æœæƒ³è£…æ›´å¤šçš„æ°´ï¼Œå°±å¾—æ¢å¤§æ°´æ¡¶ã€‚ å½“putæ—¶ï¼Œå¦‚æœå‘ç°ç›®å‰çš„bucketå ç”¨ç¨‹åº¦å·²ç»è¶…è¿‡äº†Load Factoræ‰€å¸Œæœ›çš„æ¯”ä¾‹ï¼Œé‚£ä¹ˆå°±ä¼šå‘ç”Ÿresizeã€‚åœ¨resizeçš„è¿‡ç¨‹ï¼Œç®€å•çš„è¯´å°±æ˜¯æŠŠbucketæ‰©å……ä¸º 2 å€ï¼Œä¹‹åé‡æ–°è®¡ç®—indexï¼ŒæŠŠèŠ‚ç‚¹å†æ”¾åˆ°æ–°çš„bucketä¸­ã€‚å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ 2 æ¬¡å¹‚çš„æ‰©å±• (æŒ‡é•¿åº¦æ‰©ä¸ºåŸæ¥ 2 å€)ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨ 2 æ¬¡å¹‚çš„ä½ç½®ã€‚ ä¾‹å¦‚æˆ‘ä»¬ä» 16 æ‰©å±•ä¸º 32 æ—¶ï¼Œå…·ä½“çš„å˜åŒ–å¦‚ä¸‹æ‰€ç¤ºï¼š å› æ­¤å…ƒç´ åœ¨é‡æ–°è®¡ç®—hashä¹‹åï¼Œå› ä¸º n å˜ä¸º 2 å€ï¼Œé‚£ä¹ˆ n-1 çš„ mask èŒƒå›´åœ¨é«˜ä½å¤š 1bit(çº¢è‰²)ï¼Œå› æ­¤æ–°çš„ index å°±ä¼šå‘ç”Ÿè¿™æ ·çš„å˜åŒ–ï¼š å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ‰©å……HashMapçš„æ—¶å€™ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®—hashï¼Œåªéœ€è¦çœ‹çœ‹åŸæ¥çš„hashå€¼æ–°å¢çš„é‚£ä¸ª bit æ˜¯ 1 è¿˜æ˜¯ 0 å°±å¥½äº†ï¼Œæ˜¯ 0 çš„è¯ç´¢å¼•æ²¡å˜ï¼Œæ˜¯ 1 çš„è¯ç´¢å¼•å˜æˆ â€œåŸç´¢å¼• + oldCapâ€ã€‚ è¿™ä¸ªè®¾è®¡ç¡®å®éå¸¸çš„å·§å¦™ï¼Œæ—¢çœå»äº†é‡æ–°è®¡ç®— hash å€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºæ–°å¢çš„ 1bit æ˜¯ 0 è¿˜æ˜¯ 1 å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œå› æ­¤resizeçš„è¿‡ç¨‹ï¼Œå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„bucketäº†ã€‚ final Node&lt;K,V&gt;[] resize() &#123; // æ‰©å®¹å‰çš„æ•°ç»„ Node&lt;K,V&gt;[] oldTab = table; // æ‰©å®¹å‰çš„æ•°ç»„å¤§å°å’Œé˜ˆå€¼ int oldCap = (oldTab == null) ? 0 : oldTab.length; int oldThr = threshold; // é¢„å®šä¹‰æ–°æ•°ç»„çš„å¤§å°å’Œé˜ˆå€¼ int newCap, newThr = 0; if (oldCap &gt; 0) &#123; // è¶…è¿‡æœ€å¤§å€¼å°±ä¸å†æ‰©å®¹äº† if (oldCap &gt;= MAXIMUM_CAPACITY) &#123; threshold = Integer.MAX_VALUE; return oldTab; &#125; // æ‰©å¤§å®¹é‡ä¸ºå½“å‰å®¹é‡çš„ä¸¤å€ï¼Œä½†ä¸èƒ½è¶…è¿‡ MAXIMUM_CAPACITY else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY) newThr = oldThr &lt;&lt; 1; &#125; // å½“å‰æ•°ç»„æ²¡æœ‰æ•°æ®ï¼Œä½¿ç”¨åˆå§‹åŒ–çš„å€¼ else if (oldThr &gt; 0) newCap = oldThr; else &#123; // å¦‚æœåˆå§‹åŒ–çš„å€¼ä¸º 0ï¼Œ åˆ™ä½¿ç”¨é»˜è®¤çš„åˆå§‹åŒ–å®¹é‡ newCap = DEFAULT_INITIAL_CAPACITY; newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); &#125; if (newThr == 0) &#123; float ft = (float)newCap * loadFactor; newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); &#125; threshold = newThr; @SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;) Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap]; // å¼€å§‹æ‰©å®¹ï¼Œå°†æ–°çš„å®¹é‡èµ‹å€¼ç»™ table table = newTab; // åŸæ•°æ®ä¸ä¸ºç©ºï¼Œå°†åŸå§‹çš„å®¹é‡å¤åˆ¶åˆ°æ–° table ä¸­ if (oldTab != null) &#123; // æ ¹æ®å®¹é‡å¾ªç¯æ•°ç»„ï¼Œå¤åˆ¶éç©ºå…ƒç´ åˆ°æ–° table for (int j = 0; j &lt; oldCap; ++j) &#123; Node&lt;K,V&gt; e; if ((e = oldTab[j]) != null) &#123; oldTab[j] = null; // å¦‚æœé“¾è¡¨åªæœ‰ä¸€ä¸ªï¼Œåˆ™è¿›è¡Œç›´æ¥èµ‹å€¼ if (e.next == null) newTab[e.hash &amp; (newCap - 1)] = e; else if (e instanceof TreeNode) // çº¢é»‘æ ‘ç›¸å…³çš„æ“ä½œ ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap); else &#123; // é“¾è¡¨å¤åˆ¶,JDK 1.8 æ‰©å®¹ä¼˜åŒ–éƒ¨åˆ† Node&lt;K,V&gt; loHead = null, loTail = null; Node&lt;K,V&gt; hiHead = null, hiTail = null; Node&lt;K,V&gt; next; do &#123; next = e.next; // åŸç´¢å¼• if ((e.hash &amp; oldCap) == 0) &#123; if (loTail == null) loHead = e; else loTail.next = e; loTail = e; &#125; // åŸç´¢å¼• + oldCap else &#123; if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; &#125; &#125; while ((e = next) != null); // å°†åŸç´¢å¼•æ”¾å…¥åˆ°å“ˆå¸Œæ¡¶ä¸­ if (loTail != null) &#123; loTail.next = null; newTab[j] = loHead; &#125; // å°†åŸç´¢å¼• + oldCap æ”¾åˆ°å“ˆå¸Œæ¡¶ä¸­ if (hiTail != null) &#123; hiTail.next = null; newTab[j + oldCap] = hiHead; &#125; &#125; &#125; &#125; &#125; return newTab; &#125; åŠ è½½å› å­ä¸ºä»€ä¹ˆæ˜¯0.75ï¼ŸåŠ è½½å› å­ä¹Ÿå«æ‰©å®¹å› å­æˆ–è´Ÿè½½å› å­ï¼Œç”¨æ¥åˆ¤æ–­ä»€ä¹ˆæ—¶å€™è¿›è¡Œæ‰©å®¹çš„ï¼Œå‡å¦‚åŠ è½½å› å­æ˜¯ 0.5ï¼ŒHashMap çš„åˆå§‹åŒ–å®¹é‡æ˜¯ 16ï¼Œé‚£ä¹ˆå½“ HashMap ä¸­æœ‰ 16*0.5=8 ä¸ªå…ƒç´ æ—¶ï¼ŒHashMap å°±ä¼šè¿›è¡Œæ‰©å®¹ã€‚ é‚£åŠ è½½å› å­ä¸ºä»€ä¹ˆæ˜¯ 0.75 è€Œä¸æ˜¯ 0.5 æˆ–è€… 1.0 å‘¢ï¼Ÿ è¿™å…¶å®æ˜¯å‡ºäºå®¹é‡å’Œæ€§èƒ½ä¹‹é—´å¹³è¡¡çš„ç»“æœï¼š å½“åŠ è½½å› å­è®¾ç½®æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œæ‰©å®¹çš„é—¨æ§›å°±è¢«æé«˜äº†ï¼Œæ‰©å®¹å‘ç”Ÿçš„é¢‘ç‡æ¯”è¾ƒä½ï¼Œå ç”¨çš„ç©ºé—´ä¼šæ¯”è¾ƒå°ï¼Œä½†æ­¤æ—¶å‘ç”Ÿ Hash å†²çªçš„å‡ ç‡å°±ä¼šæå‡ï¼Œå› æ­¤éœ€è¦æ›´å¤æ‚çš„æ•°æ®ç»“æ„æ¥å­˜å‚¨å…ƒç´ ï¼Œè¿™æ ·å¯¹å…ƒç´ çš„æ“ä½œæ—¶é—´å°±ä¼šå¢åŠ ï¼Œè¿è¡Œæ•ˆç‡ä¹Ÿä¼šå› æ­¤é™ä½ï¼› è€Œå½“åŠ è½½å› å­å€¼æ¯”è¾ƒå°çš„æ—¶å€™ï¼Œæ‰©å®¹çš„é—¨æ§›ä¼šæ¯”è¾ƒä½ï¼Œå› æ­¤ä¼šå ç”¨æ›´å¤šçš„ç©ºé—´ï¼Œæ­¤æ—¶å…ƒç´ çš„å­˜å‚¨å°±æ¯”è¾ƒç¨€ç–ï¼Œå‘ç”Ÿå“ˆå¸Œå†²çªçš„å¯èƒ½æ€§å°±æ¯”è¾ƒå°ï¼Œå› æ­¤æ“ä½œæ€§èƒ½ä¼šæ¯”è¾ƒé«˜ã€‚ æ‰€ä»¥ç»¼åˆäº†ä»¥ä¸Šæƒ…å†µå°±å–äº†ä¸€ä¸ª 0.5 åˆ° 1.0 çš„å¹³å‡æ•° 0.75 ä½œä¸ºåŠ è½½å› å­ã€‚ å½“æœ‰å“ˆå¸Œå†²çªæ—¶ï¼ŒHashMapæ˜¯å¦‚ä½•æŸ¥æ‰¾å¹¶ç¡®è®¤å…ƒç´ çš„ï¼Ÿ HashMap æºç ä¸­æœ‰å“ªäº›é‡è¦çš„æ–¹æ³•ï¼Ÿ HashMap ä¸­çš„æ ¸å¿ƒæ–¹æ³•HashMap æºç ä¸­ä¸‰ä¸ªé‡è¦æ–¹æ³•ï¼šæŸ¥è¯¢ã€æ–°å¢å’Œæ•°æ®æ‰©å®¹ã€‚ æŸ¥è¯¢bucket é‡Œçš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›´æ¥å‘½ä¸­ï¼›å¦‚æœæœ‰å†²çªï¼Œåˆ™é€šè¿‡ key.equals(k) å»æŸ¥æ‰¾å¯¹åº”çš„ entryè‹¥ä¸ºæ ‘ï¼Œåˆ™åœ¨æ ‘ä¸­é€šè¿‡ key.equals(k) æŸ¥æ‰¾ï¼ŒO(logn)ï¼›è‹¥ä¸ºé“¾è¡¨ï¼Œåˆ™åœ¨é“¾è¡¨ä¸­é€šè¿‡ key.equals(k) æŸ¥æ‰¾ï¼ŒO(n)ã€‚ å…·ä½“ä»£ç çš„å®ç°å¦‚ä¸‹ï¼š public V get(Object key) &#123; Node&lt;K,V&gt; e; // å¯¹ key è¿›è¡Œå“ˆå¸Œæ“ä½œ return (e = getNode(hash(key), key)) == null ? null : e.value; &#125; final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; // éç©ºåˆ¤æ–­ if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) &#123; // åˆ¤æ–­ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯å¦æ˜¯è¦æŸ¥è¯¢çš„å…ƒç´  if (first.hash == hash &amp;&amp; ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; // ä¸€ä¸‹ä¸€ä¸ªèŠ‚ç‚¹éç©ºåˆ¤æ–­ if ((e = first.next) != null) &#123; // å¦‚æœç¬¬ä¸€èŠ‚ç‚¹æ˜¯æ ‘ç»“æ„ï¼Œåˆ™ä½¿ç”¨ getTreeNode ç›´æ¥è·å–ç›¸åº”çš„æ•°æ® if (first instanceof TreeNode) return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); // éæ ‘ç»“æ„å¾ªç¯èŠ‚ç‚¹åˆ¤æ–­ do &#123; // hash ç›¸ç­‰å¹¶ä¸” key ç›¸åŒï¼Œåˆ™è¿”å›æ­¤èŠ‚ç‚¹ if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; while ((e = e.next) != null); &#125; &#125; return null; &#125; ä»ä»¥ä¸Šæºç å¯ä»¥çœ‹å‡ºï¼Œå½“å“ˆå¸Œå†²çªæ—¶æˆ‘ä»¬éœ€è¦é€šè¿‡åˆ¤æ–­ key å€¼æ˜¯å¦ç›¸ç­‰ï¼Œæ‰èƒ½ç¡®è®¤æ­¤å…ƒç´ æ˜¯ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„å…ƒç´ ã€‚ æ–°å¢put æ–¹æ³•ä¹Ÿæ˜¯HashMapä¸­æ¯”è¾ƒé‡è¦çš„æ–¹æ³•ï¼Œå› ä¸ºé€šè¿‡è¯¥æ–¹æ³•æˆ‘ä»¬å¯ä»¥çª¥æ¢åˆ° HashMap åœ¨å†…éƒ¨æ˜¯å¦‚ä½•è¿›è¡Œæ•°æ®å­˜å‚¨çš„ï¼Œæ‰€è°“çš„æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘çš„å­˜å‚¨ç»“æ„æ˜¯å¦‚ä½•å½¢æˆçš„ï¼Œåˆæ˜¯åœ¨ä½•ç§æƒ…å†µä¸‹å°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘æ¥ä¼˜åŒ–æ€§èƒ½çš„ã€‚ put æ–¹æ³•çš„å¤§è‡´å®ç°è¿‡ç¨‹å¦‚ä¸‹ï¼š å¯¹ key çš„ hashCode() åš hashï¼Œç„¶åå†è®¡ç®— index; å¦‚æœæ²¡ç¢°æ’ç›´æ¥æ”¾åˆ° bucket é‡Œï¼› å¦‚æœç¢°æ’äº†ï¼Œä»¥é“¾è¡¨çš„å½¢å¼å­˜åœ¨ buckets åï¼› å¦‚æœç¢°æ’å¯¼è‡´é“¾è¡¨è¿‡é•¿ (å¤§äºç­‰äº TREEIFY_THRESHOLD)ï¼Œå°±æŠŠé“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ï¼› å¦‚æœèŠ‚ç‚¹å·²ç»å­˜åœ¨å°±æ›¿æ¢ old value(ä¿è¯ key çš„å”¯ä¸€æ€§) å¦‚æœ bucket æ»¡äº† (è¶…è¿‡ load factor*current capacity)ï¼Œå°±è¦ resizeã€‚ public V put(K key, V value) &#123; // å¯¹ key è¿›è¡Œå“ˆå¸Œæ“ä½œ return putVal(hash(key), key, value, false, true); &#125; final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; // å“ˆå¸Œè¡¨ä¸ºç©ºåˆ™åˆ›å»º if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; // æ ¹æ® key çš„å“ˆå¸Œå€¼è®¡ç®—å‡ºè¦æ’å…¥çš„æ•°ç»„ç´¢å¼• i if ((p = tab[i = (n - 1) &amp; hash]) == null) // å¦‚æœ table[i] = null åˆ™ç›´æ¥æ’å…¥ tab[i] = newNode(hash, key, value, null); else &#123; Node&lt;K,V&gt; e; K k; // å¦‚æœ key å·²ç»å­˜åœ¨äº†ï¼Œç›´æ¥è¦†ç›– value if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) e = p; // å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºçº¢é»‘æ ‘ else if (p instanceof TreeNode) // çº¢é»‘æ ‘ç›´æ¥æ’å…¥é”®å€¼å¯¹ e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); else &#123; // é“¾è¡¨ç»“æ„ï¼Œå¾ªç¯å‡†å¤‡æ’å…¥ for (int binCount = 0; ; ++binCount) &#123; // ä¸‹ä¸€ä¸ªå…ƒç´ ä¸ºç©ºæ—¶ if ((e = p.next) == null) &#123; p.next = newNode(hash, key, value, null); // è½¬æ¢ä¸ºçº¢é»‘æ ‘è¿›è¡Œå¤„ç† if (binCount &gt;= TREEIFY_THRESHOLD - 1) treeifyBin(tab, hash); break; &#125; // key å·²ç»å­˜åœ¨ç›´æ¥è¦†ç›– value if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) break; p = e; &#125; &#125; if (e != null) &#123; V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) e.value = value; afterNodeAccess(e); return oldValue; &#125; &#125; ++modCount; // è¶…è¿‡æœ€å¤§å®¹é‡ï¼Œæ‰©å®¹ if (++size &gt; threshold) resize(); afterNodeInsertion(evict); return null; &#125; æ–°å¢æ–¹æ³•çš„æ‰§è¡Œæµç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š HashMap æ­»å¾ªç¯åˆ†æä»¥ JDK 1.7 ä¸ºä¾‹ï¼Œå‡è®¾ HashMap é»˜è®¤å¤§å°ä¸º 2ï¼ŒåŸæœ¬ HashMap ä¸­æœ‰ä¸€ä¸ªå…ƒç´  key(5)ï¼Œæˆ‘ä»¬å†ä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹ï¼št1 æ·»åŠ å…ƒç´  key(3)ï¼Œt2 æ·»åŠ å…ƒç´  key(7)ï¼Œå½“å…ƒç´  key(3) å’Œ key(7) éƒ½æ·»åŠ åˆ° HashMap ä¸­ä¹‹åï¼Œçº¿ç¨‹ t1 åœ¨æ‰§è¡Œåˆ° Entry&lt;K,V&gt; next = e.next; æ—¶ï¼Œäº¤å‡ºäº† CPU çš„ä½¿ç”¨æƒï¼Œæºç å¦‚ä¸‹ï¼š void transfer(Entry[] newTable, boolean rehash) &#123; int newCapacity = newTable.length; for (Entry&lt;K,V&gt; e: table) &#123; while (null != e) &#123; Entry&lt;K,V&gt; next = e.next; // çº¿ç¨‹ä¸€æ‰§è¡Œåˆ°æ­¤å¤„ if(rehash) &#123; e.hash = null == e.key ? 0 : hash(key); &#125; int i = indexFor(e.hash, newCapacity); e.next = newTable[i]; newTable[i] = e; e = next; &#125; &#125; &#125; é‚£ä¹ˆæ­¤æ—¶çº¿ç¨‹ t1 ä¸­çš„ e æŒ‡å‘äº† key(3)ï¼Œè€Œ next æŒ‡å‘äº† key(7) ï¼›ä¹‹åçº¿ç¨‹ t2 é‡æ–° rehash ä¹‹åé“¾è¡¨çš„é¡ºåºè¢«åè½¬ï¼Œé“¾è¡¨çš„ä½ç½®å˜æˆäº† key(5) â†’ key(7) â†’ key(3)ï¼Œå…¶ä¸­ â€œâ†’â€ ç”¨æ¥è¡¨ç¤ºä¸‹ä¸€ä¸ªå…ƒç´ ã€‚ å½“ t1 é‡æ–°è·å¾—æ‰§è¡Œæƒä¹‹åï¼Œå…ˆæ‰§è¡Œ newTalbe[i] = e æŠŠ key(3) çš„ next è®¾ç½®ä¸º key(7)ï¼Œè€Œä¸‹æ¬¡å¾ªç¯æ—¶æŸ¥è¯¢åˆ° key(7) çš„ next å…ƒç´ ä¸º key(3)ï¼Œäºæ˜¯å°±å½¢æˆäº† key(3) å’Œ key(7) çš„å¾ªç¯å¼•ç”¨ï¼Œå› æ­¤å°±å¯¼è‡´äº†æ­»å¾ªç¯çš„å‘ç”Ÿï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å½“ç„¶å‘ç”Ÿæ­»å¾ªç¯çš„åŸå› æ˜¯ JDK 1.7 é“¾è¡¨æ’å…¥æ–¹å¼ä¸ºé¦–éƒ¨å€’åºæ’å…¥ï¼Œè¿™ä¸ªé—®é¢˜åœ¨ JDK 1.8 å¾—åˆ°äº†æ”¹å–„ï¼Œå˜æˆäº†å°¾éƒ¨æ­£åºæ’å…¥ã€‚ å‚è€ƒæ–‡ç« https://coolshell.cn/articles/9606.html å…¶ä»–æ–¹æ³•æ„é€ æ–¹æ³•public HashMap(int initialCapacity, float loadFactor) &#123; if (initialCapacity &lt; 0) throw new IllegalArgumentException(&quot;Illegal initial capacity: &quot; + initialCapacity); if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException(&quot;Illegal load factor: &quot; + loadFactor); this.loadFactor = loadFactor; this.threshold = tableSizeFor(initialCapacity); &#125; è¿™æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„æ„é€ å‡½æ•°ï¼Œéœ€è¦è°ƒç”¨æ–¹ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼ŒinitialCapacity å’Œ loadFactorã€‚ ç¨‹åºçš„å¤§éƒ¨åˆ†ä»£ç åœ¨åˆ¤æ–­ä¼ å…¥å‚æ•°çš„åˆæ³•æ€§ï¼ŒinitialCapacity å°äºé›¶å°†æŠ›å‡ºå¼‚å¸¸ï¼Œå¤§äº MAXIMUM_CAPACITY å°†è¢«é™å®šä¸º MAXIMUM_CAPACITYã€‚loadFactor å¦‚æœå°äºç­‰äºé›¶æˆ–è€…éæ•°å­—ç±»å‹ä¹Ÿä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ æ•´ä¸ªæ„é€ å‡½æ•°çš„æ ¸å¿ƒåœ¨å¯¹ threshold çš„åˆå§‹åŒ–æ“ä½œï¼š static final int tableSizeFor(int cap) &#123; int n = cap - 1; n |= n &gt;&gt;&gt; 1; n |= n &gt;&gt;&gt; 2; n |= n &gt;&gt;&gt; 4; n |= n &gt;&gt;&gt; 8; n |= n &gt;&gt;&gt; 16; return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1; &#125; ç”±ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡ºï¼Œå½“åœ¨å®ä¾‹åŒ–HashMapå®ä¾‹æ—¶ï¼Œå¦‚æœç»™å®šäº†initialCapacityï¼Œç”±äºHashMapçš„capacityéƒ½æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ï¼Œå› æ­¤è¿™ä¸ªæ–¹æ³•ç”¨äºæ‰¾åˆ°å¤§äºç­‰äºinitialCapacityçš„æœ€å°çš„ 2 çš„å¹‚ï¼ˆinitialCapacity å¦‚æœå°±æ˜¯ 2 çš„å¹‚ï¼Œåˆ™è¿”å›çš„è¿˜æ˜¯è¿™ä¸ªæ•°ï¼‰ã€‚ ä¸‹é¢åˆ†æè¿™ä¸ªç®—æ³•ï¼š é¦–å…ˆï¼Œæˆ‘ä»¬æƒ³ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦å¯¹ cap åšå‡ 1 æ“ä½œï¼Ÿ int n = cap - 1 è¿™æ˜¯ä¸ºäº†é˜²æ­¢ï¼Œcap å·²ç»æ˜¯ 2 çš„å¹‚ã€‚å¦‚æœ cap å·²ç»æ˜¯ 2 çš„å¹‚ï¼Œåˆæ²¡æœ‰æ‰§è¡Œè¿™ä¸ªå‡ 1 æ“ä½œï¼Œåˆ™æ‰§è¡Œå®Œåé¢çš„å‡ æ¡æ— ç¬¦å·å³ç§»æ“ä½œä¹‹åï¼Œè¿”å›çš„ capacity å°†æ˜¯è¿™ä¸ª cap çš„ 2 å€ã€‚å¦‚æœä¸æ‡‚ï¼Œè¦çœ‹å®Œåé¢çš„å‡ ä¸ªæ— ç¬¦å·å³ç§»ä¹‹åå†å›æ¥çœ‹çœ‹ã€‚ ä¸‹é¢çœ‹çœ‹è¿™å‡ ä¸ªæ— ç¬¦å·å³ç§»æ“ä½œï¼š å¦‚æœ n è¿™æ—¶ä¸º 0 äº†ï¼ˆç»è¿‡äº† cap-1 ä¹‹åï¼‰ï¼Œåˆ™ç»è¿‡åé¢çš„å‡ æ¬¡æ— ç¬¦å·å³ç§»ä¾ç„¶æ˜¯ 0ï¼Œæœ€åè¿”å›çš„ capacity æ˜¯ 1ï¼ˆæœ€åæœ‰ä¸ª n+1 çš„æ“ä½œï¼‰ã€‚ è¿™é‡Œæˆ‘ä»¬åªè®¨è®º n ä¸ç­‰äº 0 çš„æƒ…å†µã€‚ n |= n &gt;&gt;&gt; 1; ç”±äº n ä¸ç­‰äº 0ï¼Œåˆ™ n çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­æ€»ä¼šæœ‰ä¸€ bit ä¸º 1ï¼Œè¿™æ—¶è€ƒè™‘æœ€é«˜ä½çš„ 1ã€‚é€šè¿‡æ— ç¬¦å·å³ç§» 1 ä½ï¼Œåˆ™å°†æœ€é«˜ä½çš„ 1 å³ç§»äº† 1 ä½ï¼Œå†åšæˆ–æ“ä½œï¼Œä½¿å¾— n çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ä¸æœ€é«˜ä½çš„ 1 ç´§é‚»çš„å³è¾¹ä¸€ä½ä¹Ÿä¸º 1ï¼Œå¦‚ 000011xxxxxxã€‚ n |= n &gt;&gt;&gt; 2; æ³¨æ„ï¼Œè¿™ä¸ª n å·²ç»è¿›è¡Œè¿‡ n |= n &gt;&gt;&gt; 1; æ“ä½œã€‚å‡è®¾æ­¤æ—¶ n ä¸º 000011xxxxxx ï¼Œåˆ™ n æ— ç¬¦å·å³ç§»ä¸¤ä½ï¼Œä¼šå°†æœ€é«˜ä½ä¸¤ä¸ªè¿ç»­çš„ 1 å³ç§»ä¸¤ä½ï¼Œç„¶åå†ä¸åŸæ¥çš„ n åšæˆ–æ“ä½œï¼Œè¿™æ · n çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„é«˜ä½ä¸­ä¼šæœ‰ 4 ä¸ªè¿ç»­çš„ 1ã€‚å¦‚ 00001111xxxxxx ã€‚ n |= n &gt;&gt;&gt; 4; è¿™æ¬¡æŠŠå·²ç»æœ‰çš„é«˜ä½ä¸­çš„è¿ç»­çš„ 4 ä¸ª 1ï¼Œå³ç§» 4 ä½ï¼Œå†åšæˆ–æ“ä½œï¼Œè¿™æ · n çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„é«˜ä½ä¸­ä¼šæœ‰ 8 ä¸ªè¿ç»­çš„ 1ã€‚å¦‚ 00001111 1111xxxxxx ã€‚ ä»¥æ­¤ç±»æ¨ ã€‚ã€‚ã€‚ æ³¨æ„ï¼Œå®¹é‡æœ€å¤§ä¹Ÿå°±æ˜¯ 32bit çš„æ­£æ•°ï¼Œå› æ­¤æœ€å n |= n &gt;&gt;&gt; 16; æœ€å¤šä¹Ÿå°± 32 ä¸ª 1ï¼Œä½†æ˜¯è¿™æ—¶å·²ç»å¤§äºäº† MAXIMUM_CAPACITY ï¼Œæ‰€ä»¥å–å€¼åˆ° MAXIMUM_CAPACITY ã€‚ ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå›¾ç‰‡æ¥çœ‹ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹ï¼š HashMap ä¸­è¿˜æœ‰å¾ˆå¤šçš„é‡è½½æ„é€ å‡½æ•°ï¼Œä½†å‡ ä¹éƒ½æ˜¯åŸºäºä¸Šè¿°çš„æ„é€ å‡½æ•°çš„ã€‚ public HashMap(int initialCapacity) &#123; this(initialCapacity, DEFAULT_LOAD_FACTOR); &#125; public HashMap() &#123; this.loadFactor = DEFAULT_LOAD_FACTOR; &#125; ä»¥ä¸Šè¿™äº›æ„é€ å‡½æ•°éƒ½æ²¡æœ‰ç›´æ¥çš„åˆ›å»ºä¸€ä¸ªåˆ‡å®å­˜åœ¨çš„æ•°ç»„ï¼Œä»–ä»¬éƒ½æ˜¯åœ¨ä¸ºåˆ›å»ºæ•°ç»„éœ€è¦çš„ä¸€äº›å‚æ•°åšåˆå§‹åŒ–ï¼Œæ‰€ä»¥æœ‰äº›åœ¨æ„é€ å‡½æ•°ä¸­å¹¶æ²¡æœ‰è¢«åˆå§‹åŒ–çš„å±æ€§éƒ½ä¼šåœ¨å®é™…åˆå§‹åŒ–æ•°ç»„çš„æ—¶å€™ç”¨é»˜è®¤å€¼æ›¿æ¢ã€‚ å®é™…å¯¹æ•°ç»„è¿›è¡Œåˆå§‹åŒ–æ˜¯åœ¨æ·»åŠ å…ƒç´ çš„æ—¶å€™è¿›è¡Œçš„ï¼ˆå³ put æ–¹æ³•ï¼‰ public HashMap(Map&lt;? extends K, ? extends V&gt; m) &#123; this.loadFactor = DEFAULT_LOAD_FACTOR; putMapEntries(m, false); &#125; remove æ–¹æ³•åˆ é™¤æ“ä½œå°±æ˜¯ä¸€ä¸ªæŸ¥æ‰¾ + åˆ é™¤çš„è¿‡ç¨‹ï¼Œç›¸å¯¹äºæ·»åŠ æ“ä½œå…¶å®å®¹æ˜“ä¸€äº› public V remove(Object key) &#123; Node&lt;K,V&gt; e; return (e = removeNode(hash(key), key, null, false, true)) == null ? null : e.value; &#125; æ ¹æ®é”®å€¼åˆ é™¤æŒ‡å®šèŠ‚ç‚¹ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ€å¸¸è§çš„æ“ä½œäº†ã€‚æ˜¾ç„¶ï¼ŒremoveNode æ–¹æ³•æ˜¯æ ¸å¿ƒã€‚ final Node&lt;K,V&gt; removeNode(int hash, Object key, Object value,boolean matchValue, boolean movable) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, index; if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (p = tab[index = (n - 1) &amp; hash]) != null) &#123; Node&lt;K,V&gt; node = null, e; K k; V v; if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) node = p; else if ((e = p.next) != null) &#123; if (p instanceof TreeNode) node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key); else &#123; do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) &#123; node = e; break; &#125; p = e; &#125; while ((e = e.next) != null); &#125; &#125; if (node != null &amp;&amp; (!matchValue || (v = node.value) == value ||(value != null &amp;&amp; value.equals(v)))) &#123; if (node instanceof TreeNode) ((TreeNode&lt;K,V&gt;)node).removeTreeNode(this, tab, movable); else if (node == p) tab[index] = node.next; else p.next = node.next; ++modCount; --size; afterNodeRemoval(node); return node; &#125; &#125; return null; &#125; åˆ é™¤æ“ä½œéœ€è¦ä¿è¯åœ¨è¡¨ä¸ä¸ºç©ºçš„æƒ…å†µä¸‹è¿›è¡Œï¼Œå¹¶ä¸” p èŠ‚ç‚¹æ ¹æ®é”®çš„ hash å€¼å¯¹åº”åˆ°æ•°ç»„çš„ç´¢å¼•ï¼Œåœ¨è¯¥ç´¢å¼•å¤„å¿…å®šæœ‰èŠ‚ç‚¹ï¼Œå¦‚æœä¸º null ï¼Œé‚£ä¹ˆé—´æ¥è¯´æ˜æ­¤é”®æ‰€å¯¹åº”çš„ç»“ç‚¹å¹¶ä¸å­˜åœ¨äºæ•´ä¸ª HashMap ä¸­ï¼Œè¿™æ˜¯ä¸åˆæ³•çš„ï¼Œæ‰€ä»¥é¦–å…ˆè¦åœ¨è¿™ä¸¤ä¸ªå¤§å‰æä¸‹æ‰èƒ½è¿›è¡Œåˆ é™¤ç»“ç‚¹çš„æ“ä½œã€‚ ç¬¬ä¸€æ­¥ if (p.hash == hash &amp;&amp;((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) node = p éœ€è¦åˆ é™¤çš„ç»“ç‚¹å°±æ˜¯è¿™ä¸ªå¤´èŠ‚ç‚¹ï¼Œè®© node å¼•ç”¨æŒ‡å‘å®ƒã€‚å¦åˆ™è¯´æ˜å¾…åˆ é™¤çš„ç»“ç‚¹åœ¨å½“å‰ p æ‰€æŒ‡å‘çš„å¤´èŠ‚ç‚¹çš„é“¾è¡¨æˆ–çº¢é»‘æ ‘ä¸­ï¼Œäºæ˜¯éœ€è¦æˆ‘ä»¬éå†æŸ¥æ‰¾ã€‚ ç¬¬äºŒæ­¥ else if ((e = p.next) != null) &#123; if (p instanceof TreeNode) node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key); else &#123; do &#123; if (e.hash == hash &amp;&amp;((k = e.key) == key ||(key != null &amp;&amp; key.equals(k)))) &#123; node = e; break; &#125; p = e; &#125; while ((e = e.next) != null); &#125; &#125; å¦‚æœå¤´èŠ‚ç‚¹æ˜¯çº¢é»‘æ ‘ç»“ç‚¹ï¼Œé‚£ä¹ˆè°ƒç”¨çº¢é»‘æ ‘è‡ªå·±çš„éå†æ–¹æ³•å»å¾—åˆ°è¿™ä¸ªå¾…åˆ ç»“ç‚¹ã€‚å¦åˆ™å°±æ˜¯æ™®é€šé“¾è¡¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ do while å¾ªç¯å»éå†æ‰¾åˆ°å¾…åˆ ç»“ç‚¹ã€‚æ‰¾åˆ°èŠ‚ç‚¹ä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯åˆ é™¤æ“ä½œäº†ã€‚ ç¬¬ä¸‰æ­¥ if (node != null &amp;&amp; (!matchValue || (v = node.value) == value ||(value != null &amp;&amp; value.equals(v)))) &#123; if (node instanceof TreeNode) ((TreeNode&lt;K,V&gt;)node).removeTreeNode(this, tab, movable); else if (node == p) tab[index] = node.next; else p.next = node.next; ++modCount; --size; afterNodeRemoval(node); return node; &#125; åˆ é™¤æ“ä½œä¹Ÿå¾ˆç®€å•ï¼Œå¦‚æœæ˜¯çº¢é»‘æ ‘ç»“ç‚¹çš„åˆ é™¤ï¼Œç›´æ¥è°ƒç”¨çº¢é»‘æ ‘çš„åˆ é™¤æ–¹æ³•è¿›è¡Œåˆ é™¤å³å¯ï¼Œå¦‚æœæ˜¯å¾…åˆ ç»“ç‚¹å°±æ˜¯ä¸€ä¸ªå¤´èŠ‚ç‚¹ï¼Œé‚£ä¹ˆç”¨å®ƒçš„ next ç»“ç‚¹é¡¶æ›¿å®ƒä½œä¸ºå¤´èŠ‚ç‚¹å­˜æ”¾åœ¨ table[index] ä¸­ï¼Œå¦‚æœåˆ é™¤çš„æ˜¯æ™®é€šé“¾è¡¨ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç”¨è¯¥ç»“ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹ç›´æ¥è·³è¿‡è¯¥å¾…åˆ ç»“ç‚¹æŒ‡å‘å®ƒçš„ next ç»“ç‚¹å³å¯ã€‚ æœ€åï¼Œå¦‚æœ removeNode æ–¹æ³•åˆ é™¤æˆåŠŸå°†è¿”å›è¢«åˆ ç»“ç‚¹ï¼Œå¦åˆ™è¿”å› nullã€‚ keySettransient volatile Set&lt;K&gt; keySet; public Set&lt;K&gt; keySet() &#123; Set&lt;K&gt; ks; return (ks = keySet) == null ? (keySet = new KeySet()) : ks; &#125; final class KeySet extends AbstractSet&lt;K&gt; &#123; public final int size() &#123; return size; &#125; public final void clear() &#123; HashMap.this.clear(); &#125; public final Iterator&lt;K&gt; iterator() &#123; return new KeyIterator(); &#125; public final boolean contains(Object o) &#123; return containsKey(o); &#125; public final boolean remove(Object key) &#123; return removeNode(hash(key), key, null, false, true) != null; &#125; public final Spliterator&lt;K&gt; spliterator() &#123; return new KeySpliterator&lt;&gt;(HashMap.this, 0, -1, 0, 0); &#125; &#125; HashMap ä¸­å®šä¹‰äº†ä¸€ä¸ª keySet çš„å®ä¾‹å±æ€§ï¼Œå®ƒä¿å­˜çš„æ˜¯æ•´ä¸ª HashMap ä¸­æ‰€æœ‰é”®çš„é›†åˆã€‚ä¸Šè¿°æ‰€åˆ—å‡ºçš„ KeySet ç±»æ˜¯ Set çš„ä¸€ä¸ªå®ç°ç±»ï¼Œå®ƒè´Ÿè´£ä¸ºæˆ‘ä»¬æä¾›æœ‰å…³ HashMap ä¸­æ‰€æœ‰å¯¹é”®çš„æ“ä½œã€‚ å¯ä»¥çœ‹åˆ°ï¼ŒKeySet ä¸­çš„æ‰€æœ‰çš„å®ä¾‹æ–¹æ³•éƒ½ä¾èµ–å½“å‰çš„ HashMap å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯¹è¿”å›çš„ keySet é›†ä¸­çš„ä»»æ„ä¸€ä¸ªæ“ä½œéƒ½ä¼šç›´æ¥æ˜ å°„åˆ°å½“å‰ HashMap å®ä¾‹ä¸­ï¼Œä¾‹å¦‚ä½ æ‰§è¡Œåˆ é™¤ä¸€ä¸ªé”®çš„æ“ä½œï¼Œé‚£ä¹ˆ HashMap ä¸­å°†ä¼šå°‘ä¸€ä¸ªèŠ‚ç‚¹ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://gyl-coder.top/tags/%E9%9B%86%E5%90%88/"},{"name":"HashMap","slug":"HashMap","permalink":"https://gyl-coder.top/tags/HashMap/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"int å’Œ Integer æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿè°ˆè°ˆIntegerçš„å€¼ç¼“å­˜èŒƒå›´","slug":"java/difference_between_int_and_integer","date":"2020-03-10T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"java/difference_between_int_and_integer/","link":"","permalink":"https://gyl-coder.top/java/difference_between_int_and_integer/","excerpt":"Java è™½ç„¶æ˜¯é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œä½†æ˜¯ä¾æ—§ä¿ç•™äº†ä¸€äº›åŸå§‹æ•°æ®ç±»å‹ï¼ŒåŒæ—¶ä¸ºäº†å…¼å®¹javaé¢å‘å¯¹è±¡çš„ç‰¹æ€§ï¼Œæ¯ç§åŸå§‹æ•°æ®ç±»å‹ï¼Œéƒ½æœ‰å¯¹åº”çš„åŒ…è£…ç±»å‹ã€‚ åŸå§‹æ•°æ®ç±»å‹ï¼šbooleanã€charã€byteã€shortã€intã€longã€floatã€doubleåŒ…è£…ç±»å‹ï¼šBooleanã€Characterã€Byteã€Shortã€Integerã€Longã€Floatã€Double åŒ…è£…ç±»å‹æ˜¯å¯¹åŸå§‹æ•°æ®ç±»å‹çš„ä¸€ç§å°è£…ï¼ŒåŒ…å«å¯¹åŸå§‹ç±»å‹æ•°æ®çš„å­˜å‚¨ã€åŸºæœ¬æ“ä½œä»¥åŠä¸¤ç§ç±»å‹ç›´æ¥çš„è½¬æ¢ã€‚Java5ä¸­ï¼Œå¼•å…¥äº† è‡ªåŠ¨è£…ç®±å’Œè‡ªåŠ¨æ‹†ç®± åŠŸèƒ½ï¼ˆboxing/unboxingï¼‰ï¼ŒJavaå¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡ï¼Œè‡ªåŠ¨è¿›è¡Œè½¬æ¢ï¼Œæå¤§çš„ç®€åŒ–äº†ç›¸å…³çš„ç¼–ç¨‹ã€‚ Integerå°±æ˜¯intå¯¹åº”çš„åŒ…è£…ç±»ï¼Œå®ƒæœ‰ä¸€ä¸ªintç±»å‹çš„å­—æ®µå­˜å‚¨æ•°æ®ï¼Œå¹¶ä¸”æä¾›äº†åŸºæœ¬æ“ä½œï¼Œæ¯”å¦‚æ•°å­¦è¿ç®—ã€ç±»å‹è½¬æ¢ç­‰ã€‚ å…³äºIntegerçš„å€¼ç¼“å­˜ï¼Œæ˜¯Java5ä¸­çš„ä¸€ä¸ªæ”¹è¿›ã€‚æ„é€ ä¸€ä¸ªIntegerå¯¹è±¡çš„æ­£å¸¸æ“ä½œåº”è¯¥æ˜¯ç›´æ¥ä½¿ç”¨Integerçš„æ„é€ å™¨ï¼Œnewä¸€ä¸ªå¯¹è±¡å‡ºæ¥ã€‚ä½†æ˜¯æ ¹æ®å…·ä½“å®è·µï¼Œå¤§éƒ¨åˆ†çš„æ“ä½œéƒ½è¾ƒä¸ºé›†ä¸­åœ¨æœ‰é™ä¸”è¾ƒå°çš„æ•°å€¼èŒƒå›´ã€‚å› æ­¤ï¼ŒJava5ä¸­æ–°å¢äº†é™æ€å·¥å‚æ–¹æ³• valueOfï¼Œåœ¨è°ƒç”¨å®ƒçš„æ—¶å€™ä¼šåˆ©ç”¨ä¸€ä¸ªç¼“å­˜æœºåˆ¶ã€‚ç¼“å­˜çš„æ•°å€¼èŒƒå›´ä¸º[-128, 127]ã€‚","text":"Java è™½ç„¶æ˜¯é¢å‘å¯¹è±¡çš„ç¼–ç¨‹è¯­è¨€ï¼Œä½†æ˜¯ä¾æ—§ä¿ç•™äº†ä¸€äº›åŸå§‹æ•°æ®ç±»å‹ï¼ŒåŒæ—¶ä¸ºäº†å…¼å®¹javaé¢å‘å¯¹è±¡çš„ç‰¹æ€§ï¼Œæ¯ç§åŸå§‹æ•°æ®ç±»å‹ï¼Œéƒ½æœ‰å¯¹åº”çš„åŒ…è£…ç±»å‹ã€‚ åŸå§‹æ•°æ®ç±»å‹ï¼šbooleanã€charã€byteã€shortã€intã€longã€floatã€doubleåŒ…è£…ç±»å‹ï¼šBooleanã€Characterã€Byteã€Shortã€Integerã€Longã€Floatã€Double åŒ…è£…ç±»å‹æ˜¯å¯¹åŸå§‹æ•°æ®ç±»å‹çš„ä¸€ç§å°è£…ï¼ŒåŒ…å«å¯¹åŸå§‹ç±»å‹æ•°æ®çš„å­˜å‚¨ã€åŸºæœ¬æ“ä½œä»¥åŠä¸¤ç§ç±»å‹ç›´æ¥çš„è½¬æ¢ã€‚Java5ä¸­ï¼Œå¼•å…¥äº† è‡ªåŠ¨è£…ç®±å’Œè‡ªåŠ¨æ‹†ç®± åŠŸèƒ½ï¼ˆboxing/unboxingï¼‰ï¼ŒJavaå¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡ï¼Œè‡ªåŠ¨è¿›è¡Œè½¬æ¢ï¼Œæå¤§çš„ç®€åŒ–äº†ç›¸å…³çš„ç¼–ç¨‹ã€‚ Integerå°±æ˜¯intå¯¹åº”çš„åŒ…è£…ç±»ï¼Œå®ƒæœ‰ä¸€ä¸ªintç±»å‹çš„å­—æ®µå­˜å‚¨æ•°æ®ï¼Œå¹¶ä¸”æä¾›äº†åŸºæœ¬æ“ä½œï¼Œæ¯”å¦‚æ•°å­¦è¿ç®—ã€ç±»å‹è½¬æ¢ç­‰ã€‚ å…³äºIntegerçš„å€¼ç¼“å­˜ï¼Œæ˜¯Java5ä¸­çš„ä¸€ä¸ªæ”¹è¿›ã€‚æ„é€ ä¸€ä¸ªIntegerå¯¹è±¡çš„æ­£å¸¸æ“ä½œåº”è¯¥æ˜¯ç›´æ¥ä½¿ç”¨Integerçš„æ„é€ å™¨ï¼Œnewä¸€ä¸ªå¯¹è±¡å‡ºæ¥ã€‚ä½†æ˜¯æ ¹æ®å…·ä½“å®è·µï¼Œå¤§éƒ¨åˆ†çš„æ“ä½œéƒ½è¾ƒä¸ºé›†ä¸­åœ¨æœ‰é™ä¸”è¾ƒå°çš„æ•°å€¼èŒƒå›´ã€‚å› æ­¤ï¼ŒJava5ä¸­æ–°å¢äº†é™æ€å·¥å‚æ–¹æ³• valueOfï¼Œåœ¨è°ƒç”¨å®ƒçš„æ—¶å€™ä¼šåˆ©ç”¨ä¸€ä¸ªç¼“å­˜æœºåˆ¶ã€‚ç¼“å­˜çš„æ•°å€¼èŒƒå›´ä¸º[-128, 127]ã€‚ çŸ¥è¯†ç‚¹è§£è¯»å¦‚ä½•ç†è§£è‡ªåŠ¨è£…ç®±ã€æ‹†ç®±è‡ªåŠ¨è£…ç®±å®é™…ä¸Šç®—æ˜¯ä¸€ç§è¯­æ³•ç³–ã€‚Javaä¼šè‡ªåŠ¨è¿›è¡Œè½¬æ¢ï¼Œä¿è¯ä¸åŒçš„å†™æ³•åœ¨è¿è¡Œæ—¶æ˜¯ç­‰ä»·çš„ï¼Œä»–ä»¬å‘ç”Ÿåœ¨ç¼–è¯‘é˜¶æ®µï¼Œä¹Ÿå°±æ˜¯ç”Ÿæˆçš„å­—èŠ‚ç æ˜¯ä¸€è‡´çš„ã€‚ è¯­æ³•ç³–è™½å¥½ï¼Œç”¨æ—¶å°å¿ƒ å»ºè®®é¿å…æ— æ„çš„è£…ç®±ã€æ‹†çº¿è¡Œä¸ºï¼ˆåˆ›å»º100ä¸‡ä¸ªjavaå¯¹è±¡å’Œ100ä¸‡ä¸ªæ•´æ•°çš„æ¶ˆè€—ä¸æ˜¯ä¸€ä¸ªæ•°é‡çº§çš„ï¼Œä¸ç®¡æ˜¯å†…å­˜ä½¿ç”¨è¿˜æ˜¯å¤„ç†é€Ÿåº¦ï¼Œå…‰æ˜¯å¯¹è±¡å¤´çš„ç©ºé—´å ç”¨å°±å·²ç»æ˜¯æ•°é‡çº§çš„å·®è·äº†ã€‚ï¼‰","categories":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"Int","slug":"Int","permalink":"https://gyl-coder.top/tags/Int/"},{"name":"Integer","slug":"Integer","permalink":"https://gyl-coder.top/tags/Integer/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¯æ‰©å±•çš„é™æµç®—æ³• [è½¬]","slug":"good/how-to-design-extensible-limiting-algorithm","date":"2020-03-05T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"good/how-to-design-extensible-limiting-algorithm/","link":"","permalink":"https://gyl-coder.top/good/how-to-design-extensible-limiting-algorithm/","excerpt":"é™æµï¼ˆRate Limitingï¼Œå³é€Ÿç‡é™åˆ¶ï¼‰é€šè¿‡é™åˆ¶æ¯ä¸ªç”¨æˆ·è°ƒç”¨APIçš„é¢‘ç‡æ¥é˜²æ­¢APIè¢«è¿‡åº¦ä½¿ç”¨ï¼Œè¿™å¯ä»¥é˜²æ­¢ä»–ä»¬å› ç–å¿½æˆ–æ¶æ„å¯¼è‡´çš„APIæ»¥ç”¨ã€‚åœ¨æ²¡æœ‰é€Ÿç‡é™åˆ¶çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªç”¨æˆ·å¯ä»¥éšå¿ƒæ‰€æ¬²åœ°è¯·æ±‚ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´â€œå³°å€¼â€è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´å…¶ä»–ç”¨æˆ·å¾—ä¸åˆ°å“åº”ã€‚åœ¨å¯ç”¨é€Ÿç‡é™åˆ¶ä¹‹åï¼Œå®ƒä»¬çš„è¯·æ±‚å°†è¢«é™åˆ¶ä¸ºæ¯ç§’å›ºå®šçš„æ•°é‡ã€‚","text":"é™æµï¼ˆRate Limitingï¼Œå³é€Ÿç‡é™åˆ¶ï¼‰é€šè¿‡é™åˆ¶æ¯ä¸ªç”¨æˆ·è°ƒç”¨APIçš„é¢‘ç‡æ¥é˜²æ­¢APIè¢«è¿‡åº¦ä½¿ç”¨ï¼Œè¿™å¯ä»¥é˜²æ­¢ä»–ä»¬å› ç–å¿½æˆ–æ¶æ„å¯¼è‡´çš„APIæ»¥ç”¨ã€‚åœ¨æ²¡æœ‰é€Ÿç‡é™åˆ¶çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªç”¨æˆ·å¯ä»¥éšå¿ƒæ‰€æ¬²åœ°è¯·æ±‚ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´â€œå³°å€¼â€è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´å…¶ä»–ç”¨æˆ·å¾—ä¸åˆ°å“åº”ã€‚åœ¨å¯ç”¨é€Ÿç‡é™åˆ¶ä¹‹åï¼Œå®ƒä»¬çš„è¯·æ±‚å°†è¢«é™åˆ¶ä¸ºæ¯ç§’å›ºå®šçš„æ•°é‡ã€‚ åœ¨ç¤ºä¾‹å›¾è¡¨ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°é€Ÿç‡é™åˆ¶å¦‚ä½•åœ¨ä¸€æ®µæ—¶é—´å†…é˜»å¡è¯·æ±‚ã€‚APIæœ€åˆæ¯åˆ†é’Ÿæ¥æ”¶4ä¸ªè¯·æ±‚ï¼Œç”¨ç»¿è‰²è¡¨ç¤ºã€‚å½“12:02å¯ç”¨é€Ÿç‡é™åˆ¶æ—¶ï¼Œä»¥çº¢è‰²æ˜¾ç¤ºçš„å…¶ä»–è¯·æ±‚å°†è¢«æ‹’ç»ã€‚ é€Ÿç‡é™åˆ¶å¯¹äºå…¬å…±APIæ˜¯éå¸¸é‡è¦çš„ï¼Œå› ä¸ºä½ æƒ³è¦ä¸ºæ¯ä¸ªæ¶ˆè´¹è€…ï¼ˆAPIè°ƒç”¨è€…ï¼‰ç»´æŠ¤è‰¯å¥½çš„æœåŠ¡è´¨é‡ï¼Œå³ä½¿æœ‰äº›ç”¨æˆ·è·å–äº†è¶…å‡ºå…¶å…¬å¹³é…é¢çš„æœåŠ¡ã€‚è®¡ç®—å¯†é›†å‹çš„ç«¯ç‚¹ç‰¹åˆ«éœ€è¦é€Ÿç‡é™åˆ¶â€”â€”ç‰¹åˆ«æ˜¯é€šè¿‡è‡ªåŠ¨ä¼¸ç¼©æˆ–AWS Lambdaå’ŒOpenWhiskç­‰æŒ‰è®¡ç®—ä»˜è´¹æœåŠ¡æ¥æä¾›æœåŠ¡æ—¶ã€‚ä½ è¿˜å¯èƒ½å¸Œæœ›å¯¹æä¾›æ•æ„Ÿæ•°æ®çš„APIè¿›è¡Œè¯„çº§ï¼Œå› ä¸ºå¦‚æœæ”»å‡»è€…åœ¨æŸäº›ä¸å¯é¢„è§çš„äº‹ä»¶ä¸­è·å¾—è®¿é—®æƒé™ï¼Œè¿™å¯èƒ½ä¼šé™åˆ¶æš´éœ²çš„æ•°æ®ã€‚ å®é™…ä¸Šæœ‰è®¸å¤šä¸åŒçš„æ–¹æ³•æ¥å®ç°é€Ÿç‡é™åˆ¶ï¼Œæˆ‘ä»¬å°†æ¢è®¨ä¸åŒé€Ÿç‡é™åˆ¶ç®—æ³•çš„ä¼˜ç¼ºç‚¹ã€‚æˆ‘ä»¬è¿˜å°†æ¢è®¨è·¨é›†ç¾¤æ‰©å±•æ—¶å‡ºç°çš„é—®é¢˜ã€‚æœ€åï¼Œæˆ‘ä»¬å°†å‘ä½ å±•ç¤ºä¸€ä¸ªå¦‚ä½•ä½¿ç”¨Kongå¿«é€Ÿè®¾ç½®é€Ÿç‡é™åˆ¶çš„ç¤ºä¾‹ï¼ŒKongæ˜¯æœ€æµè¡Œçš„å¼€æºAPIç½‘å…³ã€‚ é€Ÿåº¦é™åˆ¶ç®—æ³•æœ‰å„ç§å„æ ·çš„é€Ÿç‡é™åˆ¶ç®—æ³•ï¼Œæ¯ä¸€ç§éƒ½æœ‰è‡ªå·±çš„ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ï¼Œè¿™æ ·ä½ å°±å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦é€‰æ‹©æœ€å¥½çš„é™æµç®—æ³•ã€‚ æ¼æ¡¶ç®—æ³•æ¼æ¡¶ç®—æ³•ï¼ˆLeaky Bucketï¼Œä¸ä»¤ç‰Œæ¡¶å¯†åˆ‡ç›¸å…³ï¼‰æ˜¯è¿™æ ·ä¸€ç§ç®—æ³•ï¼Œå®ƒæä¾›äº†ä¸€ç§ç®€å•ã€ç›´è§‚çš„æ–¹æ³•æ¥é€šè¿‡é˜Ÿåˆ—é™åˆ¶é€Ÿç‡ï¼Œä½ å¯ä»¥å°†é˜Ÿåˆ—çœ‹ä½œä¸€ä¸ªå­˜å‚¨è¯·æ±‚çš„æ¡¶ã€‚å½“ä¸€ä¸ªè¯·æ±‚è¢«æ³¨å†Œæ—¶ï¼Œå®ƒè¢«é™„åŠ åˆ°é˜Ÿåˆ—çš„æœ«å°¾ã€‚æ¯éš”ä¸€æ®µæ—¶é—´å¤„ç†é˜Ÿåˆ—ä¸Šçš„ç¬¬ä¸€é¡¹ã€‚è¿™ä¹Ÿç§°ä¸ºå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰é˜Ÿåˆ—ã€‚å¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™ä¸¢å¼ƒï¼ˆæˆ–æ³„æ¼ï¼‰å…¶ä»–è¯·æ±‚ã€‚ è¿™ç§ç®—æ³•çš„ä¼˜ç‚¹æ˜¯å®ƒå¯ä»¥å¹³æ»‘è¯·æ±‚çš„çˆ†å‘ï¼Œå¹¶ä»¥è¿‘ä¼¼å¹³å‡çš„é€Ÿåº¦å¤„ç†å®ƒä»¬ã€‚å®ƒä¹Ÿå¾ˆå®¹æ˜“åœ¨å•ä¸ªæœåŠ¡å™¨æˆ–è´Ÿè½½å‡è¡¡å™¨ä¸Šå®ç°ï¼Œå¹¶ä¸”åœ¨æœ‰é™çš„é˜Ÿåˆ—å¤§å°ä¸‹å¯¹äºæ¯ä¸ªç”¨æˆ·éƒ½æ˜¯å†…å­˜æœ‰æ•ˆçš„ã€‚ ç„¶è€Œï¼Œçªå‘çš„è®¿é—®é‡ä¼šç”¨æ—§çš„è¯·æ±‚å¡«æ»¡é˜Ÿåˆ—ï¼Œå¹¶ä½¿æœ€è¿‘çš„è¯·æ±‚æ— æ³•è¢«å¤„ç†ã€‚å®ƒä¹Ÿä¸èƒ½ä¿è¯åœ¨å›ºå®šçš„æ—¶é—´å†…å¤„ç†è¯·æ±‚ã€‚æ­¤å¤–ï¼Œå¦‚æœä¸ºäº†å®¹é”™æˆ–å¢åŠ ååé‡è€Œè´Ÿè½½å¹³è¡¡æœåŠ¡å™¨ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ç­–ç•¥æ¥åè°ƒå’Œå¼ºåˆ¶å®ƒä»¬ä¹‹é—´çš„é™åˆ¶ã€‚ç¨åæˆ‘ä»¬å°†è®¨è®ºåˆ†å¸ƒå¼ç¯å¢ƒçš„æŒ‘æˆ˜ã€‚ å›ºå®šçª—å£ç®—æ³•åœ¨å›ºå®šçª—å£ï¼ˆFixed Windowï¼‰ç®—æ³•ä¸­ï¼Œä½¿ç”¨nç§’çš„çª—å£å¤§å°ï¼ˆé€šå¸¸ä½¿ç”¨å¯¹äººç±»å‹å¥½çš„å€¼ï¼Œå¦‚60ç§’æˆ–3600ç§’ï¼‰æ¥è·Ÿè¸ªé€Ÿç‡ã€‚æ¯ä¸ªä¼ å…¥çš„è¯·æ±‚éƒ½ä¼šå¢åŠ çª—å£çš„è®¡æ•°å™¨ã€‚å¦‚æœè®¡æ•°å™¨è¶…è¿‡é˜ˆå€¼ï¼Œåˆ™ä¸¢å¼ƒè¯·æ±‚ã€‚çª—å£é€šå¸¸ç”±å½“å‰æ—¶é—´æˆ³çš„å±‚å®šä¹‰ï¼Œå› æ­¤12:00:03çš„çª—å£é•¿åº¦ä¸º60ç§’ï¼Œåº”è¯¥åœ¨12:00:00çš„çª—å£ä¸­ã€‚ è¿™ç§ç®—æ³•çš„ä¼˜ç‚¹æ˜¯ï¼Œå®ƒå¯ä»¥ç¡®ä¿å¤„ç†æ›´å¤šæœ€è¿‘çš„è¯·æ±‚ï¼Œè€Œä¸ä¼šè¢«æ—§çš„è¯·æ±‚é¥¿æ­»ã€‚ç„¶è€Œï¼Œå‘ç”Ÿåœ¨çª—å£è¾¹ç•Œé™„è¿‘çš„å•ä¸ªæµé‡çªå‘ä¼šå¯¼è‡´å¤„ç†è¯·æ±‚çš„é€Ÿåº¦å¢åŠ ä¸€å€ï¼Œå› ä¸ºå®ƒå…è®¸åœ¨çŸ­æ—¶é—´å†…åŒæ—¶å¤„ç†å½“å‰çª—å£å’Œä¸‹ä¸€ä¸ªçª—å£çš„è¯·æ±‚ã€‚å¦å¤–ï¼Œå¦‚æœè®¸å¤šæ¶ˆè´¹è€…ç­‰å¾…ä¸€ä¸ªé‡ç½®çª—å£ï¼Œä¾‹å¦‚åœ¨ä¸€ä¸ªå°æ—¶çš„é¡¶éƒ¨ï¼Œé‚£ä¹ˆä»–ä»¬å¯èƒ½åŒæ—¶æ‰°ä¹±ä½ çš„APIã€‚ æ»‘åŠ¨æ—¥å¿—ç®—æ³•æ»‘åŠ¨æ—¥å¿—ï¼ˆSliding Logï¼‰é€Ÿç‡é™åˆ¶æ¶‰åŠåˆ°è·Ÿè¸ªæ¯ä¸ªä½¿ç”¨è€…è¯·æ±‚çš„æ—¶é—´æˆ³æ—¥å¿—ã€‚è¿™äº›æ—¥å¿—é€šå¸¸å­˜å‚¨åœ¨æŒ‰æ—¶é—´æ’åºçš„æ•£åˆ—é›†æˆ–è¡¨ä¸­ã€‚æ—¶é—´æˆ³è¶…è¿‡é˜ˆå€¼çš„æ—¥å¿—å°†è¢«ä¸¢å¼ƒã€‚å½“æ–°è¯·æ±‚å‡ºç°æ—¶ï¼Œæˆ‘ä»¬è®¡ç®—æ—¥å¿—çš„æ€»å’Œæ¥ç¡®å®šè¯·æ±‚ç‡ã€‚å¦‚æœè¯·æ±‚å°†è¶…è¿‡é˜ˆå€¼é€Ÿç‡ï¼Œåˆ™ä¿ç•™è¯¥è¯·æ±‚ã€‚ è¯¥ç®—æ³•çš„ä¼˜ç‚¹æ˜¯ä¸å—å›ºå®šçª—å£è¾¹ç•Œæ¡ä»¶çš„é™åˆ¶ï¼Œé€Ÿç‡é™åˆ¶å°†ä¸¥æ ¼æ‰§è¡Œã€‚æ­¤å¤–ï¼Œå› ä¸ºæ»‘åŠ¨æ—¥å¿—æ˜¯é’ˆå¯¹æ¯ä¸ªæ¶ˆè´¹è€…è¿›è¡Œè·Ÿè¸ªçš„ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°å¯¹å›ºå®šçª—å£é€ æˆæŒ‘æˆ˜çš„è¸©è¸æ•ˆåº”ã€‚ä½†æ˜¯ï¼Œä¸ºæ¯ä¸ªè¯·æ±‚å­˜å‚¨æ— é™æ•°é‡çš„æ—¥å¿—å¯èƒ½éå¸¸æ˜‚è´µã€‚å®ƒçš„è®¡ç®—æˆæœ¬ä¹Ÿå¾ˆé«˜ï¼Œå› ä¸ºæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦è®¡ç®—ä½¿ç”¨è€…å…ˆå‰è¯·æ±‚çš„æ€»å’Œï¼Œè¿™äº›è¯·æ±‚å¯èƒ½è·¨è¶Šä¸€ä¸ªæœåŠ¡å™¨é›†ç¾¤ã€‚å› æ­¤ï¼Œå®ƒä¸èƒ½å¾ˆå¥½åœ°å¤„ç†å¤§è§„æ¨¡çš„æµé‡çªå‘æˆ–æ‹’ç»æœåŠ¡æ”»å‡»ã€‚ æ»‘åŠ¨çª—å£è¿™æ˜¯ä¸€ç§å°†å›ºå®šçª—å£ç®—æ³•çš„ä½å¤„ç†æˆæœ¬ä¸æ”¹è¿›çš„æ»‘åŠ¨æ—¥å¿—è¾¹ç•Œæ¡ä»¶ç›¸ç»“åˆçš„æ··åˆæ–¹æ³•ã€‚ä¸å›ºå®šçª—å£ç®—æ³•ä¸€æ ·ï¼Œæˆ‘ä»¬è·Ÿè¸ªæ¯ä¸ªå›ºå®šçª—å£çš„è®¡æ•°å™¨ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ ¹æ®å½“å‰çš„æ—¶é—´æˆ³è®¡ç®—å‰ä¸€ä¸ªçª—å£è¯·æ±‚ç‡çš„åŠ æƒå€¼ï¼Œä»¥å¹³æ»‘çªå‘çš„æµé‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå½“å‰çª—å£é€šè¿‡äº†25%ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†å‰ä¸€ä¸ªçª—å£çš„è®¡æ•°åŠ æƒä¸º75%ã€‚è·Ÿè¸ªæ¯ä¸ªé”®æ‰€éœ€çš„ç›¸å¯¹è¾ƒå°‘çš„æ•°æ®ç‚¹å…è®¸æˆ‘ä»¬åœ¨å¤§å‹é›†ç¾¤ä¸­æ‰©å±•å’Œåˆ†å¸ƒã€‚ æˆ‘ä»¬æ¨èä½¿ç”¨æ»‘åŠ¨çª—å£æ–¹æ³•ï¼Œå› ä¸ºå®ƒå¯ä»¥çµæ´»åœ°è°ƒæ•´é€Ÿç‡é™åˆ¶ï¼Œå¹¶ä¸”å…·æœ‰è‰¯å¥½çš„æ€§èƒ½ã€‚é€Ÿç‡çª—å£æ˜¯å®ƒå‘APIæ¶ˆè´¹è€…æä¾›é€Ÿç‡é™åˆ¶æ•°æ®çš„ä¸€ç§ç›´è§‚æ–¹å¼ã€‚å®ƒè¿˜é¿å…äº†æ¼æ¡¶çš„é¥¥é¥¿é—®é¢˜å’Œå›ºå®šçª—å£å®ç°çš„çªå‘é—®é¢˜ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„é€Ÿç‡é™åˆ¶åŒæ­¥ç­–ç•¥å¦‚æœå¸Œæœ›åœ¨ä½¿ç”¨å¤šä¸ªèŠ‚ç‚¹çš„é›†ç¾¤æ—¶å®æ–½å…¨å±€é€Ÿç‡é™åˆ¶ï¼Œåˆ™å¿…é¡»è®¾ç½®ç­–ç•¥æ¥å®æ–½è¯¥é™åˆ¶ã€‚å¦‚æœæ¯ä¸ªèŠ‚ç‚¹éƒ½è¦è·Ÿè¸ªè‡ªå·±çš„é€Ÿç‡é™åˆ¶ï¼Œé‚£ä¹ˆå½“è¯·æ±‚è¢«å‘é€åˆ°ä¸åŒèŠ‚ç‚¹æ—¶ï¼Œä½¿ç”¨è€…å¯èƒ½ä¼šè¶…è¿‡å…¨å±€é€Ÿç‡é™åˆ¶ã€‚å®é™…ä¸Šï¼ŒèŠ‚ç‚¹çš„æ•°é‡è¶Šå¤§ï¼Œç”¨æˆ·è¶Šæœ‰å¯èƒ½è¶…è¿‡å…¨å±€é™åˆ¶ã€‚ æ‰§è¡Œæ­¤é™åˆ¶çš„æœ€ç®€å•æ–¹æ³•æ˜¯åœ¨è´Ÿè½½å‡è¡¡å™¨ä¸­è®¾ç½®ç²˜æ€§ä¼šè¯ï¼Œä»¥ä¾¿æ¯ä¸ªä½¿ç”¨è€…éƒ½è¢«ç²¾ç¡®åœ°å‘é€åˆ°ä¸€ä¸ªèŠ‚ç‚¹ã€‚ç¼ºç‚¹åŒ…æ‹¬ç¼ºä¹å®¹é”™æ€§å’ŒèŠ‚ç‚¹è¿‡è½½æ—¶çš„ç¼©æ”¾é—®é¢˜ã€‚ å…è®¸æ›´çµæ´»çš„è´Ÿè½½å¹³è¡¡è§„åˆ™çš„æ›´å¥½è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨é›†ä¸­çš„æ•°æ®å­˜å‚¨ï¼Œå¦‚Redisæˆ–Cassandraã€‚è¿™å°†å­˜å‚¨æ¯ä¸ªçª—å£å’Œæ¶ˆè´¹è€…çš„è®¡æ•°ã€‚è¿™ç§æ–¹æ³•çš„ä¸¤ä¸ªä¸»è¦é—®é¢˜æ˜¯å¢åŠ äº†å‘æ•°æ®å­˜å‚¨å‘å‡ºè¯·æ±‚çš„å»¶è¿Ÿï¼Œä»¥åŠç«äº‰æ¡ä»¶ï¼ˆæˆ‘ä»¬å°†åœ¨ä¸‹é¢è®¨è®ºï¼‰ã€‚ ç«æ€æ¡ä»¶é›†ä¸­å¼æ•°æ®å­˜å‚¨çš„æœ€å¤§é—®é¢˜ä¹‹ä¸€æ˜¯é«˜å¹¶å‘è¯·æ±‚æ¨¡å¼ä¸­çš„ç«äº‰æ¡ä»¶ã€‚å½“ä½ ä½¿ç”¨ä¸€ç§ç®€å•çš„â€œget-then-setâ€æ–¹æ³•æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼Œåœ¨è¿™ç§æ–¹æ³•ä¸­ï¼Œä½ æ£€ç´¢å½“å‰é€Ÿç‡é™åˆ¶è®¡æ•°å™¨ï¼Œå¢åŠ å®ƒçš„å€¼ï¼Œç„¶åå°†å…¶æ¨å›åˆ°æ•°æ®å­˜å‚¨ä¸­ã€‚è¿™ä¸ªæ¨¡å‹çš„é—®é¢˜æ˜¯ï¼Œåœ¨æ‰§è¡Œä¸€ä¸ªå®Œæ•´çš„è¯»é€’å¢å­˜å‚¨å‘¨æœŸæ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°é¢å¤–çš„è¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½è¯•å›¾ç”¨æ— æ•ˆçš„ï¼ˆè¾ƒä½çš„ï¼‰è®¡æ•°å™¨å€¼å­˜å‚¨é€’å¢è®¡æ•°å™¨ã€‚è¿™å…è®¸ä½¿ç”¨è€…å‘é€éå¸¸é«˜çš„è¯·æ±‚ç‡æ¥ç»•è¿‡é€Ÿç‡é™åˆ¶æ§åˆ¶ã€‚ é¿å…è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯åœ¨æœ‰é—®é¢˜çš„å¯†é’¥å‘¨å›´æ”¾ç½®ä¸€ä¸ªâ€œé”â€ï¼Œé˜²æ­¢ä»»ä½•å…¶ä»–è¿›ç¨‹è®¿é—®æˆ–å†™å…¥è®¡æ•°å™¨ã€‚è¿™å°†å¾ˆå¿«æˆä¸ºä¸€ä¸ªä¸»è¦çš„æ€§èƒ½ç“¶é¢ˆï¼Œè€Œä¸”ä¼¸ç¼©æ€§ä¸å¥½ï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨è¯¸å¦‚Redisä¹‹ç±»çš„è¿œç¨‹æœåŠ¡å™¨ä½œä¸ºå¤‡ä»½æ•°æ®å­˜å‚¨æ—¶ã€‚ æ›´å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨â€œå…ˆè®¾ç½®åè·å–â€çš„å¿ƒæ€ï¼Œä¾èµ–äºåŸå­æ“ä½œç¬¦ï¼Œå®ƒä»¬ä»¥ä¸€ç§éå¸¸é«˜æ€§èƒ½çš„æ–¹å¼å®ç°é”ï¼Œå…è®¸ä½ å¿«é€Ÿå¢åŠ å’Œæ£€æŸ¥è®¡æ•°å™¨å€¼ï¼Œè€Œä¸è®©åŸå­æ“ä½œæˆä¸ºéšœç¢ã€‚ æ€§èƒ½ä¼˜åŒ–ä½¿ç”¨é›†ä¸­å¼æ•°æ®å­˜å‚¨çš„å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼Œåœ¨æ£€æŸ¥é€Ÿç‡é™åˆ¶è®¡æ•°å™¨æ—¶å¢åŠ äº†å»¶è¿Ÿã€‚ä¸å¹¸çš„æ˜¯ï¼Œå³ä½¿æ˜¯æ£€æŸ¥åƒRedisè¿™æ ·çš„å¿«é€Ÿæ•°æ®å­˜å‚¨ï¼Œä¹Ÿä¼šå¯¼è‡´æ¯ä¸ªè¯·æ±‚å¢åŠ æ¯«ç§’çš„å»¶è¿Ÿã€‚ ä¸ºäº†ä»¥æœ€å°çš„å»¶è¿Ÿç¡®å®šè¿™äº›é€Ÿç‡é™åˆ¶ï¼Œæœ‰å¿…è¦åœ¨å†…å­˜ä¸­è¿›è¡Œæœ¬åœ°æ£€æŸ¥ã€‚è¿™å¯ä»¥é€šè¿‡æ”¾æ¾é€Ÿç‡æ£€æŸ¥æ¡ä»¶å’Œä½¿ç”¨æœ€ç»ˆä¸€è‡´çš„æ¨¡å‹æ¥å®ç°ã€‚ä¾‹å¦‚ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥åˆ›å»ºä¸€ä¸ªæ•°æ®åŒæ­¥å‘¨æœŸï¼Œè¯¥å‘¨æœŸå°†ä¸ä¸­å¤®æ•°æ®å­˜å‚¨åŒæ­¥ã€‚æ¯ä¸ªèŠ‚ç‚¹å®šæœŸå°†æ¯ä¸ªä½¿ç”¨è€…çš„è®¡æ•°å™¨å¢é‡å’Œå®ƒçœ‹åˆ°çš„çª—å£æ¨é€åˆ°æ•°æ®å­˜å‚¨ï¼Œæ•°æ®å­˜å‚¨å°†è‡ªåŠ¨æ›´æ–°è¿™äº›å€¼ã€‚ç„¶åï¼ŒèŠ‚ç‚¹å¯ä»¥æ£€ç´¢æ›´æ–°åçš„å€¼æ¥æ›´æ–°å…¶å†…å­˜ç‰ˆæœ¬ã€‚é›†ç¾¤å†…èŠ‚ç‚¹ä¹‹é—´çš„è¿™ç§æ”¶æ•›â†’å‘æ•£â†’å†æ”¶æ•›çš„å¾ªç¯æœ€ç»ˆæ˜¯ä¸€è‡´çš„ã€‚ èŠ‚ç‚¹èšåˆçš„å‘¨æœŸé€Ÿç‡åº”è¯¥æ˜¯å¯é…ç½®çš„ã€‚å½“æµé‡åˆ†å¸ƒåœ¨ç¾¤é›†ä¸­çš„å¤šä¸ªèŠ‚ç‚¹ä¸Šæ—¶ï¼ˆä¾‹å¦‚ï¼Œå½“ååœ¨ä¸€ä¸ªè½®è¯¢è°ƒåº¦å¹³è¡¡å™¨åé¢æ—¶ï¼‰ï¼Œè¾ƒçŸ­çš„åŒæ­¥é—´éš”å°†å¯¼è‡´è¾ƒå°‘çš„æ•°æ®ç‚¹åˆ†æ•£ï¼Œè€Œè¾ƒé•¿çš„åŒæ­¥é—´éš”å°†å¯¹æ•°æ®å­˜å‚¨æ–½åŠ è¾ƒå°çš„è¯»/å†™å‹åŠ›ï¼Œæ›´å°‘çš„å¼€é”€åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè·å–æ–°çš„åŒæ­¥å€¼ã€‚ ä½¿ç”¨Kongå¿«é€Ÿè®¾ç½®é€Ÿç‡é™åˆ¶Kongæ˜¯ä¸€ä¸ªå¼€æºçš„APIç½‘å…³ï¼Œå®ƒä½¿æ„å»ºå…·æœ‰é€Ÿç‡é™åˆ¶çš„å¯ä¼¸ç¼©æœåŠ¡å˜å¾—éå¸¸å®¹æ˜“ã€‚å®ƒè¢«å…¨çƒè¶…è¿‡300,000ä¸ªæ´»åŠ¨å®ä¾‹ä½¿ç”¨ã€‚å®ƒå¯ä»¥å®Œç¾åœ°ä»å•ä¸ªçš„KongèŠ‚ç‚¹æ‰©å±•åˆ°å¤§è§„æ¨¡çš„ã€è·¨è¶Šå…¨çƒçš„Kongé›†ç¾¤ã€‚ Kongä½äºAPIå‰é¢ï¼Œæ˜¯ä¸Šæ¸¸APIçš„ä¸»è¦å…¥å£ã€‚åœ¨å¤„ç†è¯·æ±‚å’Œå“åº”æ—¶ï¼ŒKongå°†æ‰§è¡Œä½ å†³å®šæ·»åŠ åˆ°APIä¸­çš„ä»»ä½•æ’ä»¶ã€‚ Kongçš„é€Ÿç‡é™åˆ¶æ’ä»¶æ˜¯é«˜åº¦å¯é…ç½®çš„ã€‚å®ƒæä¾›äº†ä¸ºæ¯ä¸ªAPIå’Œæ¶ˆè´¹è€…å®šä¹‰å¤šä¸ªé€Ÿç‡é™åˆ¶çª—å£å’Œé€Ÿç‡çš„çµæ´»æ€§ã€‚å®ƒæ”¯æŒæœ¬åœ°å†…å­˜ã€Redisã€Postgreså’ŒCassandraå¤‡ä»½æ•°æ®å­˜å‚¨ã€‚å®ƒè¿˜æä¾›äº†å„ç§æ•°æ®åŒæ­¥é€‰é¡¹ï¼ŒåŒ…æ‹¬åŒæ­¥å’Œæœ€ç»ˆä¸€è‡´çš„æ¨¡å‹ã€‚ ä½ å¯ä»¥åœ¨å…¶ä¸­ä¸€å°å¼€å‘æœºå™¨ä¸Šå¿«é€Ÿå®‰è£…Kongæ¥æµ‹è¯•å®ƒã€‚æˆ‘æœ€å–œæ¬¢çš„å…¥é—¨æ–¹å¼æ˜¯ä½¿ç”¨AWSäº‘å½¢æˆæ¨¡æ¿ï¼Œå› ä¸ºåªéœ€å‡ æ¬¡å•å‡»å°±å¯ä»¥è·å¾—é¢„å…ˆé…ç½®å¥½çš„å¼€å‘æœºå™¨ã€‚åªéœ€é€‰æ‹©ä¸€ä¸ªHVMé€‰é¡¹ï¼Œå¹¶å°†å®ä¾‹å¤§å°è®¾ç½®ä¸ºä½¿ç”¨t2.microï¼Œè¿™äº›å¯¹äºæµ‹è¯•éƒ½æ˜¯è´Ÿæ‹…å¾—èµ·çš„ã€‚ç„¶åsshåˆ°æ–°å®ä¾‹ä¸Šçš„å‘½ä»¤è¡Œè¿›è¡Œä¸‹ä¸€æ­¥ã€‚ åœ¨Kongä¸Šæ·»åŠ APIä¸‹ä¸€æ­¥æ˜¯ä½¿ç”¨Kongçš„admin APIåœ¨Kongä¸Šæ·»åŠ ä¸€ä¸ªAPIã€‚æˆ‘ä»¬å°†ä½¿ç”¨httpbinä½œä¸ºç¤ºä¾‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªé’ˆå¯¹APIçš„å…è´¹æµ‹è¯•æœåŠ¡ã€‚get URLå°†æŠŠæˆ‘çš„è¯·æ±‚æ•°æ®é•œåƒæˆJSONã€‚æˆ‘ä»¬è¿˜å‡è®¾Kongåœ¨æœ¬åœ°ç³»ç»Ÿä¸Šçš„é»˜è®¤ç«¯å£ä¸Šè¿è¡Œã€‚ curl -i -X POST \\ --url http://localhost:8001/apis/ \\ --data &#39;name=test&#39; \\ --data &#39;uris=/test&#39; \\ --data &#39;upstream_url=http://httpbin.org/get&#39; ç°åœ¨ Kong æ„è¯†åˆ°æ¯ä¸ªå‘é€åˆ° â€œ/testâ€ çš„è¯·æ±‚éƒ½åº”è¯¥ä»£ç†åˆ° httpbinã€‚æˆ‘ä»¬å¯ä»¥å‘å®ƒçš„ä»£ç†ç«¯å£ä¸Šçš„ Kong å‘å‡ºä»¥ä¸‹è¯·æ±‚æ¥æµ‹è¯•å®ƒï¼š curl http://localhost:8000/test &#123; &quot;args&quot;: &#123;&#125;, &quot;headers&quot;: &#123; &quot;Accept&quot;: &quot;*/*&quot;, &quot;Connection&quot;: &quot;close&quot;, &quot;Host&quot;: &quot;httpbin.org&quot;, &quot;User-Agent&quot;: &quot;curl/7.51.0&quot;, &quot;X-Forwarded-Host&quot;: &quot;localhost&quot; &#125;, &quot;origin&quot;: &quot;localhost, 52.89.171.202&quot;, &quot;url&quot;: &quot;http://localhost/get&quot; &#125; å®ƒè¿˜æ˜¯å¥½çš„ï¼Kong å·²ç»æ¥æ”¶äº†è¯·æ±‚å¹¶å°†å…¶ä»£ç†åˆ° httpbinï¼Œhttpbin å·²å°†æˆ‘çš„è¯·æ±‚å¤´å’Œæˆ‘çš„åŸå§‹ IP åœ°å€è¿›è¡Œäº†é•œåƒã€‚ æ·»åŠ åŸºæœ¬çš„é€Ÿç‡é™åˆ¶è®©æˆ‘ä»¬ç»§ç»­ï¼Œé€šè¿‡ä½¿ç”¨ç¤¾åŒºç‰ˆçš„é™é€Ÿæ’ä»¶ [1] æ·»åŠ é™é€ŸåŠŸèƒ½æ¥ä¿æŠ¤å®ƒä¸å—è¿‡å¤šè¯·æ±‚çš„å½±å“ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…æ¯åˆ†é’Ÿåªèƒ½å‘å‡º 5 ä¸ªè¯·æ±‚ï¼š curl -i -X POST http://localhost:8001/apis/test/plugins/ \\ -d &quot;name=rate-limiting&quot; \\ -d &quot;config.minute=5&quot; å¦‚æœæˆ‘ä»¬ç°åœ¨å‘å‡ºè¶…è¿‡ 5 ä¸ªè¯·æ±‚ï¼ŒKong ä¼šå›å¤ä»¥ä¸‹é”™è¯¯ä¿¡æ¯ï¼š curl http://localhost:8000/test &#123; &quot;message&quot;:&quot;API rate limit exceeded&quot; &#125; çœ‹ä¸Šå»ä¸é”™ï¼æˆ‘ä»¬åœ¨ Kong ä¸Šæ·»åŠ äº†ä¸€ä¸ª APIï¼Œå¹¶ä¸”ä»…åœ¨ä¸¤ä¸ª HTTP è¯·æ±‚ä¸­å‘ Kong çš„ admin API æ·»åŠ äº†é€Ÿç‡é™åˆ¶ã€‚ å®ƒé»˜è®¤ä½¿ç”¨å›ºå®šçš„çª—å£æ¥é™åˆ¶ IP åœ°å€çš„é€Ÿç‡ï¼Œå¹¶ä½¿ç”¨é»˜è®¤çš„æ•°æ®å­˜å‚¨åœ¨é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ä¹‹é—´è¿›è¡ŒåŒæ­¥ã€‚æœ‰å…³å…¶ä»–é€‰é¡¹ï¼ŒåŒ…æ‹¬æ¯ä¸ªç”¨æˆ·çš„é€Ÿç‡é™åˆ¶æˆ–ä½¿ç”¨å…¶ä»–æ•°æ®å­˜å‚¨ï¼ˆå¦‚ Redisï¼‰ï¼Œè¯·å‚é˜…æ–‡æ¡£ [1]ã€‚ ä¼ä¸šç‰ˆ Kongï¼Œæ›´å¥½çš„æ€§èƒ½ä¼ä¸šç‰ˆ [2] çš„é€Ÿç‡é™åˆ¶å¢åŠ äº†å¯¹æ»‘åŠ¨çª—å£ç®—æ³•çš„æ”¯æŒï¼Œä»¥æ›´å¥½åœ°æ§åˆ¶å’Œæ€§èƒ½ã€‚æ»‘åŠ¨çª—å£å¯ä»¥é˜²æ­¢ä½ çš„ API åœ¨çª—å£è¾¹ç•Œé™„è¿‘é‡è½½ï¼Œå¦‚ä¸Šé¢çš„éƒ¨åˆ†æ‰€è¿°ã€‚å¯¹äºä½å»¶è¿Ÿï¼Œå®ƒä½¿ç”¨è®¡æ•°å™¨çš„å†…å­˜è¡¨ï¼Œå¯ä»¥ä½¿ç”¨å¼‚æ­¥æˆ–åŒæ­¥æ›´æ–°è·¨é›†ç¾¤è¿›è¡ŒåŒæ­¥ã€‚è¿™æä¾›äº†æœ¬åœ°é˜ˆå€¼çš„å»¶è¿Ÿï¼Œå¹¶ä¸”å¯ä»¥è·¨æ•´ä¸ªé›†ç¾¤æ‰©å±•ã€‚ ç¬¬ä¸€æ­¥æ˜¯å®‰è£…ä¼ä¸šç‰ˆçš„ Kongã€‚ç„¶åï¼Œå¯ä»¥é…ç½®é€Ÿç‡é™åˆ¶ã€ä»¥ç§’ä¸ºå•ä½çš„çª—å£å¤§å°å’ŒåŒæ­¥è®¡æ•°å™¨å€¼çš„é¢‘ç‡ã€‚å®ƒçœŸçš„å¾ˆå®¹æ˜“ä½¿ç”¨ï¼Œä½ å¯ä»¥å¾—åˆ°è¿™ä¸ªå¼ºå¤§çš„æ§åˆ¶ä¸ä¸€ä¸ªç®€å•çš„ API è°ƒç”¨ï¼š curl -i -X POST http://localhost:8001/apis/test/plugins \\ -d &quot;name=rate-limiting&quot; \\ -d &quot;config.limit=5&quot; \\ -d &quot;config.window_size=60&quot; \\ -d &quot;config.sync_rate=10&quot; ä¼ä¸šè¿˜å¢åŠ äº†å¯¹ Redis Sentinel çš„æ”¯æŒï¼Œè¿™ä½¿å¾— Redis é«˜å¯ç”¨æ€§å’Œæ›´å¼ºçš„å®¹é”™èƒ½åŠ›ã€‚ä½ å¯ä»¥é˜…è¯»æ›´å¤šçš„ä¼ä¸šé€Ÿç‡é™åˆ¶æ’ä»¶æ–‡æ¡£ã€‚ é˜…è¯»åŸæ–‡https://mp.weixin.qq.com/s?__biz=MzA5OTAyNzQ2OA==&mid=2649704593&idx=1&sn=bccc83c5fc87bf4f032f91405be15cd4&scene=21#wechat_redirect'>","categories":[{"name":"è®¾è®¡","slug":"è®¾è®¡","permalink":"https://gyl-coder.top/categories/%E8%AE%BE%E8%AE%A1/"}],"tags":[{"name":"é™æµç®—æ³•","slug":"é™æµç®—æ³•","permalink":"https://gyl-coder.top/tags/%E9%99%90%E6%B5%81%E7%AE%97%E6%B3%95/"},{"name":"è®¾è®¡","slug":"è®¾è®¡","permalink":"https://gyl-coder.top/tags/%E8%AE%BE%E8%AE%A1/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"kafka ä¸»é¢˜ç®¡ç†","slug":"kafka/kafka-topic-manage","date":"2019-12-08T00:00:00.000Z","updated":"2020-12-27T04:47:15.978Z","comments":true,"path":"kafka/kafka-topic-manage/","link":"","permalink":"https://gyl-coder.top/kafka/kafka-topic-manage/","excerpt":"å¯¹äº kafka ä¸»é¢˜ï¼ˆtopicï¼‰çš„ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰ï¼Œä½¿ç”¨æœ€å¤šçš„ä¾¿æ˜¯kafkaè‡ªå¸¦çš„è„šæœ¬ã€‚","text":"å¯¹äº kafka ä¸»é¢˜ï¼ˆtopicï¼‰çš„ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰ï¼Œä½¿ç”¨æœ€å¤šçš„ä¾¿æ˜¯kafkaè‡ªå¸¦çš„è„šæœ¬ã€‚ åˆ›å»ºä¸»é¢˜kafkaæä¾›äº†è‡ªå¸¦çš„ kafka-topics è„šæœ¬ï¼Œç”¨æ¥å¸®åŠ©ç”¨æˆ·åˆ›å»ºä¸»é¢˜ï¼ˆtopicï¼‰ã€‚ bin/kafka-topics.sh --bootstrap-server broker_host:port --create --topic my_topic_name --partitions 1 --replication-factor 1 create è¡¨æ˜æˆ‘ä»¬è¦åˆ›å»ºä¸»é¢˜ï¼Œè€Œ partitions å’Œ replication factor åˆ†åˆ«è®¾ç½®äº†ä¸»é¢˜çš„åˆ†åŒºæ•°ä»¥åŠæ¯ä¸ªåˆ†åŒºä¸‹çš„å‰¯æœ¬æ•°ã€‚ è¿™é‡Œä¸ºä»€ä¹ˆç”¨çš„ --bootstrap-server å‚æ•°ï¼Œè€Œä¸æ˜¯ --zookeeper ?--zookeeper å‚æ•°æ˜¯ä¹‹å‰ç‰ˆæœ¬çš„ç”¨æ³•ï¼Œä»kafka 2.2 ç‰ˆæœ¬å¼€å§‹ï¼Œç¤¾åŒºæ¨èä½¿ç”¨ --bootstrap-server å‚æ•°æ›¿æ¢ --zoookeeper ï¼Œå¹¶ä¸”æ˜¾å¼åœ°å°†åè€…æ ‡è®°ä¸º â€œå·²è¿‡æœŸâ€ï¼Œå› æ­¤ï¼Œå¦‚æœä½ å·²ç»åœ¨ä½¿ç”¨ 2.2 ç‰ˆæœ¬äº†ï¼Œé‚£ä¹ˆåˆ›å»ºä¸»é¢˜è¯·æŒ‡å®š --bootstrap-server å‚æ•°ã€‚ æ¨èä½¿ç”¨ --bootstrap-server è€Œé --zookeeper çš„åŸå› ä¸»è¦æœ‰ä¸¤ä¸ªã€‚ ä½¿ç”¨ â€“zookeeper ä¼šç»•è¿‡ Kafka çš„å®‰å…¨ä½“ç³»ã€‚è¿™å°±æ˜¯è¯´ï¼Œå³ä½¿ä½ ä¸º Kafka é›†ç¾¤è®¾ç½®äº†å®‰å…¨è®¤è¯ï¼Œé™åˆ¶äº†ä¸»é¢˜çš„åˆ›å»ºï¼Œå¦‚æœä½ ä½¿ç”¨ â€“zookeeper çš„å‘½ä»¤ï¼Œä¾ç„¶èƒ½æˆåŠŸåˆ›å»ºä»»æ„ä¸»é¢˜ï¼Œä¸å—è®¤è¯ä½“ç³»çš„çº¦æŸã€‚è¿™æ˜¾ç„¶æ˜¯ Kafka é›†ç¾¤çš„è¿ç»´äººå‘˜ä¸å¸Œæœ›çœ‹åˆ°çš„ã€‚ ä½¿ç”¨ â€“bootstrap-server ä¸é›†ç¾¤è¿›è¡Œäº¤äº’ï¼Œè¶Šæ¥è¶Šæˆä¸ºä½¿ç”¨ Kafka çš„æ ‡å‡†å§¿åŠ¿ã€‚æ¢å¥è¯è¯´ï¼Œä»¥åä¼šæœ‰è¶Šæ¥è¶Šå°‘çš„å‘½ä»¤å’Œ API éœ€è¦ä¸ ZooKeeper è¿›è¡Œè¿æ¥ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€å¥—è¿æ¥ä¿¡æ¯ï¼Œå°±èƒ½ä¸ Kafka è¿›è¡Œå…¨æ–¹ä½çš„äº¤äº’ï¼Œä¸ç”¨åƒä»¥å‰ä¸€æ ·ï¼Œå¿…é¡»åŒæ—¶ç»´æŠ¤ ZooKeeper å’Œ Broker çš„è¿æ¥ä¿¡æ¯ã€‚ æŸ¥è¯¢ä¸»é¢˜åˆ›å»ºå¥½ä¸»é¢˜ä¹‹åï¼ŒKafka å…è®¸æˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„è„šæœ¬æŸ¥è¯¢ä¸»é¢˜ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼ŒæŸ¥è¯¢æ‰€æœ‰ä¸»é¢˜çš„åˆ—è¡¨ã€‚ bin/kafka-topics.sh --bootstrap-server broker_host:port --list å¦‚æœè¦æŸ¥è¯¢å•ä¸ªä¸»é¢˜çš„è¯¦ç»†æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚ bin/kafka-topics.sh --bootstrap-server broker_host:port --describe --topic &lt;topic_name&gt; å¦‚æœ describe å‘½ä»¤ä¸æŒ‡å®šå…·ä½“çš„ä¸»é¢˜åç§°ï¼Œé‚£ä¹ˆ Kafka é»˜è®¤ä¼šè¿”å›æ‰€æœ‰ â€œå¯è§â€ ä¸»é¢˜çš„è¯¦ç»†æ•°æ®ç»™ä½ ã€‚ è¿™é‡Œçš„ â€œå¯è§â€ï¼Œæ˜¯æŒ‡å‘èµ·è¿™ä¸ªå‘½ä»¤çš„ç”¨æˆ·èƒ½å¤Ÿçœ‹åˆ°çš„ Kafka ä¸»é¢˜ã€‚è¿™å’Œå‰é¢è¯´åˆ°ä¸»é¢˜åˆ›å»ºæ—¶ï¼Œä½¿ç”¨ â€“zookeeper å’Œ â€“bootstrap-server çš„åŒºåˆ«æ˜¯ä¸€æ ·çš„ã€‚å¦‚æœæŒ‡å®šäº† â€“bootstrap-serverï¼Œé‚£ä¹ˆè¿™æ¡å‘½ä»¤å°±ä¼šå—åˆ°å®‰å…¨è®¤è¯ä½“ç³»çš„çº¦æŸï¼Œå³å¯¹å‘½ä»¤å‘èµ·è€…è¿›è¡Œæƒé™éªŒè¯ï¼Œç„¶åè¿”å›å®ƒèƒ½çœ‹åˆ°çš„ä¸»é¢˜ã€‚å¦åˆ™ï¼Œå¦‚æœæŒ‡å®š â€“zookeeper å‚æ•°ï¼Œé‚£ä¹ˆé»˜è®¤ä¼šè¿”å›é›†ç¾¤ä¸­æ‰€æœ‰çš„ä¸»é¢˜è¯¦ç»†æ•°æ®ã€‚åŸºäºè¿™äº›åŸå› ï¼Œæˆ‘å»ºè®®ä½ æœ€å¥½ç»Ÿä¸€ä½¿ç”¨ â€“bootstrap-server è¿æ¥å‚æ•°ã€‚ ä¿®æ”¹ä¸»é¢˜ä¿®æ”¹ä¸»é¢˜åˆ†åŒºå…¶å®å°±æ˜¯å¢åŠ åˆ†åŒºï¼Œç›®å‰ Kafka ä¸å…è®¸å‡å°‘æŸä¸ªä¸»é¢˜çš„åˆ†åŒºæ•°ã€‚ä½ å¯ä»¥ä½¿ç”¨ kafka-topics è„šæœ¬ï¼Œç»“åˆ â€“alter å‚æ•°æ¥å¢åŠ æŸä¸ªä¸»é¢˜çš„åˆ†åŒºæ•°ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š bin/kafka-topics.sh --bootstrap-server broker_host:port --alter --topic &lt;topic_name&gt; --partitions &lt; æ–°åˆ†åŒºæ•° &gt; è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œä½ æŒ‡å®šçš„åˆ†åŒºæ•°ä¸€å®šè¦æ¯”åŸæœ‰åˆ†åŒºæ•°å¤§ï¼Œå¦åˆ™ Kafka ä¼šæŠ›å‡º InvalidPartitionsException å¼‚å¸¸ã€‚ ä¿®æ”¹ä¸»é¢˜çº§åˆ«å‚æ•°åœ¨ä¸»é¢˜åˆ›å»ºä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ kafka-configs è„šæœ¬ä¿®æ”¹å¯¹åº”çš„å‚æ•°ã€‚ å‡è®¾æˆ‘ä»¬è¦è®¾ç½®ä¸»é¢˜çº§åˆ«å‚æ•° max.message.bytesï¼Œé‚£ä¹ˆå‘½ä»¤å¦‚ä¸‹ï¼š bin/kafka-configs.sh --zookeeper zookeeper_host:port --entity-type topics --entity-name &lt;topic_name&gt; --alter --add-config max.message.bytes=10485760 ä¹Ÿè®¸ä½ ä¼šè§‰å¾—å¥‡æ€ªï¼Œä¸ºä»€ä¹ˆè¿™ä¸ªè„šæœ¬å°±è¦æŒ‡å®š â€“zookeeperï¼Œè€Œä¸æ˜¯ â€“bootstrap-server å‘¢ï¼Ÿå…¶å®ï¼Œè¿™ä¸ªè„šæœ¬ä¹Ÿèƒ½æŒ‡å®š â€“bootstrap-server å‚æ•°ï¼Œåªæ˜¯å®ƒæ˜¯ç”¨æ¥è®¾ç½®åŠ¨æ€å‚æ•°çš„ã€‚åœ¨ä¸“æ åé¢ï¼Œæˆ‘ä¼šè¯¦ç»†ä»‹ç»ä»€ä¹ˆæ˜¯åŠ¨æ€å‚æ•°ï¼Œä»¥åŠåŠ¨æ€å‚æ•°éƒ½æœ‰å“ªäº›ã€‚ç°åœ¨ï¼Œä½ åªéœ€è¦äº†è§£è®¾ç½®å¸¸è§„çš„ä¸»é¢˜çº§åˆ«å‚æ•°ï¼Œè¿˜æ˜¯ä½¿ç”¨ â€“zookeeperã€‚ å˜æ›´å‰¯æœ¬æ•°ä½¿ç”¨è‡ªå¸¦çš„ kafka-reassign-partitions è„šæœ¬ï¼Œå¸®åŠ©æˆ‘ä»¬å¢åŠ ä¸»é¢˜çš„å‰¯æœ¬æ•°ã€‚ å‡è®¾kafkaçš„å†…éƒ¨ä¸»é¢˜ __consumer_offsets åªæœ‰ 1 ä¸ªå‰¯æœ¬ï¼Œç°åœ¨æˆ‘ä»¬æƒ³è¦å¢åŠ è‡³ 3 ä¸ªå‰¯æœ¬ã€‚ä¸‹é¢æ˜¯æ“ä½œï¼š åˆ›å»ºä¸€ä¸ª json æ–‡ä»¶ï¼Œæ˜¾å¼æä¾› 50 ä¸ªåˆ†åŒºå¯¹åº”çš„å‰¯æœ¬æ•°ã€‚æ³¨æ„ï¼Œreplicas ä¸­çš„ 3 å° Broker æ’åˆ—é¡ºåºä¸åŒï¼Œç›®çš„æ˜¯å°† Leader å‰¯æœ¬å‡åŒ€åœ°åˆ†æ•£åœ¨ Broker ä¸Šã€‚è¯¥æ–‡ä»¶å…·ä½“æ ¼å¼å¦‚ä¸‹ &#123;&quot;version&quot;:1, &quot;partitions&quot;:[ &#123;&quot;topic&quot;:&quot;__consumer_offsets&quot;,&quot;partition&quot;:0,&quot;replicas&quot;:[0,1,2]&#125;, &#123;&quot;topic&quot;:&quot;__consumer_offsets&quot;,&quot;partition&quot;:1,&quot;replicas&quot;:[0,2,1]&#125;, &#123;&quot;topic&quot;:&quot;__consumer_offsets&quot;,&quot;partition&quot;:2,&quot;replicas&quot;:[1,0,2]&#125;, &#123;&quot;topic&quot;:&quot;__consumer_offsets&quot;,&quot;partition&quot;:3,&quot;replicas&quot;:[1,2,0]&#125;, ... &#123;&quot;topic&quot;:&quot;__consumer_offsets&quot;,&quot;partition&quot;:49,&quot;replicas&quot;:[0,1,2]&#125; ]&#125; æ‰§è¡Œ kafka-reassign-patitions è„šæœ¬ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š bin/kafka-reassign-partitions.sh --zookeeper zookeeper_host:port --reassignment-json-file reassign.json --execute é™¤äº†ä¿®æ”¹å†…éƒ¨ä¸»é¢˜ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜æƒ³æŸ¥çœ‹è¿™äº›å†…éƒ¨ä¸»é¢˜çš„æ¶ˆæ¯å†…å®¹ã€‚ç‰¹åˆ«æ˜¯å¯¹äº __consumer_offsets è€Œè¨€ï¼Œç”±äºå®ƒä¿å­˜äº†æ¶ˆè´¹è€…ç»„çš„ä½ç§»æ•°æ®ï¼Œæœ‰æ—¶å€™ç›´æ¥æŸ¥çœ‹è¯¥ä¸»é¢˜æ¶ˆæ¯æ˜¯å¾ˆæ–¹ä¾¿çš„äº‹æƒ…ã€‚ä¸‹é¢çš„å‘½ä»¤å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç›´æ¥æŸ¥çœ‹æ¶ˆè´¹è€…ç»„æäº¤çš„ä½ç§»æ•°æ®ã€‚ bin/kafka-console-consumer.sh --bootstrap-server kafka_host:port --topic __consumer_offsets --formatter &quot;kafka.coordinator.group.GroupMetadataManager\\$OffsetsMessageFormatter&quot; --from-beginning é™¤äº†æŸ¥çœ‹ä½ç§»æäº¤æ•°æ®ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥è¯»å–è¯¥ä¸»é¢˜æ¶ˆæ¯ï¼ŒæŸ¥çœ‹æ¶ˆè´¹è€…ç»„çš„çŠ¶æ€ä¿¡æ¯ã€‚ bin/kafka-console-consumer.sh --bootstrap-server kafka_host:port --topic __consumer_offsets --formatter &quot;kafka.coordinator.group.GroupMetadataManager\\$GroupMetadataMessageFormatter&quot; --from-beginning å¯¹äºå†…éƒ¨ä¸»é¢˜ __transaction_state è€Œè¨€ï¼Œæ–¹æ³•æ˜¯ç›¸åŒçš„ã€‚ä½ åªéœ€è¦æŒ‡å®š kafka.coordinator.transaction.TransactionLog$TransactionLogMessageFormatter å³å¯ã€‚ ä¿®æ”¹ä¸»é¢˜é™é€Ÿè¿™é‡Œä¸»è¦æ˜¯æŒ‡è®¾ç½® Leader å‰¯æœ¬å’Œ Follower å‰¯æœ¬ä½¿ç”¨çš„å¸¦å®½ã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è¦è®©æŸä¸ªä¸»é¢˜çš„å‰¯æœ¬åœ¨æ‰§è¡Œå‰¯æœ¬åŒæ­¥æœºåˆ¶æ—¶ï¼Œä¸è¦æ¶ˆè€—è¿‡å¤šçš„å¸¦å®½ã€‚Kafka æä¾›äº†è¿™æ ·çš„åŠŸèƒ½ã€‚æˆ‘æ¥ä¸¾ä¸ªä¾‹å­ã€‚å‡è®¾æˆ‘æœ‰ä¸ªä¸»é¢˜ï¼Œåä¸º testï¼Œæˆ‘æƒ³è®©è¯¥ä¸»é¢˜å„ä¸ªåˆ†åŒºçš„ Leader å‰¯æœ¬å’Œ Follower å‰¯æœ¬åœ¨å¤„ç†å‰¯æœ¬åŒæ­¥æ—¶ï¼Œä¸å¾—å ç”¨è¶…è¿‡ 100MBps çš„å¸¦å®½ã€‚æ³¨æ„æ˜¯å¤§å†™ Bï¼Œå³æ¯ç§’ä¸è¶…è¿‡ 100MBã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆè®¾ç½®å‘¢ï¼Ÿ è¦è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆè®¾ç½® Broker ç«¯å‚æ•° leader.replication.throttled.rate å’Œ follower.replication.throttled.rateï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š bin/kafka-configs.sh --zookeeper zookeeper_host:port --alter --add-config &#39;leader.replication.throttled.rate=104857600,follower.replication.throttled.rate=104857600&#39; --entity-type brokers --entity-name 0 è¿™æ¡å‘½ä»¤ç»“å°¾å¤„çš„ â€“entity-name å°±æ˜¯ Broker IDã€‚å€˜è‹¥è¯¥ä¸»é¢˜çš„å‰¯æœ¬åˆ†åˆ«åœ¨ 0ã€1ã€2ã€3 å¤šä¸ª Broker ä¸Šï¼Œé‚£ä¹ˆä½ è¿˜è¦ä¾æ¬¡ä¸º Broker 1ã€2ã€3 æ‰§è¡Œè¿™æ¡å‘½ä»¤ã€‚ è®¾ç½®å¥½è¿™ä¸ªå‚æ•°ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸ºè¯¥ä¸»é¢˜è®¾ç½®è¦é™é€Ÿçš„å‰¯æœ¬ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦ä¸ºæ‰€æœ‰å‰¯æœ¬éƒ½è®¾ç½®é™é€Ÿï¼Œå› æ­¤ç»Ÿä¸€ä½¿ç”¨é€šé…ç¬¦ * æ¥è¡¨ç¤ºï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š bin/kafka-configs.sh --zookeeper zookeeper_host:port --alter --add-config &#39;leader.replication.throttled.replicas=*,follower.replication.throttled.replicas=*&#39; --entity-type topics --entity-name test ä¸»é¢˜åˆ†åŒºè¿ç§»åŒæ ·æ˜¯ä½¿ç”¨ kafka-reassign-partitions è„šæœ¬ï¼Œå¯¹ä¸»é¢˜å„ä¸ªåˆ†åŒºçš„å‰¯æœ¬è¿›è¡Œ â€œæ‰‹æœ¯â€ èˆ¬çš„è°ƒæ•´ï¼Œæ¯”å¦‚æŠŠæŸäº›åˆ†åŒºæ‰¹é‡è¿ç§»åˆ°å…¶ä»– Broker ä¸Šã€‚ åˆ é™¤ä¸»é¢˜bin/kafka-topics.sh --bootstrap-server broker_host:port --delete --topic &lt;topic_name&gt; åˆ é™¤ä¸»é¢˜çš„å‘½ä»¤å¹¶ä¸å¤æ‚ï¼Œå…³é”®æ˜¯åˆ é™¤æ“ä½œæ˜¯å¼‚æ­¥çš„ï¼Œæ‰§è¡Œå®Œè¿™æ¡å‘½ä»¤ä¸ä»£è¡¨ä¸»é¢˜ç«‹å³å°±è¢«åˆ é™¤äº†ã€‚å®ƒä»…ä»…æ˜¯è¢«æ ‡è®°æˆ â€œå·²åˆ é™¤â€ çŠ¶æ€è€Œå·²ã€‚Kafka ä¼šåœ¨åå°é»˜é»˜åœ°å¼€å¯ä¸»é¢˜åˆ é™¤æ“ä½œã€‚å› æ­¤ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œä½ éƒ½éœ€è¦è€å¿ƒåœ°ç­‰å¾…ä¸€æ®µæ—¶é—´ã€‚ ä¸»é¢˜åˆ é™¤å¤±è´¥å½“è¿è¡Œå®Œä¸Šé¢çš„åˆ é™¤å‘½ä»¤åï¼Œå¾ˆå¤šäººå‘ç°å·²åˆ é™¤ä¸»é¢˜çš„åˆ†åŒºæ•°æ®ä¾ç„¶ â€œèººåœ¨â€ ç¡¬ç›˜ä¸Šï¼Œæ²¡æœ‰è¢«æ¸…é™¤ã€‚è¿™æ—¶è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ å®é™…ä¸Šï¼Œé€ æˆä¸»é¢˜åˆ é™¤å¤±è´¥çš„åŸå› æœ‰å¾ˆå¤šï¼Œæœ€å¸¸è§çš„åŸå› æœ‰ä¸¤ä¸ªï¼š å‰¯æœ¬æ‰€åœ¨çš„ Broker å®•æœºäº† å¾…åˆ é™¤ä¸»é¢˜çš„éƒ¨åˆ†åˆ†åŒºä¾ç„¶åœ¨æ‰§è¡Œè¿ç§»è¿‡ç¨‹ã€‚ å¦‚æœæ˜¯å› ä¸ºå‰è€…ï¼Œé€šå¸¸ä½ é‡å¯å¯¹åº”çš„ Broker ä¹‹åï¼Œåˆ é™¤æ“ä½œå°±èƒ½è‡ªåŠ¨æ¢å¤ï¼›å¦‚æœæ˜¯å› ä¸ºåè€…ï¼Œé‚£å°±éº»çƒ¦äº†ï¼Œå¾ˆå¯èƒ½ä¸¤ä¸ªæ“ä½œä¼šç›¸äº’å¹²æ‰°ã€‚ ä¸ç®¡ä»€ä¹ˆåŸå› ï¼Œä¸€æ—¦ä½ ç¢°åˆ°ä¸»é¢˜æ— æ³•åˆ é™¤çš„é—®é¢˜ï¼Œå¯ä»¥é‡‡ç”¨è¿™æ ·çš„æ–¹æ³•ï¼š æ‰‹åŠ¨åˆ é™¤ ZooKeeper èŠ‚ç‚¹ /admin/delete_topics ä¸‹ä»¥å¾…åˆ é™¤ä¸»é¢˜ä¸ºåçš„ znodeã€‚ æ‰‹åŠ¨åˆ é™¤è¯¥ä¸»é¢˜åœ¨ç£ç›˜ä¸Šçš„åˆ†åŒºç›®å½•ã€‚ åœ¨ ZooKeeper ä¸­æ‰§è¡Œ rmr /controllerï¼Œè§¦å‘ Controller é‡é€‰ä¸¾ï¼Œåˆ·æ–° Controller ç¼“å­˜ã€‚ åœ¨æ‰§è¡Œæœ€åä¸€æ­¥æ—¶ï¼Œä½ ä¸€å®šè¦è°¨æ…ï¼Œå› ä¸ºå®ƒå¯èƒ½é€ æˆå¤§é¢ç§¯çš„åˆ†åŒº Leader é‡é€‰ä¸¾ã€‚äº‹å®ä¸Šï¼Œä»…ä»…æ‰§è¡Œå‰ä¸¤æ­¥ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œåªæ˜¯ Controller ç¼“å­˜ä¸­æ²¡æœ‰æ¸…ç©ºå¾…åˆ é™¤ä¸»é¢˜ç½¢äº†ï¼Œä¹Ÿä¸å½±å“ä½¿ç”¨ã€‚ å¸¸è§é—®é¢˜__consumer_offsets å ç”¨å¤ªå¤šçš„ç£ç›˜ä¸€æ—¦ä½ å‘ç°è¿™ä¸ªä¸»é¢˜æ¶ˆè€—äº†è¿‡å¤šçš„ç£ç›˜ç©ºé—´ï¼Œé‚£ä¹ˆï¼Œä½ ä¸€å®šè¦æ˜¾å¼åœ°ç”¨ jstack å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹ kafka-log-cleaner-thread å‰ç¼€çš„çº¿ç¨‹çŠ¶æ€ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™éƒ½æ˜¯å› ä¸ºè¯¥çº¿ç¨‹æŒ‚æ‰äº†ï¼Œæ— æ³•åŠæ—¶æ¸…ç†æ­¤å†…éƒ¨ä¸»é¢˜ã€‚å€˜è‹¥çœŸæ˜¯è¿™ä¸ªåŸå› å¯¼è‡´çš„ï¼Œé‚£æˆ‘ä»¬å°±åªèƒ½é‡å¯ç›¸åº”çš„ Broker äº†ã€‚å¦å¤–ï¼Œè¯·ä½ æ³¨æ„ä¿ç•™å‡ºé”™æ—¥å¿—ï¼Œå› ä¸ºè¿™é€šå¸¸éƒ½æ˜¯ Bug å¯¼è‡´çš„ï¼Œæœ€å¥½æäº¤åˆ°ç¤¾åŒºçœ‹ä¸€ä¸‹ã€‚","categories":[{"name":"kafka","slug":"kafka","permalink":"https://gyl-coder.top/categories/kafka/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://gyl-coder.top/tags/kafka/"},{"name":"topic","slug":"topic","permalink":"https://gyl-coder.top/tags/topic/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.github.io"}},{"title":"kafka é—®é¢˜æ€»ç»“","slug":"kafka/kafka-todo-list","date":"2019-12-07T00:00:00.000Z","updated":"2020-12-27T04:47:15.978Z","comments":true,"path":"kafka/kafka-todo-list/","link":"","permalink":"https://gyl-coder.top/kafka/kafka-todo-list/","excerpt":"Kafkaä¸­çš„åŸºæœ¬æ¦‚å¿µ Kafkaä¸­çš„ISRã€ARåˆä»£è¡¨ä»€ä¹ˆï¼ŸISRçš„ä¼¸ç¼©åˆæŒ‡ä»€ä¹ˆï¼Ÿ Kafkaä¸­çš„HWã€LEOã€LSOç­‰åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Ÿ kafkaå¦‚ä½•ä¿è¯æ•°æ®å¯é æ€§å’Œæ•°æ®ä¸€è‡´æ€§ Kafka Rebalanceæœºåˆ¶åˆ†æ kafka ä¸»é¢˜ç®¡ç† Kafkaæœ‰å“ªå‡ å¤„åœ°æ–¹æœ‰åˆ†åŒºåˆ†é…çš„æ¦‚å¿µï¼Ÿç®€è¿°å¤§è‡´çš„è¿‡ç¨‹åŠåŸç† Kafkaä¸­æ˜¯æ€ä¹ˆä½“ç°æ¶ˆæ¯é¡ºåºæ€§çš„ï¼Ÿ","text":"Kafkaä¸­çš„åŸºæœ¬æ¦‚å¿µ Kafkaä¸­çš„ISRã€ARåˆä»£è¡¨ä»€ä¹ˆï¼ŸISRçš„ä¼¸ç¼©åˆæŒ‡ä»€ä¹ˆï¼Ÿ Kafkaä¸­çš„HWã€LEOã€LSOç­‰åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Ÿ kafkaå¦‚ä½•ä¿è¯æ•°æ®å¯é æ€§å’Œæ•°æ®ä¸€è‡´æ€§ Kafka Rebalanceæœºåˆ¶åˆ†æ kafka ä¸»é¢˜ç®¡ç† Kafkaæœ‰å“ªå‡ å¤„åœ°æ–¹æœ‰åˆ†åŒºåˆ†é…çš„æ¦‚å¿µï¼Ÿç®€è¿°å¤§è‡´çš„è¿‡ç¨‹åŠåŸç† Kafkaä¸­æ˜¯æ€ä¹ˆä½“ç°æ¶ˆæ¯é¡ºåºæ€§çš„ï¼Ÿ Kafkaçš„ç”¨é€”æœ‰å“ªäº›ï¼Ÿä½¿ç”¨åœºæ™¯å¦‚ä½•ï¼Ÿ Kafkaç”Ÿäº§è€…å®¢æˆ·ç«¯çš„æ•´ä½“ç»“æ„æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ Kafkaç”Ÿäº§è€…å®¢æˆ·ç«¯ä¸­ä½¿ç”¨äº†å‡ ä¸ªçº¿ç¨‹æ¥å¤„ç†ï¼Ÿåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ Kafkaä¸­çš„åˆ†åŒºå™¨ã€åºåˆ—åŒ–å™¨ã€æ‹¦æˆªå™¨æ˜¯å¦äº†è§£ï¼Ÿå®ƒä»¬ä¹‹é—´çš„å¤„ç†é¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿ æ¶ˆè´¹å†å‡è¡¡çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆæç¤ºï¼šæ¶ˆè´¹è€…åè°ƒå™¨å’Œæ¶ˆè´¹ç»„åè°ƒå™¨ï¼‰ â€œæ¶ˆè´¹ç»„ä¸­çš„æ¶ˆè´¹è€…ä¸ªæ•°å¦‚æœè¶…è¿‡topicçš„åˆ†åŒºï¼Œé‚£ä¹ˆå°±ä¼šæœ‰æ¶ˆè´¹è€…æ¶ˆè´¹ä¸åˆ°æ•°æ®â€ è¿™å¥è¯æ˜¯å¦æ­£ç¡®ï¼Ÿå¦‚æœæ­£ç¡®ï¼Œé‚£æœ‰æ²¡æœ‰ä»€ä¹ˆhackçš„æ‰‹æ®µï¼Ÿ Kafkaçš„æ—§ç‰ˆScalaçš„æ¶ˆè´¹è€…å®¢æˆ·ç«¯çš„è®¾è®¡æœ‰ä»€ä¹ˆç¼ºé™·ï¼Ÿ æ¶ˆè´¹è€…æäº¤æ¶ˆè´¹ä½ç§»æ—¶æäº¤çš„æ˜¯å½“å‰æ¶ˆè´¹åˆ°çš„æœ€æ–°æ¶ˆæ¯çš„offsetè¿˜æ˜¯offset+1? æœ‰å“ªäº›æƒ…å½¢ä¼šé€ æˆé‡å¤æ¶ˆè´¹ï¼Ÿ é‚£äº›æƒ…æ™¯ä¸‹ä¼šé€ æˆæ¶ˆæ¯æ¼æ¶ˆè´¹ï¼Ÿ KafkaConsumeræ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œé‚£ä¹ˆæ€ä¹ˆæ ·å®ç°å¤šçº¿ç¨‹æ¶ˆè´¹ï¼Ÿ ç®€è¿°æ¶ˆè´¹è€…ä¸æ¶ˆè´¹ç»„ä¹‹é—´çš„å…³ç³» å½“ä½ ä½¿ç”¨kafka-topics.shåˆ›å»ºï¼ˆåˆ é™¤ï¼‰äº†ä¸€ä¸ªtopicä¹‹åï¼ŒKafkaèƒŒåä¼šæ‰§è¡Œä»€ä¹ˆé€»è¾‘ï¼Ÿ topicçš„åˆ†åŒºæ•°å¯ä¸å¯ä»¥å¢åŠ ï¼Ÿå¦‚æœå¯ä»¥æ€ä¹ˆå¢åŠ ï¼Ÿå¦‚æœä¸å¯ä»¥ï¼Œé‚£åˆæ˜¯ä¸ºä»€ä¹ˆï¼Ÿ topicçš„åˆ†åŒºæ•°å¯ä¸å¯ä»¥å‡å°‘ï¼Ÿå¦‚æœå¯ä»¥æ€ä¹ˆå‡å°‘ï¼Ÿå¦‚æœä¸å¯ä»¥ï¼Œé‚£åˆæ˜¯ä¸ºä»€ä¹ˆï¼Ÿ åˆ›å»ºtopicæ—¶å¦‚ä½•é€‰æ‹©åˆé€‚çš„åˆ†åŒºæ•°ï¼Ÿ Kafkaç›®å‰æœ‰é‚£äº›å†…éƒ¨topicï¼Œå®ƒä»¬éƒ½æœ‰ä»€ä¹ˆç‰¹å¾ï¼Ÿå„è‡ªçš„ä½œç”¨åˆæ˜¯ä»€ä¹ˆï¼Ÿ ä¼˜å…ˆå‰¯æœ¬æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰ä»€ä¹ˆç‰¹æ®Šçš„ä½œç”¨ï¼Ÿ ä¸ºä»€ä¹ˆKafkaä¸æ”¯æŒè¯»å†™åˆ†ç¦»ï¼Ÿ Kafkaä¸­æœ‰é‚£äº›åœ°æ–¹éœ€è¦é€‰ä¸¾ï¼Ÿè¿™äº›åœ°æ–¹çš„é€‰ä¸¾ç­–ç•¥åˆæœ‰å“ªäº›ï¼Ÿ å¤±æ•ˆå‰¯æœ¬æ˜¯æŒ‡ä»€ä¹ˆï¼Ÿæœ‰é‚£äº›åº”å¯¹æªæ–½ï¼Ÿ å¤šå‰¯æœ¬ä¸‹ï¼Œå„ä¸ªå‰¯æœ¬ä¸­çš„HWå’ŒLEOçš„æ¼”å˜è¿‡ç¨‹ èŠä¸€èŠKafkaæ§åˆ¶å™¨çš„ä½œç”¨ ç®€è¿°Kafkaçš„æ—¥å¿—ç›®å½•ç»“æ„ Kafkaä¸­æœ‰é‚£äº›ç´¢å¼•æ–‡ä»¶ï¼Ÿ å¦‚æœæˆ‘æŒ‡å®šäº†ä¸€ä¸ªoffsetï¼ŒKafkaæ€ä¹ˆæŸ¥æ‰¾åˆ°å¯¹åº”çš„æ¶ˆæ¯ï¼Ÿ å¦‚æœæˆ‘æŒ‡å®šäº†ä¸€ä¸ªtimestampï¼ŒKafkaæ€ä¹ˆæŸ¥æ‰¾åˆ°å¯¹åº”çš„æ¶ˆæ¯ï¼Ÿ èŠä¸€èŠä½ å¯¹Kafkaçš„Log Retentionçš„ç†è§£ èŠä¸€èŠä½ å¯¹Kafkaçš„Log Compactionçš„ç†è§£ èŠä¸€èŠä½ å¯¹Kafkaåº•å±‚å­˜å‚¨çš„ç†è§£ï¼ˆé¡µç¼“å­˜ã€å†…æ ¸å±‚ã€å—å±‚ã€è®¾å¤‡å±‚ï¼‰ èŠä¸€èŠKafkaçš„å»¶æ—¶æ“ä½œçš„åŸç† Kafkaä¸­çš„å¹‚ç­‰æ˜¯æ€ä¹ˆå®ç°çš„ Kafkaä¸­çš„äº‹åŠ¡æ˜¯æ€ä¹ˆå®ç°çš„ï¼ˆè¿™é¢˜æˆ‘å»é¢è¯•6åŠ è¢«é—®4æ¬¡ï¼Œç…§ç€ç­”æ¡ˆå¿µä¹Ÿè¦å¿µåå‡ åˆ†é’Ÿï¼Œé¢è¯•å®˜ç®€ç›´å‡‘ä¸è¦è„¸) Kafkaä¸­æ€ä¹ˆå®ç°æ­»ä¿¡é˜Ÿåˆ—å’Œé‡è¯•é˜Ÿåˆ—ï¼Ÿ Kafkaä¸­çš„å»¶è¿Ÿé˜Ÿåˆ—æ€ä¹ˆå®ç°ï¼ˆè¿™é¢˜è¢«é—®çš„æ¯”äº‹åŠ¡é‚£é¢˜è¿˜è¦å¤šï¼ï¼ï¼å¬è¯´ä½ ä¼šKafkaï¼Œé‚£ä½ è¯´è¯´å»¶è¿Ÿé˜Ÿåˆ—æ€ä¹ˆå®ç°ï¼Ÿï¼‰ Kafkaä¸­æ€ä¹ˆåšæ¶ˆæ¯å®¡è®¡ï¼Ÿ Kafkaä¸­æ€ä¹ˆåšæ¶ˆæ¯è½¨è¿¹ï¼Ÿ Kafkaä¸­æœ‰é‚£äº›é…ç½®å‚æ•°æ¯”è¾ƒæœ‰æ„æ€ï¼ŸèŠä¸€èŠä½ çš„çœ‹æ³• Kafkaä¸­æœ‰é‚£äº›å‘½åæ¯”è¾ƒæœ‰æ„æ€ï¼ŸèŠä¸€èŠä½ çš„çœ‹æ³• Kafkaæœ‰å“ªäº›æŒ‡æ ‡éœ€è¦ç€é‡å…³æ³¨ï¼Ÿ æ€ä¹ˆè®¡ç®—Lagï¼Ÿ(æ³¨æ„read_uncommittedå’Œread_committedçŠ¶æ€ä¸‹çš„ä¸åŒ) Kafkaçš„é‚£äº›è®¾è®¡è®©å®ƒæœ‰å¦‚æ­¤é«˜çš„æ€§èƒ½ï¼Ÿ Kafkaæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ è¿˜ç”¨è¿‡ä»€ä¹ˆåŒè´¨ç±»çš„å…¶å®ƒäº§å“ï¼Œä¸Kafkaç›¸æ¯”æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ ä¸ºä»€ä¹ˆé€‰æ‹©Kafka? åœ¨ä½¿ç”¨Kafkaçš„è¿‡ç¨‹ä¸­é‡åˆ°è¿‡ä»€ä¹ˆå›°éš¾ï¼Ÿæ€ä¹ˆè§£å†³çš„ï¼Ÿ æ€ä¹ˆæ ·æ‰èƒ½ç¡®ä¿Kafkaæå¤§ç¨‹åº¦ä¸Šçš„å¯é æ€§ï¼Ÿ èŠä¸€èŠä½ å¯¹Kafkaç”Ÿæ€çš„ç†è§£","categories":[{"name":"kafka","slug":"kafka","permalink":"https://gyl-coder.top/categories/kafka/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://gyl-coder.top/tags/kafka/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.github.io"}},{"title":"kafka å¦‚ä½•ä¿éšœæ•°æ®å¯é æ€§ï¼Ÿ","slug":"kafka/kafka-reliability","date":"2019-12-06T00:00:00.000Z","updated":"2020-12-27T04:47:15.978Z","comments":true,"path":"kafka/kafka-reliability/","link":"","permalink":"https://gyl-coder.top/kafka/kafka-reliability/","excerpt":"Kafka ä¸­é‡‡ç”¨äº†å¤šå‰¯æœ¬çš„æœºåˆ¶ï¼Œè¿™æ˜¯å¤§å¤šæ•°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æƒ¯ç”¨çš„æ‰‹æ³•ï¼Œä»¥æ­¤æ¥å®ç°æ°´å¹³æ‰©å±•ã€æä¾›å®¹ç¾èƒ½åŠ›ã€æå‡å¯ç”¨æ€§å’Œå¯é æ€§ç­‰ã€‚ æˆ‘ä»¬å¯¹æ­¤å¯ä»¥å¼•ç”³å‡ºä¸€ç³»åˆ—çš„ç–‘é—®ï¼š Kafka å¤šå‰¯æœ¬ä¹‹é—´å¦‚ä½•è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œå°¤å…¶æ˜¯åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶å€™çš„å¤„ç†æœºåˆ¶åˆæ˜¯ä»€ä¹ˆï¼Ÿ å¤šå‰¯æœ¬é—´çš„æ•°æ®ä¸€è‡´æ€§å¦‚ä½•è§£å†³ï¼ŒåŸºäºçš„ä¸€è‡´æ€§åè®®åˆæ˜¯ä»€ä¹ˆï¼Ÿ å¦‚ä½•ç¡®ä¿Kafka çš„å¯é æ€§ï¼Ÿ Kafka ä¸­çš„å¯é æ€§å’Œå¯ç”¨æ€§ä¹‹é—´çš„å…³ç³»åˆå¦‚ä½•ï¼Ÿ ä¸‹é¢ä»å‰¯æœ¬çš„è§’åº¦åˆ‡å…¥æ¥çœ‹çœ‹Kafkaå¦‚ä½•ä¿éšœæ•°æ®ä¸€è‡´æ€§ã€æ•°æ®å¯é æ€§ç­‰é—®é¢˜ï¼Œä¸»è¦åŒ…æ‹¬å‰¯æœ¬å‰–æã€æ—¥å¿—åŒæ­¥æœºåˆ¶å’Œå¯é æ€§åˆ†æç­‰å†…å®¹ã€‚","text":"Kafka ä¸­é‡‡ç”¨äº†å¤šå‰¯æœ¬çš„æœºåˆ¶ï¼Œè¿™æ˜¯å¤§å¤šæ•°åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æƒ¯ç”¨çš„æ‰‹æ³•ï¼Œä»¥æ­¤æ¥å®ç°æ°´å¹³æ‰©å±•ã€æä¾›å®¹ç¾èƒ½åŠ›ã€æå‡å¯ç”¨æ€§å’Œå¯é æ€§ç­‰ã€‚ æˆ‘ä»¬å¯¹æ­¤å¯ä»¥å¼•ç”³å‡ºä¸€ç³»åˆ—çš„ç–‘é—®ï¼š Kafka å¤šå‰¯æœ¬ä¹‹é—´å¦‚ä½•è¿›è¡Œæ•°æ®åŒæ­¥ï¼Œå°¤å…¶æ˜¯åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶å€™çš„å¤„ç†æœºåˆ¶åˆæ˜¯ä»€ä¹ˆï¼Ÿ å¤šå‰¯æœ¬é—´çš„æ•°æ®ä¸€è‡´æ€§å¦‚ä½•è§£å†³ï¼ŒåŸºäºçš„ä¸€è‡´æ€§åè®®åˆæ˜¯ä»€ä¹ˆï¼Ÿ å¦‚ä½•ç¡®ä¿Kafka çš„å¯é æ€§ï¼Ÿ Kafka ä¸­çš„å¯é æ€§å’Œå¯ç”¨æ€§ä¹‹é—´çš„å…³ç³»åˆå¦‚ä½•ï¼Ÿ ä¸‹é¢ä»å‰¯æœ¬çš„è§’åº¦åˆ‡å…¥æ¥çœ‹çœ‹Kafkaå¦‚ä½•ä¿éšœæ•°æ®ä¸€è‡´æ€§ã€æ•°æ®å¯é æ€§ç­‰é—®é¢˜ï¼Œä¸»è¦åŒ…æ‹¬å‰¯æœ¬å‰–æã€æ—¥å¿—åŒæ­¥æœºåˆ¶å’Œå¯é æ€§åˆ†æç­‰å†…å®¹ã€‚ å‰¯æœ¬å‰–æå‰¯æœ¬ï¼ˆReplicaï¼‰æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¸¸è§çš„æ¦‚å¿µä¹‹ä¸€ï¼ŒæŒ‡çš„æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå¯¹æ•°æ®å’ŒæœåŠ¡æä¾›çš„ä¸€ç§å†—ä½™æ–¹å¼ã€‚åœ¨å¸¸è§çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸ºäº†å¯¹å¤–æä¾›å¯ç”¨çš„æœåŠ¡ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šå¯¹æ•°æ®å’ŒæœåŠ¡è¿›è¡Œå‰¯æœ¬å¤„ç†ã€‚æ•°æ®å‰¯æœ¬æ˜¯æŒ‡åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸ŠæŒä¹…åŒ–åŒä¸€ä»½æ•°æ®ï¼Œå½“æŸä¸€ä¸ªèŠ‚ç‚¹ä¸Šå­˜å‚¨çš„æ•°æ®ä¸¢å¤±æ—¶ï¼Œå¯ä»¥ä»å‰¯æœ¬ä¸Šè¯»å–è¯¥æ•°æ®ï¼Œè¿™æ˜¯è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿæ•°æ®ä¸¢å¤±é—®é¢˜æœ€æœ‰æ•ˆçš„æ‰‹æ®µã€‚å¦ä¸€ç±»å‰¯æœ¬æ˜¯æœåŠ¡å‰¯æœ¬ï¼ŒæŒ‡å¤šä¸ªèŠ‚ç‚¹æä¾›åŒæ ·çš„æœåŠ¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰èƒ½åŠ›æ¥æ”¶æ¥è‡ªå¤–éƒ¨çš„è¯·æ±‚å¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚ Kafkaä»0.8ç‰ˆæœ¬å¼€å§‹ä¸ºåˆ†åŒºå¼•å…¥äº†å¤šå‰¯æœ¬æœºåˆ¶ï¼Œé€šè¿‡å¢åŠ å‰¯æœ¬æ•°é‡æ¥æå‡æ•°æ®å®¹ç¾èƒ½åŠ›ã€‚åŒæ—¶ï¼ŒKafkaé€šè¿‡å¤šå‰¯æœ¬æœºåˆ¶å®ç°æ•…éšœè‡ªåŠ¨è½¬ç§»ï¼Œåœ¨Kafkaé›†ç¾¤ä¸­æŸä¸ªbrokerèŠ‚ç‚¹å¤±æ•ˆçš„æƒ…å†µä¸‹ä»ç„¶ä¿è¯æœåŠ¡å¯ç”¨ã€‚ ä¸€ä¸‹å†…å®¹ä¼šæ¶‰åŠåˆ°ARã€ISRã€HWç­‰åŸºç¡€æ¦‚å¿µï¼Œä¸‹é¢æˆ‘ä»¬å…ˆç®€è¦å›é¡¾ä¸€ä¸‹ï¼Œè¯¦æƒ…è¯·å‚è€ƒ &lt;Kafkaä¸­çš„åŸºæœ¬æ¦‚å¿µ&gt; å‰¯æœ¬æ˜¯ç›¸å¯¹äºåˆ†åŒºè€Œè¨€çš„ï¼Œå³å‰¯æœ¬æ˜¯ç‰¹å®šåˆ†åŒºçš„å‰¯æœ¬ã€‚ ä¸€ä¸ªåˆ†åŒºä¸­åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå‰¯æœ¬ï¼Œå…¶ä¸­ä¸€ä¸ªä¸ºleaderå‰¯æœ¬ï¼Œå…¶ä½™ä¸ºfollowerå‰¯æœ¬ï¼Œå„ä¸ªå‰¯æœ¬ä½äºä¸åŒçš„brokerèŠ‚ç‚¹ä¸­ã€‚åªæœ‰leaderå‰¯æœ¬å¯¹å¤–æä¾›æœåŠ¡ï¼Œfollowerå‰¯æœ¬åªè´Ÿè´£æ•°æ®åŒæ­¥ã€‚ åˆ†åŒºä¸­çš„æ‰€æœ‰å‰¯æœ¬ç»Ÿç§°ä¸º ARï¼Œè€ŒISR æ˜¯æŒ‡ä¸leader å‰¯æœ¬ä¿æŒåŒæ­¥çŠ¶æ€çš„å‰¯æœ¬é›†åˆï¼Œå½“ç„¶leaderå‰¯æœ¬æœ¬èº«ä¹Ÿæ˜¯è¿™ä¸ªé›†åˆä¸­çš„ä¸€å‘˜ã€‚ LEOæ ‡è¯†æ¯ä¸ªåˆ†åŒºä¸­æœ€åä¸€æ¡æ¶ˆæ¯çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼Œåˆ†åŒºçš„æ¯ä¸ªå‰¯æœ¬éƒ½æœ‰è‡ªå·±çš„LEOï¼ŒISRä¸­æœ€å°çš„LEOå³ä¸ºHWï¼Œä¿—ç§°é«˜æ°´ä½ï¼Œæ¶ˆè´¹è€…åªèƒ½æ‹‰å–åˆ°HWä¹‹å‰çš„æ¶ˆæ¯ã€‚ä»ç”Ÿäº§è€…å‘å‡ºçš„ä¸€æ¡æ¶ˆæ¯é¦–å…ˆä¼šè¢«å†™å…¥åˆ†åŒºçš„leaderå‰¯æœ¬ï¼Œä¸è¿‡è¿˜éœ€è¦ç­‰å¾…ISRé›†åˆä¸­çš„æ‰€æœ‰ follower å‰¯æœ¬éƒ½åŒæ­¥å®Œä¹‹åæ‰èƒ½è¢«è®¤ä¸ºå·²ç»æäº¤ï¼Œä¹‹åæ‰ä¼šæ›´æ–°åˆ†åŒºçš„ HWï¼Œè¿›è€Œæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹åˆ°è¿™æ¡æ¶ˆæ¯ã€‚ ä»ç”Ÿäº§è€…å‘å‡ºçš„ä¸€æ¡æ¶ˆæ¯é¦–å…ˆä¼šè¢«å†™å…¥åˆ†åŒºçš„leaderå‰¯æœ¬ï¼Œä¸è¿‡è¿˜éœ€è¦ç­‰å¾…ISRé›†åˆä¸­çš„æ‰€æœ‰ follower å‰¯æœ¬éƒ½åŒæ­¥å®Œä¹‹åæ‰èƒ½è¢«è®¤ä¸ºå·²ç»æäº¤ï¼Œä¹‹åæ‰ä¼šæ›´æ–°åˆ†åŒºçš„ HWï¼Œè¿›è€Œæ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹åˆ°è¿™æ¡æ¶ˆæ¯ã€‚ å¤±æ•ˆå‰¯æœ¬æ­£å¸¸æƒ…å†µä¸‹ï¼Œåˆ†åŒºçš„æ‰€æœ‰å‰¯æœ¬éƒ½å¤„äºISRé›†åˆä¸­ï¼Œä½†æ˜¯éš¾å…ä¼šæœ‰å¼‚å¸¸æƒ…å†µå‘ç”Ÿï¼Œä»è€ŒæŸäº›å‰¯æœ¬è¢«å‰¥ç¦»å‡ºISRé›†åˆä¸­ã€‚åœ¨ISRé›†åˆä¹‹å¤–ï¼Œä¹Ÿå°±æ˜¯å¤„äºåŒæ­¥å¤±æ•ˆæˆ–åŠŸèƒ½å¤±æ•ˆï¼ˆæ¯”å¦‚å‰¯æœ¬å¤„äºéå­˜æ´»çŠ¶æ€ï¼‰çš„å‰¯æœ¬ç»Ÿç§°ä¸ºå¤±æ•ˆå‰¯æœ¬ï¼Œå¤±æ•ˆå‰¯æœ¬å¯¹åº”çš„åˆ†åŒºä¹Ÿå°±ç§°ä¸ºåŒæ­¥å¤±æ•ˆåˆ†åŒºï¼ˆunder-replicatedåˆ†åŒºï¼‰ã€‚ å¯ä»¥é€šè¿‡ kafka-topic.sh è„šæœ¬çš„ under-replicated-partitions å‚æ•°æ¥æ˜¾ç¤ºä¸»é¢˜ä¸­åŒ…å«å¤±æ•ˆå‰¯æœ¬çš„åˆ†åŒºã€‚ bin/kafka-topic.sh --zookeeper localhost:2181 --describe --topic topic-partitions -under-replicatied-partitions å¤±æ•ˆå‰¯æœ¬ä¸ä»…æ˜¯æŒ‡å¤„äºåŠŸèƒ½å¤±æ•ˆçŠ¶æ€çš„å‰¯æœ¬ï¼Œå¤„äºåŒæ­¥å¤±æ•ˆçŠ¶æ€çš„å‰¯æœ¬ä¹Ÿå¯ä»¥çœ‹ä½œå¤±æ•ˆå‰¯æœ¬ã€‚æ€ä¹ˆåˆ¤å®šä¸€ä¸ªåˆ†åŒºæ˜¯å¦æœ‰å‰¯æœ¬å¤„äºåŒæ­¥å¤±æ•ˆçš„çŠ¶æ€å‘¢ï¼ŸKafkaä»0.9.xç‰ˆæœ¬å¼€å§‹å°±é€šè¿‡å”¯ä¸€çš„brokerç«¯å‚æ•° replica.lag.time.max.ms æ¥æŠ‰æ‹©ï¼Œå½“ISRé›†åˆä¸­çš„ä¸€ä¸ªfollowerå‰¯æœ¬æ»åleaderå‰¯æœ¬çš„æ—¶é—´è¶…è¿‡æ­¤å‚æ•°æŒ‡å®šçš„å€¼æ—¶åˆ™åˆ¤å®šä¸ºåŒæ­¥å¤±è´¥ï¼Œéœ€è¦å°†æ­¤followerå‰¯æœ¬å‰”é™¤å‡ºISRé›†åˆï¼Œreplica.lag.time.max.ms å‚æ•°çš„é»˜è®¤å€¼ä¸º10000ã€‚ å…·ä½“çš„å®ç°åŸç†ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œå½“followerå‰¯æœ¬å°†leaderå‰¯æœ¬LEOï¼ˆLogEndOffsetï¼‰ä¹‹å‰çš„æ—¥å¿—å…¨éƒ¨åŒæ­¥æ—¶ï¼Œåˆ™è®¤ä¸ºè¯¥ follower å‰¯æœ¬å·²ç»è¿½èµ¶ä¸Šleader å‰¯æœ¬ï¼Œæ­¤æ—¶æ›´æ–°è¯¥å‰¯æœ¬çš„lastCaughtUpTimeMs æ ‡è¯†ã€‚Kafka çš„å‰¯æœ¬ç®¡ç†å™¨ä¼šå¯åŠ¨ä¸€ä¸ªå‰¯æœ¬è¿‡æœŸæ£€æµ‹çš„å®šæ—¶ä»»åŠ¡ï¼Œè€Œè¿™ä¸ªå®šæ—¶ä»»åŠ¡ä¼šå®šæ—¶æ£€æŸ¥å½“å‰æ—¶é—´ä¸å‰¯æœ¬çš„ lastCaughtUpTimeMs å·®å€¼æ˜¯å¦å¤§äºå‚æ•°replica.lag.time.max.ms æŒ‡å®šçš„å€¼ã€‚ ä»€ä¹ˆæƒ…å†µä¼šå¯¼è‡´å‰¯æœ¬å¤±æ•ˆï¼Ÿ followerå‰¯æœ¬è¿›ç¨‹å¡ä½ï¼Œåœ¨ä¸€æ®µæ—¶é—´å†…æ ¹æœ¬æ²¡æœ‰å‘leaderå‰¯æœ¬å‘èµ·åŒæ­¥è¯·æ±‚ï¼Œæ¯”å¦‚é¢‘ç¹çš„Full GCã€‚ followerå‰¯æœ¬è¿›ç¨‹åŒæ­¥è¿‡æ…¢ï¼Œåœ¨ä¸€æ®µæ—¶é—´å†…éƒ½æ— æ³•è¿½èµ¶ä¸Šleaderå‰¯æœ¬ï¼Œæ¯”å¦‚I/Oå¼€é”€è¿‡å¤§ã€‚ å½“é€šè¿‡è„šæœ¬å·¥å…·å¢åŠ äº†å‰¯æœ¬å› å­ï¼Œæ–°å¢åŠ çš„å‰¯æœ¬å› å­åœ¨èµ¶ä¸Šleaderä¹‹å‰éƒ½å¤„äºå¤±æ•ˆçŠ¶æ€ ISRçš„ä¼¸ç¼©Kafka åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šå¼€å¯ä¸¤ä¸ªä¸ ISR ç›¸å…³çš„å®šæ—¶ä»»åŠ¡ï¼Œåç§°åˆ†åˆ«ä¸ºâ€œisr-expirationâ€å’Œâ€œisr-change-propagationâ€ã€‚ isr-expirationä»»åŠ¡ä¼šå‘¨æœŸæ€§åœ°æ£€æµ‹æ¯ä¸ªåˆ†åŒºæ˜¯å¦éœ€è¦ç¼©å‡å…¶ISRé›†åˆã€‚è¿™ä¸ªå‘¨æœŸå’Œ replica.lag.time.max.ms å‚æ•°æœ‰å…³ï¼Œå¤§å°æ˜¯è¿™ä¸ªå‚æ•°å€¼çš„ä¸€åŠï¼Œé»˜è®¤å€¼ä¸º5000msã€‚å½“æ£€æµ‹åˆ°ISRé›†åˆä¸­æœ‰å¤±æ•ˆå‰¯æœ¬æ—¶ï¼Œå°±ä¼šæ”¶ç¼©ISRé›†åˆã€‚å¦‚æœæŸä¸ªåˆ†åŒºçš„ISRé›†åˆå‘ç”Ÿå˜æ›´ï¼Œåˆ™ä¼šå°†å˜æ›´åçš„æ•°æ®è®°å½•åˆ° ZooKeeper å¯¹åº”çš„ /brokers/topics/ï¼œtopicï¼/partition/ï¼œparititonï¼/state èŠ‚ç‚¹ä¸­ã€‚èŠ‚ç‚¹ä¸­çš„æ•°æ®ç¤ºä¾‹å¦‚ä¸‹ï¼š &#123;&quot;controller epoch&quot;: 26, &quot;leader&quot;: 0, &quot;version&quot;: 1, &quot;leader epoch&quot;: 2, &quot;isr&quot;: [0, 1]&#125; controller_epoch è¡¨ç¤ºå½“å‰Kafkaæ§åˆ¶å™¨çš„epoch leaderè¡¨ç¤ºå½“å‰åˆ†åŒºçš„leaderå‰¯æœ¬æ‰€åœ¨çš„brokerçš„idç¼–å· versionè¡¨ç¤ºç‰ˆæœ¬å·ï¼ˆå½“å‰ç‰ˆæœ¬å›ºå®šä¸º1ï¼‰ leader_epochè¡¨ç¤ºå½“å‰åˆ†åŒºçš„leaderçºªå…ƒ isrè¡¨ç¤ºå˜æ›´åçš„ISRåˆ—è¡¨ã€‚ å½“ ISR é›†åˆå‘ç”Ÿå˜æ›´æ—¶è¿˜ä¼šå°†å˜æ›´åçš„è®°å½•ç¼“å­˜åˆ° isrChangeSet ä¸­ï¼Œisr-change-propagationä»»åŠ¡ä¼šå‘¨æœŸæ€§ï¼ˆå›ºå®šå€¼ä¸º 2500msï¼‰åœ°æ£€æŸ¥isrChangeSetï¼Œå¦‚æœå‘ç°isrChangeSetä¸­æœ‰ISRé›†åˆçš„å˜æ›´è®°å½•ï¼Œé‚£ä¹ˆå®ƒä¼šåœ¨ZooKeeperçš„/isr_change_notificationè·¯å¾„ä¸‹åˆ›å»ºä¸€ä¸ªä»¥ isr_change_å¼€å¤´çš„æŒä¹…é¡ºåºèŠ‚ç‚¹ï¼ˆæ¯”å¦‚/isr_change_notification/isr_change_0000000000ï¼‰ï¼Œå¹¶å°†isrChangeSetä¸­çš„ä¿¡æ¯ä¿å­˜åˆ°è¿™ä¸ªèŠ‚ç‚¹ä¸­ã€‚ Kafkaæ§åˆ¶å™¨ä¸º/isr_change_notificationæ·»åŠ äº†ä¸€ä¸ªWatcherï¼Œå½“è¿™ä¸ªèŠ‚ç‚¹ä¸­æœ‰å­èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–æ—¶ä¼šè§¦å‘Watcherçš„åŠ¨ä½œï¼Œä»¥æ­¤é€šçŸ¥æ§åˆ¶å™¨æ›´æ–°ç›¸å…³å…ƒæ•°æ®ä¿¡æ¯å¹¶å‘å®ƒç®¡ç†çš„brokerèŠ‚ç‚¹å‘é€æ›´æ–°å…ƒæ•°æ®çš„è¯·æ±‚ï¼Œæœ€ååˆ é™¤/isr_change_notificationè·¯å¾„ä¸‹å·²ç»å¤„ç†è¿‡çš„èŠ‚ç‚¹ã€‚é¢‘ç¹åœ°è§¦å‘Watcherä¼šå½±å“Kafkaæ§åˆ¶å™¨ã€ZooKeeperç”šè‡³å…¶ä»–brokerèŠ‚ç‚¹çš„æ€§èƒ½ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼ŒKafkaæ·»åŠ äº†é™å®šæ¡ä»¶ï¼Œå½“æ£€æµ‹åˆ°åˆ†åŒºçš„ISRé›†åˆå‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿˜éœ€è¦æ£€æŸ¥ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ï¼š ä¸Šä¸€æ¬¡ISRé›†åˆå‘ç”Ÿå˜åŒ–è·ç¦»ç°åœ¨å·²ç»è¶…è¿‡5sã€‚ ä¸Šä¸€æ¬¡å†™å…¥ZooKeeperçš„æ—¶é—´è·ç¦»ç°åœ¨å·²ç»è¶…è¿‡60sã€‚ æ»¡è¶³ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€æ‰å¯ä»¥å°†ISRé›†åˆçš„å˜åŒ–å†™å…¥ç›®æ ‡èŠ‚ç‚¹ã€‚ æœ‰ç¼©å‡å¯¹åº”å°±ä¼šæœ‰æ‰©å……ï¼Œé‚£ä¹ˆKafkaåˆæ˜¯ä½•æ—¶æ‰©å……ISRçš„å‘¢ï¼Ÿ éšç€followerå‰¯æœ¬ä¸æ–­ä¸leaderå‰¯æœ¬è¿›è¡Œæ¶ˆæ¯åŒæ­¥ï¼Œfollowerå‰¯æœ¬çš„LEOä¹Ÿä¼šé€æ¸åç§»ï¼Œå¹¶æœ€ç»ˆè¿½èµ¶ä¸Šleaderå‰¯æœ¬ï¼Œæ­¤æ—¶è¯¥followerå‰¯æœ¬å°±æœ‰èµ„æ ¼è¿›å…¥ISRé›†åˆã€‚è¿½èµ¶ä¸Šleaderå‰¯æœ¬çš„åˆ¤å®šå‡†åˆ™æ˜¯æ­¤å‰¯æœ¬çš„LEOæ˜¯å¦ä¸å°äºleaderå‰¯æœ¬çš„HWï¼Œæ³¨æ„è¿™é‡Œå¹¶ä¸æ˜¯å’Œleaderå‰¯æœ¬çš„LEOç›¸æ¯”ã€‚ISRæ‰©å……ä¹‹ååŒæ ·ä¼šæ›´æ–°ZooKeeperä¸­çš„/brokers/topics/ï¼œtopicï¼/partition/ï¼œparititonï¼/stateèŠ‚ç‚¹å’ŒisrChangeSetï¼Œä¹‹åçš„æ­¥éª¤å°±å’ŒISRæ”¶ç¼©æ—¶çš„ç›¸åŒã€‚ å½“ISRé›†åˆå‘ç”Ÿå¢å‡æ—¶ï¼Œæˆ–è€…ISRé›†åˆä¸­ä»»ä¸€å‰¯æœ¬çš„LEOå‘ç”Ÿå˜åŒ–æ—¶ï¼Œéƒ½å¯èƒ½ä¼šå½±å“æ•´ä¸ªåˆ†åŒºçš„HWã€‚ ä¾‹å¦‚å¦‚ä¸‹ï¼Œleaderå‰¯æœ¬çš„LEOä¸º9ï¼Œfollower1å‰¯æœ¬çš„LEOä¸º7ï¼Œè€Œfollower2å‰¯æœ¬çš„LEOä¸º6ï¼Œå¦‚æœåˆ¤å®šè¿™3ä¸ªå‰¯æœ¬éƒ½å¤„äºISRé›†åˆä¸­ï¼Œé‚£ä¹ˆè¿™ä¸ªåˆ†åŒºçš„HWä¸º6ï¼›å¦‚æœfollower3å·²ç»è¢«åˆ¤å®šä¸ºå¤±æ•ˆå‰¯æœ¬è¢«å‰¥ç¦»å‡ºISRé›†åˆï¼Œé‚£ä¹ˆæ­¤æ—¶åˆ†åŒºçš„HWä¸ºleaderå‰¯æœ¬å’Œfollower1å‰¯æœ¬ä¸­LEOçš„æœ€å°å€¼ï¼Œå³ä¸º7ã€‚ LEO å’Œ HWè¿™ä¸¤ä¸ªæ¦‚å¿µå¯ä»¥å‚è€ƒï¼š å¯¹äºå‰¯æœ¬è€Œè¨€ï¼Œè¿˜æœ‰ä¸¤ä¸ªæ¦‚å¿µï¼šæœ¬åœ°å‰¯æœ¬ï¼ˆLocal Replicaï¼‰å’Œè¿œç¨‹å‰¯æœ¬ï¼ˆRemoteReplicaï¼‰ï¼Œæœ¬åœ°å‰¯æœ¬æ˜¯æŒ‡å¯¹åº”çš„Logåˆ†é…åœ¨å½“å‰çš„brokerèŠ‚ç‚¹ä¸Šï¼Œè¿œç¨‹å‰¯æœ¬æ˜¯æŒ‡å¯¹åº”çš„Logåˆ†é…åœ¨å…¶ä»–çš„brokerèŠ‚ç‚¹ä¸Šã€‚åœ¨Kafkaä¸­ï¼ŒåŒä¸€ä¸ªåˆ†åŒºçš„ä¿¡æ¯ä¼šå­˜åœ¨å¤šä¸ªbrokerèŠ‚ç‚¹ä¸Šï¼Œå¹¶è¢«å…¶ä¸Šçš„å‰¯æœ¬ç®¡ç†å™¨æ‰€ç®¡ç†ï¼Œè¿™æ ·åœ¨é€»è¾‘å±‚é¢æ¯ä¸ªbrokerèŠ‚ç‚¹ä¸Šçš„åˆ†åŒºå°±æœ‰äº†å¤šä¸ªå‰¯æœ¬ï¼Œä½†æ˜¯åªæœ‰æœ¬åœ°å‰¯æœ¬æ‰æœ‰å¯¹åº”çš„æ—¥å¿—ã€‚ æ•´ä¸ªæ¶ˆæ¯è¿½åŠ çš„è¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬å¦‚ä¸‹ï¼š ç”Ÿäº§è€…å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯è‡³leaderå‰¯æœ¬ï¼ˆå‰¯æœ¬1ï¼‰ä¸­ã€‚ æ¶ˆæ¯è¢«è¿½åŠ åˆ°leaderå‰¯æœ¬çš„æœ¬åœ°æ—¥å¿—ï¼Œå¹¶ä¸”ä¼šæ›´æ–°æ—¥å¿—çš„åç§»é‡ã€‚ followerå‰¯æœ¬ï¼ˆå‰¯æœ¬2å’Œå‰¯æœ¬3ï¼‰å‘leaderå‰¯æœ¬è¯·æ±‚åŒæ­¥æ•°æ®ã€‚ leaderå‰¯æœ¬æ‰€åœ¨çš„æœåŠ¡å™¨è¯»å–æœ¬åœ°æ—¥å¿—ï¼Œå¹¶æ›´æ–°å¯¹åº”æ‹‰å–çš„followerå‰¯æœ¬çš„ä¿¡æ¯ã€‚ leaderå‰¯æœ¬æ‰€åœ¨çš„æœåŠ¡å™¨å°†æ‹‰å–ç»“æœè¿”å›ç»™followerå‰¯æœ¬ã€‚ followerå‰¯æœ¬æ”¶åˆ°leaderå‰¯æœ¬è¿”å›çš„æ‹‰å–ç»“æœï¼Œå°†æ¶ˆæ¯è¿½åŠ åˆ°æœ¬åœ°æ—¥å¿—ä¸­ï¼Œå¹¶æ›´æ–°æ—¥å¿—çš„åç§»é‡ä¿¡æ¯ã€‚ äº†è§£äº†è¿™äº›å†…å®¹åï¼Œæˆ‘ä»¬å†æ¥åˆ†æåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å„ä¸ªå‰¯æœ¬LEOå’ŒHWçš„å˜åŒ–æƒ…å†µã€‚ä¸‹é¢çš„ç¤ºä¾‹ï¼Œç”Ÿäº§è€…ä¸€ç›´åœ¨å¾€leaderå‰¯æœ¬ä¸­å†™å…¥æ¶ˆæ¯ã€‚æŸä¸€æ—¶åˆ»ï¼Œleaderå‰¯æœ¬çš„LEOå¢åŠ è‡³5ï¼Œå¹¶ä¸”æ‰€æœ‰å‰¯æœ¬çš„HWè¿˜éƒ½ä¸º0ã€‚ä¹‹åfollowerå‰¯æœ¬å‘leaderå‰¯æœ¬æ‹‰å–æ¶ˆæ¯ï¼Œåœ¨æ‹‰å–çš„è¯·æ±‚ä¸­ä¼šå¸¦æœ‰è‡ªèº«çš„LEOä¿¡æ¯ï¼Œè¿™ä¸ªLEOä¿¡æ¯å¯¹åº”çš„æ˜¯FetchRequestè¯·æ±‚ä¸­çš„fetch_offsetã€‚leaderå‰¯æœ¬è¿”å›ç»™followerå‰¯æœ¬ç›¸åº”çš„æ¶ˆæ¯ï¼Œå¹¶ä¸”è¿˜å¸¦æœ‰è‡ªèº«çš„HWä¿¡æ¯ï¼Œå¦‚å›¾8-5æ‰€ç¤ºï¼Œè¿™ä¸ªHWä¿¡æ¯å¯¹åº”çš„æ˜¯FetchResponseä¸­çš„high_watermarkã€‚ æ­¤æ—¶ä¸¤ä¸ªfollowerå‰¯æœ¬å„è‡ªæ‹‰å–åˆ°äº†æ¶ˆæ¯ï¼Œå¹¶æ›´æ–°å„è‡ªçš„LEOä¸º3å’Œ4ã€‚ä¸æ­¤åŒæ—¶ï¼Œfollowerå‰¯æœ¬è¿˜ä¼šæ›´æ–°è‡ªå·±çš„HWï¼Œæ›´æ–°HWçš„ç®—æ³•æ˜¯æ¯”è¾ƒå½“å‰LEOå’Œleaderå‰¯æœ¬ä¸­ä¼ é€è¿‡æ¥çš„HWçš„å€¼ï¼Œå–è¾ƒå°å€¼ä½œä¸ºè‡ªå·±çš„HWå€¼ã€‚å½“å‰ä¸¤ä¸ªfollowerå‰¯æœ¬çš„HWéƒ½ç­‰äº0ï¼ˆminï¼ˆ0ï¼Œ0ï¼‰=0ï¼‰ã€‚ æ¥ä¸‹æ¥followerå‰¯æœ¬å†æ¬¡è¯·æ±‚æ‹‰å–leaderå‰¯æœ¬ä¸­çš„æ¶ˆæ¯ã€‚ æ­¤æ—¶leaderå‰¯æœ¬æ”¶åˆ°æ¥è‡ªfollowerå‰¯æœ¬çš„FetchRequestè¯·æ±‚ï¼Œå…¶ä¸­å¸¦æœ‰LEOçš„ç›¸å…³ä¿¡æ¯ï¼Œé€‰å–å…¶ä¸­çš„æœ€å°å€¼ä½œä¸ºæ–°çš„HWï¼Œå³minï¼ˆ15ï¼Œ3ï¼Œ4ï¼‰=3ã€‚ç„¶åè¿åŒæ¶ˆæ¯å’ŒHWä¸€èµ·è¿”å›FetchResponseç»™followerå‰¯æœ¬ã€‚æ³¨æ„leaderå‰¯æœ¬çš„HWæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ä¸œè¥¿ï¼Œå› ä¸ºå®ƒç›´æ¥å½±å“äº†åˆ†åŒºæ•°æ®å¯¹æ¶ˆè´¹è€…çš„å¯è§æ€§ã€‚ ä¸¤ä¸ªfollowerå‰¯æœ¬åœ¨æ”¶åˆ°æ–°çš„æ¶ˆæ¯ä¹‹åæ›´æ–°LEOå¹¶ä¸”æ›´æ–°è‡ªå·±çš„HWä¸º3ï¼ˆminï¼ˆLEOï¼Œ3ï¼‰=3ï¼‰ã€‚ åœ¨ä¸€ä¸ªåˆ†åŒºä¸­ï¼Œleaderå‰¯æœ¬æ‰€åœ¨çš„èŠ‚ç‚¹ä¼šè®°å½•æ‰€æœ‰å‰¯æœ¬çš„LEOï¼Œè€Œfollowerå‰¯æœ¬æ‰€åœ¨çš„èŠ‚ç‚¹åªä¼šè®°å½•è‡ªèº«çš„LEOï¼Œè€Œä¸ä¼šè®°å½•å…¶ä»–å‰¯æœ¬çš„LEOã€‚å¯¹HWè€Œè¨€ï¼Œå„ä¸ªå‰¯æœ¬æ‰€åœ¨çš„èŠ‚ç‚¹éƒ½åªè®°å½•å®ƒè‡ªèº«çš„HWã€‚leader å‰¯æœ¬æ”¶åˆ° followerå‰¯æœ¬çš„FetchRequestè¯·æ±‚ä¹‹åï¼Œå®ƒé¦–å…ˆä¼šä»è‡ªå·±çš„æ—¥å¿—æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œç„¶ååœ¨è¿”å›ç»™followerå‰¯æœ¬æ•°æ®å‰å…ˆæ›´æ–°followerå‰¯æœ¬çš„LEOã€‚ Kafka çš„æ ¹ç›®å½•ä¸‹æœ‰ cleaner-offset-checkpointã€log-start-offset-checkpointã€recovery-point-offset-checkpointå’Œreplication-offset-checkpointå››ä¸ªæ£€æŸ¥ç‚¹æ–‡ä»¶ recovery-point-offset-checkpoint å’Œreplication-offset-checkpoint è¿™ä¸¤ä¸ªæ–‡ä»¶åˆ†åˆ«å¯¹åº”äº† LEOå’Œ HWã€‚Kafka ä¸­ä¼šæœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡è´Ÿè´£å°†æ‰€æœ‰åˆ†åŒºçš„ LEO åˆ·å†™åˆ°æ¢å¤ç‚¹æ–‡ä»¶ recovery-point-offset-checkpoint ä¸­ï¼Œå®šæ—¶å‘¨æœŸç”± broker ç«¯å‚æ•° log.flush.offset.checkpoint.interval.msæ¥é…ç½®ï¼Œé»˜è®¤å€¼ä¸º60000ã€‚è¿˜æœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡è´Ÿè´£å°†æ‰€æœ‰åˆ†åŒºçš„HWåˆ·å†™åˆ°å¤åˆ¶ç‚¹æ–‡ä»¶replication-offset-checkpointä¸­ï¼Œå®šæ—¶å‘¨æœŸç”±brokerç«¯å‚æ•°replica.high.watermark.checkpoint.interval.msæ¥é…ç½®ï¼Œé»˜è®¤å€¼ä¸º5000ã€‚ log-start-offset-checkpointæ–‡ä»¶å¯¹åº”logStartOffsetï¼ˆæ³¨æ„ä¸èƒ½ç¼©å†™ä¸ºLSOï¼Œå› ä¸ºåœ¨Kafkaä¸­LSOæ˜¯LastStableOffsetçš„ç¼©å†™ï¼‰ï¼Œåœ¨FetchRequestå’ŒFetchResponseä¸­ä¹Ÿæœ‰å®ƒçš„èº«å½±ï¼Œå®ƒç”¨æ¥æ ‡è¯†æ—¥å¿—çš„èµ·å§‹åç§»é‡ã€‚å„ä¸ªå‰¯æœ¬åœ¨å˜åŠ¨ LEO å’Œ HW çš„è¿‡ç¨‹ä¸­ï¼ŒlogStartOffset ä¹Ÿæœ‰å¯èƒ½éšä¹‹è€ŒåŠ¨ã€‚Kafka ä¹Ÿæœ‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡æ¥è´Ÿè´£å°†æ‰€æœ‰åˆ†åŒºçš„ logStartOffsetä¹¦å†™åˆ°èµ·å§‹ç‚¹æ–‡ä»¶log-start-offset-checkpointä¸­ï¼Œå®šæ—¶å‘¨æœŸç”±brokerç«¯å‚æ•°log.flush.start.offset.checkpoint.interval.msæ¥é…ç½®ï¼Œé»˜è®¤å€¼ä¸º60000ã€‚ Leader Epochæ—¥å¿—åŒæ­¥æœºåˆ¶åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ—¥å¿—åŒæ­¥æœºåˆ¶æ—¢è¦ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä¹Ÿè¦ä¿è¯æ•°æ®çš„é¡ºåºæ€§ã€‚è™½ç„¶æœ‰è®¸å¤šæ–¹å¼å¯ä»¥å®ç°è¿™äº›åŠŸèƒ½ï¼Œä½†æœ€ç®€å•é«˜æ•ˆçš„æ–¹å¼è¿˜æ˜¯ä»é›†ç¾¤ä¸­é€‰å‡ºä¸€ä¸ªleaderæ¥è´Ÿè´£å¤„ç†æ•°æ®å†™å…¥çš„é¡ºåºæ€§ã€‚åªè¦leaderè¿˜å¤„äºå­˜æ´»çŠ¶æ€ï¼Œé‚£ä¹ˆfolloweråªéœ€æŒ‰ç…§leaderä¸­çš„å†™å…¥é¡ºåºæ¥è¿›è¡ŒåŒæ­¥å³å¯ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œåªè¦leaderä¸å®•æœºæˆ‘ä»¬å°±ä¸éœ€è¦å…³å¿ƒfollowerçš„åŒæ­¥é—®é¢˜ã€‚ä¸è¿‡å½“leaderå®•æœºæ—¶ï¼Œæˆ‘ä»¬å°±è¦ä»followerä¸­é€‰ä¸¾å‡ºä¸€ä¸ªæ–°çš„leaderã€‚followerçš„åŒæ­¥çŠ¶æ€å¯èƒ½è½åleaderå¾ˆå¤šï¼Œç”šè‡³è¿˜å¯èƒ½å¤„äºå®•æœºçŠ¶æ€ï¼Œæ‰€ä»¥å¿…é¡»ç¡®ä¿é€‰æ‹©å…·æœ‰æœ€æ–°æ—¥å¿—æ¶ˆæ¯çš„followerä½œä¸ºæ–°çš„leaderã€‚æ—¥å¿—åŒæ­¥æœºåˆ¶çš„ä¸€ä¸ªåŸºæœ¬åŸåˆ™å°±æ˜¯ï¼šå¦‚æœå‘ŠçŸ¥å®¢æˆ·ç«¯å·²ç»æˆåŠŸæäº¤äº†æŸæ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆå³ä½¿ leaderå®•æœºï¼Œä¹Ÿè¦ä¿è¯æ–°é€‰ä¸¾å‡ºæ¥çš„leaderä¸­èƒ½å¤ŸåŒ…å«è¿™æ¡æ¶ˆæ¯ã€‚è¿™é‡Œå°±æœ‰ä¸€ä¸ªéœ€è¦æƒè¡¡ï¼ˆtradeoffï¼‰çš„åœ°æ–¹ï¼Œå¦‚æœleaderåœ¨æ¶ˆæ¯è¢«æäº¤å‰éœ€è¦ç­‰å¾…æ›´å¤šçš„followerç¡®è®¤ï¼Œé‚£ä¹ˆåœ¨å®ƒå®•æœºä¹‹åå°±å¯ä»¥æœ‰æ›´å¤šçš„followeræ›¿ä»£å®ƒï¼Œä¸è¿‡è¿™ä¹Ÿä¼šé€ æˆæ€§èƒ½çš„ä¸‹é™ã€‚ å¯¹äºè¿™ç§tradeoffï¼Œä¸€ç§å¸¸è§çš„åšæ³•æ˜¯â€œå°‘æ•°æœä»å¤šæ•°â€ï¼Œâ€œå°‘æ•°æœä»å¤šæ•°â€çš„æ–¹å¼æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜åŠ¿ï¼Œç³»ç»Ÿçš„å»¶è¿Ÿå–å†³äºæœ€å¿«çš„å‡ ä¸ªèŠ‚ç‚¹ï¼Œæ¯”å¦‚å‰¯æœ¬æ•°ä¸º3ï¼Œé‚£ä¹ˆå»¶è¿Ÿå°±å–å†³äºæœ€å¿«çš„é‚£ä¸ªfollowerè€Œä¸æ˜¯æœ€æ…¢çš„é‚£ä¸ªï¼ˆé™¤äº†leaderï¼Œåªéœ€è¦å¦ä¸€ä¸ªfollowerç¡®è®¤å³å¯ï¼‰ã€‚ä¸è¿‡å®ƒä¹Ÿæœ‰ä¸€äº›åŠ£åŠ¿ï¼Œä¸ºäº†ä¿è¯leaderé€‰ä¸¾çš„æ­£å¸¸è¿›è¡Œï¼Œå®ƒæ‰€èƒ½å®¹å¿çš„å¤±è´¥followeræ•°æ¯”è¾ƒå°‘ï¼Œå¦‚æœè¦å®¹å¿1ä¸ªfollowerå¤±è´¥ï¼Œé‚£ä¹ˆè‡³å°‘è¦æœ‰3ä¸ªå‰¯æœ¬ï¼Œå¦‚æœè¦å®¹å¿2ä¸ªfollowerå¤±è´¥ï¼Œå¿…é¡»è¦æœ‰5ä¸ªå‰¯æœ¬ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä¸ºäº†ä¿è¯è¾ƒé«˜çš„å®¹é”™ç‡ï¼Œå¿…é¡»è¦æœ‰å¤§é‡çš„å‰¯æœ¬ï¼Œè€Œå¤§é‡çš„å‰¯æœ¬åˆä¼šåœ¨å¤§æ•°æ®é‡ä¸‹å¯¼è‡´æ€§èƒ½çš„æ€¥å‰§ä¸‹é™ã€‚è¿™ä¹Ÿå°±æ˜¯â€œå°‘æ•°æœä»å¤šæ•°â€çš„è¿™ç§Quorumæ¨¡å‹å¸¸è¢«ç”¨ä½œå…±äº«é›†ç¾¤é…ç½®ï¼ˆæ¯”å¦‚ZooKeeperï¼‰ï¼Œè€Œå¾ˆå°‘ç”¨äºä¸»æµçš„æ•°æ®å­˜å‚¨ä¸­çš„åŸå› ã€‚ ä¸â€œå°‘æ•°æœä»å¤šæ•°â€ç›¸å…³çš„ä¸€è‡´æ€§åè®®æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚Zabã€Raftå’ŒViewstampedReplicationç­‰ã€‚è€ŒKafkaä½¿ç”¨çš„æ›´åƒæ˜¯å¾®è½¯çš„PacificAç®—æ³•ã€‚åœ¨Kafkaä¸­åŠ¨æ€ç»´æŠ¤ç€ä¸€ä¸ªISRé›†åˆï¼Œå¤„äºISRé›†åˆå†…çš„èŠ‚ç‚¹ä¿æŒä¸leaderç›¸åŒçš„é«˜æ°´ä½ï¼ˆHWï¼‰ï¼Œåªæœ‰ä½åˆ—å…¶ä¸­çš„å‰¯æœ¬ï¼ˆunclean.leader.election.enableé…ç½®ä¸ºfalseï¼‰æ‰æœ‰èµ„æ ¼è¢«é€‰ä¸ºæ–°çš„ leaderã€‚å†™å…¥æ¶ˆæ¯æ—¶åªæœ‰ç­‰åˆ°æ‰€æœ‰ ISR é›†åˆä¸­çš„å‰¯æœ¬éƒ½ç¡®è®¤æ”¶åˆ°ä¹‹åæ‰èƒ½è¢«è®¤ä¸ºå·²ç»æäº¤ã€‚ä½äº ISR ä¸­çš„ä»»ä½•å‰¯æœ¬èŠ‚ç‚¹éƒ½æœ‰èµ„æ ¼æˆä¸ºleaderï¼Œé€‰ä¸¾è¿‡ç¨‹ç®€å•ã€å¼€é”€ä½ï¼Œè¿™ä¹Ÿæ˜¯Kafkaé€‰ç”¨æ­¤æ¨¡å‹çš„é‡è¦å› ç´ ã€‚Kafkaä¸­åŒ…å«å¤§é‡çš„åˆ†åŒºï¼Œleaderå‰¯æœ¬çš„å‡è¡¡ä¿éšœäº†æ•´ä½“è´Ÿè½½çš„å‡è¡¡ï¼Œæ‰€ä»¥è¿™ä¸€å› ç´ ä¹Ÿæå¤§åœ°å½±å“Kafkaçš„æ€§èƒ½æŒ‡æ ‡ã€‚ åœ¨é‡‡ç”¨ISRæ¨¡å‹å’Œï¼ˆf+1ï¼‰ä¸ªå‰¯æœ¬æ•°çš„é…ç½®ä¸‹ï¼Œä¸€ä¸ªKafkaåˆ†åŒºèƒ½å¤Ÿå®¹å¿æœ€å¤§fä¸ªèŠ‚ç‚¹å¤±è´¥ï¼Œç›¸æ¯”äºâ€œå°‘æ•°æœä»å¤šæ•°â€çš„æ–¹å¼æ‰€éœ€çš„èŠ‚ç‚¹æ•°å¤§å¹…å‡å°‘ã€‚å®é™…ä¸Šï¼Œä¸ºäº†èƒ½å¤Ÿå®¹å¿fä¸ªèŠ‚ç‚¹å¤±è´¥ï¼Œâ€œå°‘æ•°æœä»å¤šæ•°â€çš„æ–¹å¼å’ŒISRçš„æ–¹å¼éƒ½éœ€è¦ç›¸åŒæ•°é‡å‰¯æœ¬çš„ç¡®è®¤ä¿¡æ¯æ‰èƒ½æäº¤æ¶ˆæ¯ã€‚æ¯”å¦‚ï¼Œä¸ºäº†å®¹å¿1ä¸ªèŠ‚ç‚¹å¤±è´¥ï¼Œâ€œå°‘æ•°æœä»å¤šæ•°â€éœ€è¦3ä¸ªå‰¯æœ¬å’Œ1ä¸ªfollowerçš„ç¡®è®¤ä¿¡æ¯ï¼Œé‡‡ç”¨ISRçš„æ–¹å¼éœ€è¦2ä¸ªå‰¯æœ¬å’Œ1ä¸ªfollowerçš„ç¡®è®¤ä¿¡æ¯ã€‚åœ¨éœ€è¦ç›¸åŒç¡®è®¤ä¿¡æ¯æ•°çš„æƒ…å†µä¸‹ï¼Œé‡‡ç”¨ISRçš„æ–¹å¼æ‰€éœ€è¦çš„å‰¯æœ¬æ€»æ•°å˜å°‘ï¼Œå¤åˆ¶å¸¦æ¥çš„é›†ç¾¤å¼€é”€ä¹Ÿå°±æ›´ä½ï¼Œâ€œå°‘æ•°æœä»å¤šæ•°â€çš„ä¼˜åŠ¿åœ¨äºå®ƒå¯ä»¥ç»•å¼€æœ€æ…¢å‰¯æœ¬çš„ç¡®è®¤ä¿¡æ¯ï¼Œé™ä½æäº¤çš„å»¶è¿Ÿï¼Œè€Œå¯¹Kafkaè€Œè¨€ï¼Œè¿™ç§èƒ½åŠ›å¯ä»¥äº¤ç”±å®¢æˆ·ç«¯è‡ªå·±å»é€‰æ‹©ã€‚ æ€»ç»“ å…³äºï¼šæ€æ ·å¯ä»¥ç¡®ä¿Kafka å®Œå…¨å¯é ï¼Ÿå¦‚æœè¿™æ ·åšå°±å¯ä»¥ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±äº†å—ï¼Ÿ è¿™ç±»é—®é¢˜ï¼Œå°±å¯é æ€§æœ¬èº«è€Œè¨€ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªå¯ä»¥ç”¨ç®€å•çš„â€œæ˜¯â€æˆ–â€œå¦â€æ¥è¡¡é‡çš„ä¸€ä¸ªæŒ‡æ ‡ï¼Œè€Œä¸€èˆ¬æ˜¯é‡‡ç”¨å‡ ä¸ª9æ¥è¡¡é‡çš„ã€‚ä»»ä½•ä¸œè¥¿ä¸å¯èƒ½åšåˆ°å®Œå…¨çš„å¯é ï¼Œå³ä½¿èƒ½åº”ä»˜å•æœºæ•…éšœï¼Œä¹Ÿéš¾ä»¥åº”ä»˜é›†ç¾¤ã€æ•°æ®ä¸­å¿ƒç­‰é›†ä½“æ•…éšœï¼Œå³ä½¿èº²å¾—è¿‡å¤©ç¾ä¹Ÿæœªå¿…èº²å¾—è¿‡äººç¥¸ã€‚å°±å¯é æ€§è€Œè¨€ï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºä¸€å®šçš„å‡è®¾å‰ææ¥åšåˆ†æã€‚æœ¬é—®è¦è®²è¿°çš„æ˜¯ï¼šåœ¨åªè€ƒè™‘Kafkaæœ¬èº«ä½¿ç”¨æ–¹å¼çš„å‰æä¸‹å¦‚ä½•æœ€å¤§ç¨‹åº¦åœ°æé«˜å¯é æ€§ã€‚ kafkaå¯¹å¯é æ€§çš„ä¿éšœä½“ç°åœ¨å¤šä¸ªæ–¹é¢ï¼Œæ¶ˆæ¯å‘é€é˜¶æ®µã€æ¶ˆæ¯å­˜å‚¨é˜¶æ®µä»¥åŠæ¶ˆè´¹æ¶ˆæ¯é˜¶æ®µå‡æœ‰æ¶‰åŠã€‚ æ¶ˆæ¯å‘é€é˜¶æ®µæ¶ˆæ¯å‘é€çš„3ç§æ¨¡å¼ï¼Œå³å‘åå³å¿˜ã€åŒæ­¥å’Œå¼‚æ­¥ã€‚å¯¹äºå‘åå³å¿˜çš„æ¨¡å¼ï¼Œä¸ç®¡æ¶ˆæ¯æœ‰æ²¡æœ‰è¢«æˆåŠŸå†™å…¥ï¼Œç”Ÿäº§è€…éƒ½ä¸ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œé‚£ä¹ˆå³ä½¿æ¶ˆæ¯å†™å…¥å¤±è´¥ä¹Ÿæ— ä»å¾—çŸ¥ï¼Œå› æ­¤å‘åå³å¿˜çš„æ¨¡å¼ä¸é€‚åˆé«˜å¯é æ€§è¦æ±‚çš„åœºæ™¯ã€‚å¦‚æœè¦æå‡å¯é æ€§ï¼Œé‚£ä¹ˆç”Ÿäº§è€…å¯ä»¥é‡‡ç”¨åŒæ­¥æˆ–å¼‚æ­¥çš„æ¨¡å¼ï¼Œåœ¨å‡ºç°å¼‚å¸¸æƒ…å†µæ—¶å¯ä»¥åŠæ—¶è·å¾—é€šçŸ¥ï¼Œä»¥ä¾¿å¯ä»¥åšç›¸åº”çš„è¡¥æ•‘æªæ–½ï¼Œæ¯”å¦‚é€‰æ‹©é‡è¯•å‘é€ï¼ˆå¯èƒ½ä¼šå¼•èµ·æ¶ˆæ¯é‡å¤ï¼‰ã€‚ æœ‰äº›å‘é€å¼‚å¸¸å±äºå¯é‡è¯•å¼‚å¸¸ï¼Œæ¯”å¦‚ NetworkExceptionï¼Œè¿™ä¸ªå¯èƒ½æ˜¯ç”±ç¬æ—¶çš„ç½‘ç»œæ•…éšœè€Œå¯¼è‡´çš„ï¼Œä¸€èˆ¬é€šè¿‡é‡è¯•å°±å¯ä»¥è§£å†³ã€‚å¯¹äºè¿™ç±»å¼‚å¸¸ï¼Œå¦‚æœç›´æ¥æŠ›ç»™å®¢æˆ·ç«¯çš„ä½¿ç”¨æ–¹ä¹Ÿæœªå…è¿‡äºå…´å¸ˆåŠ¨ä¼—ï¼Œå®¢æˆ·ç«¯å†…éƒ¨æœ¬èº«æä¾›äº†é‡è¯•æœºåˆ¶æ¥åº”å¯¹è¿™ç§ç±»å‹çš„å¼‚å¸¸ï¼Œé€šè¿‡ retries å‚æ•°å³å¯é…ç½®ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œretrieså‚æ•°è®¾ç½®ä¸º0ï¼Œå³ä¸è¿›è¡Œé‡è¯•ï¼Œå¯¹äºé«˜å¯é æ€§è¦æ±‚çš„åœºæ™¯ï¼Œéœ€è¦å°†è¿™ä¸ªå€¼è®¾ç½®ä¸ºå¤§äº 0 çš„å€¼ï¼Œä¸ retries å‚æ•°ç›¸å…³çš„è¿˜æœ‰ä¸€ä¸ªretry.backoff.mså‚æ•°ï¼Œå®ƒç”¨æ¥è®¾å®šä¸¤æ¬¡é‡è¯•ä¹‹é—´çš„æ—¶é—´é—´éš”ï¼Œä»¥æ­¤é¿å…æ— æ•ˆçš„é¢‘ç¹é‡è¯•ã€‚åœ¨é…ç½®retrieså’Œretry.backoff.msä¹‹å‰ï¼Œæœ€å¥½å…ˆä¼°ç®—ä¸€ä¸‹å¯èƒ½çš„å¼‚å¸¸æ¢å¤æ—¶é—´ï¼Œè¿™æ ·å¯ä»¥è®¾å®šæ€»çš„é‡è¯•æ—¶é—´å¤§äºè¿™ä¸ªå¼‚å¸¸æ¢å¤æ—¶é—´ï¼Œä»¥æ­¤æ¥é¿å…ç”Ÿäº§è€…è¿‡æ—©åœ°æ”¾å¼ƒé‡è¯•ã€‚å¦‚æœä¸çŸ¥é“ retries å‚æ•°åº”è¯¥é…ç½®ä¸ºå¤šå°‘ï¼Œåˆ™å¯ä»¥å‚è€ƒ KafkaAdminClientï¼Œåœ¨ KafkaAdminClient ä¸­retrieså‚æ•°çš„é»˜è®¤å€¼ä¸º5ã€‚ å¦‚æœé…ç½®çš„retrieså‚æ•°å€¼å¤§äº0ï¼Œåˆ™å¯èƒ½å¼•èµ·ä¸€äº›è´Ÿé¢çš„å½±å“ã€‚ç”±äºé»˜è®¤çš„max.in.flight.requests.per.connectionå‚æ•°å€¼ä¸º5ï¼Œè¿™æ ·å¯èƒ½ä¼šå½±å“æ¶ˆæ¯çš„é¡ºåºæ€§ï¼Œå¯¹æ­¤è¦ä¹ˆæ”¾å¼ƒå®¢æˆ·ç«¯å†…éƒ¨çš„é‡è¯•åŠŸèƒ½ï¼Œè¦ä¹ˆå°†max.in.flight.requests.per.connectionå‚æ•°è®¾ç½®ä¸º1ï¼Œè¿™æ ·ä¹Ÿå°±æ”¾å¼ƒäº†ååã€‚å…¶æ¬¡ï¼Œæœ‰äº›åº”ç”¨å¯¹äºæ—¶å»¶çš„è¦æ±‚å¾ˆé«˜ï¼Œå¾ˆå¤šæ—¶å€™éƒ½æ˜¯éœ€è¦å¿«é€Ÿå¤±è´¥çš„ï¼Œè®¾ç½®retriesï¼0ä¼šå¢åŠ å®¢æˆ·ç«¯å¯¹äºå¼‚å¸¸çš„åé¦ˆæ—¶å»¶ï¼Œå¦‚æ­¤å¯èƒ½ä¼šå¯¹åº”ç”¨é€ æˆä¸è‰¯çš„å½±å“ã€‚ ç”Ÿäº§è€…å®¢æˆ·ç«¯å‚æ•° acks ä¹Ÿæ˜¯ç”¨æ¥æ”¯æ’‘å¯é æ€§çš„ã€‚è¯¥å‚æ•°æœ‰ä¸‰ä¸ªå¯é€‰é¡¹ï¼š0ã€1ã€-1ï¼ˆå®¢æˆ·ç«¯è¿˜å¯ä»¥é…ç½®ä¸ºallï¼Œå®ƒçš„å«ä¹‰ä¸-1ä¸€æ ·ï¼Œä»¥ä¸‹åªä»¥-1æ¥è¿›è¡Œé™ˆè¿°ï¼‰ å¯¹äºacks=1çš„é…ç½®ï¼Œç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°leaderå‰¯æœ¬ï¼Œleaderå‰¯æœ¬åœ¨æˆåŠŸå†™å…¥æœ¬åœ°æ—¥å¿—ä¹‹åä¼šå‘ŠçŸ¥ç”Ÿäº§è€…å·²ç»æˆåŠŸæäº¤ã€‚ï¼ˆå¦‚æœæ­¤æ—¶ISRé›†åˆçš„followerå‰¯æœ¬è¿˜æ²¡æ¥å¾—åŠæ‹‰å–åˆ°leaderä¸­æ–°å†™å…¥çš„æ¶ˆæ¯ï¼Œleaderå°±å®•æœºäº†ï¼Œé‚£ä¹ˆæ­¤æ¬¡å‘é€çš„æ¶ˆæ¯å°±ä¼šä¸¢å¤±ã€‚ï¼‰ å¯¹äºack=-1çš„é…ç½®ï¼Œç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°leaderå‰¯æœ¬ï¼Œleaderå‰¯æœ¬åœ¨æˆåŠŸå†™å…¥æœ¬åœ°æ—¥å¿—ä¹‹åè¿˜è¦ç­‰å¾… ISR ä¸­çš„ follower å‰¯æœ¬å…¨éƒ¨åŒæ­¥å®Œæˆæ‰èƒ½å¤Ÿå‘ŠçŸ¥ç”Ÿäº§è€…å·²ç»æˆåŠŸæäº¤ï¼Œå³ä½¿æ­¤æ—¶leaderå‰¯æœ¬å®•æœºï¼Œæ¶ˆæ¯ä¹Ÿä¸ä¼šä¸¢å¤± åœ¨acks=-1çš„æƒ…å½¢ä¸­ï¼Œå®ƒè¦æ±‚ISRä¸­æ‰€æœ‰çš„å‰¯æœ¬éƒ½æ”¶åˆ°ç›¸å…³çš„æ¶ˆæ¯ä¹‹åæ‰èƒ½å¤Ÿå‘ŠçŸ¥ç”Ÿäº§è€…å·²ç»æˆåŠŸæäº¤ã€‚è¯•æƒ³ä¸€ä¸‹è¿™æ ·çš„æƒ…å½¢ï¼Œleader å‰¯æœ¬çš„æ¶ˆæ¯æµå…¥é€Ÿåº¦å¾ˆå¿«ï¼Œè€Œfollowerå‰¯æœ¬çš„åŒæ­¥é€Ÿåº¦å¾ˆæ…¢ï¼Œåœ¨æŸä¸ªä¸´ç•Œç‚¹æ—¶æ‰€æœ‰çš„followerå‰¯æœ¬éƒ½è¢«å‰”é™¤å‡ºäº†ISRé›†åˆï¼Œé‚£ä¹ˆISRä¸­åªæœ‰ä¸€ä¸ªleaderå‰¯æœ¬ï¼Œæœ€ç»ˆacks=-1æ¼”å˜ä¸ºacks=1çš„æƒ…å½¢ï¼Œå¦‚æ­¤ä¹Ÿå°±åŠ å¤§äº†æ¶ˆæ¯ä¸¢å¤±çš„é£é™©ã€‚ Kafkaä¹Ÿè€ƒè™‘åˆ°äº†è¿™ç§æƒ…å†µï¼Œå¹¶ä¸ºæ­¤æä¾›äº†min.insync.replicaså‚æ•°ï¼ˆé»˜è®¤å€¼ä¸º1ï¼‰æ¥ä½œä¸ºè¾…åŠ©ï¼ˆé…åˆacks=-1æ¥ä½¿ç”¨ï¼‰ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šäº†ISRé›†åˆä¸­æœ€å°çš„å‰¯æœ¬æ•°ï¼Œå¦‚æœä¸æ»¡è¶³æ¡ä»¶å°±ä¼šæŠ›å‡ºNotEnoughReplicasExceptionæˆ–NotEnoughReplicasAfterAppendExceptionã€‚ åœ¨æ­£å¸¸çš„é…ç½®ä¸‹ï¼Œéœ€è¦æ»¡è¶³å‰¯æœ¬æ•° ï¼ min.insync.replicaså‚æ•°çš„å€¼ã€‚ä¸€ä¸ªå…¸å‹çš„é…ç½®æ–¹æ¡ˆä¸ºï¼šå‰¯æœ¬æ•°é…ç½®ä¸º 3ï¼Œmin.insync.replicas å‚æ•°å€¼é…ç½®ä¸º 2ã€‚æ³¨æ„min.insync.replicaså‚æ•°åœ¨æå‡å¯é æ€§çš„æ—¶å€™ä¼šä»ä¾§é¢å½±å“å¯ç”¨æ€§ã€‚ï¼ˆè¯•æƒ³å¦‚æœISRä¸­åªæœ‰ä¸€ä¸ªleaderå‰¯æœ¬ï¼Œé‚£ä¹ˆæœ€èµ·ç è¿˜å¯ä»¥ä½¿ç”¨ï¼Œè€Œæ­¤æ—¶å¦‚æœé…ç½®min.insync.replicasï¼1ï¼Œåˆ™ä¼šä½¿æ¶ˆæ¯æ— æ³•å†™å…¥ã€‚ï¼‰ ä¸å¯é æ€§å’ŒISRé›†åˆæœ‰å…³çš„è¿˜æœ‰ä¸€ä¸ªå‚æ•°â€”unclean.leader.election.enableã€‚è¿™ä¸ªå‚æ•°çš„é»˜è®¤å€¼ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueå°±æ„å‘³ç€å½“leaderä¸‹çº¿æ—¶å€™å¯ä»¥ä»éISRé›†åˆä¸­é€‰ä¸¾å‡ºæ–°çš„ leaderï¼Œè¿™æ ·æœ‰å¯èƒ½é€ æˆæ•°æ®çš„ä¸¢å¤±ã€‚å¦‚æœè¿™ä¸ªå‚æ•°è®¾ç½®ä¸ºfalseï¼Œé‚£ä¹ˆä¹Ÿä¼šå½±å“å¯ç”¨æ€§ï¼ŒéISRé›†åˆä¸­çš„å‰¯æœ¬è™½ç„¶æ²¡èƒ½åŠæ—¶åŒæ­¥æ‰€æœ‰çš„æ¶ˆæ¯ï¼Œä½†æœ€èµ·ç è¿˜æ˜¯å­˜æ´»çš„å¯ç”¨å‰¯æœ¬ã€‚ä»0.11.0.0 ç‰ˆæœ¬å¼€å§‹ï¼Œunclean.leader.election.enable çš„é»˜è®¤å€¼ç”±åŸæ¥çš„ true æ”¹ä¸ºäº†falseï¼Œå¯ä»¥çœ‹å‡ºKafkaçš„è®¾è®¡è€…æ„ˆå‘åœ°åå‘äºå¯é æ€§çš„æå‡ã€‚ æ¶ˆæ¯å­˜å‚¨é˜¶æ®µå­˜å‚¨æ¶ˆæ¯é˜¶æ®µéœ€è¦åœ¨æ¶ˆæ¯åˆ·ç›˜ä¹‹åå†ç»™ç”Ÿäº§è€…å“åº”ï¼Œå‡è®¾æ¶ˆæ¯å†™å…¥ç¼“å­˜ä¸­å°±è¿”å›å“åº”ï¼Œé‚£ä¹ˆæœºå™¨çªç„¶æ–­ç”µè¿™æ¶ˆæ¯å°±æ²¡äº†ï¼Œè€Œç”Ÿäº§è€…ä»¥ä¸ºå·²ç»å‘é€æˆåŠŸäº†ã€‚ å¦‚æœBrokeræ˜¯é›†ç¾¤éƒ¨ç½²ï¼Œæœ‰å¤šå‰¯æœ¬æœºåˆ¶ï¼Œå³æ¶ˆæ¯ä¸ä»…ä»…è¦å†™å…¥å½“å‰Broker,è¿˜éœ€è¦å†™å…¥å‰¯æœ¬æœºä¸­ã€‚é‚£é…ç½®æˆè‡³å°‘å†™å…¥ä¸¤å°æœºå­åå†ç»™ç”Ÿäº§è€…å“åº”ã€‚è¿™æ ·åŸºæœ¬ä¸Šå°±èƒ½ä¿è¯å­˜å‚¨çš„å¯é äº†ã€‚ä¸€å°æŒ‚äº†è¿˜æœ‰ä¸€å°è¿˜åœ¨å‘¢ã€‚ é‚£å‡å¦‚æ¥ä¸ªåœ°éœ‡æœºæˆ¿æœºå­éƒ½æŒ‚äº†å‘¢ï¼Ÿemmmmmmâ€¦å¤§å…¬å¸åŸºæœ¬ä¸Šéƒ½æœ‰å¼‚åœ°å¤šæ´»ã€‚ å°±Kafkaè€Œè¨€ï¼Œè¶Šå¤šçš„å‰¯æœ¬æ•°è¶Šèƒ½å¤Ÿä¿è¯æ•°æ®çš„å¯é æ€§ï¼Œå‰¯æœ¬æ•°å¯ä»¥åœ¨åˆ›å»ºä¸»é¢˜æ—¶é…ç½®ï¼Œä¹Ÿå¯ä»¥åœ¨åæœŸä¿®æ”¹ï¼Œä¸è¿‡å‰¯æœ¬æ•°è¶Šå¤šä¹Ÿä¼šå¼•èµ·ç£ç›˜ã€ç½‘ç»œå¸¦å®½çš„æµªè´¹ï¼ŒåŒæ—¶ä¼šå¼•èµ·æ€§èƒ½çš„ä¸‹é™ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œè®¾ç½®å‰¯æœ¬æ•°ä¸º3å³å¯æ»¡è¶³ç»å¤§å¤šæ•°åœºæ™¯å¯¹å¯é æ€§çš„è¦æ±‚ï¼Œè€Œå¯¹å¯é æ€§è¦æ±‚æ›´é«˜çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥é€‚å½“å¢å¤§è¿™ä¸ªæ•°å€¼ï¼Œæ¯”å¦‚å›½å†…éƒ¨åˆ†é“¶è¡Œåœ¨ä½¿ç”¨ Kafka æ—¶å°±ä¼šè®¾ç½®å‰¯æœ¬æ•°ä¸º 5ã€‚ åœ¨brokerç«¯è¿˜æœ‰ä¸¤ä¸ªå‚æ•°log.flush.interval.messages å’Œ log.flush.interval.msï¼Œç”¨æ¥è°ƒæ•´åŒæ­¥åˆ·ç›˜çš„ç­–ç•¥ï¼Œé»˜è®¤æ˜¯ä¸åšæ§åˆ¶è€Œäº¤ç”±æ“ä½œç³»ç»Ÿæœ¬èº«æ¥è¿›è¡Œå¤„ç†ã€‚åŒæ­¥åˆ·ç›˜æ˜¯å¢å¼ºä¸€ä¸ªç»„ä»¶å¯é æ€§çš„æœ‰æ•ˆæ–¹å¼ï¼Œä¸è¿‡è¿™ç§æ–¹å¼æå…¶æŸè€—æ€§èƒ½ï¼Œæœ€å¥½è¿˜æ˜¯é‡‡ç”¨å¤šå‰¯æœ¬çš„æœºåˆ¶æ¥ä¿éšœã€‚ æ¶ˆæ¯æ¶ˆè´¹é˜¶æ®µæ¶ˆè´¹è€…éœ€è¦çœŸæ­£æ‰§è¡Œå®Œä¸šåŠ¡é€»è¾‘ä¹‹åï¼Œå†å‘é€ç»™Brokeræ¶ˆè´¹æˆåŠŸï¼Œè¿™æ‰æ˜¯çœŸæ­£çš„æ¶ˆè´¹äº†ã€‚ æ‰€ä»¥åªè¦æˆ‘ä»¬åœ¨æ¶ˆæ¯ä¸šåŠ¡é€»è¾‘å¤„ç†å®Œæˆä¹‹åå†ç»™Brokerå“åº”ï¼Œé‚£ä¹ˆæ¶ˆè´¹é˜¶æ®µæ¶ˆæ¯å°±ä¸ä¼šä¸¢å¤±ã€‚ åœ¨kafkaä¸­ï¼Œæ¶ˆæ¯åœ¨è¢«è¿½åŠ åˆ° Partition(åˆ†åŒº)çš„æ—¶å€™éƒ½ä¼šåˆ†é…ä¸€ä¸ªç‰¹å®šçš„åç§»é‡ï¼ˆoffsetï¼‰ã€‚åç§»é‡ï¼ˆoffset)è¡¨ç¤º Consumer å½“å‰æ¶ˆè´¹åˆ°çš„ Partition(åˆ†åŒº)çš„æ‰€åœ¨çš„ä½ç½®ã€‚Kafka é€šè¿‡åç§»é‡ï¼ˆoffsetï¼‰å¯ä»¥ä¿è¯æ¶ˆæ¯åœ¨åˆ†åŒºå†…çš„é¡ºåºæ€§ã€‚ å½“æ¶ˆè´¹è€…æ‹‰å–åˆ°äº†åˆ†åŒºçš„æŸä¸ªæ¶ˆæ¯ä¹‹åï¼Œæ¶ˆè´¹è€…ä¼šè‡ªåŠ¨æäº¤äº† offsetï¼ˆenable.auto.commit å‚æ•°çš„é»˜è®¤å€¼ä¸º trueï¼‰ã€‚è™½ç„¶è¿™ç§æ–¹å¼éå¸¸ç®€ä¾¿ï¼Œä½†å®ƒä¼šå¸¦æ¥é‡å¤æ¶ˆè´¹å’Œæ¶ˆæ¯ä¸¢å¤±çš„é—®é¢˜ï¼Œå¯¹äºé«˜å¯é æ€§è¦æ±‚çš„åº”ç”¨æ¥è¯´æ˜¾ç„¶ä¸å¯å–ï¼Œæ‰€ä»¥éœ€è¦å°† enable.auto.commit å‚æ•°è®¾ç½®ä¸º false æ¥æ‰§è¡Œæ‰‹åŠ¨ä½ç§»æäº¤ã€‚åœ¨æ‰§è¡Œæ‰‹åŠ¨ä½ç§»æäº¤çš„æ—¶å€™ä¹Ÿè¦éµå¾ªä¸€ä¸ªåŸåˆ™ï¼šå¦‚æœæ¶ˆæ¯æ²¡æœ‰è¢«æˆåŠŸæ¶ˆè´¹ï¼Œé‚£ä¹ˆå°±ä¸èƒ½æäº¤æ‰€å¯¹åº”çš„æ¶ˆè´¹ä½ç§»ã€‚å¯¹äºé«˜å¯é è¦æ±‚çš„åº”ç”¨æ¥è¯´ï¼Œå®æ„¿é‡å¤æ¶ˆè´¹ä¹Ÿä¸åº”è¯¥å› ä¸ºæ¶ˆè´¹å¼‚å¸¸è€Œå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ã€‚ å¯¹äºæ¶ˆè´¹ç«¯ï¼ŒKafka è¿˜æä¾›äº†ä¸€ä¸ªå¯ä»¥å…œåº•çš„åŠŸèƒ½ï¼Œå³å›æº¯æ¶ˆè´¹ï¼Œé€šè¿‡è¿™ä¸ªåŠŸèƒ½å¯ä»¥è®©æˆ‘ä»¬èƒ½å¤Ÿæœ‰æœºä¼šå¯¹æ¼æ‰çš„æ¶ˆæ¯ç›¸åº”åœ°è¿›è¡Œå›è¡¥ï¼Œè¿›è€Œå¯ä»¥è¿›ä¸€æ­¥æé«˜å¯é æ€§ã€‚","categories":[{"name":"kafka","slug":"kafka","permalink":"https://gyl-coder.top/categories/kafka/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://gyl-coder.top/tags/kafka/"},{"name":"å¯é æ€§","slug":"å¯é æ€§","permalink":"https://gyl-coder.top/tags/%E5%8F%AF%E9%9D%A0%E6%80%A7/"},{"name":"ä¸€è‡´æ€§","slug":"ä¸€è‡´æ€§","permalink":"https://gyl-coder.top/tags/%E4%B8%80%E8%87%B4%E6%80%A7/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"Kafka Rebalanceæœºåˆ¶åˆ†æ","slug":"kafka/kafka-rebalance","date":"2019-12-05T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"kafka/kafka-rebalance/","link":"","permalink":"https://gyl-coder.top/kafka/kafka-rebalance/","excerpt":"Rebalance æœ¬è´¨ä¸Šæ˜¯ä¸€ç§åè®®ï¼Œè§„å®šäº†ä¸€ä¸ª Consumer Group ä¸‹çš„æ‰€æœ‰ consumer å¦‚ä½•è¾¾æˆä¸€è‡´ï¼Œæ¥åˆ†é…è®¢é˜… Topic çš„æ¯ä¸ªåˆ†åŒºã€‚ ä¾‹å¦‚ï¼šæŸ Group ä¸‹æœ‰ 20 ä¸ª consumer å®ä¾‹ï¼Œå®ƒè®¢é˜…äº†ä¸€ä¸ªå…·æœ‰ 100 ä¸ª partition çš„ Topic ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œkafka ä¼šä¸ºæ¯ä¸ª Consumer å¹³å‡çš„åˆ†é… 5 ä¸ªåˆ†åŒºã€‚è¿™ä¸ªåˆ†é…çš„è¿‡ç¨‹å°±æ˜¯ Rebalanceã€‚","text":"Rebalance æœ¬è´¨ä¸Šæ˜¯ä¸€ç§åè®®ï¼Œè§„å®šäº†ä¸€ä¸ª Consumer Group ä¸‹çš„æ‰€æœ‰ consumer å¦‚ä½•è¾¾æˆä¸€è‡´ï¼Œæ¥åˆ†é…è®¢é˜… Topic çš„æ¯ä¸ªåˆ†åŒºã€‚ ä¾‹å¦‚ï¼šæŸ Group ä¸‹æœ‰ 20 ä¸ª consumer å®ä¾‹ï¼Œå®ƒè®¢é˜…äº†ä¸€ä¸ªå…·æœ‰ 100 ä¸ª partition çš„ Topic ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œkafka ä¼šä¸ºæ¯ä¸ª Consumer å¹³å‡çš„åˆ†é… 5 ä¸ªåˆ†åŒºã€‚è¿™ä¸ªåˆ†é…çš„è¿‡ç¨‹å°±æ˜¯ Rebalanceã€‚ è§¦å‘ Rebalance çš„æ—¶æœºRebalance çš„è§¦å‘æ¡ä»¶æœ‰3ä¸ªã€‚ ç»„æˆå‘˜ä¸ªæ•°å‘ç”Ÿå˜åŒ–ã€‚ä¾‹å¦‚æœ‰æ–°çš„ consumer å®ä¾‹åŠ å…¥è¯¥æ¶ˆè´¹ç»„æˆ–è€…ç¦»å¼€ç»„ã€‚ è®¢é˜…çš„ Topic ä¸ªæ•°å‘ç”Ÿå˜åŒ–ã€‚ è®¢é˜… Topic çš„åˆ†åŒºæ•°å‘ç”Ÿå˜åŒ–ã€‚ Rebalance å‘ç”Ÿæ—¶ï¼ŒGroup ä¸‹æ‰€æœ‰ consumer å®ä¾‹éƒ½ä¼šåè°ƒåœ¨ä¸€èµ·å…±åŒå‚ä¸ï¼Œkafka èƒ½å¤Ÿä¿è¯å°½é‡è¾¾åˆ°æœ€å…¬å¹³çš„åˆ†é…ã€‚ä½†æ˜¯ Rebalance è¿‡ç¨‹å¯¹ consumer group ä¼šé€ æˆæ¯”è¾ƒä¸¥é‡çš„å½±å“ã€‚åœ¨ Rebalance çš„è¿‡ç¨‹ä¸­ consumer group ä¸‹çš„æ‰€æœ‰æ¶ˆè´¹è€…å®ä¾‹éƒ½ä¼šåœæ­¢å·¥ä½œï¼Œç­‰å¾… Rebalance è¿‡ç¨‹å®Œæˆã€‚ Rebalance è¿‡ç¨‹åˆ†æRebalance è¿‡ç¨‹åˆ†ä¸ºä¸¤æ­¥ï¼šJoin å’Œ Syncã€‚ Join é¡¾åæ€ä¹‰å°±æ˜¯åŠ å…¥ç»„ã€‚è¿™ä¸€æ­¥ä¸­ï¼Œæ‰€æœ‰æˆå‘˜éƒ½å‘coordinatorå‘é€JoinGroupè¯·æ±‚ï¼Œè¯·æ±‚åŠ å…¥æ¶ˆè´¹ç»„ã€‚ä¸€æ—¦æ‰€æœ‰æˆå‘˜éƒ½å‘é€äº†JoinGroupè¯·æ±‚ï¼Œcoordinatorä¼šä»ä¸­é€‰æ‹©ä¸€ä¸ªconsumeræ‹…ä»»leaderçš„è§’è‰²ï¼Œå¹¶æŠŠç»„æˆå‘˜ä¿¡æ¯ä»¥åŠè®¢é˜…ä¿¡æ¯å‘ç»™leaderâ€”â€”æ³¨æ„leaderå’Œcoordinatorä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µã€‚leaderè´Ÿè´£æ¶ˆè´¹åˆ†é…æ–¹æ¡ˆçš„åˆ¶å®šã€‚ Syncï¼Œè¿™ä¸€æ­¥leaderå¼€å§‹åˆ†é…æ¶ˆè´¹æ–¹æ¡ˆï¼Œå³å“ªä¸ªconsumerè´Ÿè´£æ¶ˆè´¹å“ªäº›topicçš„å“ªäº›partitionã€‚ä¸€æ—¦å®Œæˆåˆ†é…ï¼Œleaderä¼šå°†è¿™ä¸ªæ–¹æ¡ˆå°è£…è¿›SyncGroupè¯·æ±‚ä¸­å‘ç»™coordinatorï¼Œéleaderä¹Ÿä¼šå‘SyncGroupè¯·æ±‚ï¼Œåªæ˜¯å†…å®¹ä¸ºç©ºã€‚coordinatoræ¥æ”¶åˆ°åˆ†é…æ–¹æ¡ˆä¹‹åä¼šæŠŠæ–¹æ¡ˆå¡è¿›SyncGroupçš„responseä¸­å‘ç»™å„ä¸ªconsumerã€‚è¿™æ ·ç»„å†…çš„æ‰€æœ‰æˆå‘˜å°±éƒ½çŸ¥é“è‡ªå·±åº”è¯¥æ¶ˆè´¹å“ªäº›åˆ†åŒºäº†ã€‚ Rebalance åœºæ™¯åˆ†ææ–°æˆå‘˜åŠ å…¥ç»„ ç»„æˆå‘˜â€œå´©æºƒâ€ç»„æˆå‘˜å´©æºƒå’Œç»„æˆå‘˜ä¸»åŠ¨ç¦»å¼€æ˜¯ä¸¤ä¸ªä¸åŒçš„åœºæ™¯ã€‚å› ä¸ºåœ¨å´©æºƒæ—¶æˆå‘˜å¹¶ä¸ä¼šä¸»åŠ¨åœ°å‘ŠçŸ¥coordinatoræ­¤äº‹ï¼Œcoordinatoræœ‰å¯èƒ½éœ€è¦ä¸€ä¸ªå®Œæ•´çš„session.timeoutå‘¨æœŸ(å¿ƒè·³å‘¨æœŸ)æ‰èƒ½æ£€æµ‹åˆ°è¿™ç§å´©æºƒï¼Œè¿™å¿…ç„¶ä¼šé€ æˆconsumerçš„æ»åã€‚å¯ä»¥è¯´ç¦»å¼€ç»„æ˜¯ä¸»åŠ¨åœ°å‘èµ·rebalanceï¼›è€Œå´©æºƒåˆ™æ˜¯è¢«åŠ¨åœ°å‘èµ·rebalanceã€‚ ç»„æˆå‘˜ä¸»åŠ¨ç¦»å¼€ç»„ æäº¤ä½ç§» å¦‚ä½•é¿å…ä¸å¿…è¦çš„rebalanceè¦é¿å… Rebalanceï¼Œè¿˜æ˜¯è¦ä» Rebalance å‘ç”Ÿçš„æ—¶æœºå…¥æ‰‹ã€‚æˆ‘ä»¬åœ¨å‰é¢è¯´è¿‡ï¼ŒRebalance å‘ç”Ÿçš„æ—¶æœºæœ‰ä¸‰ä¸ªï¼š ç»„æˆå‘˜æ•°é‡å‘ç”Ÿå˜åŒ– è®¢é˜…ä¸»é¢˜æ•°é‡å‘ç”Ÿå˜åŒ– è®¢é˜…ä¸»é¢˜çš„åˆ†åŒºæ•°å‘ç”Ÿå˜åŒ– åä¸¤ä¸ªæˆ‘ä»¬å¤§å¯ä»¥äººä¸ºçš„é¿å…ï¼Œå‘ç”Ÿrebalanceæœ€å¸¸è§çš„åŸå› æ˜¯æ¶ˆè´¹ç»„æˆå‘˜çš„å˜åŒ–ã€‚ æ¶ˆè´¹è€…æˆå‘˜æ­£å¸¸çš„æ·»åŠ å’Œåœæ‰å¯¼è‡´rebalanceï¼Œè¿™ç§æƒ…å†µæ— æ³•é¿å…ï¼Œä½†æ˜¯æ—¶åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒConsumer å®ä¾‹ä¼šè¢« Coordinator é”™è¯¯åœ°è®¤ä¸º â€œå·²åœæ­¢â€ ä»è€Œè¢«â€œè¸¢å‡ºâ€Groupã€‚ä»è€Œå¯¼è‡´rebalanceã€‚ å½“ Consumer Group å®Œæˆ Rebalance ä¹‹åï¼Œæ¯ä¸ª Consumer å®ä¾‹éƒ½ä¼šå®šæœŸåœ°å‘ Coordinator å‘é€å¿ƒè·³è¯·æ±‚ï¼Œè¡¨æ˜å®ƒè¿˜å­˜æ´»ç€ã€‚å¦‚æœæŸä¸ª Consumer å®ä¾‹ä¸èƒ½åŠæ—¶åœ°å‘é€è¿™äº›å¿ƒè·³è¯·æ±‚ï¼ŒCoordinator å°±ä¼šè®¤ä¸ºè¯¥ Consumer å·²ç» â€œæ­»â€ äº†ï¼Œä»è€Œå°†å…¶ä» Group ä¸­ç§»é™¤ï¼Œç„¶åå¼€å¯æ–°ä¸€è½® Rebalanceã€‚è¿™ä¸ªæ—¶é—´å¯ä»¥é€šè¿‡Consumer ç«¯çš„å‚æ•° session.timeout.msè¿›è¡Œé…ç½®ã€‚é»˜è®¤å€¼æ˜¯ 10 ç§’ã€‚ é™¤äº†è¿™ä¸ªå‚æ•°ï¼ŒConsumer è¿˜æä¾›äº†ä¸€ä¸ªæ§åˆ¶å‘é€å¿ƒè·³è¯·æ±‚é¢‘ç‡çš„å‚æ•°ï¼Œå°±æ˜¯ heartbeat.interval.msã€‚è¿™ä¸ªå€¼è®¾ç½®å¾—è¶Šå°ï¼ŒConsumer å®ä¾‹å‘é€å¿ƒè·³è¯·æ±‚çš„é¢‘ç‡å°±è¶Šé«˜ã€‚é¢‘ç¹åœ°å‘é€å¿ƒè·³è¯·æ±‚ä¼šé¢å¤–æ¶ˆè€—å¸¦å®½èµ„æºï¼Œä½†å¥½å¤„æ˜¯èƒ½å¤Ÿæ›´åŠ å¿«é€Ÿåœ°çŸ¥æ™“å½“å‰æ˜¯å¦å¼€å¯ Rebalanceï¼Œå› ä¸ºï¼Œç›®å‰ Coordinator é€šçŸ¥å„ä¸ª Consumer å®ä¾‹å¼€å¯ Rebalance çš„æ–¹æ³•ï¼Œå°±æ˜¯å°† REBALANCE_NEEDED æ ‡å¿—å°è£…è¿›å¿ƒè·³è¯·æ±‚çš„å“åº”ä½“ä¸­ã€‚ é™¤äº†ä»¥ä¸Šä¸¤ä¸ªå‚æ•°ï¼ŒConsumer ç«¯è¿˜æœ‰ä¸€ä¸ªå‚æ•°ï¼Œç”¨äºæ§åˆ¶ Consumer å®é™…æ¶ˆè´¹èƒ½åŠ›å¯¹ Rebalance çš„å½±å“ï¼Œå³ max.poll.interval.ms å‚æ•°ã€‚å®ƒé™å®šäº† Consumer ç«¯åº”ç”¨ç¨‹åºä¸¤æ¬¡è°ƒç”¨ poll æ–¹æ³•çš„æœ€å¤§æ—¶é—´é—´éš”ã€‚å®ƒçš„é»˜è®¤å€¼æ˜¯ 5 åˆ†é’Ÿï¼Œè¡¨ç¤ºä½ çš„ Consumer ç¨‹åºå¦‚æœåœ¨ 5 åˆ†é’Ÿä¹‹å†…æ— æ³•æ¶ˆè´¹å®Œ poll æ–¹æ³•è¿”å›çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆ Consumer ä¼šä¸»åŠ¨å‘èµ· â€œç¦»å¼€ç»„â€ çš„è¯·æ±‚ï¼ŒCoordinator ä¹Ÿä¼šå¼€å¯æ–°ä¸€è½® Rebalanceã€‚ é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹é‚£äº›rebalanceæ˜¯å¯ä»¥é¿å…çš„ï¼š ç¬¬ä¸€ç±»éå¿…è¦ Rebalance æ˜¯å› ä¸ºæœªèƒ½åŠæ—¶å‘é€å¿ƒè·³ï¼Œå¯¼è‡´ Consumer è¢« â€œè¸¢å‡ºâ€Group è€Œå¼•å‘çš„ã€‚è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥è®¾ç½® session.timeout.ms å’Œ heartbeat.interval.ms çš„å€¼ï¼Œæ¥å°½é‡é¿å…rebalanceçš„å‡ºç°ã€‚ï¼ˆä»¥ä¸‹çš„é…ç½®æ˜¯åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„æœ€ä½³å®è·µï¼Œæš‚æ—¶è¿˜æ²¡æµ‹è¯•è¿‡ï¼‰ è®¾ç½® session.timeout.ms = 6sã€‚ è®¾ç½® heartbeat.interval.ms = 2sã€‚ è¦ä¿è¯ Consumer å®ä¾‹åœ¨è¢«åˆ¤å®šä¸º â€œdeadâ€ ä¹‹å‰ï¼Œèƒ½å¤Ÿå‘é€è‡³å°‘ 3 è½®çš„å¿ƒè·³è¯·æ±‚ï¼Œå³ session.timeout.ms &gt;= 3 * heartbeat.interval.msã€‚ å°† session.timeout.ms è®¾ç½®æˆ 6s ä¸»è¦æ˜¯ä¸ºäº†è®© Coordinator èƒ½å¤Ÿæ›´å¿«åœ°å®šä½å·²ç»æŒ‚æ‰çš„ Consumerï¼Œæ—©æ—¥æŠŠå®ƒä»¬è¸¢å‡º Groupã€‚ ç¬¬äºŒç±»éå¿…è¦ Rebalance æ˜¯ Consumer æ¶ˆè´¹æ—¶é—´è¿‡é•¿å¯¼è‡´çš„ã€‚æ­¤æ—¶ï¼Œmax.poll.interval.ms å‚æ•°å€¼çš„è®¾ç½®æ˜¾å¾—å°¤ä¸ºå…³é”®ã€‚å¦‚æœè¦é¿å…éé¢„æœŸçš„ Rebalanceï¼Œä½ æœ€å¥½å°†è¯¥å‚æ•°å€¼è®¾ç½®å¾—å¤§ä¸€ç‚¹ï¼Œæ¯”ä½ çš„ä¸‹æ¸¸æœ€å¤§å¤„ç†æ—¶é—´ç¨é•¿ä¸€ç‚¹ã€‚ æ€»ä¹‹ï¼Œè¦ä¸ºä¸šåŠ¡å¤„ç†é€»è¾‘ç•™ä¸‹å……è¶³çš„æ—¶é—´ã€‚è¿™æ ·ï¼ŒConsumer å°±ä¸ä¼šå› ä¸ºå¤„ç†è¿™äº›æ¶ˆæ¯çš„æ—¶é—´å¤ªé•¿è€Œå¼•å‘ Rebalance ã€‚ ç›¸å…³æ¦‚å¿µcoordinatorGroup Coordinatoræ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œæ¯ä¸ªBrokeråœ¨å¯åŠ¨çš„æ—¶å€™éƒ½ä¼šå¯åŠ¨ä¸€ä¸ªè¯¥æœåŠ¡ã€‚Group Coordinatorçš„ä½œç”¨æ˜¯ç”¨æ¥å­˜å‚¨Groupçš„ç›¸å…³Metaä¿¡æ¯ï¼Œå¹¶å°†å¯¹åº”Partitionçš„Offsetä¿¡æ¯è®°å½•åˆ°Kafkaå†…ç½®Topic(__consumer_offsets)ä¸­ã€‚Kafkaåœ¨0.9ä¹‹å‰æ˜¯åŸºäºZookeeperæ¥å­˜å‚¨Partitionçš„Offsetä¿¡æ¯(consumers/{group}/offsets/{topic}/{partition})ï¼Œå› ä¸ºZKå¹¶ä¸é€‚ç”¨äºé¢‘ç¹çš„å†™æ“ä½œï¼Œæ‰€ä»¥åœ¨0.9ä¹‹åé€šè¿‡å†…ç½®Topicçš„æ–¹å¼æ¥è®°å½•å¯¹åº”Partitionçš„Offsetã€‚ æ¯ä¸ªGroupéƒ½ä¼šé€‰æ‹©ä¸€ä¸ªCoordinatoræ¥å®Œæˆè‡ªå·±ç»„å†…å„Partitionçš„Offsetä¿¡æ¯ï¼Œé€‰æ‹©çš„è§„åˆ™å¦‚ä¸‹ï¼š 1ï¼Œè®¡ç®—Groupå¯¹åº”åœ¨__consumer_offsetsä¸Šçš„Partition 2ï¼Œæ ¹æ®å¯¹åº”çš„Partitionå¯»æ‰¾è¯¥Partitionçš„leaderæ‰€å¯¹åº”çš„Brokerï¼Œè¯¥Brokerä¸Šçš„Group Coordinatorå³å°±æ˜¯è¯¥Groupçš„Coordinator Partitionè®¡ç®—è§„åˆ™ï¼š partition-Id(__consumer_offsets) = Math.abs(groupId.hashCode() % groupMetadataTopicPartitionCount) å…¶ä¸­groupMetadataTopicPartitionCountå¯¹åº”offsets.topic.num.partitionså‚æ•°å€¼ï¼Œé»˜è®¤å€¼æ˜¯50ä¸ªåˆ†åŒºã€‚","categories":[{"name":"kafka","slug":"kafka","permalink":"https://gyl-coder.top/categories/kafka/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://gyl-coder.top/tags/kafka/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.github.io"}},{"title":"Kafkaæœ‰å“ªå‡ å¤„åœ°æ–¹æœ‰åˆ†åŒºåˆ†é…çš„æ¦‚å¿µï¼Ÿç®€è¿°å¤§è‡´çš„è¿‡ç¨‹åŠåŸç†","slug":"kafka/kafka-partition-alocation","date":"2019-12-04T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"kafka/kafka-partition-alocation/","link":"","permalink":"https://gyl-coder.top/kafka/kafka-partition-alocation/","excerpt":"åœ¨ kafka ä¸­ï¼Œåˆ†åŒºåˆ†é…æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œå®ƒä¼šå½±å“Kafkaæ•´ä½“çš„æ€§èƒ½å‡è¡¡ã€‚kafka ä¸­ä¸€å…±æœ‰ä¸‰å¤„åœ°æ–¹æ¶‰åŠæ­¤æ¦‚å¿µï¼Œåˆ†åˆ«æ˜¯ï¼šç”Ÿäº§è€…å‘é€æ¶ˆæ¯ã€æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯å’Œåˆ›å»ºä¸»é¢˜ã€‚è™½ç„¶è¿™ä¸‰å¤„çš„å¯¹åº”æ“ä½œéƒ½å¯ä»¥è¢«ç§°ä¹‹ä¸ºâ€œåˆ†åŒºåˆ†é…â€ï¼Œä½†æ˜¯å…¶å®è´¨ä¸Šæ‰€åŒ…å«çš„å†…å®¹å´å¹¶ä¸ç›¸åŒã€‚","text":"åœ¨ kafka ä¸­ï¼Œåˆ†åŒºåˆ†é…æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µï¼Œå®ƒä¼šå½±å“Kafkaæ•´ä½“çš„æ€§èƒ½å‡è¡¡ã€‚kafka ä¸­ä¸€å…±æœ‰ä¸‰å¤„åœ°æ–¹æ¶‰åŠæ­¤æ¦‚å¿µï¼Œåˆ†åˆ«æ˜¯ï¼šç”Ÿäº§è€…å‘é€æ¶ˆæ¯ã€æ¶ˆè´¹è€…æ¶ˆè´¹æ¶ˆæ¯å’Œåˆ›å»ºä¸»é¢˜ã€‚è™½ç„¶è¿™ä¸‰å¤„çš„å¯¹åº”æ“ä½œéƒ½å¯ä»¥è¢«ç§°ä¹‹ä¸ºâ€œåˆ†åŒºåˆ†é…â€ï¼Œä½†æ˜¯å…¶å®è´¨ä¸Šæ‰€åŒ…å«çš„å†…å®¹å´å¹¶ä¸ç›¸åŒã€‚ ç”Ÿäº§è€…çš„åˆ†åŒºåˆ†é…ç”¨æˆ·åœ¨ä½¿ç”¨ kafka å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯æ—¶ï¼Œè°ƒç”¨ send æ–¹æ³•å‘é€æ¶ˆæ¯ä¹‹åï¼Œæ¶ˆæ¯å°±è‡ªç„¶è€Œç„¶çš„å‘é€åˆ°äº† broker ä¸­ã€‚ å…¶å®è¿™ä¸€è¿‡ç¨‹éœ€è¦ç»è¿‡æ‹¦æˆªå™¨ã€åºåˆ—åŒ–å™¨ã€åˆ†åŒºå™¨ç­‰ä¸€ç³»åˆ—ä½œç”¨ä¹‹åæ‰èƒ½è¢«çœŸæ­£å‘å¾€ brokerã€‚æ¶ˆæ¯åœ¨å‘å¾€ broker ä¹‹å‰éœ€è¦ç¡®è®¤å®ƒéœ€è¦å‘é€åˆ°çš„åˆ†åŒºï¼Œå¦‚æœ ProducerRecord ä¸­æŒ‡å®šäº† partition å­—æ®µï¼Œé‚£å°±ä¸éœ€è¦åˆ†åŒºå™¨çš„ä½œç”¨ï¼Œå› ä¸º partition å°±ä»£è¡¨çš„æ˜¯æ‰€è¦å‘å¾€çš„åˆ†åŒºå·ã€‚å¦‚æœæ¶ˆæ¯ProducerRecordä¸­æ²¡æœ‰æŒ‡å®špartitionå­—æ®µï¼Œé‚£ä¹ˆå°±éœ€è¦ä¾èµ–åˆ†åŒºå™¨ï¼Œæ ¹æ®keyè¿™ä¸ªå­—æ®µæ¥è®¡ç®—partitionçš„å€¼ã€‚åˆ†åŒºå™¨çš„ä½œç”¨å°±æ˜¯ä¸ºæ¶ˆæ¯åˆ†é…åˆ†åŒºã€‚ Kafkaä¸­æä¾›çš„é»˜è®¤åˆ†åŒºå™¨æ˜¯DefaultPartitionerï¼Œå®ƒå®ç°äº†Partitioneræ¥å£ï¼ˆç”¨æˆ·å¯ä»¥å®ç°è¿™ä¸ªæ¥å£æ¥è‡ªå®šä¹‰åˆ†åŒºå™¨ï¼‰ï¼Œå…¶ä¸­çš„partitionæ–¹æ³•å°±æ˜¯ç”¨æ¥å®ç°å…·ä½“çš„åˆ†åŒºåˆ†é…é€»è¾‘ï¼š public int partition(String topic, Object key, byte[] keyBytes, Object value, byte[] valueBytes, Cluster cluster); é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ¶ˆæ¯çš„keyä¸ä¸ºnullï¼Œé‚£ä¹ˆé»˜è®¤çš„åˆ†åŒºå™¨ä¼šå¯¹keyè¿›è¡Œå“ˆå¸Œï¼ˆé‡‡ç”¨MurmurHash2ç®—æ³•ï¼Œå…·å¤‡é«˜è¿ç®—æ€§èƒ½åŠä½ç¢°æ’ç‡ï¼‰ï¼Œæœ€ç»ˆæ ¹æ®å¾—åˆ°çš„å“ˆå¸Œå€¼æ¥è®¡ç®—åˆ†åŒºå·ï¼Œæ‹¥æœ‰ç›¸åŒkeyçš„æ¶ˆæ¯ä¼šè¢«å†™å…¥åŒä¸€ä¸ªåˆ†åŒºã€‚å¦‚æœkeyä¸ºnullï¼Œé‚£ä¹ˆæ¶ˆæ¯å°†ä¼šä»¥è½®è¯¢çš„æ–¹å¼å‘å¾€ topic çš„å„ä¸ªå¯ç”¨åˆ†åŒºã€‚ æ³¨æ„ï¼šå¦‚æœkeyä¸ä¸ºnullï¼Œé‚£ä¹ˆè®¡ç®—å¾—åˆ°çš„åˆ†åŒºå·ä¼šæ˜¯æ‰€æœ‰åˆ†åŒºä¸­çš„ä»»æ„ä¸€ä¸ªï¼›å¦‚æœkeyä¸ºnullå¹¶ä¸”æœ‰å¯ç”¨åˆ†åŒºï¼Œé‚£ä¹ˆè®¡ç®—å¾—åˆ°çš„åˆ†åŒºå·ä»…ä¸ºå¯ç”¨åˆ†åŒºä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œæ³¨æ„ä¸¤è€…ä¹‹é—´çš„å·®åˆ«ã€‚ æ¶ˆè´¹è€…çš„åˆ†åŒºåˆ†é…åœ¨Kafkaçš„é»˜è®¤è§„åˆ™ä¸­ï¼Œæ¯ä¸€ä¸ªåˆ†åŒºåªèƒ½è¢«åŒä¸€ä¸ªæ¶ˆè´¹ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ã€‚æ¶ˆè´¹è€…çš„åˆ†åŒºåˆ†é…æ˜¯æŒ‡ä¸ºæ¶ˆè´¹ç»„ä¸­çš„æ¶ˆè´¹è€…åˆ†é…æ‰€è®¢é˜…ä¸»é¢˜ä¸­çš„åˆ†åŒºã€‚ å¦‚å›¾æ‰€ç¤ºï¼ŒæŸä¸ªä¸»é¢˜ä¸­å…±æœ‰4ä¸ªåˆ†åŒºï¼ˆPartitionï¼‰ï¼šP0ã€P1ã€P2ã€P3ã€‚æœ‰ä¸¤ä¸ªæ¶ˆè´¹ç»„Aå’ŒBéƒ½è®¢é˜…äº†è¿™ä¸ªä¸»é¢˜ï¼Œæ¶ˆè´¹ç»„Aä¸­æœ‰4ä¸ªæ¶ˆè´¹è€…ï¼ˆC0ã€C1ã€C2å’ŒC3ï¼‰ï¼Œæ¶ˆè´¹ç»„Bä¸­æœ‰2ä¸ªæ¶ˆè´¹è€…ï¼ˆC4å’ŒC5ï¼‰ã€‚æŒ‰ç…§Kafkaé»˜è®¤çš„è§„åˆ™ï¼Œæœ€åçš„åˆ†é…ç»“æœæ˜¯æ¶ˆè´¹ç»„Aä¸­çš„æ¯ä¸€ä¸ªæ¶ˆè´¹è€…åˆ†é…åˆ°1ä¸ªåˆ†åŒºï¼Œæ¶ˆè´¹ç»„Bä¸­çš„æ¯ä¸€ä¸ªæ¶ˆè´¹è€…åˆ†é…åˆ°2ä¸ªåˆ†åŒºï¼Œä¸¤ä¸ªæ¶ˆè´¹ç»„ä¹‹é—´äº’ä¸å½±å“ã€‚æ¯ä¸ªæ¶ˆè´¹è€…åªèƒ½æ¶ˆè´¹æ‰€åˆ†é…åˆ°çš„åˆ†åŒºä¸­çš„æ¶ˆæ¯ã€‚ å¯¹äºæ¶ˆè´¹è€…çš„åˆ†åŒºåˆ†é…è€Œè¨€ï¼ŒKafkaè‡ªèº«æä¾›äº†ä¸‰ç§ç­–ç•¥ï¼Œåˆ†åˆ«ä¸º RangeAssignorã€ RoundRobinAssignor ä»¥åŠ StickyAssignor ï¼Œå…¶ä¸­ RangeAssignor ä¸ºé»˜è®¤çš„åˆ†åŒºåˆ†é…ç­–ç•¥ã€‚ RangeAssignorRangeAssignorç­–ç•¥çš„åŸç†æ˜¯æŒ‰ç…§æ¶ˆè´¹è€…æ€»æ•°å’Œåˆ†åŒºæ€»æ•°è¿›è¡Œæ•´é™¤è¿ç®—æ¥è·å¾—ä¸€ä¸ªè·¨åº¦ï¼Œç„¶åå°†åˆ†åŒºæŒ‰ç…§è·¨åº¦è¿›è¡Œå¹³å‡åˆ†é…ï¼Œä»¥ä¿è¯åˆ†åŒºå°½å¯èƒ½å‡åŒ€åœ°åˆ†é…ç»™æ‰€æœ‰çš„æ¶ˆè´¹è€…ã€‚å¯¹äºæ¯ä¸€ä¸ªtopicï¼ŒRangeAssignorç­–ç•¥ä¼šå°†æ¶ˆè´¹ç»„å†…æ‰€æœ‰è®¢é˜…è¿™ä¸ªtopicçš„æ¶ˆè´¹è€…æŒ‰ç…§åç§°çš„å­—å…¸åºæ’åºï¼Œç„¶åä¸ºæ¯ä¸ªæ¶ˆè´¹è€…åˆ’åˆ†å›ºå®šçš„åˆ†åŒºèŒƒå›´ï¼Œå¦‚æœä¸å¤Ÿå¹³å‡åˆ†é…ï¼Œé‚£ä¹ˆå­—å…¸åºé å‰çš„æ¶ˆè´¹è€…ä¼šè¢«å¤šåˆ†é…ä¸€ä¸ªåˆ†åŒºã€‚ å‡è®¾n=åˆ†åŒºæ•°/æ¶ˆè´¹è€…æ•°é‡ï¼Œm=åˆ†åŒºæ•°%æ¶ˆè´¹è€…æ•°é‡ï¼Œé‚£ä¹ˆå‰mä¸ªæ¶ˆè´¹è€…æ¯ä¸ªåˆ†é…n+1ä¸ªåˆ†åŒºï¼Œåé¢çš„ï¼ˆæ¶ˆè´¹è€…æ•°é‡-mï¼‰ä¸ªæ¶ˆè´¹è€…æ¯ä¸ªåˆ†é…nä¸ªåˆ†åŒºã€‚ ä¸ºäº†æ›´åŠ é€šä¿—çš„è®²è§£RangeAssignorç­–ç•¥ï¼Œæˆ‘ä»¬ä¸å¦¨å†ä¸¾ä¸€äº›ç¤ºä¾‹ã€‚å‡è®¾æ¶ˆè´¹ç»„å†…æœ‰2ä¸ªæ¶ˆè´¹è€…C0å’ŒC1ï¼Œéƒ½è®¢é˜…äº†ä¸»é¢˜t0å’Œt1ï¼Œå¹¶ä¸”æ¯ä¸ªä¸»é¢˜éƒ½æœ‰4ä¸ªåˆ†åŒºï¼Œé‚£ä¹ˆæ‰€è®¢é˜…çš„æ‰€æœ‰åˆ†åŒºå¯ä»¥æ ‡è¯†ä¸ºï¼št0p0ã€t0p1ã€t0p2ã€t0p3ã€t1p0ã€t1p1ã€t1p2ã€t1p3ã€‚æœ€ç»ˆçš„åˆ†é…ç»“æœä¸ºï¼š æ¶ˆè´¹è€…C0ï¼št0p0ã€t0p1ã€t1p0ã€t1p1 æ¶ˆè´¹è€…C1ï¼št0p2ã€t0p3ã€t1p2ã€t1p3 è¿™æ ·åˆ†é…çš„å¾ˆå‡åŒ€ï¼Œé‚£ä¹ˆæ­¤ç§åˆ†é…ç­–ç•¥èƒ½å¤Ÿä¸€ç›´ä¿æŒè¿™ç§è‰¯å¥½çš„ç‰¹æ€§å‘¢ï¼Ÿæˆ‘ä»¬å†æ¥çœ‹ä¸‹å¦å¤–ä¸€ç§æƒ…å†µã€‚å‡è®¾ä¸Šé¢ä¾‹å­ä¸­2ä¸ªä¸»é¢˜éƒ½åªæœ‰3ä¸ªåˆ†åŒºï¼Œé‚£ä¹ˆæ‰€è®¢é˜…çš„æ‰€æœ‰åˆ†åŒºå¯ä»¥æ ‡è¯†ä¸ºï¼št0p0ã€t0p1ã€t0p2ã€t1p0ã€t1p1ã€t1p2ã€‚æœ€ç»ˆçš„åˆ†é…ç»“æœä¸ºï¼š æ¶ˆè´¹è€…C0ï¼št0p0ã€t0p1ã€t1p0ã€t1p1 æ¶ˆè´¹è€…C1ï¼št0p2ã€t1p2 å¯ä»¥æ˜æ˜¾çš„çœ‹åˆ°è¿™æ ·çš„åˆ†é…å¹¶ä¸å‡åŒ€ï¼Œå¦‚æœå°†ç±»ä¼¼çš„æƒ…å½¢æ‰©å¤§ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°éƒ¨åˆ†æ¶ˆè´¹è€…è¿‡è½½çš„æƒ…å†µã€‚å¯¹æ­¤æˆ‘ä»¬å†æ¥çœ‹ä¸‹å¦ä¸€ç§RoundRobinAssignorç­–ç•¥çš„åˆ†é…æ•ˆæœå¦‚ä½•ã€‚ RoundRobinAssignorRoundRobinAssignorç­–ç•¥çš„åŸç†æ˜¯å°†æ¶ˆè´¹ç»„å†…æ‰€æœ‰æ¶ˆè´¹è€…ä»¥åŠæ¶ˆè´¹è€…æ‰€è®¢é˜…çš„æ‰€æœ‰topicçš„partitionæŒ‰ç…§å­—å…¸åºæ’åºï¼Œç„¶åé€šè¿‡è½®è¯¢æ–¹å¼é€ä¸ªå°†åˆ†åŒºä»¥æ­¤åˆ†é…ç»™æ¯ä¸ªæ¶ˆè´¹è€…ã€‚RoundRobinAssignorç­–ç•¥å¯¹åº”çš„partition.assignment.strategyå‚æ•°å€¼ä¸ºï¼šorg.apache.kafka.clients.consumer.RoundRobinAssignorã€‚ å¦‚æœåŒä¸€ä¸ªæ¶ˆè´¹ç»„å†…æ‰€æœ‰çš„æ¶ˆè´¹è€…çš„è®¢é˜…ä¿¡æ¯éƒ½æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆRoundRobinAssignorç­–ç•¥çš„åˆ†åŒºåˆ†é…ä¼šæ˜¯å‡åŒ€çš„ã€‚ä¸¾ä¾‹ï¼Œå‡è®¾æ¶ˆè´¹ç»„ä¸­æœ‰2ä¸ªæ¶ˆè´¹è€…C0å’ŒC1ï¼Œéƒ½è®¢é˜…äº†ä¸»é¢˜t0å’Œt1ï¼Œå¹¶ä¸”æ¯ä¸ªä¸»é¢˜éƒ½æœ‰3ä¸ªåˆ†åŒºï¼Œé‚£ä¹ˆæ‰€è®¢é˜…çš„æ‰€æœ‰åˆ†åŒºå¯ä»¥æ ‡è¯†ä¸ºï¼št0p0ã€t0p1ã€t0p2ã€t1p0ã€t1p1ã€t1p2ã€‚æœ€ç»ˆçš„åˆ†é…ç»“æœä¸ºï¼š æ¶ˆè´¹è€…C0ï¼št0p0ã€t0p2ã€t1p1 æ¶ˆè´¹è€…C1ï¼št0p1ã€t1p0ã€t1p2 å¦‚æœåŒä¸€ä¸ªæ¶ˆè´¹ç»„å†…çš„æ¶ˆè´¹è€…æ‰€è®¢é˜…çš„ä¿¡æ¯æ˜¯ä¸ç›¸åŒçš„ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œåˆ†åŒºåˆ†é…çš„æ—¶å€™å°±ä¸æ˜¯å®Œå…¨çš„è½®è¯¢åˆ†é…ï¼Œæœ‰å¯èƒ½ä¼šå¯¼è‡´åˆ†åŒºåˆ†é…çš„ä¸å‡åŒ€ã€‚å¦‚æœæŸä¸ªæ¶ˆè´¹è€…æ²¡æœ‰è®¢é˜…æ¶ˆè´¹ç»„å†…çš„æŸä¸ªtopicï¼Œé‚£ä¹ˆåœ¨åˆ†é…åˆ†åŒºçš„æ—¶å€™æ­¤æ¶ˆè´¹è€…å°†åˆ†é…ä¸åˆ°è¿™ä¸ªtopicçš„ä»»ä½•åˆ†åŒºã€‚ ä¸¾ä¾‹ï¼Œå‡è®¾æ¶ˆè´¹ç»„å†…æœ‰3ä¸ªæ¶ˆè´¹è€…C0ã€C1å’ŒC2ï¼Œå®ƒä»¬å…±è®¢é˜…äº†3ä¸ªä¸»é¢˜ï¼št0ã€t1ã€t2ï¼Œè¿™3ä¸ªä¸»é¢˜åˆ†åˆ«æœ‰1ã€2ã€3ä¸ªåˆ†åŒºï¼Œå³æ•´ä¸ªæ¶ˆè´¹ç»„è®¢é˜…äº†t0p0ã€t1p0ã€t1p1ã€t2p0ã€t2p1ã€t2p2è¿™6ä¸ªåˆ†åŒºã€‚å…·ä½“è€Œè¨€ï¼Œæ¶ˆè´¹è€…C0è®¢é˜…çš„æ˜¯ä¸»é¢˜t0ï¼Œæ¶ˆè´¹è€…C1è®¢é˜…çš„æ˜¯ä¸»é¢˜t0å’Œt1ï¼Œæ¶ˆè´¹è€…C2è®¢é˜…çš„æ˜¯ä¸»é¢˜t0ã€t1å’Œt2ï¼Œé‚£ä¹ˆæœ€ç»ˆçš„åˆ†é…ç»“æœä¸ºï¼š æ¶ˆè´¹è€…C0ï¼št0p0 æ¶ˆè´¹è€…C1ï¼št1p0 æ¶ˆè´¹è€…C2ï¼št1p1ã€t2p0ã€t2p1ã€t2p2 å¯ä»¥çœ‹åˆ°RoundRobinAssignorç­–ç•¥ä¹Ÿä¸æ˜¯ååˆ†å®Œç¾ï¼Œè¿™æ ·åˆ†é…å…¶å®å¹¶ä¸æ˜¯æœ€ä¼˜è§£ï¼Œå› ä¸ºå®Œå…¨å¯ä»¥å°†åˆ†åŒºt1p1åˆ†é…ç»™æ¶ˆè´¹è€…C1ã€‚ StickyAssignoræˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹StickyAssignorç­–ç•¥ï¼Œâ€œstickyâ€è¿™ä¸ªå•è¯å¯ä»¥ç¿»è¯‘ä¸ºâ€œç²˜æ€§çš„â€ï¼ŒKafkaä»0.11.xç‰ˆæœ¬å¼€å§‹å¼•å…¥è¿™ç§åˆ†é…ç­–ç•¥ï¼Œå®ƒä¸»è¦æœ‰ä¸¤ä¸ªç›®çš„ï¼š åˆ†åŒºçš„åˆ†é…è¦å°½å¯èƒ½çš„å‡åŒ€ï¼› åˆ†åŒºçš„åˆ†é…å°½å¯èƒ½çš„ä¸ä¸Šæ¬¡åˆ†é…çš„ä¿æŒç›¸åŒã€‚å½“ä¸¤è€…å‘ç”Ÿå†²çªæ—¶ï¼Œç¬¬ä¸€ä¸ªç›®æ ‡ä¼˜å…ˆäºç¬¬äºŒä¸ªç›®æ ‡ã€‚é‰´äºè¿™ä¸¤ä¸ªç›®æ ‡ï¼ŒStickyAssignorç­–ç•¥çš„å…·ä½“å®ç°è¦æ¯”RangeAssignorå’ŒRoundRobinAssignorè¿™ä¸¤ç§åˆ†é…ç­–ç•¥è¦å¤æ‚å¾ˆå¤šã€‚æˆ‘ä»¬ä¸¾ä¾‹æ¥çœ‹ä¸€ä¸‹StickyAssignorç­–ç•¥çš„å®é™…æ•ˆæœã€‚ å‡è®¾æ¶ˆè´¹ç»„å†…æœ‰3ä¸ªæ¶ˆè´¹è€…ï¼šC0ã€C1å’ŒC2ï¼Œå®ƒä»¬éƒ½è®¢é˜…äº†4ä¸ªä¸»é¢˜ï¼št0ã€t1ã€t2ã€t3ï¼Œå¹¶ä¸”æ¯ä¸ªä¸»é¢˜æœ‰2ä¸ªåˆ†åŒºï¼Œä¹Ÿå°±æ˜¯è¯´æ•´ä¸ªæ¶ˆè´¹ç»„è®¢é˜…äº†t0p0ã€t0p1ã€t1p0ã€t1p1ã€t2p0ã€t2p1ã€t3p0ã€t3p1è¿™8ä¸ªåˆ†åŒºã€‚æœ€ç»ˆçš„åˆ†é…ç»“æœå¦‚ä¸‹ï¼š æ¶ˆè´¹è€…C0ï¼št0p0ã€t1p1ã€t3p0 æ¶ˆè´¹è€…C1ï¼št0p1ã€t2p0ã€t3p1 æ¶ˆè´¹è€…C2ï¼št1p0ã€t2p1 è¿™æ ·åˆçœ‹ä¸Šå»ä¼¼ä¹ä¸é‡‡ç”¨RoundRobinAssignorç­–ç•¥æ‰€åˆ†é…çš„ç»“æœç›¸åŒï¼Œä½†äº‹å®æ˜¯å¦çœŸçš„å¦‚æ­¤å‘¢ï¼Ÿå†å‡è®¾æ­¤æ—¶æ¶ˆè´¹è€…C1è„±ç¦»äº†æ¶ˆè´¹ç»„ï¼Œé‚£ä¹ˆæ¶ˆè´¹ç»„å°±ä¼šæ‰§è¡Œå†å¹³è¡¡æ“ä½œï¼Œè¿›è€Œæ¶ˆè´¹åˆ†åŒºä¼šé‡æ–°åˆ†é…ã€‚å¦‚æœé‡‡ç”¨RoundRobinAssignorç­–ç•¥ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„åˆ†é…ç»“æœå¦‚ä¸‹ï¼š æ¶ˆè´¹è€…C0ï¼št0p0ã€t1p0ã€t2p0ã€t3p0 æ¶ˆè´¹è€…C2ï¼št0p1ã€t1p1ã€t2p1ã€t3p1 å¦‚åˆ†é…ç»“æœæ‰€ç¤ºï¼ŒRoundRobinAssignorç­–ç•¥ä¼šæŒ‰ç…§æ¶ˆè´¹è€…C0å’ŒC2è¿›è¡Œé‡æ–°è½®è¯¢åˆ†é…ã€‚è€Œå¦‚æœæ­¤æ—¶ä½¿ç”¨çš„æ˜¯StickyAssignorç­–ç•¥ï¼Œé‚£ä¹ˆåˆ†é…ç»“æœä¸ºï¼š æ¶ˆè´¹è€…C0ï¼št0p0ã€t1p1ã€t3p0ã€t2p0 æ¶ˆè´¹è€…C2ï¼št1p0ã€t2p1ã€t0p1ã€t3p1 å¯ä»¥çœ‹åˆ°åˆ†é…ç»“æœä¸­ä¿ç•™äº†ä¸Šä¸€æ¬¡åˆ†é…ä¸­å¯¹äºæ¶ˆè´¹è€…C0å’ŒC2çš„æ‰€æœ‰åˆ†é…ç»“æœï¼Œå¹¶å°†åŸæ¥æ¶ˆè´¹è€…C1çš„â€œè´Ÿæ‹…â€åˆ†é…ç»™äº†å‰©ä½™çš„ä¸¤ä¸ªæ¶ˆè´¹è€…C0å’ŒC2ï¼Œæœ€ç»ˆC0å’ŒC2çš„åˆ†é…è¿˜ä¿æŒäº†å‡è¡¡ã€‚ å¦‚æœå‘ç”Ÿåˆ†åŒºé‡åˆ†é…ï¼Œé‚£ä¹ˆå¯¹äºåŒä¸€ä¸ªåˆ†åŒºè€Œè¨€æœ‰å¯èƒ½ä¹‹å‰çš„æ¶ˆè´¹è€…å’Œæ–°æŒ‡æ´¾çš„æ¶ˆè´¹è€…ä¸æ˜¯åŒä¸€ä¸ªï¼Œå¯¹äºä¹‹å‰æ¶ˆè´¹è€…è¿›è¡Œåˆ°ä¸€åŠçš„å¤„ç†è¿˜è¦åœ¨æ–°æŒ‡æ´¾çš„æ¶ˆè´¹è€…ä¸­å†æ¬¡å¤ç°ä¸€éï¼Œè¿™æ˜¾ç„¶å¾ˆæµªè´¹ç³»ç»Ÿèµ„æºã€‚StickyAssignorç­–ç•¥å¦‚åŒå…¶åç§°ä¸­çš„â€œstickyâ€ä¸€æ ·ï¼Œè®©åˆ†é…ç­–ç•¥å…·å¤‡ä¸€å®šçš„â€œç²˜æ€§â€ï¼Œå°½å¯èƒ½åœ°è®©å‰åä¸¤æ¬¡åˆ†é…ç›¸åŒï¼Œè¿›è€Œå‡å°‘ç³»ç»Ÿèµ„æºçš„æŸè€—ä»¥åŠå…¶å®ƒå¼‚å¸¸æƒ…å†µçš„å‘ç”Ÿã€‚ åˆ°ç›®å‰ä¸ºæ­¢æ‰€åˆ†æçš„éƒ½æ˜¯æ¶ˆè´¹è€…çš„è®¢é˜…ä¿¡æ¯éƒ½æ˜¯ç›¸åŒçš„æƒ…å†µï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è®¢é˜…ä¿¡æ¯ä¸åŒçš„æƒ…å†µä¸‹çš„å¤„ç†ã€‚ ä¸¾ä¾‹ï¼ŒåŒæ ·æ¶ˆè´¹ç»„å†…æœ‰3ä¸ªæ¶ˆè´¹è€…ï¼šC0ã€C1å’ŒC2ï¼Œé›†ç¾¤ä¸­æœ‰3ä¸ªä¸»é¢˜ï¼št0ã€t1å’Œt2ï¼Œè¿™3ä¸ªä¸»é¢˜åˆ†åˆ«æœ‰1ã€2ã€3ä¸ªåˆ†åŒºï¼Œä¹Ÿå°±æ˜¯è¯´é›†ç¾¤ä¸­æœ‰t0p0ã€t1p0ã€t1p1ã€t2p0ã€t2p1ã€t2p2è¿™6ä¸ªåˆ†åŒºã€‚æ¶ˆè´¹è€…C0è®¢é˜…äº†ä¸»é¢˜t0ï¼Œæ¶ˆè´¹è€…C1è®¢é˜…äº†ä¸»é¢˜t0å’Œt1ï¼Œæ¶ˆè´¹è€…C2è®¢é˜…äº†ä¸»é¢˜t0ã€t1å’Œt2ã€‚ å¦‚æœæ­¤æ—¶é‡‡ç”¨RoundRobinAssignorç­–ç•¥ï¼Œé‚£ä¹ˆæœ€ç»ˆçš„åˆ†é…ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼ˆå’Œè®²è¿°RoundRobinAssignorç­–ç•¥æ—¶çš„ä¸€æ ·ï¼Œè¿™æ ·ä¸å¦¨èµ˜è¿°ä¸€ä¸‹ï¼‰ï¼š ã€åˆ†é…ç»“æœé›†1ã€‘ æ¶ˆè´¹è€…C0ï¼št0p0 æ¶ˆè´¹è€…C1ï¼št1p0 æ¶ˆè´¹è€…C2ï¼št1p1ã€t2p0ã€t2p1ã€t2p2 å¦‚æœæ­¤æ—¶é‡‡ç”¨çš„æ˜¯StickyAssignorç­–ç•¥ï¼Œé‚£ä¹ˆæœ€ç»ˆçš„åˆ†é…ç»“æœä¸ºï¼š ã€åˆ†é…ç»“æœé›†2ã€‘ æ¶ˆè´¹è€…C0ï¼št0p0 æ¶ˆè´¹è€…C1ï¼št1p0ã€t1p1 æ¶ˆè´¹è€…C2ï¼št2p0ã€t2p1ã€t2p2 å¯ä»¥çœ‹åˆ°è¿™æ˜¯ä¸€ä¸ªæœ€ä¼˜è§£ï¼ˆæ¶ˆè´¹è€…C0æ²¡æœ‰è®¢é˜…ä¸»é¢˜t1å’Œt2ï¼Œæ‰€ä»¥ä¸èƒ½åˆ†é…ä¸»é¢˜t1å’Œt2ä¸­çš„ä»»ä½•åˆ†åŒºç»™å®ƒï¼Œå¯¹äºæ¶ˆè´¹è€…C1ä¹Ÿå¯åŒç†æ¨æ–­ï¼‰ã€‚å‡å¦‚æ­¤æ—¶æ¶ˆè´¹è€…C0è„±ç¦»äº†æ¶ˆè´¹ç»„ï¼Œé‚£ä¹ˆRoundRobinAssignorç­–ç•¥çš„åˆ†é…ç»“æœä¸ºï¼š æ¶ˆè´¹è€…C1ï¼št0p0ã€t1p1 æ¶ˆè´¹è€…C2ï¼št1p0ã€t2p0ã€t2p1ã€t2p2 å¯ä»¥çœ‹åˆ°RoundRobinAssignorç­–ç•¥ä¿ç•™äº†æ¶ˆè´¹è€…C1å’ŒC2ä¸­åŸæœ‰çš„3ä¸ªåˆ†åŒºçš„åˆ†é…ï¼št2p0ã€t2p1å’Œt2p2ï¼ˆé’ˆå¯¹ç»“æœé›†1ï¼‰ã€‚è€Œå¦‚æœé‡‡ç”¨çš„æ˜¯StickyAssignorç­–ç•¥ï¼Œé‚£ä¹ˆåˆ†é…ç»“æœä¸ºï¼š æ¶ˆè´¹è€…C1ï¼št1p0ã€t1p1ã€t0p0 æ¶ˆè´¹è€…C2ï¼št2p0ã€t2p1ã€t2p2 å¯ä»¥çœ‹åˆ°StickyAssignorç­–ç•¥ä¿ç•™äº†æ¶ˆè´¹è€…C1å’ŒC2ä¸­åŸæœ‰çš„5ä¸ªåˆ†åŒºçš„åˆ†é…ï¼št1p0ã€t1p1ã€t2p0ã€t2p1ã€t2p2ã€‚ ä»ç»“æœä¸Šçœ‹StickyAssignorç­–ç•¥æ¯”å¦å¤–ä¸¤è€…åˆ†é…ç­–ç•¥è€Œè¨€æ˜¾å¾—æ›´åŠ çš„ä¼˜å¼‚ï¼Œè¿™ä¸ªç­–ç•¥çš„ä»£ç å®ç°ä¹Ÿæ˜¯å¼‚å¸¸å¤æ‚ã€‚ è‡ªå®šä¹‰åˆ†åŒºåˆ†é…ç­–ç•¥kafka å¤„ç†æ”¯æŒé»˜è®¤æä¾›çš„ä¸‰ç§åˆ†åŒºåˆ†é…ç®—æ³•ï¼Œè¿˜æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰åˆ†åŒºåˆ†é…ç®—æ³•ï¼Œè‡ªå®šä¹‰çš„åˆ†é…ç­–ç•¥å¿…é¡»è¦å®ç°org.apache.kafka.clients.consumer.internals.PartitionAssignoræ¥å£ã€‚PartitionAssignoræ¥å£çš„å®šä¹‰å¦‚ä¸‹ï¼š Subscription subscription(Set&lt;String&gt; topics); String name(); Map&lt;String, Assignment&gt; assign(Cluster metadata, Map&lt;String, Subscription&gt; subscriptions); void onAssignment(Assignment assignment); class Subscription &#123; private final List&lt;String&gt; topics; private final ByteBuffer userData; ï¼ˆçœç•¥è‹¥å¹²æ–¹æ³•â€¦â€¦ï¼‰ &#125; class Assignment &#123; private final List&lt;TopicPartition&gt; partitions; private final ByteBuffer userData; ï¼ˆçœç•¥è‹¥å¹²æ–¹æ³•â€¦â€¦ï¼‰ &#125; PartitionAssignoræ¥å£ä¸­å®šä¹‰äº†ä¸¤ä¸ªå†…éƒ¨ç±»ï¼šSubscriptionå’ŒAssignmentã€‚ Subscriptionç±»ç”¨æ¥è¡¨ç¤ºæ¶ˆè´¹è€…çš„è®¢é˜…ä¿¡æ¯ï¼Œç±»ä¸­æœ‰ä¸¤ä¸ªå±æ€§ï¼štopicså’ŒuserDataï¼Œåˆ†åˆ«è¡¨ç¤ºæ¶ˆè´¹è€…æ‰€è®¢é˜…topicåˆ—è¡¨å’Œç”¨æˆ·è‡ªå®šä¹‰ä¿¡æ¯ã€‚PartitionAssignoræ¥å£é€šè¿‡subscription()æ–¹æ³•æ¥è®¾ç½®æ¶ˆè´¹è€…è‡ªèº«ç›¸å…³çš„Subscriptionä¿¡æ¯ï¼Œæ³¨æ„åˆ°æ­¤æ–¹æ³•ä¸­åªæœ‰ä¸€ä¸ªå‚æ•°topicsï¼Œä¸Subscriptionç±»ä¸­çš„topicsçš„ç›¸äº’å‘¼åº”ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æœ‰å…³userDataçš„å‚æ•°ä½“ç°ã€‚ä¸ºäº†å¢å¼ºç”¨æˆ·å¯¹åˆ†é…ç»“æœçš„æ§åˆ¶ï¼Œå¯ä»¥åœ¨subscription()æ–¹æ³•å†…éƒ¨æ·»åŠ ä¸€äº›å½±å“åˆ†é…çš„ç”¨æˆ·è‡ªå®šä¹‰ä¿¡æ¯èµ‹äºˆuserDataï¼Œæ¯”å¦‚ï¼šæƒé‡ã€ipåœ°å€ã€hostæˆ–è€…æœºæ¶ï¼ˆrackï¼‰ç­‰ç­‰ã€‚ ä¸¾ä¾‹ï¼Œåœ¨subscription()è¿™ä¸ªæ–¹æ³•ä¸­æä¾›æœºæ¶ä¿¡æ¯ï¼Œæ ‡è¯†æ­¤æ¶ˆè´¹è€…æ‰€éƒ¨ç½²çš„æœºæ¶ä½ç½®ï¼Œåœ¨åˆ†åŒºåˆ†é…æ—¶å¯ä»¥æ ¹æ®åˆ†åŒºçš„leaderå‰¯æœ¬æ‰€åœ¨çš„æœºæ¶ä½ç½®æ¥å®æ–½å…·ä½“çš„åˆ†é…ï¼Œè¿™æ ·å¯ä»¥è®©æ¶ˆè´¹è€…ä¸æ‰€éœ€æ‹‰å–æ¶ˆæ¯çš„brokerèŠ‚ç‚¹å¤„äºåŒä¸€æœºæ¶ã€‚å‚è€ƒä¸‹å›¾ï¼Œæ¶ˆè´¹è€…consumer1å’Œbroker1éƒ½éƒ¨ç½²åœ¨æœºæ¶rack1ä¸Šï¼Œæ¶ˆè´¹è€…consumer2å’Œbroker2éƒ½éƒ¨ç½²åœ¨æœºæ¶rack2ä¸Šã€‚å¦‚æœåˆ†åŒºçš„åˆ†é…ä¸æ˜¯æœºæ¶æ„ŸçŸ¥çš„ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½ä¸å›¾ï¼ˆä¸Šéƒ¨åˆ†ï¼‰ä¸­çš„åˆ†é…ç»“æœä¸€æ ·ï¼Œconsumer1æ¶ˆè´¹broker2ä¸­çš„åˆ†åŒºï¼Œè€Œconsumer2æ¶ˆè´¹broker1ä¸­çš„åˆ†åŒºï¼›å¦‚æœåˆ†åŒºçš„åˆ†é…æ˜¯æœºæ¶æ„ŸçŸ¥çš„ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°å›¾ï¼ˆä¸‹éƒ¨åˆ†ï¼‰çš„åˆ†é…ç»“æœï¼Œconsumer1æ¶ˆè´¹broker1ä¸­çš„åˆ†åŒºï¼Œè€Œconsumer2æ¶ˆè´¹broker2ä¸­çš„åˆ†åŒºï¼Œè¿™æ ·ç›¸æ¯”äºå‰ä¸€ç§æƒ…å½¢è€Œè¨€ï¼Œæ—¢å¯ä»¥å‡å°‘æ¶ˆè´¹å»¶è¿Ÿåˆå¯ä»¥å‡å°‘è·¨æœºæ¶å¸¦å®½çš„å ç”¨ã€‚ å†æ¥è¯´ä¸€ä¸‹Assignmentç±»ï¼Œå®ƒæ˜¯ç”¨æ¥è¡¨ç¤ºåˆ†é…ç»“æœä¿¡æ¯çš„ï¼Œç±»ä¸­ä¹Ÿæœ‰ä¸¤ä¸ªå±æ€§ï¼špartitionså’ŒuserDataï¼Œåˆ†åˆ«è¡¨ç¤ºæ‰€åˆ†é…åˆ°çš„åˆ†åŒºé›†åˆå’Œç”¨æˆ·è‡ªå®šä¹‰çš„æ•°æ®ã€‚å¯ä»¥é€šè¿‡PartitionAssignoræ¥å£ä¸­çš„onAssignment()æ–¹æ³•æ˜¯åœ¨æ¯ä¸ªæ¶ˆè´¹è€…æ”¶åˆ°æ¶ˆè´¹ç»„leaderåˆ†é…ç»“æœæ—¶çš„å›è°ƒå‡½æ•°ï¼Œä¾‹å¦‚åœ¨StickyAssignorç­–ç•¥ä¸­å°±æ˜¯é€šè¿‡è¿™ä¸ªæ–¹æ³•ä¿å­˜å½“å‰çš„åˆ†é…æ–¹æ¡ˆï¼Œä»¥å¤‡åœ¨ä¸‹æ¬¡æ¶ˆè´¹ç»„å†å¹³è¡¡ï¼ˆrebalanceï¼‰æ—¶å¯ä»¥æä¾›åˆ†é…å‚è€ƒä¾æ®ã€‚ æ¥å£ä¸­çš„name()æ–¹æ³•ç”¨æ¥æä¾›åˆ†é…ç­–ç•¥çš„åç§°ï¼Œå¯¹äºKafkaæä¾›çš„3ç§åˆ†é…ç­–ç•¥è€Œè¨€ï¼ŒRangeAssignorå¯¹åº”çš„protocol_nameä¸ºâ€œrangeâ€ï¼ŒRoundRobinAssignorå¯¹åº”çš„protocol_nameä¸ºâ€œroundrobinâ€ï¼ŒStickyAssignorå¯¹åº”çš„protocol_nameä¸ºâ€œstickyâ€ï¼Œæ‰€ä»¥è‡ªå®šä¹‰çš„åˆ†é…ç­–ç•¥ä¸­è¦æ³¨æ„å‘½åçš„æ—¶å€™ä¸è¦ä¸å·²å­˜åœ¨çš„åˆ†é…ç­–ç•¥å‘ç”Ÿå†²çªã€‚è¿™ä¸ªå‘½åç”¨æ¥æ ‡è¯†åˆ†é…ç­–ç•¥çš„åç§°ï¼Œåœ¨åé¢æ‰€æè¿°çš„åŠ å…¥æ¶ˆè´¹ç»„ä»¥åŠé€‰ä¸¾æ¶ˆè´¹ç»„leaderçš„æ—¶å€™ä¼šæœ‰æ¶‰åŠã€‚ çœŸæ­£çš„åˆ†åŒºåˆ†é…æ–¹æ¡ˆçš„å®ç°æ˜¯åœ¨assign()æ–¹æ³•ä¸­ï¼Œæ–¹æ³•ä¸­çš„å‚æ•°metadataè¡¨ç¤ºé›†ç¾¤çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œè€Œsubscriptionsè¡¨ç¤ºæ¶ˆè´¹ç»„å†…å„ä¸ªæ¶ˆè´¹è€…æˆå‘˜çš„è®¢é˜…ä¿¡æ¯ï¼Œæœ€ç»ˆæ–¹æ³•è¿”å›å„ä¸ªæ¶ˆè´¹è€…çš„åˆ†é…ä¿¡æ¯ã€‚ Kafkaä¸­è¿˜æä¾›äº†ä¸€ä¸ªæŠ½è±¡ç±»org.apache.kafka.clients.consumer.internals.AbstractPartitionAssignorï¼Œå®ƒå¯ä»¥ç®€åŒ–PartitionAssignoræ¥å£çš„å®ç°ï¼Œå¯¹assign()æ–¹æ³•è¿›è¡Œäº†å®ç°ï¼Œå…¶ä¸­ä¼šå°†Subscriptionä¸­çš„userDataä¿¡æ¯å»æ‰åï¼Œåœ¨è¿›è¡Œåˆ†é…ã€‚Kafkaæä¾›çš„3ç§åˆ†é…ç­–ç•¥éƒ½æ˜¯ç»§æ‰¿è‡ªè¿™ä¸ªæŠ½è±¡ç±»ã€‚å¦‚æœå¼€å‘äººå‘˜åœ¨è‡ªå®šä¹‰åˆ†åŒºåˆ†é…ç­–ç•¥æ—¶éœ€è¦ä½¿ç”¨userDataä¿¡æ¯æ¥æ§åˆ¶åˆ†åŒºåˆ†é…çš„ç»“æœï¼Œé‚£ä¹ˆå°±ä¸èƒ½ç›´æ¥ç»§æ‰¿AbstractPartitionAssignorè¿™ä¸ªæŠ½è±¡ç±»ï¼Œè€Œéœ€è¦ç›´æ¥å®ç°PartitionAssignoræ¥å£ã€‚ ä¸‹é¢ä»£ç å‚è€ƒKafkaä¸­çš„RangeAssignorç­–ç•¥æ¥è‡ªå®šä¹‰ä¸€ä¸ªéšæœºçš„åˆ†é…ç­–ç•¥ï¼Œè¿™é‡Œç¬”è€…ç§°ä¹‹ä¸ºRandomAssignorï¼Œå…·ä½“ä»£ç å®ç°å¦‚ä¸‹ï¼š package org.apache.kafka.clients.consumer; import org.apache.kafka.clients.consumer.internals.AbstractPartitionAssignor; import org.apache.kafka.common.TopicPartition; import java.util.*; public class RandomAssignor extends AbstractPartitionAssignor &#123; @Override public String name() &#123; return &quot;random&quot;; &#125; @Override public Map&lt;String, List&lt;TopicPartition&gt;&gt; assign( Map&lt;String, Integer&gt; partitionsPerTopic, Map&lt;String, Subscription&gt; subscriptions) &#123; Map&lt;String, List&lt;String&gt;&gt; consumersPerTopic = consumersPerTopic(subscriptions); Map&lt;String, List&lt;TopicPartition&gt;&gt; assignment = new HashMap&lt;&gt;(); for (String memberId : subscriptions.keySet()) &#123; assignment.put(memberId, new ArrayList&lt;&gt;()); &#125; // é’ˆå¯¹æ¯ä¸€ä¸ªtopicè¿›è¡Œåˆ†åŒºåˆ†é… for (Map.Entry&lt;String, List&lt;String&gt;&gt; topicEntry : consumersPerTopic.entrySet()) &#123; String topic = topicEntry.getKey(); List&lt;String&gt; consumersForTopic = topicEntry.getValue(); int consumerSize = consumersForTopic.size(); Integer numPartitionsForTopic = partitionsPerTopic.get(topic); if (numPartitionsForTopic == null) &#123; continue; &#125; // å½“å‰topicä¸‹çš„æ‰€æœ‰åˆ†åŒº List&lt;TopicPartition&gt; partitions = AbstractPartitionAssignor.partitions(topic, numPartitionsForTopic); // å°†æ¯ä¸ªåˆ†åŒºéšæœºåˆ†é…ç»™ä¸€ä¸ªæ¶ˆè´¹è€… for (TopicPartition partition : partitions) &#123; int rand = new Random().nextInt(consumerSize); String randomConsumer = consumersForTopic.get(rand); assignment.get(randomConsumer).add(partition); &#125; &#125; return assignment; &#125; // è·å–æ¯ä¸ªtopicæ‰€å¯¹åº”çš„æ¶ˆè´¹è€…åˆ—è¡¨ï¼Œå³ï¼š[topic, List[consumer]] private Map&lt;String, List&lt;String&gt;&gt; consumersPerTopic( Map&lt;String, Subscription&gt; consumerMetadata) &#123; Map&lt;String, List&lt;String&gt;&gt; res = new HashMap&lt;&gt;(); for (Map.Entry&lt;String, Subscription&gt; subscriptionEntry : consumerMetadata.entrySet()) &#123; String consumerId = subscriptionEntry.getKey(); for (String topic : subscriptionEntry.getValue().topics()) put(res, topic, consumerId); &#125; return res; &#125; &#125; åœ¨ä½¿ç”¨æ—¶ï¼Œæ¶ˆè´¹è€…å®¢æˆ·ç«¯éœ€è¦æ·»åŠ ç›¸åº”çš„Propertieså‚æ•°ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š properties.put(ConsumerConfig.PARTITION_ASSIGNMENT_STRATEGY_CONFIG, RandomAssignor.class.getName()); åˆ†é…çš„å®æ–½æˆ‘ä»¬äº†è§£äº†Kafkaä¸­æ¶ˆè´¹è€…çš„åˆ†åŒºåˆ†é…ç­–ç•¥ä¹‹åæ˜¯å¦ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼šå¦‚æœæ¶ˆè´¹è€…å®¢æˆ·ç«¯ä¸­é…ç½®äº†ä¸¤ä¸ªåˆ†é…ç­–ç•¥ï¼Œé‚£ä¹ˆä»¥å“ªä¸ªä¸ºå‡†ï¼Ÿå¦‚æœæœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œå½¼æ­¤æ‰€é…ç½®çš„åˆ†é…ç­–ç•¥å¹¶ä¸å®Œå…¨ç›¸åŒï¼Œé‚£ä¹ˆä»¥å“ªä¸ªä¸ºå‡†ï¼Ÿå¤šä¸ªæ¶ˆè´¹è€…ä¹‹é—´çš„åˆ†åŒºåˆ†é…æ˜¯éœ€è¦ååŒçš„ï¼Œé‚£ä¹ˆè¿™ä¸ªååŒçš„è¿‡ç¨‹åˆæ˜¯æ€æ ·ï¼Ÿ åœ¨kafkaä¸­æœ‰ä¸€ä¸ªç»„åè°ƒå™¨ï¼ˆGroupCoordinatorï¼‰è´Ÿè´£æ¥åè°ƒæ¶ˆè´¹ç»„å†…å„ä¸ªæ¶ˆè´¹è€…çš„åˆ†åŒºåˆ†é…ï¼Œå¯¹äºæ¯ä¸€ä¸ªæ¶ˆè´¹ç»„è€Œè¨€ï¼Œåœ¨kafkaæœåŠ¡ç«¯éƒ½ä¼šæœ‰å…¶å¯¹åº”çš„ä¸€ä¸ªç»„åè°ƒå™¨ã€‚å…·ä½“çš„åè°ƒåˆ†åŒºåˆ†é…çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š1.é¦–å…ˆå„ä¸ªæ¶ˆè´¹è€…å‘GroupCoordinatorææ¡ˆå„è‡ªçš„åˆ†é…ç­–ç•¥ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå„ä¸ªæ¶ˆè´¹è€…ææ¡ˆçš„åˆ†é…ç­–ç•¥å’Œè®¢é˜…ä¿¡æ¯éƒ½åŒ…å«åœ¨JoinGroupRequestè¯·æ±‚ä¸­ã€‚ 2.GroupCoordinatoræ”¶é›†å„ä¸ªæ¶ˆè´¹è€…çš„ææ¡ˆï¼Œç„¶åæ‰§è¡Œä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼šä¸€ã€é€‰ä¸¾æ¶ˆè´¹ç»„çš„leaderï¼›äºŒã€é€‰ä¸¾æ¶ˆè´¹ç»„çš„åˆ†åŒºåˆ†é…ç­–ç•¥ã€‚ é€‰ä¸¾æ¶ˆè´¹ç»„çš„åˆ†åŒºåˆ†é…ç­–ç•¥æ¯”è¾ƒå¥½ç†è§£ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œè¿˜è¦é€‰ä¸¾æ¶ˆè´¹ç»„çš„leaderï¼Œå› ä¸ºæœ€ç»ˆçš„åˆ†åŒºåˆ†é…ç­–ç•¥çš„å®æ–½éœ€è¦æœ‰ä¸€ä¸ªæˆå‘˜æ¥æ‰§è¡Œï¼Œè€Œè¿™ä¸ªleaderæ¶ˆè´¹è€…æ­£å¥½æ‰®æ¼”äº†è¿™ä¸€ä¸ªè§’è‰²ã€‚åœ¨Kafkaä¸­æŠŠå…·ä½“çš„åˆ†åŒºåˆ†é…ç­–ç•¥çš„å…·ä½“æ‰§è¡Œæƒäº¤ç»™äº†æ¶ˆè´¹è€…å®¢æˆ·ç«¯ï¼Œè¿™æ ·å¯ä»¥æä¾›æ›´é«˜çš„çµæ´»æ€§ã€‚æ¯”å¦‚éœ€è¦å˜æ›´åˆ†é…ç­–ç•¥ï¼Œé‚£ä¹ˆåªéœ€ä¿®æ”¹æ¶ˆè´¹è€…å®¢æˆ·ç«¯å°±é†’æ¥ï¼Œè€Œä¸å¿…è¦ä¿®æ”¹å¹¶é‡å¯KafkaæœåŠ¡ç«¯ã€‚ æ€ä¹ˆé€‰ä¸¾æ¶ˆè´¹ç»„çš„leader? è¿™ä¸ªåˆ†ä¸¤ç§æƒ…å†µåˆ†æï¼šå¦‚æœæ¶ˆè´¹ç»„å†…è¿˜æ²¡æœ‰leaderï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªåŠ å…¥æ¶ˆè´¹ç»„çš„æ¶ˆè´¹è€…å³ä¸ºæ¶ˆè´¹ç»„çš„leaderï¼›å¦‚æœæŸä¸€æ—¶åˆ»leaderæ¶ˆè´¹è€…ç”±äºæŸäº›åŸå› é€€å‡ºäº†æ¶ˆè´¹ç»„ï¼Œé‚£ä¹ˆå°±ä¼šé‡æ–°é€‰ä¸¾ä¸€ä¸ªæ–°çš„leaderï¼Œè¿™ä¸ªé‡æ–°é€‰ä¸¾leaderçš„è¿‡ç¨‹åˆæ›´ä¸ºâ€œéšæ„â€äº†ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š //scala code. private val members = new mutable.HashMap[String, MemberMetadata] var leaderId = members.keys.head è§£é‡Šä¸€ä¸‹è¿™2è¡Œä»£ç ï¼šåœ¨GroupCoordinatorä¸­æ¶ˆè´¹è€…çš„ä¿¡æ¯æ˜¯ä»¥HashMapçš„å½¢å¼å­˜å‚¨çš„ï¼Œå…¶ä¸­keyä¸ºæ¶ˆè´¹è€…çš„åç§°ï¼Œè€Œvalueæ˜¯æ¶ˆè´¹è€…ç›¸å…³çš„å…ƒæ•°æ®ä¿¡æ¯ã€‚leaderIdè¡¨ç¤ºleaderæ¶ˆè´¹è€…çš„åç§°ï¼Œå®ƒçš„å–å€¼ä¸ºHashMapä¸­çš„ç¬¬ä¸€ä¸ªé”®å€¼å¯¹çš„keyï¼Œè¿™ç§é€‰ä¸¾çš„æ–¹å¼åŸºæœ¬ä¸Šå’ŒéšæœºæŒ‘é€‰æ— å¼‚ã€‚æ€»ä½“ä¸Šæ¥è¯´ï¼Œæ¶ˆè´¹ç»„çš„leaderé€‰ä¸¾è¿‡ç¨‹æ˜¯å¾ˆéšæ„çš„ã€‚ æ€ä¹ˆé€‰ä¸¾æ¶ˆè´¹ç»„çš„åˆ†é…ç­–ç•¥ï¼ŸæŠ•ç¥¨å†³å®šã€‚æ¯ä¸ªæ¶ˆè´¹è€…éƒ½å¯ä»¥è®¾ç½®è‡ªå·±çš„åˆ†åŒºåˆ†é…ç­–ç•¥ï¼Œå¯¹äºæ¶ˆè´¹ç»„è€Œè¨€éœ€è¦ä»å„ä¸ªæ¶ˆè´¹è€…æ‰€å‘ˆæŠ¥ä¸Šæ¥çš„å„ä¸ªåˆ†é…ç­–ç•¥ä¸­é€‰ä¸¾ä¸€ä¸ªå½¼æ­¤éƒ½â€œä¿¡æœâ€çš„ç­–ç•¥æ¥è¿›è¡Œæ•´ä½“ä¸Šçš„åˆ†åŒºåˆ†é…ã€‚è¿™ä¸ªåˆ†åŒºåˆ†é…çš„é€‰ä¸¾å¹¶éç”±leaderæ¶ˆè´¹è€…æ¥å†³å®šï¼Œè€Œæ˜¯æ ¹æ®æ¶ˆè´¹ç»„å†…çš„å„ä¸ªæ¶ˆè´¹è€…æŠ•ç¥¨æ¥å†³å®šã€‚è¿™é‡Œæ‰€è¯´çš„â€œæ ¹æ®ç»„å†…çš„å„ä¸ªæ¶ˆè´¹è€…æŠ•ç¥¨æ¥å†³å®šâ€ä¸æ˜¯æŒ‡GroupCoordinatorè¿˜è¦ä¸å„ä¸ªæ¶ˆè´¹è€…è¿›è¡Œè¿›ä¸€æ­¥äº¤äº’æ¥å®æ–½ï¼Œè€Œæ˜¯æ ¹æ®å„ä¸ªæ¶ˆè´¹è€…æ‰€å‘ˆæŠ¥çš„åˆ†é…ç­–ç•¥æ¥å®æ–½ã€‚æœ€ç»ˆæ‰€é€‰ä¸¾çš„åˆ†é…ç­–ç•¥åŸºæœ¬ä¸Šå¯ä»¥çœ‹åšæ˜¯è¢«å„ä¸ªæ¶ˆè´¹è€…æ‰€æ”¯æŒçš„æœ€å¤šçš„ç­–ç•¥ï¼Œå…·ä½“çš„é€‰ä¸¾è¿‡ç¨‹å¦‚ä¸‹ï¼š æ”¶é›†å„ä¸ªæ¶ˆè´¹è€…æ‰€æ”¯æŒçš„æ‰€æœ‰åˆ†é…ç­–ç•¥ï¼Œç»„æˆå€™é€‰é›†candidatesã€‚æ¯ä¸ªæ¶ˆè´¹è€…ä»å€™é€‰é›†candidatesä¸­æ‰¾å‡ºç¬¬ä¸€ä¸ªè‡ªèº«æ‰€æ”¯æŒçš„ç­–ç•¥ï¼Œä¸ºè¿™ä¸ªç­–ç•¥æŠ•ä¸Šä¸€ç¥¨ã€‚è®¡ç®—å€™é€‰é›†ä¸­å„ä¸ªç­–ç•¥çš„é€‰ç¥¨æ•°ï¼Œé€‰ç¥¨æ•°æœ€å¤šçš„ç­–ç•¥å³ä¸ºå½“å‰æ¶ˆè´¹ç»„çš„åˆ†é…ç­–ç•¥ã€‚å¦‚æœæŸä¸ªæ¶ˆè´¹è€…å¹¶ä¸æ”¯æŒæ‰€é€‰ä¸¾å‡ºçš„åˆ†é…ç­–ç•¥ï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚3.GroupCoordinatorå‘é€å›æ‰§ç»™å„ä¸ªæ¶ˆè´¹è€…ï¼Œå¹¶äº¤ç”±leaderæ¶ˆè´¹è€…æ‰§è¡Œå…·ä½“çš„åˆ†åŒºåˆ†é…ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒJoinGroupResponseå›æ‰§ä¸­åŒ…å«æœ‰GroupCoordinatorä¸­æŠ•ç¥¨é€‰ä¸¾å‡ºçš„åˆ†é…ç­–ç•¥çš„ä¿¡æ¯ã€‚å¹¶ä¸”ï¼Œåªæœ‰leaderæ¶ˆè´¹è€…çš„å›æ‰§ä¸­åŒ…å«å„ä¸ªæ¶ˆè´¹è€…çš„è®¢é˜…ä¿¡æ¯ï¼Œå› ä¸ºåªéœ€è¦leaderæ¶ˆè´¹è€…æ ¹æ®è®¢é˜…ä¿¡æ¯æ¥æ‰§è¡Œå…·ä½“çš„åˆ†é…ï¼Œå…¶ä½™çš„æ¶ˆè´¹å¹¶ä¸éœ€è¦ã€‚ 4.leaderæ¶ˆè´¹è€…åœ¨æ•´ç†å‡ºå…·ä½“çš„åˆ†åŒºåˆ†é…æ–¹æ¡ˆåé€šè¿‡SyncGroupRequestè¯·æ±‚æäº¤ç»™GroupCoordinatorï¼Œç„¶åGroupCoordinatorä¸ºæ¯ä¸ªæ¶ˆè´¹è€…æŒ‘é€‰å‡ºå„è‡ªçš„åˆ†é…ç»“æœå¹¶é€šè¿‡SyncGroupResponseå›æ‰§ä»¥å‘ŠçŸ¥å®ƒä»¬ã€‚ brokerç«¯çš„åˆ†åŒºåˆ†é…ç”Ÿäº§è€…çš„åˆ†åŒºåˆ†é…æ˜¯æŒ‡ä¸ºæ¯æ¡æ¶ˆæ¯æŒ‡å®šå…¶æ‰€è¦å‘å¾€çš„åˆ†åŒºï¼Œæ¶ˆè´¹è€…ä¸­çš„åˆ†åŒºåˆ†é…æ˜¯æŒ‡ä¸ºæ¶ˆè´¹è€…æŒ‡å®šå…¶å¯ä»¥æ¶ˆè´¹æ¶ˆæ¯çš„åˆ†åŒºï¼Œè€Œè¿™é‡Œçš„åˆ†åŒºåˆ†é…æ˜¯æŒ‡ä¸ºé›†ç¾¤åˆ¶å®šåˆ›å»ºä¸»é¢˜æ—¶çš„åˆ†åŒºå‰¯æœ¬åˆ†é…æ–¹æ¡ˆï¼Œå³åœ¨å“ªä¸ªbrokerä¸­åˆ›å»ºå“ªäº›åˆ†åŒºçš„å‰¯æœ¬ã€‚åˆ†åŒºåˆ†é…æ˜¯å¦å‡è¡¡ä¼šå½±å“åˆ°Kafkaæ•´ä½“çš„è´Ÿè½½å‡è¡¡ï¼Œå…·ä½“è¿˜ä¼šç‰µæ¶‰åˆ°ä¼˜å…ˆå‰¯æœ¬ç­‰æ¦‚å¿µã€‚ åœ¨åˆ›å»ºä¸»é¢˜æ—¶ï¼Œå¦‚æœä½¿ç”¨äº†replica-assignmentå‚æ•°ï¼Œé‚£ä¹ˆå°±æŒ‰ç…§æŒ‡å®šçš„æ–¹æ¡ˆæ¥è¿›è¡Œåˆ†åŒºå‰¯æœ¬çš„åˆ›å»ºï¼›å¦‚æœæ²¡æœ‰ä½¿ç”¨replica-assignmentå‚æ•°ï¼Œé‚£ä¹ˆå°±éœ€è¦æŒ‰ç…§å†…éƒ¨çš„é€»è¾‘æ¥è®¡ç®—åˆ†é…æ–¹æ¡ˆäº†ã€‚ä½¿ç”¨kafka-topics.shè„šæœ¬åˆ›å»ºä¸»é¢˜æ—¶çš„å†…éƒ¨åˆ†é…é€»è¾‘æŒ‰ç…§æœºæ¶ä¿¡æ¯åˆ’åˆ†æˆä¸¤ç§ç­–ç•¥ï¼šæœªæŒ‡å®šæœºæ¶ä¿¡æ¯å’ŒæŒ‡å®šæœºæ¶ä¿¡æ¯ã€‚å¦‚æœé›†ç¾¤ä¸­æ‰€æœ‰çš„brokerèŠ‚ç‚¹éƒ½æ²¡æœ‰é…ç½®broker.rackå‚æ•°ï¼Œæˆ–è€…ä½¿ç”¨disable-rack-awareå‚æ•°æ¥åˆ›å»ºä¸»é¢˜ï¼Œé‚£ä¹ˆé‡‡ç”¨çš„å°±æ˜¯æœªæŒ‡å®šæœºæ¶ä¿¡æ¯çš„åˆ†é…ç­–ç•¥ï¼Œå¦åˆ™é‡‡ç”¨çš„å°±æ˜¯æŒ‡å®šæœºæ¶ä¿¡æ¯çš„åˆ†é…ç­–ç•¥ã€‚","categories":[{"name":"kafka","slug":"kafka","permalink":"https://gyl-coder.top/categories/kafka/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://gyl-coder.top/tags/kafka/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.github.io"}},{"title":"kafkaçš„listenersé…ç½®é”™è¯¯å¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡","slug":"kafka/kafka-listeners-config","date":"2019-12-03T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"kafka/kafka-listeners-config/","link":"","permalink":"https://gyl-coder.top/kafka/kafka-listeners-config/","excerpt":"é—®é¢˜èƒŒæ™¯æˆ‘ä»¬åœ¨ç”¨kafkaçš„æ—¶å€™ï¼Œå¶å°”ä¼šé‡åˆ°è¿™æ ·è¿™æ ·ä¸€ä¸ªé—®é¢˜ã€‚ æˆ‘ä»¬å†™çš„kafkaçš„å®¢æˆ·ç«¯ç¨‹åºï¼Œåœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæ— ç¼˜æ— æ•…çš„ å¡ä½ï¼ˆé˜»å¡ï¼‰ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š","text":"é—®é¢˜èƒŒæ™¯æˆ‘ä»¬åœ¨ç”¨kafkaçš„æ—¶å€™ï¼Œå¶å°”ä¼šé‡åˆ°è¿™æ ·è¿™æ ·ä¸€ä¸ªé—®é¢˜ã€‚ æˆ‘ä»¬å†™çš„kafkaçš„å®¢æˆ·ç«¯ç¨‹åºï¼Œåœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæ— ç¼˜æ— æ•…çš„ å¡ä½ï¼ˆé˜»å¡ï¼‰ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™æ—¶ç¨‹åºä¼šé•¿æ—¶é—´é˜»å¡åœ¨è¿™é‡Œï¼Œæ— æ³•ç»§ç»­è¿›è¡Œåç»­æ“ä½œã€‚ é—®é¢˜æ’æŸ¥å› ä¸ºæ—¥å¿—æ²¡æœ‰ä»»ä½•æŠ¥é”™ä¿¡æ¯ï¼Œä½†æ˜¯åˆå¯ä»¥è‚¯å®šå½“å‰é¡¹ç›®å¹¶æ²¡æœ‰å®Œå…¨å¯åŠ¨æˆåŠŸã€‚æ„Ÿè§‰åƒæ˜¯ç¨‹åºå½“ä¸­æœ‰ä¸ªåœ°æ–¹å¡åˆ°äº†ã€‚é€šè¿‡ VisualVM å·¥å…·dump çº¿ç¨‹ç›¸å…³çš„ä¿¡æ¯ï¼Œå¾ˆå¿«å‘ç°äº†é—®é¢˜æ‰€åœ¨ã€‚åŸæ¥å¡åœ¨äº†consumeråˆå§‹åŒ–çš„åœ°æ–¹ã€‚ ä¸€ä¸‹æ˜¯æˆ‘è¿™è¾¹çš„å¤„ç†æ–¹å¼ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒä¸‹ã€‚å¦‚æœæœ‰æ›´å¥½çš„æ–¹å¼æ¬¢è¿å¤§å®¶ç›¸äº’äº¤æµã€‚ ä»¥ä¸‹æ–¹æ³•æ˜¯åœ¨åˆå§‹åŒ–Consumerçš„æ—¶å€™è¿›è¡Œå¤„ç†çš„ï¼š public KafkaConsumerImpl init() &#123; if (group == null || group.isEmpty()) &#123; throw new RuntimeException(&quot;phoenix.mq.group is empty&quot;); &#125; Properties props = new Properties(); props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, namesrvAddr); props.put(ConsumerConfig.GROUP_ID_CONFIG, group); // æ˜¯å¦å…è®¸è‡ªåŠ¨æäº¤offsetï¼Œè¿™é‡Œè®¾ä¸ºfalseï¼Œä¸‹é¢æ‰‹åŠ¨æäº¤ props.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, &quot;false&quot;); // ... consumer = new KafkaConsumer&lt;&gt;(props); // consumer è®¢é˜…çš„topicåŠpartition topicPartition = new TopicPartition(this.topic, this.partitionId); this.partitions = Collections.singletonList(topicPartition); // å…ƒæ•°æ®åˆå§‹åŒ–å’Œè¿æ¥æµ‹è¯•ï¼Œ3æ¬¡å¤±è´¥åæŠ›å‡ºå¼‚å¸¸ Callable&lt;Boolean&gt; call = new Callable&lt;Boolean&gt;() &#123; boolean res = false; int tryTimes = 3; @Override public Boolean call() throws Exception &#123; while (tryTimes-- &gt; 0) &#123; try &#123; consumer.assign(partitions); // é»˜è®¤åˆå§‹åŒ–offsetå½“å‰æœ€å¤§å€¼ nextBeginOffset = consumer.position(topicPartition); res = true; break; &#125; catch (Exception e) &#123; if (e instanceof InterruptedException) &#123; break; // å¦‚æœpositionåœ¨é˜»å¡çŠ¶æ€æ—¶ï¼Œè°ƒç”¨äº† task.cancel ä¼šæŠ›å‡ºæ­¤å¼‚å¸¸ã€‚ç›´æ¥é€€å‡ºå³å¯ &#125; LOG.error(e.getMessage(), e); LOG.error(&quot; ==&gt; error when trying to fetch metadata for kafka. topic&lt;&#123;&#125;&gt;, partition&lt;&#123;&#125;&gt;&quot;, topic, partitionId); &#125; // sleep try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; return res; &#125; &#125;; FutureTask&lt;Boolean&gt; task = new FutureTask&lt;&gt;(call); new Thread(task).start(); boolean isOk = false; try &#123; isOk = task.get(10000, TimeUnit.MILLISECONDS); &#125; catch (Exception e) &#123; LOG.error(&quot;Get task result timeout&quot;, e); &#125; task.cancel(true); if (isOk) &#123; LOG.info(&quot; ==&gt; init kafka consumer succeed: servers&lt;&#123;&#125;&gt;, topic&lt;&#123;&#125;&gt;, partition&lt;&#123;&#125;&gt;, nextBeginOffset&lt;&#123;&#125;&gt;&quot;, namesrvAddr, topic, partitionId, nextBeginOffset); &#125; else &#123; throw new RuntimeException(String.format( &quot; ==&gt; init kafka consumer failed. please check the conf (listeners or advertised.listeners or ...) and try to ping the host name in the conf value&quot;)); &#125; return this; &#125; åˆ©ç”¨ FutureTask çš„ç‰¹æ€§ï¼Œå®šä¹‰ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œ åœ¨åˆå§‹åŒ–Consumerçš„æ—¶å€™ï¼Œå°è¯•å»è¿æ¥kafkaï¼Œå¦‚æœé…ç½®çš„kafkaçš„åœ°å€æœ‰è¯¯ï¼Œæˆ–è€…é…ç½®å‡ºé”™åœ¨è¿™é‡Œå¯ä»¥é€šè¿‡æŠ›å‡ºé”™è¯¯ä½“ç°å‡ºæ¥ã€‚ æœ€åé€šè¿‡task.get() æ–¹æ³•è¿”å›çš„ç»“æœæ¥åˆ¤æ–­ Consumer æ˜¯å¦æˆåŠŸåˆå§‹åŒ–ã€‚","categories":[{"name":"kafka","slug":"kafka","permalink":"https://gyl-coder.top/categories/kafka/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://gyl-coder.top/tags/kafka/"},{"name":"çº¿ç¨‹é˜»å¡","slug":"çº¿ç¨‹é˜»å¡","permalink":"https://gyl-coder.top/tags/%E7%BA%BF%E7%A8%8B%E9%98%BB%E5%A1%9E/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.github.io"}},{"title":"Kafkaä¸­çš„åŸºæœ¬æ¦‚å¿µ","slug":"kafka/kafka-concept","date":"2019-12-01T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"kafka/kafka-concept/","link":"","permalink":"https://gyl-coder.top/kafka/kafka-concept/","excerpt":"æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸€ä¸‹kafkaä¸­çš„åŸºæœ¬æ¦‚å¿µï¼Œä¸»è¦åŒ…æ‹¬ï¼šProducerã€Consumerã€topicã€partitionã€offsetã€brokerã€ISRã€ARã€HWã€LEOç­‰ã€‚","text":"æœ¬æ–‡ä¸»è¦ä»‹ç»ä¸€ä¸‹kafkaä¸­çš„åŸºæœ¬æ¦‚å¿µï¼Œä¸»è¦åŒ…æ‹¬ï¼šProducerã€Consumerã€topicã€partitionã€offsetã€brokerã€ISRã€ARã€HWã€LEOç­‰ã€‚ ä¸€ä¸ªå…¸å‹çš„ Kafka ä½“ç³»æ¶æ„åŒ…æ‹¬è‹¥å¹² Producerã€è‹¥å¹² Brokerã€è‹¥å¹²Consumerï¼Œä»¥åŠä¸€ä¸ªZooKeeperé›†ç¾¤ã€‚å…¶ä¸­ZooKeeperæ˜¯Kafkaç”¨æ¥è´Ÿè´£é›†ç¾¤å…ƒæ•°æ®çš„ç®¡ç†ã€æ§åˆ¶å™¨çš„é€‰ä¸¾ç­‰æ“ä½œçš„ã€‚Producerå°†æ¶ˆæ¯å‘é€åˆ°Brokerï¼ŒBrokerè´Ÿè´£å°†æ”¶åˆ°çš„æ¶ˆæ¯å­˜å‚¨åˆ°ç£ç›˜ä¸­ï¼Œè€ŒConsumerè´Ÿè´£ä»Brokerè®¢é˜…å¹¶æ¶ˆè´¹æ¶ˆæ¯ã€‚ Producerï¼šç”Ÿäº§è€…ï¼Œä¹Ÿå°±æ˜¯å‘é€æ¶ˆæ¯çš„ä¸€æ–¹ã€‚ç”Ÿäº§è€…è´Ÿè´£åˆ›å»ºæ¶ˆæ¯ï¼Œç„¶åå°†å…¶æŠ•é€’åˆ°Kafkaä¸­ã€‚ Consumerï¼šæ¶ˆè´¹è€…ï¼Œä¹Ÿå°±æ˜¯æ¥æ”¶æ¶ˆæ¯çš„ä¸€æ–¹ã€‚æ¶ˆè´¹è€…è¿æ¥åˆ°Kafkaä¸Šå¹¶æ¥æ”¶æ¶ˆæ¯ï¼Œè¿›è€Œè¿›è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚ Brokerï¼šæœåŠ¡ä»£ç†èŠ‚ç‚¹ã€‚å¯¹äºKafkaè€Œè¨€ï¼ŒBrokerå¯ä»¥ç®€å•åœ°çœ‹ä½œä¸€ä¸ªç‹¬ç«‹çš„KafkaæœåŠ¡èŠ‚ç‚¹æˆ–KafkaæœåŠ¡å®ä¾‹ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ä¹Ÿå¯ä»¥å°†Brokerçœ‹ä½œä¸€å°KafkaæœåŠ¡å™¨ï¼Œå‰ææ˜¯è¿™å°æœåŠ¡å™¨ä¸Šåªéƒ¨ç½²äº†ä¸€ä¸ªKafkaå®ä¾‹ã€‚ä¸€ä¸ªæˆ–å¤šä¸ªBrokerç»„æˆäº†ä¸€ä¸ªKafkaé›†ç¾¤ã€‚ æ¶ˆè´¹è€…ï¼ˆConsumerï¼‰è´Ÿè´£è®¢é˜…Kafkaä¸­çš„ä¸»é¢˜ï¼ˆTopicï¼‰ï¼Œå¹¶ä¸”ä»è®¢é˜…çš„ä¸»é¢˜ä¸Šæ‹‰å–æ¶ˆæ¯ã€‚ä¸å…¶ä»–ä¸€äº›æ¶ˆæ¯ä¸­é—´ä»¶ä¸åŒçš„æ˜¯ï¼šåœ¨Kafkaçš„æ¶ˆè´¹ç†å¿µä¸­è¿˜æœ‰ä¸€å±‚æ¶ˆè´¹ç»„ï¼ˆConsumer Groupï¼‰çš„æ¦‚å¿µï¼Œæ¯ä¸ªæ¶ˆè´¹è€…éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„æ¶ˆè´¹ç»„ã€‚å½“æ¶ˆæ¯å‘å¸ƒåˆ°ä¸»é¢˜åï¼Œåªä¼šè¢«æŠ•é€’ç»™è®¢é˜…å®ƒçš„æ¯ä¸ªæ¶ˆè´¹ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…ã€‚ ä¾‹å¦‚ï¼ŒæŸä¸ªä¸»é¢˜ä¸­å…±æœ‰4ä¸ªåˆ†åŒºï¼ˆPartitionï¼‰ï¼šP0ã€P1ã€P2ã€P3ã€‚æœ‰ä¸¤ä¸ªæ¶ˆè´¹ç»„Aå’ŒBéƒ½è®¢é˜…äº†è¿™ä¸ªä¸»é¢˜ï¼Œæ¶ˆè´¹ç»„Aä¸­æœ‰4ä¸ªæ¶ˆè´¹è€…ï¼ˆC0ã€C1ã€C2å’ŒC3ï¼‰ï¼Œæ¶ˆè´¹ç»„Bä¸­æœ‰2ä¸ªæ¶ˆè´¹è€…ï¼ˆC4å’ŒC5ï¼‰ã€‚æŒ‰ç…§Kafkaé»˜è®¤çš„è§„åˆ™ï¼Œæœ€åçš„åˆ†é…ç»“æœæ˜¯æ¶ˆè´¹ç»„Aä¸­çš„æ¯ä¸€ä¸ªæ¶ˆè´¹è€…åˆ†é…åˆ°1ä¸ªåˆ†åŒºï¼Œæ¶ˆè´¹ç»„Bä¸­çš„æ¯ä¸€ä¸ªæ¶ˆè´¹è€…åˆ†é…åˆ°2ä¸ªåˆ†åŒºï¼Œä¸¤ä¸ªæ¶ˆè´¹ç»„ä¹‹é—´äº’ä¸å½±å“ã€‚æ¯ä¸ªæ¶ˆè´¹è€…åªèƒ½æ¶ˆè´¹æ‰€åˆ†é…åˆ°çš„åˆ†åŒºä¸­çš„æ¶ˆæ¯ã€‚æ¢è¨€ä¹‹ï¼Œæ¯ä¸€ä¸ªåˆ†åŒºåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹ç»„ä¸­çš„ä¸€ä¸ªæ¶ˆè´¹è€…æ‰€æ¶ˆè´¹ã€‚ æ¶ˆè´¹è€…ä¸æ¶ˆè´¹ç»„è¿™ç§æ¨¡å‹å¯ä»¥è®©æ•´ä½“çš„æ¶ˆè´¹èƒ½åŠ›å…·å¤‡æ¨ªå‘ä¼¸ç¼©æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ ï¼ˆæˆ–å‡å°‘ï¼‰æ¶ˆè´¹è€…çš„ä¸ªæ•°æ¥æé«˜ï¼ˆæˆ–é™ä½ï¼‰æ•´ä½“çš„æ¶ˆè´¹èƒ½åŠ›ã€‚å¯¹äºåˆ†åŒºæ•°å›ºå®šçš„æƒ…å†µï¼Œä¸€å‘³åœ°å¢åŠ æ¶ˆè´¹è€…å¹¶ä¸ä¼šè®©æ¶ˆè´¹èƒ½åŠ›ä¸€ç›´å¾—åˆ°æå‡ï¼Œå¦‚æœæ¶ˆè´¹è€…è¿‡å¤šï¼Œå‡ºç°äº†æ¶ˆè´¹è€…çš„ä¸ªæ•°å¤§äºåˆ†åŒºä¸ªæ•°çš„æƒ…å†µï¼Œå°±ä¼šæœ‰æ¶ˆè´¹è€…åˆ†é…ä¸åˆ°ä»»ä½•åˆ†åŒºã€‚ ä»¥ä¸Šåˆ†é…é€»è¾‘éƒ½æ˜¯åŸºäºé»˜è®¤çš„åˆ†åŒºåˆ†é…ç­–ç•¥è¿›è¡Œåˆ†æçš„ï¼Œå¯ä»¥é€šè¿‡æ¶ˆè´¹è€…å®¢æˆ·ç«¯å‚æ•°partition.assignment.strategy æ¥è®¾ç½®æ¶ˆè´¹è€…ä¸è®¢é˜…ä¸»é¢˜ä¹‹é—´çš„åˆ†åŒºåˆ†é…ç­–ç•¥ã€‚ å¯¹äºæ¶ˆæ¯ä¸­é—´ä»¶è€Œè¨€ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ¶ˆæ¯æŠ•é€’æ¨¡å¼ï¼šç‚¹å¯¹ç‚¹ï¼ˆP2Pï¼ŒPoint-to-Pointï¼‰æ¨¡å¼å’Œå‘å¸ƒ/è®¢é˜…ï¼ˆPub/Subï¼‰æ¨¡å¼ã€‚ç‚¹å¯¹ç‚¹æ¨¡å¼æ˜¯åŸºäºé˜Ÿåˆ—çš„ï¼Œæ¶ˆæ¯ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ï¼Œæ¶ˆæ¯æ¶ˆè´¹è€…ä»é˜Ÿåˆ—ä¸­æ¥æ”¶æ¶ˆæ¯ã€‚å‘å¸ƒè®¢é˜…æ¨¡å¼å®šä¹‰äº†å¦‚ä½•å‘ä¸€ä¸ªå†…å®¹èŠ‚ç‚¹å‘å¸ƒå’Œè®¢é˜…æ¶ˆæ¯ï¼Œè¿™ä¸ªå†…å®¹èŠ‚ç‚¹ç§°ä¸ºä¸»é¢˜ï¼ˆTopicï¼‰ï¼Œä¸»é¢˜å¯ä»¥è®¤ä¸ºæ˜¯æ¶ˆæ¯ä¼ é€’çš„ä¸­ä»‹ï¼Œæ¶ˆæ¯å‘å¸ƒè€…å°†æ¶ˆæ¯å‘å¸ƒåˆ°æŸä¸ªä¸»é¢˜ï¼Œè€Œæ¶ˆæ¯è®¢é˜…è€…ä»ä¸»é¢˜ä¸­è®¢é˜…æ¶ˆæ¯ã€‚ä¸»é¢˜ä½¿å¾—æ¶ˆæ¯çš„è®¢é˜…è€…å’Œå‘å¸ƒè€…äº’ç›¸ä¿æŒç‹¬ç«‹ï¼Œä¸éœ€è¦è¿›è¡Œæ¥è§¦å³å¯ä¿è¯æ¶ˆæ¯çš„ä¼ é€’ï¼Œå‘å¸ƒ/è®¢é˜…æ¨¡å¼åœ¨æ¶ˆæ¯çš„ä¸€å¯¹å¤šå¹¿æ’­æ—¶é‡‡ç”¨ã€‚Kafka åŒæ—¶æ”¯æŒä¸¤ç§æ¶ˆæ¯æŠ•é€’æ¨¡å¼ï¼Œè€Œè¿™æ­£æ˜¯å¾—ç›Šäºæ¶ˆè´¹è€…ä¸æ¶ˆè´¹ç»„æ¨¡å‹çš„å¥‘åˆï¼š å¦‚æœæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½éš¶å±äºåŒä¸€ä¸ªæ¶ˆè´¹ç»„ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ¶ˆæ¯éƒ½ä¼šè¢«å‡è¡¡åœ°æŠ•é€’ç»™æ¯ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œå³æ¯æ¡æ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†ï¼Œè¿™å°±ç›¸å½“äºç‚¹å¯¹ç‚¹æ¨¡å¼çš„åº”ç”¨ã€‚ å¦‚æœæ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½éš¶å±äºä¸åŒçš„æ¶ˆè´¹ç»„ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„æ¶ˆæ¯éƒ½ä¼šè¢«å¹¿æ’­ç»™æ‰€æœ‰çš„æ¶ˆè´¹è€…ï¼Œå³æ¯æ¡æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰çš„æ¶ˆè´¹è€…å¤„ç†ï¼Œè¿™å°±ç›¸å½“äºå‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„åº”ç”¨ã€‚ åœ¨Kafkaä¸­è¿˜æœ‰ä¸¤ä¸ªç‰¹åˆ«é‡è¦çš„æ¦‚å¿µ â€” ä¸»é¢˜ï¼ˆTopicï¼‰ ä¸ åˆ†åŒºï¼ˆPartitionï¼‰ã€‚ Kafkaä¸­çš„æ¶ˆæ¯ä»¥ä¸»é¢˜ä¸ºå•ä½è¿›è¡Œå½’ç±»ï¼Œç”Ÿäº§è€…è´Ÿè´£å°†æ¶ˆæ¯å‘é€åˆ°ç‰¹å®šçš„ä¸»é¢˜ï¼ˆå‘é€åˆ°Kafkaé›†ç¾¤ä¸­çš„æ¯ä¸€æ¡æ¶ˆæ¯éƒ½è¦æŒ‡å®šä¸€ä¸ªä¸»é¢˜ï¼‰ï¼Œè€Œæ¶ˆè´¹è€…è´Ÿè´£è®¢é˜…ä¸»é¢˜å¹¶è¿›è¡Œæ¶ˆè´¹ã€‚ä¸»é¢˜æ˜¯ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œå®ƒè¿˜å¯ä»¥ç»†åˆ†ä¸ºå¤šä¸ªåˆ†åŒºï¼Œä¸€ä¸ªåˆ†åŒºåªå±äºå•ä¸ªä¸»é¢˜ï¼Œå¾ˆå¤šæ—¶å€™ä¹Ÿä¼šæŠŠåˆ†åŒºç§°ä¸ºä¸»é¢˜åˆ†åŒºï¼ˆTopic-Partitionï¼‰ã€‚åŒä¸€ä¸»é¢˜ä¸‹çš„ä¸åŒåˆ†åŒºåŒ…å«çš„æ¶ˆæ¯æ˜¯ä¸åŒçš„ï¼Œåˆ†åŒºåœ¨å­˜å‚¨å±‚é¢å¯ä»¥çœ‹ä½œä¸€ä¸ªå¯è¿½åŠ çš„æ—¥å¿—ï¼ˆLogï¼‰æ–‡ä»¶ï¼Œæ¶ˆæ¯åœ¨è¢«è¿½åŠ åˆ°åˆ†åŒºæ—¥å¿—æ–‡ä»¶çš„æ—¶å€™éƒ½ä¼šåˆ†é…ä¸€ä¸ªç‰¹å®šçš„åç§»é‡ï¼ˆoffsetï¼‰ã€‚offsetæ˜¯æ¶ˆæ¯åœ¨åˆ†åŒºä¸­çš„å”¯ä¸€æ ‡è¯†ï¼ŒKafkaé€šè¿‡å®ƒæ¥ä¿è¯æ¶ˆæ¯åœ¨åˆ†åŒºå†…çš„é¡ºåºæ€§ï¼Œä¸è¿‡offsetå¹¶ä¸è·¨è¶Šåˆ†åŒºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒKafkaä¿è¯çš„æ˜¯åˆ†åŒºæœ‰åºè€Œä¸æ˜¯ä¸»é¢˜æœ‰åºã€‚Kafkaä¸­çš„åˆ†åŒºå¯ä»¥åˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ï¼ˆbrokerï¼‰ä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªä¸»é¢˜å¯ä»¥æ¨ªè·¨å¤šä¸ªbrokerï¼Œä»¥æ­¤æ¥æä¾›æ¯”å•ä¸ªbrokeræ›´å¼ºå¤§çš„æ€§èƒ½ã€‚ æ¯ä¸€æ¡æ¶ˆæ¯è¢«å‘é€åˆ°brokerä¹‹å‰ï¼Œä¼šæ ¹æ®åˆ†åŒºè§„åˆ™é€‰æ‹©å­˜å‚¨åˆ°å“ªä¸ªå…·ä½“çš„åˆ†åŒºã€‚å¦‚æœåˆ†åŒºè§„åˆ™è®¾å®šå¾—åˆç†ï¼Œæ‰€æœ‰çš„æ¶ˆæ¯éƒ½å¯ä»¥å‡åŒ€åœ°åˆ†é…åˆ°ä¸åŒçš„åˆ†åŒºä¸­ã€‚å¦‚æœä¸€ä¸ªä¸»é¢˜åªå¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶æ‰€åœ¨çš„æœºå™¨ I/O å°†ä¼šæˆä¸ºè¿™ä¸ªä¸»é¢˜çš„æ€§èƒ½ç“¶é¢ˆï¼Œè€Œåˆ†åŒºè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚åœ¨åˆ›å»ºä¸»é¢˜çš„æ—¶å€™å¯ä»¥é€šè¿‡æŒ‡å®šçš„å‚æ•°æ¥è®¾ç½®åˆ†åŒºçš„ä¸ªæ•°ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨ä¸»é¢˜åˆ›å»ºå®Œæˆä¹‹åå»ä¿®æ”¹åˆ†åŒºçš„æ•°é‡ï¼Œé€šè¿‡å¢åŠ åˆ†åŒºçš„æ•°é‡å¯ä»¥å®ç°æ°´å¹³æ‰©å±•ã€‚ Kafka ä¸ºåˆ†åŒºå¼•å…¥äº†å¤šå‰¯æœ¬ï¼ˆReplicaï¼‰æœºåˆ¶ï¼Œé€šè¿‡å¢åŠ å‰¯æœ¬æ•°é‡å¯ä»¥æå‡å®¹ç¾èƒ½åŠ›ã€‚åŒä¸€åˆ†åŒºçš„ä¸åŒå‰¯æœ¬ä¸­ä¿å­˜çš„æ˜¯ç›¸åŒçš„æ¶ˆæ¯ï¼ˆåœ¨åŒä¸€æ—¶åˆ»ï¼Œå‰¯æœ¬ä¹‹é—´å¹¶éå®Œå…¨ä¸€æ ·ï¼‰ï¼Œå‰¯æœ¬ä¹‹é—´æ˜¯â€œä¸€ä¸»å¤šä»â€çš„å…³ç³»ï¼Œå…¶ä¸­leaderå‰¯æœ¬è´Ÿè´£å¤„ç†è¯»å†™è¯·æ±‚ï¼Œfollowerå‰¯æœ¬åªè´Ÿè´£ä¸leaderå‰¯æœ¬çš„æ¶ˆæ¯åŒæ­¥ã€‚å‰¯æœ¬å¤„äºä¸åŒçš„brokerä¸­ï¼Œå½“leaderå‰¯æœ¬å‡ºç°æ•…éšœæ—¶ï¼Œä»followerå‰¯æœ¬ä¸­é‡æ–°é€‰ä¸¾æ–°çš„leaderå‰¯æœ¬å¯¹å¤–æä¾›æœåŠ¡ã€‚Kafkaé€šè¿‡å¤šå‰¯æœ¬æœºåˆ¶å®ç°äº†æ•…éšœçš„è‡ªåŠ¨è½¬ç§»ï¼Œå½“Kafkaé›†ç¾¤ä¸­æŸä¸ªbrokerå¤±æ•ˆæ—¶ä»ç„¶èƒ½ä¿è¯æœåŠ¡å¯ç”¨ã€‚ Kafka æ¶ˆè´¹ç«¯ä¹Ÿå…·å¤‡ä¸€å®šçš„å®¹ç¾èƒ½åŠ›ã€‚Consumer ä½¿ç”¨æ‹‰ï¼ˆPullï¼‰æ¨¡å¼ä»æœåŠ¡ç«¯æ‹‰å–æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¿å­˜æ¶ˆè´¹çš„å…·ä½“ä½ç½®ï¼Œå½“æ¶ˆè´¹è€…å®•æœºåæ¢å¤ä¸Šçº¿æ—¶å¯ä»¥æ ¹æ®ä¹‹å‰ä¿å­˜çš„æ¶ˆè´¹ä½ç½®é‡æ–°æ‹‰å–éœ€è¦çš„æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼Œè¿™æ ·å°±ä¸ä¼šé€ æˆæ¶ˆæ¯ä¸¢å¤±ã€‚ åˆ†åŒºä¸­çš„æ‰€æœ‰å‰¯æœ¬ç»Ÿç§°ä¸ºARï¼ˆAssigned Replicasï¼‰ã€‚æ‰€æœ‰ä¸leaderå‰¯æœ¬ä¿æŒä¸€å®šç¨‹åº¦åŒæ­¥çš„å‰¯æœ¬ï¼ˆåŒ…æ‹¬leaderå‰¯æœ¬åœ¨å†…ï¼‰ç»„æˆISRï¼ˆIn-Sync Replicasï¼‰ï¼ŒISRé›†åˆæ˜¯ARé›†åˆä¸­çš„ä¸€ä¸ªå­é›†ã€‚æ¶ˆæ¯ä¼šå…ˆå‘é€åˆ°leaderå‰¯æœ¬ï¼Œç„¶åfollowerå‰¯æœ¬æ‰èƒ½ä»leaderå‰¯æœ¬ä¸­æ‹‰å–æ¶ˆæ¯è¿›è¡ŒåŒæ­¥ï¼ŒåŒæ­¥æœŸé—´å†…followerå‰¯æœ¬ç›¸å¯¹äºleaderå‰¯æœ¬è€Œè¨€ä¼šæœ‰ä¸€å®šç¨‹åº¦çš„æ»åã€‚å‰é¢æ‰€è¯´çš„â€œä¸€å®šç¨‹åº¦çš„åŒæ­¥â€æ˜¯æŒ‡å¯å¿å—çš„æ»åèŒƒå›´ï¼Œè¿™ä¸ªèŒƒå›´å¯ä»¥é€šè¿‡å‚æ•°è¿›è¡Œé…ç½®ã€‚ä¸leaderå‰¯æœ¬åŒæ­¥æ»åè¿‡å¤šçš„å‰¯æœ¬ï¼ˆä¸åŒ…æ‹¬leaderå‰¯æœ¬ï¼‰ç»„æˆOSRï¼ˆOut-of-Sync Replicasï¼‰ï¼Œç”±æ­¤å¯è§ï¼ŒAR=ISR+OSRã€‚åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„ follower å‰¯æœ¬éƒ½åº”è¯¥ä¸ leader å‰¯æœ¬ä¿æŒä¸€å®šç¨‹åº¦çš„åŒæ­¥ï¼Œå³AR=ISRï¼ŒOSRé›†åˆä¸ºç©ºã€‚ leaderå‰¯æœ¬è´Ÿè´£ç»´æŠ¤å’Œè·Ÿè¸ªISRé›†åˆä¸­æ‰€æœ‰followerå‰¯æœ¬çš„æ»åçŠ¶æ€ï¼Œå½“followerå‰¯æœ¬è½åå¤ªå¤šæˆ–å¤±æ•ˆæ—¶ï¼Œleaderå‰¯æœ¬ä¼šæŠŠå®ƒä»ISRé›†åˆä¸­å‰”é™¤ã€‚å¦‚æœOSRé›†åˆä¸­æœ‰followerå‰¯æœ¬â€œè¿½ä¸Šâ€äº†leaderå‰¯æœ¬ï¼Œé‚£ä¹ˆleaderå‰¯æœ¬ä¼šæŠŠå®ƒä»OSRé›†åˆè½¬ç§»è‡³ISRé›†åˆã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“leaderå‰¯æœ¬å‘ç”Ÿæ•…éšœæ—¶ï¼Œåªæœ‰åœ¨ISRé›†åˆä¸­çš„å‰¯æœ¬æ‰æœ‰èµ„æ ¼è¢«é€‰ä¸¾ä¸ºæ–°çš„leaderï¼Œè€Œåœ¨OSRé›†åˆä¸­çš„å‰¯æœ¬åˆ™æ²¡æœ‰ä»»ä½•æœºä¼šï¼ˆä¸è¿‡è¿™ä¸ªåŸåˆ™ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹ç›¸åº”çš„å‚æ•°é…ç½®æ¥æ”¹å˜ï¼‰ã€‚ HW ã€ LEO å’Œä¸Šé¢æåˆ°çš„ ISRæœ‰ç€ç´§å¯†çš„å…³ç³»ã€‚ HW ï¼ˆHigh Watermarkï¼‰ä¿—ç§°é«˜æ°´ä½ï¼Œå®ƒæ ‡è¯†äº†ä¸€ä¸ªç‰¹å®šçš„æ¶ˆæ¯åç§»é‡ï¼ˆoffsetï¼‰ï¼Œæ¶ˆè´¹è€…åªèƒ½æ‹‰å–åˆ°è¿™ä¸ªoffsetä¹‹å‰çš„æ¶ˆæ¯ã€‚ ä¸‹å›¾è¡¨ç¤ºä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œè¿™ä¸ªæ—¥å¿—æ–‡ä»¶ä¸­åªæœ‰9æ¡æ¶ˆæ¯ï¼Œç¬¬ä¸€æ¡æ¶ˆæ¯çš„offsetï¼ˆLogStartOffsetï¼‰ä¸º0ï¼Œæœ€æœ‰ä¸€æ¡æ¶ˆæ¯çš„offsetä¸º8ï¼Œoffsetä¸º9çš„æ¶ˆæ¯ä½¿ç”¨è™šçº¿è¡¨ç¤ºçš„ï¼Œä»£è¡¨ä¸‹ä¸€æ¡å¾…å†™å…¥çš„æ¶ˆæ¯ã€‚æ—¥å¿—æ–‡ä»¶çš„ HW ä¸º6ï¼Œè¡¨ç¤ºæ¶ˆè´¹è€…åªèƒ½æ‹‰å–offsetåœ¨ 0 åˆ° 5 ä¹‹é—´çš„æ¶ˆæ¯ï¼Œoffsetä¸º6çš„æ¶ˆæ¯å¯¹æ¶ˆè´¹è€…è€Œè¨€æ˜¯ä¸å¯è§çš„ã€‚ LEO ï¼ˆLog End Offsetï¼‰ï¼Œæ ‡è¯†å½“å‰æ—¥å¿—æ–‡ä»¶ä¸­ä¸‹ä¸€æ¡å¾…å†™å…¥çš„æ¶ˆæ¯çš„offsetã€‚ä¸Šå›¾ä¸­offsetä¸º9çš„ä½ç½®å³ä¸ºå½“å‰æ—¥å¿—æ–‡ä»¶çš„ LEOï¼ŒLEO çš„å¤§å°ç›¸å½“äºå½“å‰æ—¥å¿—åˆ†åŒºä¸­æœ€åä¸€æ¡æ¶ˆæ¯çš„offsetå€¼åŠ 1.åˆ†åŒº ISR é›†åˆä¸­çš„æ¯ä¸ªå‰¯æœ¬éƒ½ä¼šç»´æŠ¤è‡ªèº«çš„ LEO ï¼Œè€Œ ISR é›†åˆä¸­æœ€å°çš„ LEO å³ä¸ºåˆ†åŒºçš„ HWï¼Œå¯¹æ¶ˆè´¹è€…è€Œè¨€åªèƒ½æ¶ˆè´¹ HW ä¹‹å‰çš„æ¶ˆæ¯ã€‚ LWæ˜¯Low Watermarkçš„ç¼©å†™ï¼Œä¿—ç§°â€œä½æ°´ä½â€ï¼Œä»£è¡¨ARé›†åˆä¸­æœ€å°çš„logStartOffsetå€¼ã€‚å‰¯æœ¬çš„æ‹‰å–è¯·æ±‚ï¼ˆFetchRequestï¼Œå®ƒæœ‰å¯èƒ½è§¦å‘æ–°å»ºæ—¥å¿—åˆ†æ®µè€Œæ—§çš„è¢«æ¸…ç†ï¼Œè¿›è€Œå¯¼è‡´logStartOffsetçš„å¢åŠ ï¼‰å’Œåˆ é™¤æ¶ˆæ¯è¯·æ±‚ï¼ˆDeleteRecordRequestï¼‰éƒ½æœ‰å¯èƒ½ä¿ƒä½¿LWçš„å¢é•¿ã€‚ ä¸‹é¢å…·ä½“åˆ†æä¸€ä¸‹ ISR é›†åˆå’Œ HWã€LEOçš„å…³ç³»ã€‚ å‡è®¾æŸåˆ†åŒºçš„ ISR é›†åˆä¸­æœ‰ 3 ä¸ªå‰¯æœ¬ï¼Œå³ä¸€ä¸ª leader å‰¯æœ¬å’Œ 2 ä¸ª follower å‰¯æœ¬ï¼Œæ­¤æ—¶åˆ†åŒºçš„ LEO å’Œ HW éƒ½åˆ†åˆ«ä¸º 3 ã€‚æ¶ˆæ¯3å’Œæ¶ˆæ¯4ä»ç”Ÿäº§è€…å‡ºå‘ä¹‹åå…ˆè¢«å­˜å…¥leaderå‰¯æœ¬ã€‚ åœ¨æ¶ˆæ¯è¢«å†™å…¥leaderå‰¯æœ¬ä¹‹åï¼Œfollowerå‰¯æœ¬ä¼šå‘é€æ‹‰å–è¯·æ±‚æ¥æ‹‰å–æ¶ˆæ¯3å’Œæ¶ˆæ¯4è¿›è¡Œæ¶ˆæ¯åŒæ­¥ã€‚ åœ¨åŒæ­¥è¿‡ç¨‹ä¸­ä¸åŒçš„å‰¯æœ¬åŒæ­¥çš„æ•ˆç‡ä¸å°½ç›¸åŒï¼Œåœ¨æŸä¸€æ—¶åˆ»follower1å®Œå…¨è·Ÿä¸Šäº†leaderå‰¯æœ¬è€Œfollower2åªåŒæ­¥äº†æ¶ˆæ¯3ï¼Œå¦‚æ­¤leaderå‰¯æœ¬çš„LEOä¸º5ï¼Œfollower1çš„LEOä¸º5ï¼Œfollower2çš„LEO ä¸º4ï¼Œé‚£ä¹ˆå½“å‰åˆ†åŒºçš„HWå–æœ€å°å€¼4ï¼Œæ­¤æ—¶æ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹åˆ°offset0è‡³3ä¹‹é—´çš„æ¶ˆæ¯ã€‚ å½“æ‰€æœ‰å‰¯æœ¬éƒ½æˆåŠŸå†™å…¥æ¶ˆæ¯3å’Œæ¶ˆæ¯4ä¹‹åï¼Œæ•´ä¸ªåˆ†åŒºçš„HWå’ŒLEOéƒ½å˜ä¸º5ï¼Œå› æ­¤æ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹åˆ°offsetä¸º4çš„æ¶ˆæ¯äº†ã€‚ ç”±æ­¤å¯è§kafkaçš„å¤åˆ¶æœºåˆ¶æ—¢ä¸æ˜¯å®Œå…¨çš„åŒæ­¥å¤åˆ¶ï¼Œä¹Ÿä¸æ˜¯å•çº¯çš„å¼‚æ­¥å¤åˆ¶ã€‚äº‹å®ä¸Šï¼ŒåŒæ­¥å¤åˆ¶è¦æ±‚æ‰€æœ‰èƒ½å·¥ä½œçš„followerå‰¯æœ¬éƒ½å¤åˆ¶å®Œï¼Œè¿™æ¡æ¶ˆæ¯æ‰ä¼šè¢«ç¡®è®¤å·²æˆåŠŸæäº¤ï¼Œè¿™ç§å¤åˆ¶æ–¹å¼æå¤§çš„å½±å“äº†æ€§èƒ½ã€‚è€Œåœ¨å¼‚æ­¥å¤åˆ¶çš„æ–¹å¼ä¸‹ï¼Œfollowerå‰¯æœ¬å¼‚æ­¥çš„ä»leaderå‰¯æœ¬ä¸­å¤åˆ¶æ•°æ®ï¼Œæ•°æ®åªè¦è¢«leaderå‰¯æœ¬å†™å…¥å°±ä¼šè¢«è®¤ä¸ºå·²ç»æˆåŠŸæäº¤ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœfollowerå‰¯æœ¬éƒ½è¿˜æ²¡æœ‰å¤åˆ¶å®Œè€Œè½åäºleaderå‰¯æœ¬ï¼Œç„¶åleaderå‰¯æœ¬å®•æœºï¼Œåˆ™ä¼šé€ æˆæ•°æ®ä¸¢å¤±ã€‚kafkaä½¿ç”¨è¿™ç§ISRçš„æ–¹å¼æœ‰æ•ˆçš„æƒè¡¡äº†æ•°æ®å¯é æ€§å’Œæ€§èƒ½ä¹‹é—´çš„å…³ç³»ã€‚","categories":[{"name":"kafka","slug":"kafka","permalink":"https://gyl-coder.top/categories/kafka/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://gyl-coder.top/tags/kafka/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"æ™ºåŠ›é¢˜","slug":"iq","date":"2019-11-14T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"iq/","link":"","permalink":"https://gyl-coder.top/iq/","excerpt":"","text":"No.1 ç»™ä¸€ä¸ªçå­52å¼ æ‰‘å…‹ç‰Œï¼Œå¹¶å‘Šè¯‰ä»–é‡Œé¢æ°å¥½æœ‰10å¼ ç‰Œæ˜¯æ­£é¢æœä¸Šçš„ã€‚è¦æ±‚è¿™ä¸ªçå­æŠŠç‰Œåˆ†æˆä¸¤å †ï¼Œä½¿å¾—æ¯å †ç‰Œé‡Œæ­£é¢æœä¸Šçš„ç‰Œçš„å¼ æ•°ä¸€æ ·å¤šã€‚çå­åº”è¯¥æ€ä¹ˆåšï¼Ÿ ç­”æ¡ˆï¼šæŠŠæ‰‘å…‹ç‰Œåˆ†æˆä¸¤å †ï¼Œä¸€å †10å¼ ï¼Œä¸€å †42å¼ ã€‚ç„¶åï¼ŒæŠŠå°çš„é‚£ä¸€å †é‡Œçš„æ‰€æœ‰ç‰Œå…¨éƒ¨ç¿»è¿‡æ¥ã€‚ No.2 å¦‚ä½•ç”¨ä¸€æšç¡¬å¸ç­‰æ¦‚ç‡åœ°äº§ç”Ÿä¸€ä¸ª1åˆ°3ä¹‹é—´çš„éšæœºæ•´æ•°ï¼Ÿå¦‚æœè¿™æšç¡¬å¸æ˜¯ä¸å…¬æ­£çš„å‘¢ï¼Ÿ ç­”æ¡ˆï¼šå¦‚æœæ˜¯å…¬æ­£çš„ç¡¬å¸ï¼Œåˆ™æŠ•æ·ä¸¤æ¬¡ï¼Œâ€œæ­£åâ€ä¸º1ï¼Œâ€œåæ­£â€ä¸º2ï¼Œâ€œæ­£æ­£â€ä¸º3ï¼Œâ€œååâ€é‡æ¥ã€‚ å¦‚æœæ˜¯ä¸å…¬æ­£çš„ç¡¬å¸ï¼Œæ³¨æ„åˆ°å‡ºç°â€œæ­£åâ€å’Œâ€œåæ­£â€çš„æ¦‚ç‡ä¸€æ ·ï¼Œå› æ­¤ä»¤â€œæ­£ååæ­£â€ã€â€œåæ­£æ­£åâ€ã€â€œæ­£åæ­£åâ€åˆ†åˆ«ä¸º1ã€2ã€3ï¼Œå…¶ä½™æƒ…å†µé‡æ¥ã€‚å¦ä¸€ç§æ›´å¦™çš„åŠæ³•æ˜¯ï¼ŒæŠ•æ·ä¸‰æ¬¡ç¡¬å¸ï¼Œâ€œæ­£ååâ€ä¸º1ï¼Œâ€œåæ­£åâ€ä¸º2ï¼Œâ€œååæ­£â€ä¸º3ï¼Œå…¶ä½™æƒ…å†µé‡æ¥ã€‚ No.330æšé¢å€¼ä¸å…¨ç›¸åŒçš„ç¡¬å¸æ‘†æˆä¸€æ’ï¼Œç”²ã€ä¹™ä¸¤ä¸ªäººè½®æµé€‰æ‹©è¿™æ’ç¡¬å¸çš„å…¶ä¸­ä¸€ç«¯ï¼Œå¹¶å–èµ°æœ€å¤–è¾¹çš„é‚£æšç¡¬å¸ã€‚å¦‚æœä½ å…ˆå–ç¡¬å¸ï¼Œèƒ½ä¿è¯å¾—åˆ°çš„é’±ä¸ä¼šæ¯”å¯¹æ‰‹å°‘å—ï¼Ÿ ç­”æ¡ˆï¼šå…ˆå–è€…å¯ä»¥è®©è‡ªå·±æ€»æ˜¯å–å¥‡æ•°ä½ç½®ä¸Šçš„ç¡¬å¸æˆ–è€…æ€»æ˜¯å–å¶æ•°ä½ç½®ä¸Šçš„ç¡¬å¸ã€‚æ•°ä¸€æ•°æ˜¯å¥‡æ•°ä½ç½®ä¸Šçš„é¢å€¼æ€»å’Œå¤šè¿˜æ˜¯å¶æ•°ä½ç½®ä¸Šçš„é¢å€¼æ€»å’Œå¤šï¼Œç„¶åæ€»æ˜¯å–è¿™äº›ä½ç½®ä¸Šçš„ç¡¬å¸å°±å¯ä»¥äº†ã€‚ No.4 ä¸€ä¸ªç¯å½¢è½¨é“ä¸Šæœ‰nä¸ªåŠ æ²¹ç«™ï¼Œæ‰€æœ‰åŠ æ²¹ç«™çš„æ²¹é‡æ€»å’Œæ­£å¥½å¤Ÿè½¦è·‘ä¸€åœˆã€‚è¯æ˜ï¼Œæ€»èƒ½æ‰¾åˆ°å…¶ä¸­ä¸€ä¸ªåŠ æ²¹ç«™ï¼Œä½¿å¾—åˆå§‹æ—¶æ²¹ç®±ä¸ºç©ºçš„æ±½è½¦ä»è¿™é‡Œå‡ºå‘ï¼Œèƒ½å¤Ÿé¡ºåˆ©ç¯è¡Œä¸€åœˆå›åˆ°èµ·ç‚¹ã€‚ ç­”æ¡ˆï¼šæ€»å­˜åœ¨ä¸€ä¸ªåŠ æ²¹ç«™ï¼Œä»…ç”¨å®ƒçš„æ²¹å°±è¶³å¤Ÿè·‘åˆ°ä¸‹ä¸€ä¸ªåŠ æ²¹ç«™ï¼ˆå¦åˆ™æ‰€æœ‰åŠ æ²¹ç«™çš„æ²¹é‡åŠ èµ·æ¥å°†ä¸å¤Ÿå…¨ç¨‹ï¼‰ã€‚æŠŠä¸‹ä¸€ä¸ªåŠ æ²¹ç«™çš„æ‰€æœ‰æ²¹éƒ½æå‰æ¬åˆ°è¿™ä¸ªåŠ  æ²¹ç«™æ¥ï¼Œå¹¶æŠŠæ²¹å·²è¢«æ¬èµ°çš„åŠ æ²¹ç«™æ— è§†æ‰ã€‚åœ¨å‰©ä¸‹çš„åŠ æ²¹ç«™ä¸­ç»§ç»­å¯»æ‰¾æ²¹é‡è¶³ä»¥åˆ°è¾¾ä¸‹ä¸ªåŠ æ²¹ç«™çš„åœ°æ–¹ï¼Œä¸æ–­åˆå¹¶åŠ æ²¹ç«™ï¼Œç›´åˆ°åªå‰©ä¸€ä¸ªåŠ æ²¹ç«™ä¸ºæ­¢ã€‚æ˜¾ç„¶ä»è¿™é‡Œå‡ºå‘å°±èƒ½é¡ºåˆ©è·‘å®Œå…¨ç¨‹ã€‚ å¦ä¸€ç§è¯æ˜æ–¹æ³•ï¼šå…ˆè®©æ±½è½¦æ²¹ç®±é‡Œè£…å¥½è¶³å¤Ÿå¤šçš„æ²¹ï¼Œéšä¾¿ä»å“ªä¸ªåŠ æ²¹ç«™å‡ºå‘è¯•è·‘ä¸€åœˆã€‚è½¦æ¯åˆ°ä¸€ä¸ªåŠ æ²¹ç«™æ—¶ï¼Œè®°å½•æ­¤æ—¶æ²¹ç®±é‡Œå‰©ä¸‹çš„æ²¹é‡ï¼Œç„¶åæŠŠé‚£ä¸ªåŠ æ²¹ç«™çš„æ²¹å…¨éƒ¨è£…ä¸Šã€‚è¯•è·‘å®Œä¸€åœˆåï¼Œæ£€æŸ¥åˆšæ‰è·¯ä¸Šåˆ°å“ªä¸ªåŠ æ²¹ç«™æ—¶å‰©çš„æ²¹é‡æœ€å°‘ï¼Œé‚£ä¹ˆç©ºç€æ²¹ç®±ä»é‚£é‡Œå‡ºå‘æ˜¾ç„¶ä¸€å®šèƒ½è·‘å®Œå…¨ç¨‹ã€‚ No.5åˆå§‹æ—¶ï¼Œä¸¤ä¸ªå£è¢‹é‡Œå„æœ‰ä¸€ä¸ªçƒã€‚æŠŠåé¢çš„n-2ä¸ªçƒä¾æ¬¡æ”¾å…¥å£è¢‹ï¼Œæ”¾è¿›å“ªä¸ªå£è¢‹å…¶æ¦‚ç‡ä¸å„å£è¢‹å·²æœ‰çš„çƒæ•°æˆæ­£æ¯”ã€‚è¿™æ ·ä¸‹æ¥ï¼Œçƒæ•°è¾ƒå°‘çš„é‚£ä¸ªå£è¢‹å¹³å‡æœŸæœ›æœ‰å¤šå°‘ä¸ªçƒï¼Ÿ ç­”æ¡ˆï¼šå…ˆè€ƒè™‘ä¸€ä¸ªçœ‹ä¼¼æ— å…³çš„é—®é¢˜â€”â€”æ€æ ·äº§ç”Ÿä¸€ä¸ª1åˆ°nçš„éšæœºæ’åˆ—ã€‚é¦–å…ˆï¼Œåœ¨çº¸ä¸Šå†™ä¸‹æ•°å­—1ï¼›ç„¶åï¼ŒæŠŠ2å†™åœ¨1çš„å·¦è¾¹æˆ–è€…å³è¾¹ï¼›ç„¶åï¼ŒæŠŠ3å†™åœ¨æœ€ å·¦è¾¹ï¼Œæœ€å³è¾¹ï¼Œæˆ–è€…æ’è¿›1å’Œ2ä¹‹é—´â€¦â€¦æ€»ä¹‹ï¼ŒæŠŠæ•°å­—iç­‰æ¦‚ç‡åœ°æ”¾è¿›ç”±å‰é¢i-1ä¸ªæ•°äº§ç”Ÿçš„ï¼ˆåŒ…æ‹¬æœ€å·¦ç«¯å’Œæœ€å³ç«¯åœ¨å†…çš„ï¼‰å…±iä¸ªç©ºä½ä¸­çš„ä¸€ä¸ªã€‚è¿™æ ·ç”Ÿæˆçš„æ˜¾ ç„¶æ˜¯ä¸€ä¸ªå®Œå…¨éšæœºçš„æ’åˆ—ã€‚ æˆ‘ä»¬æ¢ä¸€ä¸ªè§’åº¦æ¥çœ‹é¢˜ç›®æè¿°çš„è¿‡ç¨‹ï¼šå‡æƒ³ç”¨ä¸€æ ¹ç»³å­æŠŠä¸¤ä¸ªçƒæ‹´åœ¨ä¸€èµ·ï¼ŒæŠŠè¿™æ ¹ç»³å­æ ‡å·ä¸º1ã€‚æ¥ä¸‹æ¥ï¼ŒæŠŠå…¶ä¸­ä¸€ä¸ªå°çƒåˆ†è£‚æˆä¸¤ä¸ªå°çƒï¼Œè¿™ä¸¤ä¸ªå°çƒç”¨ æ ‡å·ä¸º2çš„ç»³å­ç›¸è¿ã€‚æ€»ä¹‹ï¼ŒæŠŠâ€œæ”¾è¿›ç¬¬iä¸ªçƒâ€çš„æ“ä½œæƒ³è±¡æˆæŠŠå…¶ä¸­ä¸€ä¸ªçƒåˆ†è£‚æˆä¸¤ä¸ªç”¨æ ‡æœ‰i-1çš„ç»³å­ç›¸è¿çš„å°çƒã€‚è”æƒ³æˆ‘ä»¬å‰é¢çš„è®¨è®ºï¼Œè¿™äº›ç»³å­çš„æ ‡å·äº‹ å®ä¸Šæ˜¯ä¸€ä¸ªéšæœºçš„å…¨æ’åˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¼€å§‹ç»³å­1çš„ä½ç½®æœ€åç­‰å¯èƒ½åœ°å‡ºç°åœ¨æ¯ä¸ªåœ°æ–¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¸¤è¾¹çš„å°çƒä¸ªæ•°(1,n-1)ã€(2,n-2)ã€ (3,n-3)ã€â€¦â€¦ã€(n-1,1)è¿™n-1ç§æƒ…å†µç­‰å¯èƒ½åœ°å‘ç”Ÿã€‚å› æ­¤ï¼Œå°è¢‹å­é‡Œçš„çƒæ•°å¤§çº¦ä¸ºn/4ä¸ªã€‚å‡†ç¡®åœ°è¯´ï¼Œå½“nä¸ºå¥‡æ•°æ—¶ï¼Œå°è¢‹å­é‡Œçš„çƒæ•°ä¸º (n+1)/4ï¼›å½“nä¸ºå¶æ•°æ—¶ï¼Œå°è¢‹å­é‡Œçš„çƒæ•°ä¸ºn^2/(4n-4)ã€‚ No.6è€ƒè™‘ä¸€ä¸ªn*nçš„æ£‹ç›˜ï¼ŒæŠŠæœ‰å…¬å…±è¾¹çš„ä¸¤ä¸ªæ ¼å­å«åšç›¸é‚»çš„æ ¼å­ã€‚åˆå§‹æ—¶ï¼Œæœ‰äº›æ ¼å­é‡Œæœ‰ç—…æ¯’ã€‚æ¯ä¸€ç§’é’Ÿåï¼Œåªè¦ä¸€ä¸ªæ ¼å­è‡³å°‘æœ‰ä¸¤ä¸ªç›¸é‚»æ ¼å­æŸ“ä¸Šäº†ç—…æ¯’ï¼Œé‚£ä¹ˆä»–è‡ªå·±ä¹Ÿä¼šè¢«æ„ŸæŸ“ã€‚ä¸ºäº†è®©æ‰€æœ‰çš„æ ¼å­éƒ½è¢«æ„ŸæŸ“ï¼Œåˆå§‹æ—¶æœ€å°‘éœ€è¦æœ‰å‡ ä¸ªå¸¦ç—…æ¯’çš„æ ¼å­ï¼Ÿç»™å‡ºä¸€ç§æ–¹æ¡ˆå¹¶è¯æ˜æœ€ä¼˜æ€§ã€‚ ç­”æ¡ˆï¼šè‡³å°‘è¦nä¸ªï¼Œæ¯”å¦‚ä¸€æ¡å¯¹è§’çº¿ä¸Šçš„nä¸ªæ ¼å­ã€‚nä¸ªæ ¼å­ä¹Ÿæ˜¯å¿…éœ€çš„ã€‚å½“ä¸€ä¸ªæ–°çš„æ ¼å­è¢«æ„ŸæŸ“åï¼Œå…¨ä½“è¢«æ„ŸæŸ“çš„æ ¼å­æ‰€ç»„æˆçš„å›¾å½¢çš„å‘¨é•¿å°†å‡å°‘0ä¸ªã€ 2ä¸ªæˆ–4ä¸ªå•ä½ï¼ˆå…·ä½“å‡å°‘äº†å¤šå°‘è¦çœ‹å®ƒå‘¨å›´è¢«æ„ŸæŸ“çš„æ ¼å­æœ‰å¤šå°‘ä¸ªï¼‰ã€‚åˆå› ä¸ºå½“æ‰€æœ‰æ ¼å­éƒ½è¢«æ„ŸæŸ“åï¼Œå›¾å½¢çš„å‘¨é•¿ä¸º4nï¼Œå› æ­¤åˆå§‹æ—¶è‡³å°‘è¦æœ‰nä¸ªè¢«æ„ŸæŸ“çš„æ ¼ å­ã€‚ No.7åœ¨ä¸€ä¸ªm*nçš„æ£‹ç›˜ä¸Šï¼Œæœ‰kä¸ªæ ¼å­é‡Œæ”¾æœ‰æ£‹å­ã€‚æ˜¯å¦æ€»èƒ½å¯¹æ‰€æœ‰æ£‹å­è¿›è¡Œçº¢è“äºŒæŸ“è‰²ï¼Œä½¿å¾—æ¯è¡Œæ¯åˆ—çš„çº¢è‰²æ£‹å­å’Œè“è‰²æ£‹å­æœ€å¤šå·®ä¸€ä¸ªï¼Ÿ ç­”æ¡ˆï¼šå¯ä»¥ã€‚å»ºä¸€ä¸ªäºŒåˆ†å›¾G(X,Y)ï¼Œå…¶ä¸­Xæœ‰mä¸ªé¡¶ç‚¹ä»£è¡¨äº†æ£‹ç›˜çš„mä¸ªè¡Œï¼ŒYæœ‰nä¸ªé¡¶ç‚¹ä»£è¡¨äº†æ£‹ç›˜çš„nä¸ªåˆ—ã€‚ç¬¬iè¡Œç¬¬jåˆ—æœ‰æ£‹å­å°±åœ¨X(i) å’ŒY(j)ä¹‹é—´è¿ä¸€æ¡è¾¹ã€‚å…ˆæ‰¾å‡ºå›¾Gé‡Œçš„æ‰€æœ‰ç¯ï¼ˆç”±äºæ˜¯äºŒåˆ†å›¾ï¼Œç¯çš„é•¿åº¦ä¸€å®šæ˜¯å¶æ•°ï¼‰ï¼ŒæŠŠç¯é‡Œçš„è¾¹çº¢è“äº¤æ›¿æŸ“è‰²ã€‚å‰©ä¸‹çš„æ²¡æŸ“è‰²çš„å›¾ä¸€å®šæ˜¯ä¸€äº›æ ‘ã€‚å¯¹æ¯æ£µæ ‘ é€’å½’åœ°è¿›è¡Œæ“ä½œï¼šå»æ‰ä¸€ä¸ªå¶å­èŠ‚ç‚¹å’Œå¯¹åº”è¾¹ï¼ŒæŠŠå‰©ä¸‹çš„æ ‘è¿›è¡Œåˆæ³•çš„çº¢è“äºŒæŸ“è‰²ï¼Œå†æŠŠåˆšæ‰å»æ‰çš„é¡¶ç‚¹å’Œè¾¹åŠ å›å»ï¼Œç»™è¿™ä¸ªè¾¹é€‚å½“çš„é¢œè‰²ä»¥æ»¡è¶³è¦æ±‚ã€‚ No.8ä»»æ„ç»™ä¸€ä¸ª88çš„01çŸ©é˜µï¼Œä½ æ¯æ¬¡åªèƒ½é€‰ä¸€ä¸ª33æˆ–è€…4*4çš„å­çŸ©é˜µå¹¶æŠŠé‡Œé¢çš„å…ƒç´ å…¨éƒ¨å–åã€‚æ˜¯å¦æ€»æœ‰åŠæ³•æŠŠçŸ©é˜µé‡Œçš„æ‰€æœ‰æ•°å…¨éƒ¨å˜ä¸º1ï¼Ÿ ç­”æ¡ˆï¼šä¸èƒ½ã€‚å¤§çŸ©é˜µä¸­æœ‰36ä¸ª33çš„å°çŸ©é˜µå’Œ25ä¸ª44çš„å°çŸ©é˜µï¼Œå› æ­¤æ€»å…±æœ‰61ç§å¯èƒ½çš„æ“ä½œã€‚æ˜¾ç„¶ï¼Œç»™å®šä¸€ä¸ªæ“ä½œåºåˆ—ï¼Œè¿™äº›æ“ä½œçš„å…ˆåé¡ºåº æ˜¯æ— å…³ç´§è¦çš„ï¼›å¦å¤–ï¼Œåœ¨ä¸€ä¸ªæ“ä½œåºåˆ—ä¸­ä½¿ç”¨ä¸¤ç§æˆ–ä¸¤ç§ä»¥ä¸Šç›¸åŒçš„æ“ä½œä¹Ÿæ˜¯æ— ç”¨çš„ã€‚å› æ­¤ï¼Œå®è´¨ä¸åŒçš„æ“ä½œåºåˆ—åªæœ‰2^61ç§ã€‚ä½†8*8çš„01çŸ©é˜µä¸€å…±æœ‰ 2^64ç§ï¼Œå› æ­¤ä¸æ˜¯æ¯ç§æƒ…å†µéƒ½æœ‰åŠæ³•è¾¾åˆ°ç›®çš„ã€‚ No.9äº”ä¸ªæ´æ’æˆä¸€æ’ï¼Œå…¶ä¸­ä¸€ä¸ªæ´é‡Œè—æœ‰ä¸€åªç‹ç‹¸ã€‚æ¯ä¸ªå¤œæ™šï¼Œç‹ç‹¸éƒ½ä¼šè·³åˆ°ä¸€ä¸ªç›¸é‚»çš„æ´é‡Œï¼›æ¯ä¸ªç™½å¤©ï¼Œä½ éƒ½åªå…è®¸æ£€æŸ¥å…¶ä¸­ä¸€ä¸ªæ´ã€‚æ€æ ·æ‰èƒ½ä¿è¯ç‹ç‹¸æœ€ç»ˆä¼šè¢«æŠ“ä½ï¼Ÿ ç­”æ¡ˆï¼šæŒ‰ç…§2, 3, 4, 2, 3, 4çš„é¡ºåºæ£€æŸ¥ç‹ç‹¸æ´å¯ä»¥ä¿è¯æŠ“ä½ç‹ç‹¸ã€‚ä¸ºäº†è¯´æ˜è¿™ä¸ªæ–¹æ¡ˆæ˜¯å¯è¡Œçš„ï¼Œç”¨é›†åˆFè¡¨ç¤ºç‹ç‹¸å¯èƒ½å‡ºç°çš„ä½ç½®ï¼Œåˆå§‹æ—¶F = {1, 2, 3, 4, 5}ã€‚å¦‚æœå®ƒä¸åœ¨2å·æ´ï¼Œåˆ™ç¬¬äºŒå¤©ç‹ç‹¸å·²ç»è·‘åˆ°äº†F = {2, 3, 4, 5}ã€‚å¦‚æœæ­¤æ—¶å®ƒä¸åœ¨3å·æ´ï¼Œåˆ™ç¬¬ä¸‰å¤©ç‹ç‹¸ä¸€å®šè·‘åˆ°äº†F = {1, 3, 4, 5}ã€‚å¦‚æœæ­¤æ—¶å®ƒä¸åœ¨4å·æ´ï¼Œåˆ™å†è¿‡ä¸€æ™šåF = {2, 4}ã€‚å¦‚æœæ­¤æ—¶å®ƒä¸åœ¨2å·æ´ï¼Œåˆ™å†è¿‡ä¸€å¤©F = {3, 5}ã€‚å¦‚æœæ­¤æ—¶å®ƒä¸åœ¨3å·æ´ï¼Œå†è¿‡ä¸€å¤©å®ƒå°±ä¸€å®šè·‘åˆ°4å·æ´äº†ã€‚ æ–¹æ¡ˆä¸æ˜¯å”¯ä¸€çš„ï¼Œä¸‹é¢è¿™äº›æ–¹æ¡ˆéƒ½æ˜¯å¯è¡Œçš„ï¼š 2, 3, 4, 4, 3, 24, 3, 2, 2, 3, 44, 3, 2, 4, 3, 2 No.10ä¸€ä¸ªç»å…¸è€é¢˜æ˜¯è¯´ï¼ŒæŠŠä¸€ä¸ª333çš„ç«‹æ–¹ä½“åˆ‡æˆ27ä¸ªå•ä½ç«‹æ–¹ä½“ï¼Œè‹¥æ¯ä¸€åˆ€åˆ‡å®Œåéƒ½å…è®¸é‡æ–°æ‘†æ”¾å„ä¸ªå°å—çš„ä½ç½®ï¼Œæœ€å°‘å¯ä»¥ç”¨å‡ åˆ€ï¼Ÿç­”æ¡ˆä»ç„¶æ˜¯6åˆ€ï¼Œå› ä¸º æ­£ä¸­é—´é‚£ä¸ªå•ä½ç«‹æ–¹ä½“çš„6ä¸ªé¢éƒ½æ˜¯åæ¥æ‰åˆ‡å‡ºæ¥çš„ï¼Œå› æ­¤æ€ä¹ˆä¹Ÿéœ€è¦6åˆ€ã€‚è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼šè‹¥æŠŠä¸€ä¸ªnnnçš„ç«‹æ–¹ä½“åˆ‡æˆä¸€ä¸ªä¸ªå•ä½ç«‹æ–¹ä½“ï¼Œæœ€å°‘éœ€è¦å‡ åˆ€ï¼Ÿ ç­”æ¡ˆï¼šäº‹å®ä¸Šï¼Œä»ä¸€ä¸ªæ›´å¼ºçš„å‘½é¢˜å‡ºå‘åè€Œèƒ½ä½¿é—®é¢˜å˜å¾—æ›´ç®€å•ã€‚å¯¹äºä¸€ä¸ªabcçš„é•¿æ–¹ä½“ï¼Œæˆ‘ä»¬éœ€è¦f(a)+f(b)+f(c)åˆ€ï¼Œå…¶ä¸­ f(x)=âŒˆlog(x)/log(2)âŒ‰ã€‚åªéœ€è¦æ³¨æ„åˆ°ï¼Œåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­çš„ä»»ä½•ä¸€æ­¥ï¼Œåˆ‡å®Œå½“å‰æœ€å¤§çš„å—æ‰€éœ€è¦çš„åˆ€æ•°ä¹Ÿå°±ç­‰äºæ•´ä¸ªè¿‡ç¨‹è¿˜éœ€è¦çš„åˆ€æ•°ï¼Œå› ä¸ºå…¶ å®ƒå°å—éœ€è¦çš„åˆ€æ•°éƒ½ä¸ä¼šè¶…è¿‡æœ€å¤§å—æ‰€éœ€åˆ€æ•°ï¼Œå®ƒä»¬éƒ½å¯ä»¥ä¸æœ€å¤§å—ä¸€é“å¹¶è¡Œå¤„ç†ã€‚è¿™è¡¨æ˜ï¼Œæˆ‘ä»¬çš„æœ€ä¼˜å†³ç­–å³æ˜¯è®©å½“å‰çš„æœ€å¤§å—å°½å¯èƒ½çš„å°ï¼Œä¹Ÿå°±æ˜¯è¯´è¦æŠŠå½“å‰çš„ æœ€å¤§å—å°½å¯èƒ½ç›¸ç­‰åœ°åˆ‡æˆä¸¤åŠã€‚åˆ©ç”¨æ•°å­¦å½’çº³æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¿«å¾—åˆ°æœ¬æ®µå¼€å¤´çš„ç»“è®ºã€‚","categories":[],"tags":[],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.github.io"}},{"title":"ç­‰å¾…é€šçŸ¥æœºåˆ¶","slug":"concurrency/waiting_for_notification","date":"2019-11-06T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"concurrency/waiting_for_notification/","link":"","permalink":"https://gyl-coder.top/concurrency/waiting_for_notification/","excerpt":"å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œç»å¸¸å‡ºç°è¿™æ ·ä¸€ç§åœºæ™¯ã€‚ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†ä¸€ä¸ªå¯¹è±¡çš„å€¼ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹æ„ŸçŸ¥åˆ°äº†å˜åŒ–ï¼Œç„¶åè¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œæ•´ä¸ªè¿‡ç¨‹å¼€å§‹äºä¸€ä¸ªçº¿ç¨‹ï¼Œæœ€ç»ˆç»“æŸäºå¦ä¸€ä¸ªçº¿ç¨‹ã€‚è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å‹ï¼ˆå‰è€…æ˜¯ç”Ÿäº§è€…ï¼Œåè€…æ˜¯æ¶ˆè´¹è€…ï¼‰ã€‚ è€Œå®ç°è¿™ç§åŠŸèƒ½æ¯”è¾ƒç®€å•çš„æ–¹æ³•å°±æ˜¯è®©æ¶ˆè´¹è€…çº¿ç¨‹ä¸æ–­çš„å¾ªç¯å˜é‡åˆ¤æ–­æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚å¦‚ä¸‹æ‰€ç¤º while (!isOK(...))&#123; Thread.sleep(1000); &#125; doIt(); while å¾ªç¯ä¸­è®¾ç½®ä¸æ»¡è¶³çš„æ¡ä»¶ï¼Œå¦‚æœæ¡ä»¶æ»¡è¶³åˆ™é€€å‡ºå¾ªç¯ï¼ˆç¡çœ å¯ä»¥é˜²æ­¢è¿‡å¿«çš„â€œæ— æ•ˆå°è¯•â€ï¼‰ å¦‚æœisOKæ–¹æ³•çš„åˆ¤æ–­é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œæ“ä½œè€—æ—¶è¾ƒçŸ­ï¼Œè€Œä¸”å¹¶å‘å†²çªé‡ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨è¿™ç§æ–¹æ¡ˆä¹Ÿæœªå°ä¸å¯ã€‚ä½†æ˜¯å¦‚æœåˆ¤æ–­é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œæˆ–è€…å¹¶å‘å†²çªè¾ƒå¤§æ—¶ã€‚è¿™ç§æ–¹æ¡ˆå°±ä¸è¡Œäº†ï¼Œwhileå¾ªç¯ä¼šæ‰§è¡Œå¾ˆå¤šå¾ˆå¤šæ¬¡ï¼ŒCPUæ¶ˆè€—è¾ƒå¤§ã€‚ é’ˆå¯¹è¿™ç§é—®é¢˜ï¼ŒJavaå†…ç½®çš„ç­‰å¾…é€šçŸ¥æœºåˆ¶èƒ½å¤Ÿè¾ƒå¥½çš„è§£å†³ã€‚å½“æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹é˜»å¡è‡ªå·±ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚å½“çº¿ç¨‹æ¡ä»¶æ»¡è¶³æ—¶ï¼Œé€šçŸ¥ç­‰å¾…çš„çº¿ç¨‹é‡æ–°æ‰§è¡Œã€‚çº¿ç¨‹é˜»å¡é¿å…äº†å¾ªç¯ç­‰å¾…å¸¦æ¥çš„CPUæ¶ˆè€—é—®é¢˜ã€‚","text":"å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œç»å¸¸å‡ºç°è¿™æ ·ä¸€ç§åœºæ™¯ã€‚ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†ä¸€ä¸ªå¯¹è±¡çš„å€¼ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹æ„ŸçŸ¥åˆ°äº†å˜åŒ–ï¼Œç„¶åè¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œæ•´ä¸ªè¿‡ç¨‹å¼€å§‹äºä¸€ä¸ªçº¿ç¨‹ï¼Œæœ€ç»ˆç»“æŸäºå¦ä¸€ä¸ªçº¿ç¨‹ã€‚è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å‹ï¼ˆå‰è€…æ˜¯ç”Ÿäº§è€…ï¼Œåè€…æ˜¯æ¶ˆè´¹è€…ï¼‰ã€‚ è€Œå®ç°è¿™ç§åŠŸèƒ½æ¯”è¾ƒç®€å•çš„æ–¹æ³•å°±æ˜¯è®©æ¶ˆè´¹è€…çº¿ç¨‹ä¸æ–­çš„å¾ªç¯å˜é‡åˆ¤æ–­æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚å¦‚ä¸‹æ‰€ç¤º while (!isOK(...))&#123; Thread.sleep(1000); &#125; doIt(); while å¾ªç¯ä¸­è®¾ç½®ä¸æ»¡è¶³çš„æ¡ä»¶ï¼Œå¦‚æœæ¡ä»¶æ»¡è¶³åˆ™é€€å‡ºå¾ªç¯ï¼ˆç¡çœ å¯ä»¥é˜²æ­¢è¿‡å¿«çš„â€œæ— æ•ˆå°è¯•â€ï¼‰ å¦‚æœisOKæ–¹æ³•çš„åˆ¤æ–­é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œæ“ä½œè€—æ—¶è¾ƒçŸ­ï¼Œè€Œä¸”å¹¶å‘å†²çªé‡ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨è¿™ç§æ–¹æ¡ˆä¹Ÿæœªå°ä¸å¯ã€‚ä½†æ˜¯å¦‚æœåˆ¤æ–­é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œæˆ–è€…å¹¶å‘å†²çªè¾ƒå¤§æ—¶ã€‚è¿™ç§æ–¹æ¡ˆå°±ä¸è¡Œäº†ï¼Œwhileå¾ªç¯ä¼šæ‰§è¡Œå¾ˆå¤šå¾ˆå¤šæ¬¡ï¼ŒCPUæ¶ˆè€—è¾ƒå¤§ã€‚ é’ˆå¯¹è¿™ç§é—®é¢˜ï¼ŒJavaå†…ç½®çš„ç­‰å¾…é€šçŸ¥æœºåˆ¶èƒ½å¤Ÿè¾ƒå¥½çš„è§£å†³ã€‚å½“æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹é˜»å¡è‡ªå·±ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚å½“çº¿ç¨‹æ¡ä»¶æ»¡è¶³æ—¶ï¼Œé€šçŸ¥ç­‰å¾…çš„çº¿ç¨‹é‡æ–°æ‰§è¡Œã€‚çº¿ç¨‹é˜»å¡é¿å…äº†å¾ªç¯ç­‰å¾…å¸¦æ¥çš„CPUæ¶ˆè€—é—®é¢˜ã€‚ å°±è¯Šæµç¨‹è¿™é‡Œå€Ÿç”¨æå®¢æ—¶é—´ä¸­å¤§ä½¬æ–‡ç« ï¼ˆæ–‡æœ«æœ‰é“¾æ¥ï¼Œåé¢åä¸ªï¼Œå…ˆåˆ°å…ˆå¾—ï¼‰ä¸­çš„ä¸€ä¸ªä¾‹å­æ¥æ›´å¥½çš„ç†è§£ä¸€ä¸‹ç­‰å¾…é€šçŸ¥æœºåˆ¶ã€‚ æˆ‘ä»¬å»åŒ»é™¢çœ‹ç—…ï¼Œä¸€èˆ¬éƒ½ä¼šç»å†ä»¥ä¸‹æµç¨‹ï¼š æ‚£è€…å…ˆå»æŒ‚å·ï¼Œç„¶ååˆ°å°±è¯Šé—¨å£åˆ†è¯Šï¼Œç­‰å¾…å«å·ã€‚ å½“å«åˆ°è‡ªå·±çš„å·æ—¶ï¼Œæ‚£è€…å°±å¯ä»¥å»æ‰¾å¤§å¤«äº†ã€‚ å°±è¯Šè¿‡ç¨‹ä¸­ï¼Œå¤§å¤«å¯èƒ½ä¼šè®©æ‚£è€…å»åšä¸€äº›è¾…åŠ©æ£€æŸ¥ï¼ŒåŒæ—¶å«ä¸‹ä¸€ä½æ‚£è€…ã€‚ å½“æ‚£è€…åšå®Œæ£€æŸ¥ä¹‹åï¼Œæ‹¿åˆ°æ£€æµ‹æŠ¥å‘Šé‡æ–°åˆ†è¯Šï¼Œç­‰å¾…å«å·ã€‚ å½“å¤§å¤«åœ¨æ­¤å«åˆ°è‡ªå·±çš„å·æ—¶ï¼Œæ‚£è€…å†å»æ‰¾å¤§å¤«å°±è¯Šã€‚ ç¬¬ä¸€/äºŒæ­¥ä¸­ï¼Œæ‚£è€…å»æŒ‚å·åˆ†è¯Šç±»ä¼¼äºçº¿ç¨‹å»è¿‡å»äº’æ–¥é”çš„è¿‡ç¨‹ï¼Œå½“æ‚£è€…ä¼šå«åˆ°å·æ—¶ç±»ä¼¼äºæ‹¿åˆ°äº†é” å¤§å¤«è®©æ‚£è€…å»åšæ£€æŸ¥çš„æ“ä½œç±»ä¼¼äºï¼Œçº¿ç¨‹æ²¡æœ‰æ»¡è¶³æ¡ä»¶ã€‚ æ‚£è€…å»åšæ£€æŸ¥ç±»ä¼¼äºçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç„¶åå¤§å¤«å«ä¸‹ä¸€ä¸ªæ‚£è€…ï¼Œè¿™ä¸ªæ­¥éª¤æˆ‘ä»¬åœ¨å‰é¢çš„ç­‰å¾… - é€šçŸ¥æœºåˆ¶ä¸­å¿½ç•¥æ‰äº†ï¼Œè¿™ä¸ªæ­¥éª¤å¯¹åº”åˆ°ç¨‹åºé‡Œï¼Œæœ¬è´¨æ˜¯çº¿ç¨‹é‡Šæ”¾æŒæœ‰çš„äº’æ–¥é”ã€‚ æ‚£è€…åšå®Œæ£€æŸ¥ï¼Œç±»ä¼¼äºçº¿ç¨‹è¦æ±‚çš„æ¡ä»¶å·²ç»æ»¡è¶³ï¼›æ‚£è€…æ‹¿æ£€æµ‹æŠ¥å‘Šé‡æ–°åˆ†è¯Šï¼Œç±»ä¼¼äºçº¿ç¨‹éœ€è¦é‡æ–°è·å–äº’æ–¥é”ï¼Œè¿™ä¸ªæ­¥éª¤æˆ‘ä»¬åœ¨å‰é¢çš„ç­‰å¾… - é€šçŸ¥æœºåˆ¶ä¸­ä¹Ÿå¿½è§†äº†ã€‚ ç”±æ­¤å¯ä»¥æ€»ç»“å‡ºï¼šä¸€ä¸ªå®Œæ•´çš„ç­‰å¾… - é€šçŸ¥æœºåˆ¶ï¼šçº¿ç¨‹é¦–å…ˆè·å–äº’æ–¥é”ï¼Œå½“çº¿ç¨‹è¦æ±‚çš„æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œé‡Šæ”¾äº’æ–¥é”ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼›å½“è¦æ±‚çš„æ¡ä»¶æ»¡è¶³æ—¶ï¼Œé€šçŸ¥ç­‰å¾…çš„çº¿ç¨‹ï¼Œé‡æ–°è·å–äº’æ–¥é”ã€‚ ç”¨Synchronizedå®ç°ç­‰å¾…é€šçŸ¥æœºåˆ¶é€šè¿‡synchronizedé…åˆwait(), notifyAll(), notify()æ–¹æ³•æ¥å®ç°ç­‰å¾…é€šçŸ¥æœºåˆ¶ã€‚ // è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹è¿›å…¥WAITINGçŠ¶æ€ï¼Œåªæœ‰ç­‰å¾…å¦å¤–çº¿ç¨‹çš„é€šçŸ¥æˆ–è¢«ä¸­æ–­æ‰è¿”å›ï¼Œè°ƒç”¨waitæ–¹æ³•ä¼šé‡Šæ”¾é” wait(); // é€šçŸ¥ä¸€ä¸ªåœ¨å¯¹è±¡ä¸Šç­‰å¾…çš„çº¿ç¨‹ä»wait()æ–¹æ³•è¿”å›ï¼Œè¿”å›çš„å‰ææ˜¯è¯¥çº¿ç¨‹è·å–åˆ°å¯¹è±¡é” notify(); // é€šçŸ¥æ‰€æœ‰ç­‰å¾…åœ¨è¯¥å¯¹è±¡ä¸Šçš„çº¿ç¨‹ notifyAll(); ä¸‹é¢é€šè¿‡ä¸€ä¸ªå…·ä½“å®ä¾‹æ¥å…·ä½“å®ç°ä»¥ä¸‹ public class WaitNotify &#123; static boolean flag = true; static Object lock = new Object(); public static void main(String[] args) throws Exception &#123; new Thread(new Wait(), &quot;WaitThread&quot;).start(); Thread.sleep(1000); new Thread(new Notify(), &quot;NotifyThread&quot;).start(); &#125; // ç­‰å¾… static class Wait implements Runnable &#123; public void run() &#123; // åŠ é”ï¼Œæ‹¥æœ‰lockçš„Monitor synchronized (lock) &#123; // å½“æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œç»§ç»­waitï¼ŒåŒæ—¶é‡Šæ”¾äº†lockçš„é” while (flag) &#123; try &#123; System.out.println(Thread.currentThread().getName() + &quot; flag is true. wait &quot;); lock.wait(); &#125; catch (InterruptedException e) &#123; &#125; &#125; // æ¡ä»¶æ»¡è¶³æ—¶ï¼Œå®Œæˆå·¥ä½œ System.out.println(Thread.currentThread().getName() + &quot; flag is false. running &quot;); &#125; &#125; &#125; // é€šçŸ¥ static class Notify implements Runnable &#123; public void run() &#123; // åŠ é”ï¼Œæ‹¥æœ‰lockçš„Monitor synchronized (lock) &#123; // è·å–lockçš„é”ï¼Œç„¶åè¿›è¡Œé€šçŸ¥ï¼Œé€šçŸ¥æ—¶ä¸ä¼šé‡Šæ”¾lockçš„é”ï¼Œ // ç›´åˆ°å½“å‰çº¿ç¨‹é‡Šæ”¾äº†lockåï¼ŒWaitThreadæ‰èƒ½ä»waitæ–¹æ³•ä¸­è¿”å› System.out.println(Thread.currentThread().getName() + &quot; hold lock. notify &quot;); lock.notifyAll(); flag = false; try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; // å†æ¬¡åŠ é” synchronized (lock) &#123; System.out.println(Thread.currentThread().getName() + &quot; hold lock again. sleep &quot;); try &#123; Thread.sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; &#125; åœ¨ä¸Šé¢çš„å®ä¾‹ä¸­ï¼Œç­‰å¾…çº¿ç¨‹(WaitThread)é¦–å…ˆè·å¾—äº†å¯¹è±¡é”ï¼Œç„¶åè°ƒç”¨å¯¹è±¡çš„wait()æ–¹æ³•ï¼Œä»è€Œæ”¾å¼ƒäº†é”ï¼Œå¹¶è¿›å…¥å¯¹è±¡çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚ç”±äºç­‰å¾…çº¿ç¨‹é‡Šæ”¾äº†å¯¹è±¡é”ï¼Œé€šçŸ¥çº¿ç¨‹(NotifyThread)éšåè·å–äº†å¯¹è±¡çš„é”ï¼Œæ”¹å˜çŠ¶æ€ä½¿æ»¡è¶³æ¡ä»¶ï¼Œå¹¶è°ƒç”¨å¯¹è±¡çš„notify()æ–¹æ³•ï¼Œé€šçŸ¥ç­‰å¾…é˜Ÿåˆ—ï¼ˆäº’æ–¥é”çš„ç­‰å¾…é˜Ÿåˆ—ï¼‰ä¸­çš„çº¿ç¨‹ï¼Œå‘Šè¯‰å®ƒæ¡ä»¶æ›¾ç»æ»¡è¶³è¿‡ã€‚ï¼ˆè¿™é‡Œnotify()åªèƒ½ä¿è¯åœ¨é€šçŸ¥æ—¶é—´ç‚¹ï¼Œæ¡ä»¶æ˜¯æ»¡è¶³çš„ã€‚è€Œè¢«é€šçŸ¥çº¿ç¨‹çš„æ‰§è¡Œæ—¶é—´ç‚¹å’Œé€šçŸ¥æ—¶é—´ç‚¹åŸºæœ¬ä¸Šä¸ä¼šé‡åˆï¼Œæ‰€ä»¥å½“çº¿ç¨‹æ‰§è¡Œçš„æ—¶å€™ï¼Œå¾ˆå¯èƒ½çº¿ç¨‹æ¡ä»¶å·²ç»ä¸æ»¡è¶³äº†ï¼‰ç­‰å¾…çº¿ç¨‹ä»ç­‰å¾…é˜Ÿåˆ—ä¸­ç§»å‡ºï¼ŒçŠ¶æ€å˜ä¸ºé˜»å¡çŠ¶æ€ã€‚é€šçŸ¥çº¿ç¨‹é‡Šæ”¾é”ä¹‹åï¼Œç­‰å¾…çº¿ç¨‹å†æ¬¡è·å–é”ä»wait()æ–¹æ³•è¿”å›ç»§ç»­æ‰§è¡Œã€‚ è¿™ä¸ªè¿‡ç¨‹éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š ä½¿ç”¨wait(), notify(), notifyAll()æ—¶éœ€è¦å…ˆå¯¹è°ƒç”¨å¯¹è±¡åŠ é”ã€‚ è°ƒç”¨wait()æ–¹æ³•åï¼Œçº¿ç¨‹çŠ¶æ€æœ‰RUNNINGå˜ä¸ºWAITINGï¼Œå¹¶å°†å½“å‰çº¿ç¨‹æ”¾ç½®åˆ°å¯¹è±¡çš„ç­‰å¾…é˜Ÿåˆ— notify()æˆ–notifyAll()æ–¹æ³•è°ƒç”¨åï¼Œç­‰å¾…çº¿ç¨‹ä¾æ—§ä¸ä¼šä»wait()è¿”å›ï¼Œéœ€è¦è°ƒç”¨notify()æˆ– notifAll()çš„çº¿ç¨‹é‡Šæ”¾é”ä¹‹åï¼Œç­‰å¾…çº¿ç¨‹æ‰æœ‰æœºä¼šä»wait()è¿”å›ã€‚ ä»wait()æ–¹æ³•è¿”å›çš„å‰ææ˜¯è·å¾—äº†è°ƒç”¨å¯¹è±¡çš„é”ã€‚ ç­‰å¾…è¶…æ—¶æ¨¡å¼åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å†µï¼Œè°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ˆä¸€èˆ¬æ¥è¯´æ˜¯ç»™å®šä¸€ä¸ªæ—¶é—´æ®µï¼‰ï¼Œå¦‚æœè¯¥æ–¹æ³•èƒ½å¤Ÿåœ¨ç»™å®šçš„æ—¶é—´æ®µä¹‹å†…å¾—åˆ°ç»“æœï¼Œé‚£ä¹ˆå°†ç»“æœç«‹åˆ»è¿”å›ï¼Œåä¹‹ï¼Œè¶…æ—¶è¿”å›é»˜è®¤ç»“æœæˆ–è‡ªå®šä¹‰å¤„ç†ã€‚ è€Œè¦åœ¨ç­‰å¾…/é€šçŸ¥æ¨¡å‹ä¸­è¦åŠ å…¥è¶…å¸‚ç­‰å¾…é€»è¾‘ï¼Œåªéœ€è¦åšä¸€äº›å°å°çš„æ”¹åŠ¨ã€‚ å‡è®¾è¶…æ—¶æ—¶é—´æ®µæ˜¯Tï¼Œé‚£ä¹ˆå¯ä»¥æ¨æ–­å‡ºåœ¨å½“å‰æ—¶é—´now+Tä¹‹åå°±ä¼šè¶…æ—¶ã€‚ å®šä¹‰å¦‚ä¸‹å˜é‡ï¼š ç­‰å¾…æŒç»­æ—¶é—´ï¼šREMAINING=Tã€‚ è¶…æ—¶æ—¶é—´ï¼šFUTURE=now+Tã€‚ è¿™æ—¶ä»…éœ€è¦wait(REMAINING)å³å¯ï¼Œåœ¨wait(REMAINING)è¿”å›ä¹‹åä¼šå°†æ‰§è¡Œï¼š REMAINING=FUTUREâ€“nowã€‚å¦‚æœREMAININGå°äºç­‰äº0ï¼Œè¡¨ç¤ºå·²ç»è¶…æ—¶ï¼Œç›´æ¥é€€å‡ºï¼Œå¦åˆ™å°† ç»§ç»­æ‰§è¡Œwait(REMAINING)ã€‚ ç›¸å…³å®ç°å¦‚ä¸‹ // å¯¹å½“å‰å¯¹è±¡åŠ é” public synchronized Object get(long mills) throws InterruptedException &#123; long future = System.currentTimeMillis() + mills; long remaining = mills; // å½“è¶…æ—¶å¤§äº0å¹¶ä¸”resultè¿”å›å€¼ä¸æ»¡è¶³è¦æ±‚ while ((result == null) &amp;&amp; remaining &gt; 0) &#123; wait(remaining); remaining = future - System.currentTimeMillis(); &#125; return result; &#125; ä¸€ä¸ªç®€å•çš„æ•°æ®åº“è¿æ¥æ± ç¤ºä¾‹æˆ‘ä»¬ä½¿ç”¨ç­‰å¾…è¶…æ—¶æ¨¡å¼æ¥æ„é€ ä¸€ä¸ªç®€å•çš„æ•°æ®åº“è¿æ¥æ± ï¼Œåœ¨ç¤ºä¾‹ä¸­æ¨¡æ‹Ÿä»è¿æ¥æ± ä¸­è·å–ã€ä½¿ç”¨å’Œé‡Šæ”¾è¿æ¥çš„è¿‡ç¨‹ï¼Œè€Œå®¢æˆ·ç«¯è·å–è¿æ¥çš„è¿‡ç¨‹è¢«è®¾å®šä¸ºç­‰å¾…è¶…æ—¶çš„æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯åœ¨1000æ¯«ç§’å†…å¦‚æœæ— æ³•è·å–åˆ°å¯ç”¨è¿æ¥ï¼Œå°†ä¼šè¿”å›ç»™å®¢æˆ·ç«¯ä¸€ä¸ªnullã€‚è®¾å®šè¿æ¥æ± çš„å¤§å°ä¸º10ä¸ªï¼Œç„¶åé€šè¿‡è°ƒèŠ‚å®¢æˆ·ç«¯çš„çº¿ç¨‹æ•°æ¥æ¨¡æ‹Ÿæ— æ³•è·å–è¿æ¥çš„åœºæ™¯ã€‚ é¦–å…ˆçœ‹ä¸€ä¸‹è¿æ¥æ± çš„å®šä¹‰ã€‚å®ƒé€šè¿‡æ„é€ å‡½æ•°åˆå§‹åŒ–è¿æ¥çš„æœ€å¤§ä¸Šé™ï¼Œé€šè¿‡ä¸€ä¸ªåŒå‘é˜Ÿåˆ—æ¥ç»´æŠ¤è¿æ¥ï¼Œè°ƒç”¨æ–¹éœ€è¦å…ˆè°ƒç”¨fetchConnection(long)æ–¹æ³•æ¥æŒ‡å®šåœ¨å¤šå°‘æ¯«ç§’å†…è¶…æ—¶è·å–è¿æ¥ï¼Œå½“è¿æ¥ä½¿ç”¨å®Œæˆåï¼Œéœ€è¦è°ƒç”¨releaseConnection(Connection)æ–¹æ³•å°†è¿æ¥æ”¾å›çº¿ç¨‹æ± ã€‚ import java.sql.Connection; import java.util.LinkedList; public class ConnectionPool &#123; private LinkedList&lt;Connection&gt; pool = new LinkedList&lt;Connection&gt;(); public ConnectionPool(int initialSize) &#123; if (initialSize &gt; 0) &#123; for (int i = 0; i &lt; initialSize; i++) &#123; pool.addLast(ConnectionDriver.createConnection()); &#125; &#125; &#125; public void releaseConnection(Connection connection) &#123; if (connection != null) &#123; synchronized (pool) &#123; // è¿æ¥é‡Šæ”¾åéœ€è¦è¿›è¡Œé€šçŸ¥ï¼Œè¿™æ ·å…¶ä»–æ¶ˆè´¹è€…èƒ½å¤Ÿæ„ŸçŸ¥åˆ°è¿æ¥æ± ä¸­å·²ç»å½’è¿˜äº†ä¸€ä¸ªè¿æ¥ pool.addLast(connection); pool.notifyAll(); &#125; &#125; &#125; // åœ¨millså†…æ— æ³•è·å–åˆ°è¿æ¥ï¼Œå°†ä¼šè¿”å›null public Connection fetchConnection(long mills) throws InterruptedException &#123; synchronized (pool) &#123; // å®Œå…¨è¶…æ—¶ if (mills &lt;= 0) &#123; while (pool.isEmpty()) &#123; pool.wait(); &#125; return pool.removeFirst(); &#125; else &#123; // è¶…è¿‡è®¾ç½®çš„æ—¶é—´millsï¼Œå°†æ¨å‡ºwhileå¾ªç¯ long future = System.currentTimeMillis() + mills; long remaining = mills; while (pool.isEmpty() &amp;&amp; remaining &gt; 0) &#123; pool.wait(remaining); remaining = future - System.currentTimeMillis(); &#125; Connection result = null; if (!pool.isEmpty()) &#123; result = pool.removeFirst(); &#125; return result; &#125; &#125; &#125; &#125; ç”±äºjava.sql.Connectionæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ€ç»ˆçš„å®ç°æ˜¯ç”±æ•°æ®åº“é©±åŠ¨æä¾›æ–¹æ¥å®ç°çš„ï¼Œè€ƒè™‘åˆ°åªæ˜¯ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬é€šè¿‡åŠ¨æ€ä»£ç†æ„é€ äº†ä¸€ä¸ªConnectionï¼Œè¯¥Connectionçš„ä»£ç†å®ç°ä»…ä»…æ˜¯åœ¨commit()æ–¹æ³•è°ƒç”¨æ—¶ä¼‘çœ 100æ¯«ç§’. import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.lang.reflect.Proxy; import java.sql.Connection; import java.util.concurrent.TimeUnit; public class ConnectionDriver &#123; static class ConnectionHandler implements InvocationHandler &#123; // commitæ—¶ä¼šå›è°ƒ public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; if (method.getName().equals(&quot;commit&quot;)) &#123; TimeUnit.MILLISECONDS.sleep(100); &#125; return null; &#125; &#125; // åˆ›å»ºä¸€ä¸ªConnectionçš„ä»£ç†ï¼Œåœ¨commitæ—¶ä¼‘çœ 100æ¯«ç§’ public static final Connection createConnection() &#123; return (Connection) Proxy.newProxyInstance(ConnectionDriver.class.getClassLoader(), new Class[] &#123; Connection.class &#125;, new ConnectionHandler()); &#125; &#125; ä¸‹é¢é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥æµ‹è¯•ç®€æ˜“æ•°æ®åº“è¿æ¥æ± çš„å·¥ä½œæƒ…å†µï¼Œæ¨¡æ‹Ÿå®¢æˆ·ç«¯ConnectionRunnerè·å–ã€ä½¿ç”¨ã€æœ€åé‡Šæ”¾è¿æ¥çš„è¿‡ç¨‹ï¼Œå½“å®ƒä½¿ç”¨æ—¶è¿æ¥å°†ä¼šå¢åŠ è·å–åˆ°è¿æ¥çš„æ•°é‡ï¼Œåä¹‹ï¼Œå°†ä¼šå¢åŠ æœªè·å–åˆ°è¿æ¥çš„æ•°é‡ã€‚ import java.sql.Connection; import java.util.concurrent.CountDownLatch; import java.util.concurrent.atomic.AtomicInteger; public class Main &#123; static ConnectionPool pool = new ConnectionPool(10); // ä¿è¯æ‰€æœ‰CountDownLatchèƒ½å¤ŸåŒæ—¶å¼€å§‹ static CountDownLatch start = new CountDownLatch(1); // ä¿è¯mainçº¿ç¨‹ç­‰å¾…æ‰€æœ‰ConnectionRunnerç»“æŸä¹‹åæ‰ç»§ç»­æ‰§è¡Œ static CountDownLatch end; public static void main(String[] args) throws InterruptedException &#123; // çº¿ç¨‹æ•°é‡ï¼Œå¯ä»¥ä¿®æ”¹çº¿ç¨‹æ•°é‡è¿›è¡Œè§‚å¯Ÿ int threadCount = 10; end = new CountDownLatch(threadCount); int count = 20; // æˆåŠŸçš„ä¸ªæ•° AtomicInteger got = new AtomicInteger(); // å¤±è´¥çš„ä¸ªæ•° AtomicInteger notGot = new AtomicInteger(); for (int i = 0; i &lt; threadCount; i++) &#123; Thread thread = new Thread(new ConnetionRunner(count, got, notGot), &quot;ConnectionRunnerThread&quot;); thread.start(); &#125; start.countDown(); end.await(); System.out.println(&quot;total invoke: &quot; + (threadCount * count)); System.out.println(&quot;got connection: &quot; + got); System.out.println(&quot;not got connection &quot; + notGot); &#125; static class ConnetionRunner implements Runnable &#123; int count; AtomicInteger got; AtomicInteger notGot; public ConnetionRunner(int count, AtomicInteger got, AtomicInteger notGot) &#123; this.count = count; this.got = got; this.notGot = notGot; &#125; @Override public void run() &#123; try &#123; start.await(); &#125; catch (Exception ex) &#123; &#125; while (count &gt; 0) &#123; try &#123; // ä»çº¿ç¨‹æ± ä¸­è·å–è¿æ¥ï¼Œå¦‚æœ1000mså†…æ— æ³•è·å–åˆ°ï¼Œå°†ä¼šè¿”å›null // åˆ†åˆ«ç»Ÿè®¡è¿æ¥è·å–çš„æ•°é‡gotå’Œæœªè·å–åˆ°çš„æ•°é‡notGot Connection connection = pool.fetchConnection(1000); if (connection != null) &#123; try &#123; connection.createStatement(); connection.commit(); &#125; finally &#123; pool.releaseConnection(connection); // æˆåŠŸä¸ªæ•°+1 got.incrementAndGet(); &#125; &#125; else &#123; // å¤±è´¥ä¸ªæ•°+1 notGot.incrementAndGet(); &#125; &#125; catch (Exception ex) &#123; &#125; finally &#123; count--; &#125; &#125; end.countDown(); &#125; &#125; &#125; ä¸Šè¿°ç¤ºä¾‹ä¸­ä½¿ç”¨äº†CountDownLatchæ¥ç¡®ä¿ConnectionRunnerThreadèƒ½å¤ŸåŒæ—¶å¼€å§‹æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨å…¨éƒ¨ç»“æŸä¹‹åï¼Œæ‰ä½¿mainçº¿ç¨‹ä»ç­‰å¾…çŠ¶æ€ä¸­è¿”å›ã€‚ å½“å‰è®¾å®šçš„åœºæ™¯æ˜¯10ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œè·å–è¿æ¥æ± ï¼ˆ10ä¸ªè¿æ¥ï¼‰ä¸­çš„è¿æ¥ï¼Œå¯ä»¥é€šè¿‡è°ƒèŠ‚çº¿ç¨‹æ•°é‡æ¥è§‚å¯Ÿæœªè·å–åˆ°è¿æ¥çš„æƒ…å†µã€‚çº¿ç¨‹æ•°ã€æ€»è·å–æ¬¡æ•°ã€è·å–åˆ°çš„æ•°é‡ã€æœªè·å–åˆ°çš„æ•°é‡ä»¥åŠæœªè·å–åˆ°çš„æ¯”ç‡ã€‚","categories":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://gyl-coder.top/categories/%E5%B9%B6%E5%8F%91/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://gyl-coder.top/tags/%E5%B9%B6%E5%8F%91/"},{"name":"ç­‰å¾…é€šçŸ¥æœºåˆ¶","slug":"ç­‰å¾…é€šçŸ¥æœºåˆ¶","permalink":"https://gyl-coder.top/tags/%E7%AD%89%E5%BE%85%E9%80%9A%E7%9F%A5%E6%9C%BA%E5%88%B6/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"å¤šä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°å†…å®¹","slug":"concurrency/alternate_printing","date":"2019-11-05T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"concurrency/alternate_printing/","link":"","permalink":"https://gyl-coder.top/concurrency/alternate_printing/","excerpt":"éœ€æ±‚ï¼š å¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œäº¤æ›¿æ‰“å°å¥‡å¶æ•°ã€‚ æ•ˆæœå¦‚ä¸‹æ‰€ç¤º å¶æ•°çº¿ç¨‹ï¼š0 å¥‡æ•°çº¿ç¨‹ï¼š1 å¶æ•°çº¿ç¨‹ï¼š2 ...","text":"éœ€æ±‚ï¼š å¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œäº¤æ›¿æ‰“å°å¥‡å¶æ•°ã€‚ æ•ˆæœå¦‚ä¸‹æ‰€ç¤º å¶æ•°çº¿ç¨‹ï¼š0 å¥‡æ•°çº¿ç¨‹ï¼š1 å¶æ•°çº¿ç¨‹ï¼š2 ... ä¸¤ä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°æ— é”å®ç°ä¸éœ€è¦è¿›è¡Œä»»ä½•åŠ é”ï¼Œåˆ©ç”¨å¹¶å‘åŒ…ä¸­çš„AtomicIntegerå’Œvolidateä¿®é¥°ç¬¦ç»„åˆè¿›è¡Œå®ç°ã€‚ public class Thread_demo1 &#123; private static volatile Boolean flag = true; private static AtomicInteger num = new AtomicInteger(); public static CountDownLatch latch = new CountDownLatch(2); public static void main(String[] args) throws InterruptedException &#123; long start = System.currentTimeMillis(); Thread thread1 = new Thread(new Runnable() &#123; @Override public void run() &#123; while(num.get() &lt;= 10000)&#123; if(!flag)&#123; System.out.println(Thread.currentThread().getName()+&quot;: &quot; + num.getAndIncrement()); flag = true; &#125; &#125; latch.countDown(); &#125; &#125;, &quot;å¥‡æ•°çº¿ç¨‹&quot;); Thread thread2 = new Thread(new Runnable() &#123; @Override public void run() &#123; while(num.get() &lt;= 10000)&#123; if(flag)&#123; System.out.println(Thread.currentThread().getName()+ &quot;ï¼š&quot; + num.getAndIncrement()); flag = false; &#125; &#125; latch.countDown(); &#125; &#125;, &quot;å¶æ•°çº¿ç¨‹&quot;); thread1.start(); thread2.start(); latch.await(); System.out.println(&quot;å…±è€—æ—¶ï¼š&quot;+(System.currentTimeMillis() - start) + &quot;ms&quot;); &#125; &#125; åŠ é”å®ç°Aé€šè¿‡ä¸€ä¸ªbooleanç±»å‹çš„å˜é‡æ¥é™åˆ¶ä¸¤ä¸ªçº¿ç¨‹ï¼Œåˆ†åˆ«åªè¾“å‡ºå¥‡æ•°å’Œå¶æ•°ã€‚ public class Thread_demo2 &#123; private int count = 0; private final Object lock = new Object(); public static CountDownLatch latch = new CountDownLatch(2); public void go() throws InterruptedException &#123; long start = System.currentTimeMillis(); Thread thread1 = new Thread(() -&gt; &#123; while (count &lt; 10000) &#123; synchronized (lock) &#123; if ((count &amp; 1) == 0) &#123; System.out.println(Thread.currentThread().getName() + &quot;: &quot; + count ++); &#125; &#125; &#125; latch.countDown(); &#125;, &quot;å¶æ•°çº¿ç¨‹&quot;); Thread thread2 = new Thread(() -&gt; &#123; while (count &lt; 10000) &#123; synchronized (lock) &#123; if ((count &amp; 1) == 1) &#123; System.out.println(Thread.currentThread().getName() + &quot;: &quot; + count ++); &#125; &#125; &#125; latch.countDown(); &#125;, &quot;å¥‡æ•°çº¿ç¨‹&quot;); thread1.start(); thread2.start(); latch.await(); System.out.println(&quot;å…±è€—æ—¶ï¼š&quot;+(System.currentTimeMillis() - start) + &quot;ms&quot;); &#125; public static void main(String[] args) throws InterruptedException &#123; Thread_demo2 threaddemo2 = new Thread_demo2(); threaddemo2.go(); &#125; &#125; åŠ é”å®ç°Bé€šè¿‡åŒä¸€ä¸ªå¯¹è±¡é”æ¥å®ç°ã€‚ public class Thread_demo3 &#123; private int count = 0; private final Object lock = new Object(); public static CountDownLatch latch = new CountDownLatch(2); public void go() throws InterruptedException &#123; long begin = System.currentTimeMillis(); new Thread(new RunnerTest(), &quot;å¶æ•°çº¿ç¨‹&quot;).start(); // ç¡®ä¿å¶æ•°çº¿ç¨‹çº¿å…ˆè·å–åˆ°é” Thread.sleep(1); new Thread(new RunnerTest(), &quot;å¥‡æ•°çº¿ç¨‹&quot;).start(); latch.await(); System.out.println(System.currentTimeMillis() - begin); &#125; class RunnerTest implements Runnable &#123; @Override public void run() &#123; while (count &lt; 10000) &#123; synchronized (lock) &#123; // æ‹¿åˆ°é”å°±æ‰“å° System.out.println(Thread.currentThread().getName() + &quot;: &quot; + count ++); // å”¤é†’å…¶ä»–çº¿ç¨‹ lock.notifyAll(); try &#123; if (count &lt; 10000) &#123; // å¦‚æœä»»åŠ¡è¿˜æ²¡æœ‰ç»“æŸï¼Œåˆ™è®©å‡ºå½“å‰çš„é”å¹¶ä¼‘çœ  lock.wait(); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; latch.countDown(); &#125; &#125; public static void main(String[] args) throws InterruptedException &#123; Thread_demo3 threaddemo3 = new Thread_demo3(); threaddemo3.go(); &#125; &#125; å¤šä¸ªçº¿ç¨‹äº¤æ›¿æ‰“å°éœ€æ±‚ï¼š nä¸ªçº¿ç¨‹ï¼Œäº¤æ›¿æ‰“å°æ•°å­—ã€‚ æ•ˆæœå¦‚ä¸‹æ‰€ç¤º çº¿ç¨‹1ï¼š0 çº¿ç¨‹2ï¼š1 çº¿ç¨‹3ï¼š2 çº¿ç¨‹1ï¼š3 çº¿ç¨‹2ï¼š4 çº¿ç¨‹3ï¼š5 çº¿ç¨‹1ï¼š6 ... public class Demo implements Runnable &#123; private static final Object LOCK = new Object(); /** * å½“å‰å³å°†æ‰“å°çš„æ•°å­— */ private static int current = 0; /** * å½“å‰çº¿ç¨‹ç¼–å·ï¼Œä»0å¼€å§‹ */ private int threadNo; /** * çº¿ç¨‹æ•°é‡ */ private int threadCount; /** * æ‰“å°çš„æœ€å¤§æ•°å€¼ */ private int maxInt; public Demo(int threadNo, int threadCount, int maxInt) &#123; this.threadNo = threadNo; this.threadCount = threadCount; this.maxInt = maxInt; &#125; @Override public void run() &#123; while (true) &#123; synchronized (LOCK) &#123; // åˆ¤æ–­æ˜¯å¦è½®åˆ°å½“å‰çº¿ç¨‹æ‰§è¡Œ while (current % threadCount != threadNo) &#123; if (current &gt; maxInt) &#123; break; &#125; try &#123; // å¦‚æœä¸æ˜¯ï¼Œåˆ™å½“å‰çº¿ç¨‹è¿›å…¥wait LOCK.wait(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; // æœ€å¤§å€¼è·³å‡ºå¾ªç¯ if (current &gt; maxInt) &#123; break; &#125; System.out.println(&quot;thread&quot; + threadNo + &quot; : &quot; + current); current++; // å”¤é†’å…¶ä»–waitçº¿ç¨‹ LOCK.notifyAll(); &#125; &#125; &#125; public static void main(String[] args) &#123; int threadCount = 3; int max = 100; for (int i = 0; i &lt; threadCount; i++) &#123; new Thread(new Demo(i, threadCount, max)).start(); &#125; &#125; &#125; å¯ä»¥çœ‹åˆ°ï¼Œæ ¸å¿ƒæ€æƒ³éƒ½æ˜¯å·®ä¸å¤šçš„ã€‚éƒ½ç”¨çš„æ˜¯ç­‰å¾…é€šçŸ¥æœºåˆ¶ã€‚ è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ã€‚å½“threadCountï¼ˆçº¿ç¨‹æ•°é‡ï¼‰æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œåœ¨æ‰§è¡ŒnotifyAllå”¤é†’å…¶ä»–çº¿ç¨‹çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°çº¿ç¨‹æŠ¢åˆ°äº†é”ä½†å¹¶ä¸è¯¥è‡ªå·±æ‰§è¡Œï¼Œç„¶ååˆè¿›å…¥waitçš„æƒ…å†µã€‚æ¯”å¦‚ç°åœ¨æœ‰100ä¸ªçº¿ç¨‹ï¼Œç°åœ¨æ˜¯ç¬¬ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œï¼Œä»–æ‰§è¡Œå®Œä¹‹åéœ€è¦ç¬¬äºŒä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œä½†æ˜¯ç¬¬100ä¸ªçº¿ç¨‹æŠ¢åˆ°äº†ï¼Œå‘ç°ä¸æ˜¯è‡ªå·±ç„¶ååˆè¿›å…¥waitï¼Œç„¶åç¬¬99ä¸ªçº¿ç¨‹æŠ¢åˆ°äº†ï¼Œå‘ç°ä¸æ˜¯è‡ªå·±ç„¶ååˆè¿›å…¥waitï¼Œç„¶åç¬¬98,97â€¦ç›´åˆ°ç¬¬3ä¸ªçº¿ç¨‹éƒ½æŠ¢åˆ°äº†ï¼Œæœ€åæ‰åˆ°ç¬¬äºŒä¸ªçº¿ç¨‹æŠ¢åˆ°åŒæ­¥é”ï¼Œè¿™é‡Œå°±ä¼šç™½ç™½çš„å¤šæ‰§è¡Œå¾ˆå¤šè¿‡ç¨‹ï¼Œè™½ç„¶æœ€åèƒ½å®Œæˆç›®æ ‡ã€‚ è§£å†³åŠæ³•å¤šç§å¤šæ ·ï¼Œè¿™é‡Œä»‹ç»ä¸€ç§åŸºäºä¿¡å·é‡çš„å®ç°æ–¹å¼ã€‚ public class Main &#123; static int result = 0; public static void main(String[] args) throws InterruptedException &#123; int N = 3; Thread[] threads = new Thread[N]; final Semaphore[] syncObjects = new Semaphore[N]; for (int i = 0; i &lt; N; i++) &#123; syncObjects[i] = new Semaphore(1); if (i != N-1)&#123; syncObjects[i].acquire(); &#125; &#125; for (int i = 0; i &lt; N; i++) &#123; final Semaphore lastSemphore = i == 0 ? syncObjects[N - 1] : syncObjects[i - 1]; final Semaphore curSemphore = syncObjects[i]; final int index = i; threads[i] = new Thread(new Runnable() &#123; public void run() &#123; try &#123; while (true) &#123; // ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ï¼Œç”±äºæœ€åä¸€ä¸ªä¿¡å·é‡å¹¶æ²¡æœ‰æ‰§è¡Œacquireï¼Œæ‰€ä»¥è¿™é‡Œä¸ä¼šé˜»å¡ lastSemphore.acquire(); System.out.println(&quot;thread&quot; + index + &quot;: &quot; + result++); if (result &gt; 100)&#123; System.exit(0); &#125; // é‡Šæ”¾ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„çº¿ç¨‹çš„ curSemphore.release(); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125;); threads[i].start(); &#125; &#125; &#125;","categories":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://gyl-coder.top/categories/%E5%B9%B6%E5%8F%91/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://gyl-coder.top/tags/%E5%B9%B6%E5%8F%91/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"Lock & Synchronized","slug":"concurrency/lock_and_synchronized","date":"2019-11-05T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"concurrency/lock_and_synchronized/","link":"","permalink":"https://gyl-coder.top/concurrency/lock_and_synchronized/","excerpt":"é¦–å…ˆæˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Ÿ åœ¨Lockå‡ºç°ä¹‹å‰æˆ‘ä»¬ä¸€ç›´ä½¿ç”¨synchronizedæ¥å®ç°åŒæ­¥è®¿é—®ã€‚é‚£ä¸ºä»€ä¹ˆè¿˜è¦æä¾›lockå‘¢ï¼Ÿ æˆ‘ä»¬çŸ¥é“å¦‚æœä¸€ä¸ªä»£ç å—è¢«synchronizedä¿®é¥°äº†ï¼Œå½“æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–äº†å¯¹åº”çš„é”ï¼Œå¹¶æ‰§è¡Œè¯¥ä»£ç å¿«æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å°±åªèƒ½åœ¨ä¸€æ—ç­‰å¾…ã€‚ è€Œè·å–é”çš„çº¿ç¨‹åªæœ‰åœ¨çº¿ç¨‹æ­£å¸¸æ‰§è¡Œå®Œè¯¥ä»£ç æˆ–è€…çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸æ‰ä¼šé‡Šæ”¾å¯¹é”çš„å æœ‰ã€‚ åœ¨synchronizedè¿™ç§æœºåˆ¶ä¸‹ï¼Œç¨‹åºå°±æœ‰å¯èƒ½å‡ºç°å¦‚ä¸‹é—®é¢˜ï¼š è·å–é”çš„çº¿ç¨‹ç”±äºè¦ç­‰å¾…IOæˆ–å…¶ä»–åŸå› è¢«é˜»å¡ä½äº†ï¼Œä½†æ˜¯åˆæ²¡æœ‰é‡Šæ”¾é”ï¼Œå…¶ä»–çº¿ç¨‹åªèƒ½ç­‰å¾…ã€‚å½±å“æ•ˆç‡ ç›¸äº’æ²¡æœ‰å†²çªçš„å¤šä¸ªçº¿ç¨‹ä¸èƒ½å¹¶å‘æ‰§è¡Œ è§£å†³æ­»é”çš„ä¸€ä¸ªæ–¹æ¡ˆæ˜¯ç ´åä¸å¯æŠ¢å æ¡ä»¶synchronized æ²¡æœ‰åŠæ³•è§£å†³ã€‚åŸå› æ˜¯ synchronized ç”³è¯·èµ„æºçš„æ—¶å€™ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜»å¡çŠ¶æ€äº†ï¼Œè€Œçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå•¥éƒ½å¹²ä¸äº†ï¼Œä¹Ÿé‡Šæ”¾ä¸äº†çº¿ç¨‹å·²ç»å æœ‰çš„èµ„æºã€‚ æ­£æ˜¯ç”±äºè¿™äº›å› ç´ çš„é™åˆ¶ï¼Œéœ€è¦å¼€å‘å‡ºä¸€ç§æ»¡è¶³å¦‚ä¸‹æ¡ä»¶çš„åŒæ­¥æœºåˆ¶ã€‚ èƒ½å¤Ÿå“åº”ä¸­æ–­ã€‚synchronized çš„é—®é¢˜æ˜¯ï¼ŒæŒæœ‰é” A åï¼Œå¦‚æœå°è¯•è·å–é” B å¤±è´¥ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä¸€æ—¦å‘ç”Ÿæ­»é”ï¼Œå°±æ²¡æœ‰ä»»ä½•æœºä¼šæ¥å”¤é†’é˜»å¡çš„çº¿ç¨‹ã€‚ä½†å¦‚æœé˜»å¡çŠ¶æ€çš„çº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ä¿¡å·ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬ç»™é˜»å¡çš„çº¿ç¨‹å‘é€ä¸­æ–­ä¿¡å·çš„æ—¶å€™ï¼Œèƒ½å¤Ÿå”¤é†’å®ƒï¼Œé‚£å®ƒå°±æœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é” Aã€‚ æ”¯æŒè¶…æ—¶ã€‚å¦‚æœçº¿ç¨‹åœ¨ä¸€æ®µæ—¶é—´ä¹‹å†…æ²¡æœ‰è·å–åˆ°é”ï¼Œä¸æ˜¯è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é”ã€‚ éé˜»å¡åœ°è·å–é”ã€‚å¦‚æœå°è¯•è·å–é”å¤±è´¥ï¼Œå¹¶ä¸è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é”ã€‚","text":"é¦–å…ˆæˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Ÿ åœ¨Lockå‡ºç°ä¹‹å‰æˆ‘ä»¬ä¸€ç›´ä½¿ç”¨synchronizedæ¥å®ç°åŒæ­¥è®¿é—®ã€‚é‚£ä¸ºä»€ä¹ˆè¿˜è¦æä¾›lockå‘¢ï¼Ÿ æˆ‘ä»¬çŸ¥é“å¦‚æœä¸€ä¸ªä»£ç å—è¢«synchronizedä¿®é¥°äº†ï¼Œå½“æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–äº†å¯¹åº”çš„é”ï¼Œå¹¶æ‰§è¡Œè¯¥ä»£ç å¿«æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å°±åªèƒ½åœ¨ä¸€æ—ç­‰å¾…ã€‚ è€Œè·å–é”çš„çº¿ç¨‹åªæœ‰åœ¨çº¿ç¨‹æ­£å¸¸æ‰§è¡Œå®Œè¯¥ä»£ç æˆ–è€…çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸æ‰ä¼šé‡Šæ”¾å¯¹é”çš„å æœ‰ã€‚ åœ¨synchronizedè¿™ç§æœºåˆ¶ä¸‹ï¼Œç¨‹åºå°±æœ‰å¯èƒ½å‡ºç°å¦‚ä¸‹é—®é¢˜ï¼š è·å–é”çš„çº¿ç¨‹ç”±äºè¦ç­‰å¾…IOæˆ–å…¶ä»–åŸå› è¢«é˜»å¡ä½äº†ï¼Œä½†æ˜¯åˆæ²¡æœ‰é‡Šæ”¾é”ï¼Œå…¶ä»–çº¿ç¨‹åªèƒ½ç­‰å¾…ã€‚å½±å“æ•ˆç‡ ç›¸äº’æ²¡æœ‰å†²çªçš„å¤šä¸ªçº¿ç¨‹ä¸èƒ½å¹¶å‘æ‰§è¡Œ è§£å†³æ­»é”çš„ä¸€ä¸ªæ–¹æ¡ˆæ˜¯ç ´åä¸å¯æŠ¢å æ¡ä»¶synchronized æ²¡æœ‰åŠæ³•è§£å†³ã€‚åŸå› æ˜¯ synchronized ç”³è¯·èµ„æºçš„æ—¶å€™ï¼Œå¦‚æœç”³è¯·ä¸åˆ°ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜»å¡çŠ¶æ€äº†ï¼Œè€Œçº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå•¥éƒ½å¹²ä¸äº†ï¼Œä¹Ÿé‡Šæ”¾ä¸äº†çº¿ç¨‹å·²ç»å æœ‰çš„èµ„æºã€‚ æ­£æ˜¯ç”±äºè¿™äº›å› ç´ çš„é™åˆ¶ï¼Œéœ€è¦å¼€å‘å‡ºä¸€ç§æ»¡è¶³å¦‚ä¸‹æ¡ä»¶çš„åŒæ­¥æœºåˆ¶ã€‚ èƒ½å¤Ÿå“åº”ä¸­æ–­ã€‚synchronized çš„é—®é¢˜æ˜¯ï¼ŒæŒæœ‰é” A åï¼Œå¦‚æœå°è¯•è·å–é” B å¤±è´¥ï¼Œé‚£ä¹ˆçº¿ç¨‹å°±è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä¸€æ—¦å‘ç”Ÿæ­»é”ï¼Œå°±æ²¡æœ‰ä»»ä½•æœºä¼šæ¥å”¤é†’é˜»å¡çš„çº¿ç¨‹ã€‚ä½†å¦‚æœé˜»å¡çŠ¶æ€çš„çº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ä¿¡å·ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬ç»™é˜»å¡çš„çº¿ç¨‹å‘é€ä¸­æ–­ä¿¡å·çš„æ—¶å€™ï¼Œèƒ½å¤Ÿå”¤é†’å®ƒï¼Œé‚£å®ƒå°±æœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é” Aã€‚ æ”¯æŒè¶…æ—¶ã€‚å¦‚æœçº¿ç¨‹åœ¨ä¸€æ®µæ—¶é—´ä¹‹å†…æ²¡æœ‰è·å–åˆ°é”ï¼Œä¸æ˜¯è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªé”™è¯¯ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é”ã€‚ éé˜»å¡åœ°è·å–é”ã€‚å¦‚æœå°è¯•è·å–é”å¤±è´¥ï¼Œå¹¶ä¸è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹ä¹Ÿæœ‰æœºä¼šé‡Šæ”¾æ›¾ç»æŒæœ‰çš„é”ã€‚ Lockä¸‹é¢æˆ‘ä»¬çœ‹ä¸‹lockæ¥å£çš„API // æ”¯æŒä¸­æ–­çš„ API void lockInterruptibly() throws InterruptedException; // æ”¯æŒè¶…æ—¶çš„ API boolean tryLock(long time, TimeUnit unit) throws InterruptedException; // æ”¯æŒéé˜»å¡è·å–é”çš„ API boolean tryLock(); void lock(); void unlock(); Condition newCondition(); Java SDK é‡Œé¢ Lock çš„ä½¿ç”¨ï¼Œæœ‰ä¸€ä¸ªç»å…¸çš„èŒƒä¾‹ï¼Œå°±æ˜¯try{}finally{}ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨çš„æ˜¯åœ¨ finally é‡Œé¢é‡Šæ”¾é”ã€‚ä¸‹é¢æˆ‘ä»¬å…·ä½“çœ‹ä¸‹ä¸Šé¢é‚£å‡ ä¸ªæ–¹æ³•çš„ä½¿ç”¨ã€‚ **lcok()**æ–¹æ³•æ˜¯å¹³æ—¶æ¯”è¾ƒå¸¸ç”¨çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥è·å–é”ã€‚å¦‚æœé”è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼Œåˆ™è¿›è¡Œç­‰å¾…ã€‚ ç”±äºåœ¨å‰é¢è®²åˆ°å¦‚æœé‡‡ç”¨Lockï¼Œå¿…é¡»ä¸»åŠ¨å»é‡Šæ”¾é”ï¼Œå¹¶ä¸”åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¸ä¼šè‡ªåŠ¨é‡Šæ”¾é”ã€‚å› æ­¤ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨Lockå¿…é¡»åœ¨try{}catch{}å—ä¸­è¿›è¡Œï¼Œå¹¶ä¸”å°†é‡Šæ”¾é”çš„æ“ä½œæ”¾åœ¨finallyå—ä¸­è¿›è¡Œï¼Œä»¥ä¿è¯é”ä¸€å®šè¢«è¢«é‡Šæ”¾ï¼Œé˜²æ­¢æ­»é”çš„å‘ç”Ÿã€‚é€šå¸¸ä½¿ç”¨Lockæ¥è¿›è¡ŒåŒæ­¥çš„è¯ï¼Œæ˜¯ä»¥ä¸‹é¢è¿™ç§å½¢å¼å»ä½¿ç”¨çš„ï¼š Lock lock = ...; lock.lock(); try&#123; //å¤„ç†ä»»åŠ¡ &#125;catch(Exception e)&#123; &#125;finally&#123; lock.unlock(); //é‡Šæ”¾é” &#125; tryLock()æ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œå®ƒè¡¨ç¤ºç”¨æ¥å°è¯•è·å–é”ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™è¿”å›trueï¼Œå¦‚æœè·å–å¤±è´¥ï¼ˆå³é”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼‰ï¼Œåˆ™è¿”å›falseï¼Œä¹Ÿå°±è¯´è¿™ä¸ªæ–¹æ³•æ— è®ºå¦‚ä½•éƒ½ä¼šç«‹å³è¿”å›ã€‚åœ¨æ‹¿ä¸åˆ°é”æ—¶ä¸ä¼šä¸€ç›´åœ¨é‚£ç­‰å¾…ã€‚ tryLock(long time, TimeUnit unit)æ–¹æ³•å’ŒtryLock()æ–¹æ³•æ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡åŒºåˆ«åœ¨äºè¿™ä¸ªæ–¹æ³•åœ¨æ‹¿ä¸åˆ°é”æ—¶ä¼šç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œåœ¨æ—¶é—´æœŸé™ä¹‹å†…å¦‚æœè¿˜æ‹¿ä¸åˆ°é”ï¼Œå°±è¿”å›falseã€‚å¦‚æœå¦‚æœä¸€å¼€å§‹æ‹¿åˆ°é”æˆ–è€…åœ¨ç­‰å¾…æœŸé—´å†…æ‹¿åˆ°äº†é”ï¼Œåˆ™è¿”å›trueã€‚ æ‰€ä»¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹é€šè¿‡tryLockæ¥è·å–é”æ—¶æ˜¯è¿™æ ·ä½¿ç”¨çš„ï¼š Lock lock = ...; if(lock.tryLock()) &#123; try&#123; //å¤„ç†ä»»åŠ¡ &#125;catch(Exception ex)&#123; &#125;finally&#123; lock.unlock(); //é‡Šæ”¾é” &#125; &#125;else &#123; //å¦‚æœä¸èƒ½è·å–é”ï¼Œåˆ™ç›´æ¥åšå…¶ä»–äº‹æƒ… &#125; lockInterruptibly()æ–¹æ³•æ¯”è¾ƒç‰¹æ®Šï¼Œå½“é€šè¿‡è¿™ä¸ªæ–¹æ³•å»è·å–é”æ—¶ï¼Œå¦‚æœçº¿ç¨‹æ­£åœ¨ç­‰å¾…è·å–é”ï¼Œåˆ™è¿™ä¸ªçº¿ç¨‹èƒ½å¤Ÿå“åº”ä¸­æ–­ï¼Œå³ä¸­æ–­çº¿ç¨‹çš„ç­‰å¾…çŠ¶æ€ã€‚ä¹Ÿå°±ä½¿è¯´ï¼Œå½“ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶é€šè¿‡lock.lockInterruptibly()æƒ³è·å–æŸä¸ªé”æ—¶ï¼Œå‡è‹¥æ­¤æ—¶çº¿ç¨‹Aè·å–åˆ°äº†é”ï¼Œè€Œçº¿ç¨‹Båªæœ‰åœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆå¯¹çº¿ç¨‹Bè°ƒç”¨threadB.interrupt()æ–¹æ³•èƒ½å¤Ÿä¸­æ–­çº¿ç¨‹Bçš„ç­‰å¾…è¿‡ç¨‹ã€‚ ç”±äºlockInterruptibly()çš„å£°æ˜ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæ‰€ä»¥lock.lockInterruptibly()å¿…é¡»æ”¾åœ¨tryå—ä¸­æˆ–è€…åœ¨è°ƒç”¨lockInterruptibly()çš„æ–¹æ³•å¤–å£°æ˜æŠ›å‡ºInterruptedExceptionã€‚ å› æ­¤lockInterruptibly()ä¸€èˆ¬çš„ä½¿ç”¨å½¢å¼å¦‚ä¸‹ï¼š public void method() throws InterruptedException &#123; lock.lockInterruptibly(); try &#123; //..... &#125; finally &#123; lock.unlock(); &#125; &#125; æ³¨æ„ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å–äº†é”ä¹‹åï¼Œæ˜¯ä¸ä¼šè¢«interrupt()æ–¹æ³•ä¸­æ–­çš„ã€‚å› ä¸ºæœ¬èº«åœ¨å‰é¢çš„æ–‡ç« ä¸­è®²è¿‡å•ç‹¬è°ƒç”¨interrupt()æ–¹æ³•ä¸èƒ½ä¸­æ–­æ­£åœ¨è¿è¡Œè¿‡ç¨‹ä¸­çš„çº¿ç¨‹ï¼Œåªèƒ½ä¸­æ–­é˜»å¡è¿‡ç¨‹ä¸­çš„çº¿ç¨‹ã€‚ å› æ­¤å½“é€šè¿‡lockInterruptibly()æ–¹æ³•è·å–æŸä¸ªé”æ—¶ï¼Œå¦‚æœä¸èƒ½è·å–åˆ°ï¼Œåªæœ‰è¿›è¡Œç­‰å¾…çš„æƒ…å†µä¸‹ï¼Œæ˜¯å¯ä»¥å“åº”ä¸­æ–­çš„ã€‚ è€Œç”¨synchronizedä¿®é¥°çš„è¯ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å¤„äºç­‰å¾…æŸä¸ªé”çš„çŠ¶æ€ï¼Œæ˜¯æ— æ³•è¢«ä¸­æ–­çš„ï¼Œåªæœ‰ä¸€ç›´ç­‰å¾…ä¸‹å»ã€‚ Lockå¦‚æœä¿è¯å¯è§æ€§synchronized ä¹‹æ‰€ä»¥èƒ½å¤Ÿä¿è¯å¯è§æ€§ï¼Œä¹Ÿæ˜¯å› ä¸ºæœ‰ä¸€æ¡synchronized ç›¸å…³çš„è§„åˆ™ï¼šsynchronized çš„è§£é” Happens-Before äºåç»­å¯¹è¿™ä¸ªé”çš„åŠ é”ã€‚é‚£ Lock é ä»€ä¹ˆä¿è¯å¯è§æ€§å‘¢ï¼Ÿä¾‹å¦‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œçº¿ç¨‹ T1 å¯¹ value è¿›è¡Œäº† +=1 æ“ä½œï¼Œé‚£åç»­çš„çº¿ç¨‹ T2 èƒ½å¤Ÿçœ‹åˆ° value çš„æ­£ç¡®ç»“æœå—ï¼Ÿ class X &#123; private final Lock rtl = new ReentrantLock(); int value; public void addOne() &#123; // è·å–é” rtl.lock(); try &#123; value+=1; &#125; finally &#123; // ä¿è¯é”èƒ½é‡Šæ”¾ rtl.unlock(); &#125; &#125; &#125; Lockåˆ©ç”¨volatileç›¸å…³çš„Happens-Beforeè§„åˆ™æ¥ä¿è¯å¯è§æ€§ã€‚ Java SDK é‡Œé¢çš„ ReentrantLockï¼Œå†…éƒ¨æŒæœ‰ä¸€ä¸ªvolatileçš„æˆå‘˜å˜é‡stateï¼Œè·å–é”çš„æ—¶å€™ï¼Œä¼šè¯»å†™stateçš„å€¼ï¼›è§£é”çš„æ—¶å€™ä¹Ÿä¼šè¯»å†™stateçš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ‰§è¡Œ value+=1 ä¹‹å‰ï¼Œç¨‹åºå…ˆè¯»å†™äº†ä¸€æ¬¡ volatileå˜é‡stateï¼Œåœ¨æ‰§è¡Œvalue+=1ä¹‹åï¼Œåˆè¯»å†™ä¸€æ¬¡olatileå˜é‡stateã€‚ç›¸å…³çš„Happens-Beforeè§„åˆ™å¦‚ä¸‹ï¼š é¡ºåºæ€§è§„åˆ™ï¼šå¯¹äºçº¿ç¨‹ T1ï¼Œvalue+=1 Happens-Beforeé‡Šæ”¾é”çš„æ“ä½œunlockï¼ˆï¼‰ï¼› volatile å˜é‡è§„åˆ™ï¼šç”±äº state = 1 ä¼šå…ˆè¯»å– stateï¼Œæ‰€ä»¥çº¿ç¨‹ T1 çš„ unlock() æ“ä½œ Happens-Before çº¿ç¨‹ T2 çš„ lock() æ“ä½œï¼› ä¼ é€’æ€§è§„åˆ™ï¼šçº¿ç¨‹ T1 çš„ value+=1 Happen-Beforeçº¿ç¨‹T2çš„lockï¼ˆï¼‰æ“ä½œã€‚ class SampleLock &#123; volatile int state; // åŠ é” lock() &#123; // çœç•¥ä»£ç æ— æ•° state = 1; &#125; // è§£é” unlock() &#123; // çœç•¥ä»£ç æ— æ•° state = 0; &#125; &#125; æ€»ç»“æ¥è¯´ï¼ŒLockå’Œsynchronizedæœ‰ä»¥ä¸‹å‡ ç‚¹ä¸åŒï¼š 1ï¼‰Lockæ˜¯ä¸€ä¸ªæ¥å£ï¼Œè€Œsynchronizedæ˜¯Javaä¸­çš„å…³é”®å­—ï¼Œsynchronizedæ˜¯å†…ç½®çš„è¯­è¨€å®ç°ï¼› 2ï¼‰synchronizedåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾çº¿ç¨‹å æœ‰çš„é”ï¼Œå› æ­¤ä¸ä¼šå¯¼è‡´æ­»é”ç°è±¡å‘ç”Ÿï¼›è€ŒLockåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå¦‚æœæ²¡æœ‰ä¸»åŠ¨é€šè¿‡unLock()å»é‡Šæ”¾é”ï¼Œåˆ™å¾ˆå¯èƒ½é€ æˆæ­»é”ç°è±¡ï¼Œå› æ­¤ä½¿ç”¨Lockæ—¶éœ€è¦åœ¨finallyå—ä¸­é‡Šæ”¾é”ï¼› 3ï¼‰Lockå¯ä»¥è®©ç­‰å¾…é”çš„çº¿ç¨‹å“åº”ä¸­æ–­ï¼Œè€Œsynchronizedå´ä¸è¡Œï¼Œä½¿ç”¨synchronizedæ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œä¸èƒ½å¤Ÿå“åº”ä¸­æ–­ï¼› 4ï¼‰é€šè¿‡Lockå¯ä»¥çŸ¥é“æœ‰æ²¡æœ‰æˆåŠŸè·å–é”ï¼Œè€Œsynchronizedå´æ— æ³•åŠåˆ°ã€‚ 5ï¼‰Lockå¯ä»¥æé«˜å¤šä¸ªçº¿ç¨‹è¿›è¡Œè¯»æ“ä½œçš„æ•ˆç‡ã€‚ åœ¨æ€§èƒ½ä¸Šæ¥è¯´ï¼Œå¦‚æœç«äº‰èµ„æºä¸æ¿€çƒˆï¼Œä¸¤è€…çš„æ€§èƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œè€Œå½“ç«äº‰èµ„æºéå¸¸æ¿€çƒˆæ—¶ï¼ˆå³æœ‰å¤§é‡çº¿ç¨‹åŒæ—¶ç«äº‰ï¼‰ï¼Œæ­¤æ—¶Lockçš„æ€§èƒ½è¦è¿œè¿œä¼˜äºsynchronizedã€‚æ‰€ä»¥è¯´ï¼Œåœ¨å…·ä½“ä½¿ç”¨æ—¶è¦æ ¹æ®é€‚å½“æƒ…å†µé€‰æ‹©ã€‚ Happens-Beforeç›¸å…³è§„åˆ™ä»‹ç»å¯çœ‹ä¸‹ç‹å®ä»¤å¤§ç¥çš„Javaå¹¶å‘è¯¾ç¨‹","categories":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://gyl-coder.top/categories/%E5%B9%B6%E5%8F%91/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://gyl-coder.top/tags/%E5%B9%B6%E5%8F%91/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"Why Concurrency ?","slug":"concurrency/why_concurrency","date":"2019-11-05T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"concurrency/why_concurrency/","link":"","permalink":"https://gyl-coder.top/concurrency/why_concurrency/","excerpt":"ä¸€é—¨æŠ€æœ¯çš„å‡ºç°å¿…ç„¶æœ‰å…¶å‡ºç°çš„é“ç†ï¼Œåæ¥éœ€è¦äº†è§£å®ƒå‡ºç°çš„æ—¶ä»£ç¯å¢ƒå’Œå› ç´ ï¼Œæ‰©å……è‡ªå·±çš„è§†é‡ï¼Œå‘æ˜æŠ€æœ¯å‘å±•çš„ç»è¿‡ã€‚åˆ†æå…¶ä¼˜ç¼ºç‚¹ï¼Œä»¥ä¾¿æ›´å¥½çš„è¿ç”¨ã€‚ ä¸€ç›´ä»¥æ¥ï¼Œç¡¬ä»¶çš„å‘å±•æå…¶è¿…é€Ÿï¼Œä¹Ÿæœ‰ä¸€ä¸ªå¾ˆè‘—åçš„ æ‘©å°”å®šå¾‹ ,ç„¶è€Œäº‹å®è¯æ˜æ‘©å°”å®šå¾‹çš„æœ‰æ•ˆæ€§è¶…è¿‡åŠä¸ªä¸–çºªå°±å¤±æ•ˆäº†ã€‚ä¸ºäº†è¿›ä¸€æ­¥æå‡è®¡ç®—é€Ÿåº¦ï¼Œæ”¾å¼ƒäº†ä¸€å‘³è¿½æ±‚å•ç‹¬çš„è®¡ç®—å•å…ƒï¼Œå°†å¤šä¸ªè®¡ç®—å•å…ƒæ•´åˆåˆ°ä¸€èµ·ï¼Œä¹Ÿå°±æ˜¯å½¢æˆäº†å¤šæ ¸CPUã€‚åœ¨å¤šæ ¸CPUçš„ç¯å¢ƒä¸‹ï¼Œå¹¶å‘ç¼–ç¨‹çš„å½¢å¼å¯ä»¥å°†å¤šæ ¸CPUçš„è®¡ç®—èƒ½åŠ›å‘æŒ¥åˆ°æè‡´ï¼Œæ€§èƒ½å¾—åˆ°æå‡ã€‚","text":"ä¸€é—¨æŠ€æœ¯çš„å‡ºç°å¿…ç„¶æœ‰å…¶å‡ºç°çš„é“ç†ï¼Œåæ¥éœ€è¦äº†è§£å®ƒå‡ºç°çš„æ—¶ä»£ç¯å¢ƒå’Œå› ç´ ï¼Œæ‰©å……è‡ªå·±çš„è§†é‡ï¼Œå‘æ˜æŠ€æœ¯å‘å±•çš„ç»è¿‡ã€‚åˆ†æå…¶ä¼˜ç¼ºç‚¹ï¼Œä»¥ä¾¿æ›´å¥½çš„è¿ç”¨ã€‚ ä¸€ç›´ä»¥æ¥ï¼Œç¡¬ä»¶çš„å‘å±•æå…¶è¿…é€Ÿï¼Œä¹Ÿæœ‰ä¸€ä¸ªå¾ˆè‘—åçš„ æ‘©å°”å®šå¾‹ ,ç„¶è€Œäº‹å®è¯æ˜æ‘©å°”å®šå¾‹çš„æœ‰æ•ˆæ€§è¶…è¿‡åŠä¸ªä¸–çºªå°±å¤±æ•ˆäº†ã€‚ä¸ºäº†è¿›ä¸€æ­¥æå‡è®¡ç®—é€Ÿåº¦ï¼Œæ”¾å¼ƒäº†ä¸€å‘³è¿½æ±‚å•ç‹¬çš„è®¡ç®—å•å…ƒï¼Œå°†å¤šä¸ªè®¡ç®—å•å…ƒæ•´åˆåˆ°ä¸€èµ·ï¼Œä¹Ÿå°±æ˜¯å½¢æˆäº†å¤šæ ¸CPUã€‚åœ¨å¤šæ ¸CPUçš„ç¯å¢ƒä¸‹ï¼Œå¹¶å‘ç¼–ç¨‹çš„å½¢å¼å¯ä»¥å°†å¤šæ ¸CPUçš„è®¡ç®—èƒ½åŠ›å‘æŒ¥åˆ°æè‡´ï¼Œæ€§èƒ½å¾—åˆ°æå‡ã€‚ å¹¶å‘å¸¦æ¥çš„å¥½å¤„æ€§èƒ½ä¸Šçš„æå‡æå‡å¤šæ ¸CPUçš„åˆ©ç”¨ç‡ï¼šä¸€èˆ¬æ¥è¯´ä¸€å°ä¸»æœºä¸Šçš„ä¼šæœ‰å¤šä¸ªCPUæ ¸å¿ƒï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥å°†å¤šä¸ªçº¿ç¨‹åˆ†é…ç»™ä¸åŒçš„CPUå»æ‰§è¡Œï¼Œæ¯ä¸ªCPUæ‰§è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·å°±æé«˜äº†CPUçš„ä½¿ç”¨æ•ˆç‡ï¼Œå¦‚æœä½¿ç”¨å•çº¿ç¨‹å°±åªèƒ½æœ‰ä¸€ä¸ªCPUæ ¸å¿ƒè¢«ä½¿ç”¨ã€‚ æå‡è®¿é—®I/Oæ—¶CPUçš„åˆ©ç”¨ç‡ï¼šå½“ä¸€ä¸ªçº¿ç¨‹è¦åœ¨ç½‘ä¸Šä¸‹è½½ä¸€äº›ä¸œè¥¿çš„æ—¶å€™ï¼Œè¿™ä¸ªçº¿ç¨‹å°†å¤„äºé˜»å¡çŠ¶æ€ï¼Œè¿™æ—¶CPUå°±ä¸ä¼šå†ä¸ºè¿™ä¸ªçº¿ç¨‹åˆ†é…CPUæ—¶é—´äº†ï¼Œè€Œå…¶ä»–è¿›ç¨‹å¯ä»¥ä¸å—ä»»ä½•å½±å“åœ°è·å¾—CPUæ—¶é—´ã€‚åè¿‡æ¥å¦‚æœæ²¡æœ‰ä½¿ç”¨å¹¶å‘ï¼Œå½“å‰é¢çš„æŒ‡ä»¤ç”³è¯·I/Oèµ„æºçš„æ—¶å€™ï¼Œæ•´ä¸ªè¿›ç¨‹å°±è¢«æŒ‚èµ·äº†ï¼Œå³ä½¿CPUå¤„äºç©ºé—²çŠ¶æ€åé¢çš„æŒ‡ä»¤ä¹Ÿä¸èƒ½è¢«æ‰§è¡Œã€‚ é™ä½ç³»ç»Ÿçš„å“åº”æ—¶é—´ï¼šå½“æœ‰å¤šä¸ªè¯·æ±‚éœ€è¦è¢«å¤„ç†æ—¶ã€‚åœ¨å•çº¿ç¨‹çš„ç¯å¢ƒä¸­ï¼Œæ‰€æœ‰è¯·æ±‚éœ€è¦æ’é˜Ÿè¿›è¡Œå¤„ç†ã€‚è¿™æ ·å¤„åœ¨åé¢çš„è¯·æ±‚å°†ä¼šç­‰å¾…è¾ƒé•¿çš„æ—¶é—´ã€‚å¤šçº¿ç¨‹å¤„ç†çš„è¯å¯ä»¥å›é¿å“åº”æ—¶é—´é•¿çš„é—®é¢˜ï¼Œæ‰€æœ‰è¯·æ±‚è½®æµä½¿ç”¨CPUèµ„æºï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¯ä»¥è¾ƒå¿«çš„å¾—åˆ°å“åº”ã€‚ æå‡ç³»ç»Ÿå®¹é”™èƒ½åŠ›ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ä¸å—å…¶ä»–çº¿ç¨‹çš„å¹²æ‰°ç‹¬ç«‹è¿è¡Œï¼Œå¦‚æœæŸä¸ªçº¿ç¨‹çš„ä»£ç é‡Œå‡ºç°äº†Bugï¼Œè¿™ä¸ªçº¿ç¨‹å¯èƒ½æŠ›å‡ºå¼‚å¸¸é€€å‡ºäº†ï¼Œè¿™æ—¶å€™å…¶ä»–çº¿ç¨‹å¯ä»¥ä¸å—ä»»ä½•å½±å“ç»§ç»­æ‰§è¡Œï¼Œä¸è‡³äºå¯¼è‡´æ•´ä¸ªç³»ç»Ÿéƒ½å´©æºƒã€‚ å¹¶å‘çš„å¼Šç«¯é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶é—´ç‰‡æ˜¯CPUåˆ†é…ç»™å„ä¸ªçº¿ç¨‹çš„æ—¶é—´ï¼Œå› ä¸ºæ—¶é—´éå¸¸çŸ­ï¼Œæ‰€ä»¥CPUä¸æ–­é€šè¿‡åˆ‡æ¢çº¿ç¨‹ï¼Œè®©æˆ‘ä»¬è§‰å¾—å¤šä¸ªçº¿ç¨‹æ˜¯åŒæ—¶æ‰§è¡Œçš„ï¼Œæ—¶é—´ç‰‡ä¸€èˆ¬æ˜¯å‡ åæ¯«ç§’ã€‚è€Œæ¯æ¬¡åˆ‡æ¢æ—¶ï¼Œéœ€è¦ä¿å­˜å½“å‰çš„çŠ¶æ€èµ·æ¥ï¼Œä»¥ä¾¿èƒ½å¤Ÿè¿›è¡Œæ¢å¤å…ˆå‰çŠ¶æ€ï¼Œè€Œè¿™ä¸ªåˆ‡æ¢æ—¶éå¸¸æŸè€—æ€§èƒ½ï¼Œè¿‡äºé¢‘ç¹åè€Œæ— æ³•å‘æŒ¥å‡ºå¤šçº¿ç¨‹ç¼–ç¨‹çš„ä¼˜åŠ¿ã€‚ é€šå¸¸å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢å¯ä»¥é‡‡ç”¨æ— é”å¹¶å‘ç¼–ç¨‹ï¼ŒCASç®—æ³•ï¼Œä½¿ç”¨æœ€å°‘çš„çº¿ç¨‹å’Œä½¿ç”¨åç¨‹ã€‚ æ— é”å¹¶å‘ç¼–ç¨‹ï¼šå¯ä»¥å‚ç…§concurrentHashMapé”åˆ†æ®µçš„æ€æƒ³ï¼Œä¸åŒçš„çº¿ç¨‹å¤„ç†ä¸åŒæ®µçš„æ•°æ®ï¼Œè¿™æ ·åœ¨å¤šçº¿ç¨‹ç«äº‰çš„æ¡ä»¶ä¸‹ï¼Œå¯ä»¥å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ—¶é—´ã€‚ CASç®—æ³•ï¼Œåˆ©ç”¨Atomicä¸‹ä½¿ç”¨CASç®—æ³•æ¥æ›´æ–°æ•°æ®ï¼Œä½¿ç”¨äº†ä¹è§‚é”ï¼Œå¯ä»¥æœ‰æ•ˆçš„å‡å°‘ä¸€éƒ¨åˆ†ä¸å¿…è¦çš„é”ç«äº‰å¸¦æ¥çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ ä½¿ç”¨æœ€å°‘çº¿ç¨‹ï¼šé¿å…åˆ›å»ºä¸éœ€è¦çš„çº¿ç¨‹ï¼Œæ¯”å¦‚ä»»åŠ¡å¾ˆå°‘ï¼Œä½†æ˜¯åˆ›å»ºäº†å¾ˆå¤šçš„çº¿ç¨‹ï¼Œè¿™æ ·ä¼šé€ æˆå¤§é‡çš„çº¿ç¨‹éƒ½å¤„äºç­‰å¾…çŠ¶æ€ åç¨‹ï¼šåœ¨å•çº¿ç¨‹é‡Œå®ç°å¤šä»»åŠ¡çš„è°ƒåº¦ï¼Œå¹¶åœ¨å•çº¿ç¨‹é‡Œç»´æŒå¤šä¸ªä»»åŠ¡é—´çš„åˆ‡æ¢ å¹¶å‘é—®é¢˜å¤šæ˜“å‡ºé”™ç¼–å†™å¹¶å‘ä»£ç å®¹æ˜“å‡ºé”™ï¼Œå¤šçº¿ç¨‹å¹¶å‘è¿è¡Œç»™æ‰§è¡Œè¿‡ç¨‹å¸¦æ¥äº†å¾ˆå¤šä¸ç¡®å®šæ€§ï¼Œå› ä¸ºåªæœ‰åŒä¸€ä¸ªçº¿ç¨‹å†…éƒ¨ä»£ç çš„æ‰§è¡Œé¡ºåºæ˜¯å›ºå®šçš„ï¼Œè€Œä¸åŒçº¿ç¨‹ä¹‹é—´çš„ä»£ç æ‰§è¡Œé¡ºåºæ— æ³•ç¡®å®šã€‚å½“å¤šä¸ªçº¿ç¨‹ä¹‹é—´äº’ç›¸å¹²æ‰°æ—¶ï¼Œé—®é¢˜å°±ä¼šæ¥è¸µè€Œè‡³ã€‚ç¼–å†™å¤šçº¿ç¨‹ä»£ç æ—¶ï¼Œå¦‚æœæ²¡æœ‰è€ƒè™‘å…¨é¢å¾ˆå®¹æ˜“äº§ç”Ÿæ¦‚ç‡æ€§çš„ã€éš¾ä»¥å¤ç°çš„Bug æ˜¯å¦é‡‡ç”¨å¹¶å‘ç¼–ç¨‹çš„æ¨¡å¼ï¼Œæœ€ç»ˆè¿˜æ˜¯è¦ç»“åˆè‡ªå·±çš„åœºæ™¯æƒè¡¡åˆ©å¼Šã€‚","categories":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://gyl-coder.top/categories/%E5%B9%B6%E5%8F%91/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://gyl-coder.top/tags/%E5%B9%B6%E5%8F%91/"},{"name":"Concurrency","slug":"Concurrency","permalink":"https://gyl-coder.top/tags/Concurrency/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"å¹¶å‘è®¾è®¡æ¨¡å¼ï¼šImmutability æ¨¡å¼","slug":"design-pattern/immutability","date":"2019-10-25T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"design-pattern/immutability/","link":"","permalink":"https://gyl-coder.top/design-pattern/immutability/","excerpt":"å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™åŒä¸€å…±äº«å˜é‡å­˜åœ¨å¹¶å‘é—®é¢˜**ï¼Œå…¶ä¸­çš„å¿…è¦æ¡ä»¶ä¹‹ä¸€å°±æ˜¯ è¯»å†™ ï¼Œå¦‚æœæ²¡æœ‰å†™ï¼Œåªå­˜åœ¨è¯»ï¼Œæ˜¯ä¸ä¼šå­˜åœ¨å¹¶å‘é—®é¢˜çš„ã€‚ å¦‚æœè®©ä¸€ä¸ªå…±äº«å˜é‡åªæœ‰è¯»æ“ä½œï¼Œæ²¡æœ‰å†™æ“ä½œï¼Œå¦‚æ­¤åˆ™å¯ä»¥è§£å†³å¹¶å‘é—®é¢˜ã€‚è¯¥ç†è®ºçš„å…·ä½“å®ç°å°±æ˜¯ ä¸å˜æ€§ï¼ˆImmutabilityï¼‰æ¨¡å¼ ã€‚æ‰€è°“ä¸å˜æ€§ï¼Œç®€å•æ¥è®²ï¼Œå°±æ˜¯å¯¹è±¡ä¸€æ—¦è¢«åˆ›å»ºä¹‹åï¼ŒçŠ¶æ€å°±ä¸å†å‘ç”Ÿå˜åŒ–ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å˜é‡ä¸€æ—¦è¢«èµ‹å€¼ï¼Œå°±ä¸å…è®¸ä¿®æ”¹äº†ï¼ˆæ²¡æœ‰å†™æ“ä½œï¼‰ï¼›æ²¡æœ‰ä¿®æ”¹æ“ä½œï¼Œä¹Ÿå°±æ˜¯ä¿æŒäº†ä¸å˜æ€§ã€‚","text":"å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™åŒä¸€å…±äº«å˜é‡å­˜åœ¨å¹¶å‘é—®é¢˜**ï¼Œå…¶ä¸­çš„å¿…è¦æ¡ä»¶ä¹‹ä¸€å°±æ˜¯ è¯»å†™ ï¼Œå¦‚æœæ²¡æœ‰å†™ï¼Œåªå­˜åœ¨è¯»ï¼Œæ˜¯ä¸ä¼šå­˜åœ¨å¹¶å‘é—®é¢˜çš„ã€‚ å¦‚æœè®©ä¸€ä¸ªå…±äº«å˜é‡åªæœ‰è¯»æ“ä½œï¼Œæ²¡æœ‰å†™æ“ä½œï¼Œå¦‚æ­¤åˆ™å¯ä»¥è§£å†³å¹¶å‘é—®é¢˜ã€‚è¯¥ç†è®ºçš„å…·ä½“å®ç°å°±æ˜¯ ä¸å˜æ€§ï¼ˆImmutabilityï¼‰æ¨¡å¼ ã€‚æ‰€è°“ä¸å˜æ€§ï¼Œç®€å•æ¥è®²ï¼Œå°±æ˜¯å¯¹è±¡ä¸€æ—¦è¢«åˆ›å»ºä¹‹åï¼ŒçŠ¶æ€å°±ä¸å†å‘ç”Ÿå˜åŒ–ã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯å˜é‡ä¸€æ—¦è¢«èµ‹å€¼ï¼Œå°±ä¸å…è®¸ä¿®æ”¹äº†ï¼ˆæ²¡æœ‰å†™æ“ä½œï¼‰ï¼›æ²¡æœ‰ä¿®æ”¹æ“ä½œï¼Œä¹Ÿå°±æ˜¯ä¿æŒäº†ä¸å˜æ€§ã€‚ å®ç°å…·å¤‡ä¸å¯å˜æ€§çš„ç±»å°†ä¸€ä¸ªç±»æ‰€æœ‰çš„å±æ€§éƒ½è®¾ç½®æˆ final çš„ï¼Œå¹¶ä¸”åªå…è®¸å­˜åœ¨åªè¯»æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»åŸºæœ¬ä¸Šå°±å…·å¤‡ä¸å¯å˜æ€§äº†ã€‚æ›´ä¸¥æ ¼çš„åšæ³•æ˜¯è¿™ä¸ªç±»æœ¬èº«ä¹Ÿæ˜¯ final çš„ï¼Œä¹Ÿå°±æ˜¯ä¸å…è®¸ç»§æ‰¿ã€‚å› ä¸ºå­ç±»å¯ä»¥è¦†ç›–çˆ¶ç±»çš„æ–¹æ³•ï¼Œæœ‰å¯èƒ½æ”¹å˜ä¸å¯å˜æ€§ã€‚ Java SDK é‡Œå¾ˆå¤šç±»éƒ½å…·å¤‡ä¸å¯å˜æ€§ï¼Œåªæ˜¯ç”±äºå®ƒä»¬çš„ä½¿ç”¨å¤ªç®€å•ï¼Œæœ€ååè€Œè¢«å¿½ç•¥äº†ã€‚ä¾‹å¦‚ç»å¸¸ç”¨åˆ°çš„ String å’Œ Longã€Integerã€Double ç­‰åŸºç¡€ç±»å‹çš„åŒ…è£…ç±»éƒ½å…·å¤‡ä¸å¯å˜æ€§ï¼Œè¿™äº›å¯¹è±¡çš„çº¿ç¨‹å®‰å…¨æ€§éƒ½æ˜¯é ä¸å¯å˜æ€§æ¥ä¿è¯çš„ã€‚å¦‚æœä½ ä»”ç»†ç¿»çœ‹è¿™äº›ç±»çš„å£°æ˜ã€å±æ€§å’Œæ–¹æ³•ï¼Œä½ ä¼šå‘ç°å®ƒä»¬éƒ½ä¸¥æ ¼éµå®ˆä¸å¯å˜ç±»çš„ä¸‰ç‚¹è¦æ±‚ï¼šç±»å’Œå±æ€§éƒ½æ˜¯ final çš„ï¼Œæ‰€æœ‰æ–¹æ³•å‡æ˜¯åªè¯»çš„ã€‚ çœ‹åˆ°è¿™é‡Œä½ å¯èƒ½ä¼šç–‘æƒ‘ï¼ŒJava çš„ String æ–¹æ³•ä¹Ÿæœ‰ç±»ä¼¼å­—ç¬¦æ›¿æ¢æ“ä½œï¼Œæ€ä¹ˆèƒ½è¯´æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯åªè¯»çš„å‘¢ï¼Ÿä¸‹é¢é€šè¿‡ String çš„æºä»£ç æ¥çœ‹ä¸€å“ˆã€‚ ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æºè‡ª Java 1.8 SDKã€‚String è¿™ä¸ªç±»ä»¥åŠå®ƒçš„å±æ€§ value[] éƒ½æ˜¯ final çš„ï¼›è€Œ replace() æ–¹æ³•çš„å®ç°ï¼Œå°±çš„ç¡®æ²¡æœ‰ä¿®æ”¹ value[]ï¼Œè€Œæ˜¯å°†æ›¿æ¢åçš„å­—ç¬¦ä¸²ä½œä¸ºè¿”å›å€¼è¿”å›äº†ã€‚ public final class String &#123; private final char value[]; // å­—ç¬¦æ›¿æ¢ String replace(char oldChar, char newChar) &#123; // æ— éœ€æ›¿æ¢ï¼Œç›´æ¥è¿”å› this if (oldChar == newChar)&#123; return this; &#125; int len = value.length; int i = -1; /* avoid getfield opcode */ char[] val = value; // å®šä½åˆ°éœ€è¦æ›¿æ¢çš„å­—ç¬¦ä½ç½® while (++i &lt; len) &#123; if (val[i] == oldChar) &#123; break; &#125; &#125; // æœªæ‰¾åˆ° oldCharï¼Œæ— éœ€æ›¿æ¢ if (i &gt;= len) &#123; return this; &#125; // åˆ›å»ºä¸€ä¸ª buf[]ï¼Œè¿™æ˜¯å…³é”® // ç”¨æ¥ä¿å­˜æ›¿æ¢åçš„å­—ç¬¦ä¸² char buf[] = new char[len]; for (int j = 0; j &lt; i; j++) &#123; buf[j] = val[j]; &#125; while (i &lt; len) &#123; char c = val[i]; buf[i] = (c == oldChar) ? newChar : c; i++; &#125; // åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²è¿”å› // åŸå­—ç¬¦ä¸²ä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ– return new String(buf, true); &#125; &#125; ç”±ä¸Šé¢çš„ä»£ç å¯ä»¥å‘ç°ï¼ŒString æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸å¯å˜å¯¹è±¡ æ¥å®ç° ä¿®æ”¹ çš„åŠŸèƒ½ã€‚å¦‚æœ æ‰€æœ‰çš„ä¿®æ”¹æ“ä½œéƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸å¯å˜å¯¹è±¡ï¼Œä½ å¯èƒ½ä¼šæœ‰è¿™ç§æ‹…å¿ƒï¼šæ˜¯ä¸æ˜¯åˆ›å»ºçš„å¯¹è±¡å¤ªå¤šäº†ï¼Œæœ‰ç‚¹å¤ªæµªè´¹å†…å­˜å‘¢ï¼Ÿæ˜¯çš„ï¼Œè¿™æ ·åšçš„ç¡®æœ‰äº›æµªè´¹ï¼Œé‚£å¦‚ä½•è§£å†³å‘¢ï¼Ÿ åˆ©ç”¨äº«å…ƒæ¨¡å¼é¿å…åˆ›å»ºé‡å¤å¯¹è±¡åˆ©ç”¨äº«å…ƒæ¨¡å¼å¯ä»¥å‡å°‘åˆ›å»ºå¯¹è±¡çš„æ•°é‡ï¼Œä»è€Œå‡å°‘å†…å­˜å ç”¨ã€‚Java è¯­è¨€é‡Œé¢ Longã€Integerã€Shortã€Byte ç­‰è¿™äº›åŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…ç±»éƒ½ç”¨åˆ°äº†äº«å…ƒæ¨¡å¼ã€‚ ä¸‹é¢ä»¥ Long è¿™ä¸ªç±»ä½œä¸ºä¾‹å­ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•åˆ©ç”¨äº«å…ƒæ¨¡å¼æ¥ä¼˜åŒ–å¯¹è±¡çš„åˆ›å»ºçš„ã€‚ äº«å…ƒæ¨¡å¼æœ¬è´¨ä¸Šå…¶å®å°±æ˜¯ä¸€ä¸ªå¯¹è±¡æ± ï¼Œåˆ©ç”¨äº«å…ƒæ¨¡å¼åˆ›å»ºå¯¹è±¡çš„é€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼šåˆ›å»ºä¹‹å‰ï¼Œé¦–å…ˆå»å¯¹è±¡æ± é‡Œçœ‹çœ‹æ˜¯ä¸æ˜¯å­˜åœ¨ï¼›å¦‚æœå·²ç»å­˜åœ¨ï¼Œå°±åˆ©ç”¨å¯¹è±¡æ± é‡Œçš„å¯¹è±¡ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œå°±ä¼šæ–°åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”æŠŠè¿™ä¸ªæ–°åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡æ”¾è¿›å¯¹è±¡æ± é‡Œã€‚ Long è¿™ä¸ªç±»å¹¶æ²¡æœ‰ç…§æ¬äº«å…ƒæ¨¡å¼ï¼ŒLong å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªé™æ€çš„å¯¹è±¡æ± ï¼Œä»…ç¼“å­˜äº† [-128,127] ä¹‹é—´çš„æ•°å­—ï¼Œè¿™ä¸ªå¯¹è±¡æ± åœ¨ JVM å¯åŠ¨çš„æ—¶å€™å°±åˆ›å»ºå¥½äº†ï¼Œè€Œä¸”è¿™ä¸ªå¯¹è±¡æ± ä¸€ç›´éƒ½ä¸ä¼šå˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯é™æ€çš„ã€‚ä¹‹æ‰€ä»¥é‡‡ç”¨è¿™æ ·çš„è®¾è®¡ï¼Œæ˜¯å› ä¸º Long è¿™ä¸ªå¯¹è±¡çš„çŠ¶æ€å…±æœ‰ 2 çš„ 64 æ¬¡æ–¹ ç§ï¼Œå®åœ¨å¤ªå¤šï¼Œå¹¶ä¸é€‚åˆå…¨éƒ¨ç¼“å­˜ï¼Œè€Œ [-128,127] ä¹‹é—´çš„æ•°å­—åˆ©ç”¨ç‡æœ€é«˜ã€‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç å‡ºè‡ª Java 1.8ï¼ŒvalueOf() æ–¹æ³•å°±ç”¨åˆ°äº† LongCache è¿™ä¸ªç¼“å­˜ã€‚ Long valueOf(long l) &#123; final int offset = 128; // [-128,127] ç›´æ¥çš„æ•°å­—åšäº†ç¼“å­˜ if (l &gt;= -128 &amp;&amp; l &lt;= 127) &#123; return LongCache .cache[(int)l + offset]; &#125; return new Long(l); &#125; // ç¼“å­˜ï¼Œç­‰ä»·äºå¯¹è±¡æ±  // ä»…ç¼“å­˜ [-128,127] ç›´æ¥çš„æ•°å­— static class LongCache &#123; static final Long cache[] = new Long[-(-128) + 127 + 1]; static &#123; for(int i=0; i&lt;cache.length; i++) cache[i] = new Long(i-128); &#125; &#125; æ³¨æ„ï¼š** â€œInteger å’Œ String ç±»å‹çš„å¯¹è±¡ä¸é€‚åˆåšé”â€ï¼Œå…¶å®åŸºæœ¬ä¸Šæ‰€æœ‰çš„åŸºç¡€ç±»å‹çš„åŒ…è£…ç±»éƒ½ä¸é€‚åˆåšé”ï¼Œå› ä¸ºå®ƒä»¬å†…éƒ¨ç”¨åˆ°äº†äº«å…ƒæ¨¡å¼ï¼Œè¿™ä¼šå¯¼è‡´çœ‹ä¸Šå»ç§æœ‰çš„é”ï¼Œå…¶å®æ˜¯å…±æœ‰çš„ã€‚ä¾‹å¦‚åœ¨ä¸‹é¢ä»£ç ä¸­ï¼Œæœ¬æ„æ˜¯ A ç”¨é” alï¼ŒB ç”¨é” blï¼Œå„è‡ªç®¡ç†å„è‡ªçš„ï¼Œäº’ä¸å½±å“ã€‚ä½†å®é™…ä¸Š al å’Œ bl æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç»“æœ A å’Œ B å…±ç”¨çš„æ˜¯ä¸€æŠŠé”ã€‚ class A &#123; Long al=Long.valueOf(1); public void setAX()&#123; synchronized (al) &#123; // çœç•¥ä»£ç æ— æ•° &#125; &#125; &#125; class B &#123; Long bl=Long.valueOf(1); public void setBY()&#123; synchronized (bl) &#123; // çœç•¥ä»£ç æ— æ•° &#125; &#125; &#125; ä½¿ç”¨ Immutability æ¨¡å¼çš„æ³¨æ„äº‹é¡¹åœ¨ä½¿ç”¨ Immutability æ¨¡å¼çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹ä¸¤ç‚¹ï¼š å¯¹è±¡çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯ final çš„ï¼Œå¹¶ä¸èƒ½ä¿è¯ä¸å¯å˜æ€§ï¼› ä¸å¯å˜å¯¹è±¡ä¹Ÿéœ€è¦æ­£ç¡®å‘å¸ƒã€‚ åœ¨ Java è¯­è¨€ä¸­ï¼Œfinal ä¿®é¥°çš„å±æ€§ä¸€æ—¦è¢«èµ‹å€¼ï¼Œå°±ä¸å¯ä»¥å†ä¿®æ”¹ï¼Œä½†æ˜¯å¦‚æœå±æ€§çš„ç±»å‹æ˜¯æ™®é€šå¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ™®é€šå¯¹è±¡çš„å±æ€§æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ä¸­ï¼ŒBar çš„å±æ€§ foo è™½ç„¶æ˜¯ final çš„ï¼Œä¾ç„¶å¯ä»¥é€šè¿‡ setAge() æ–¹æ³•æ¥è®¾ç½® foo çš„å±æ€§ ageã€‚æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨ Immutability æ¨¡å¼çš„æ—¶å€™ä¸€å®šè¦ç¡®è®¤ä¿æŒä¸å˜æ€§çš„è¾¹ç•Œåœ¨å“ªé‡Œï¼Œæ˜¯å¦è¦æ±‚å±æ€§å¯¹è±¡ä¹Ÿå…·å¤‡ä¸å¯å˜æ€§ã€‚ class Foo&#123; int age=0; int ; &#125; final class Bar &#123; final Foo foo; void setAge(int a)&#123; foo.age=a; &#125; &#125; ä¸‹é¢æˆ‘ä»¬å†çœ‹çœ‹å¦‚ä½•æ­£ç¡®åœ°å‘å¸ƒä¸å¯å˜å¯¹è±¡ã€‚ä¸å¯å˜å¯¹è±¡è™½ç„¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å¹¶ä¸æ„å‘³ç€å¼•ç”¨è¿™äº›ä¸å¯å˜å¯¹è±¡çš„å¯¹è±¡å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¾‹å¦‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼ŒFoo å…·å¤‡ä¸å¯å˜æ€§ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯ç±» Bar å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œç±» Bar ä¸­æŒæœ‰å¯¹ Foo çš„å¼•ç”¨ fooï¼Œå¯¹ foo è¿™ä¸ªå¼•ç”¨çš„ä¿®æ”¹åœ¨å¤šçº¿ç¨‹ä¸­å¹¶ä¸èƒ½ä¿è¯å¯è§æ€§å’ŒåŸå­æ€§ã€‚ //Foo çº¿ç¨‹å®‰å…¨ final class Foo&#123; final int age=0; final int ; &#125; //Bar çº¿ç¨‹ä¸å®‰å…¨ class Bar &#123; Foo foo; void setFoo(Foo f)&#123; this.foo=f; &#125; &#125; å¦‚æœä½ çš„ç¨‹åºä»…ä»…éœ€è¦ foo ä¿æŒå¯è§æ€§ï¼Œæ— éœ€ä¿è¯åŸå­æ€§ï¼Œé‚£ä¹ˆå¯ä»¥å°† foo å£°æ˜ä¸º volatile å˜é‡ï¼Œè¿™æ ·å°±èƒ½ä¿è¯å¯è§æ€§ã€‚å¦‚æœä½ çš„ç¨‹åºéœ€è¦ä¿è¯åŸå­æ€§ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡åŸå­ç±»æ¥å®ç°ã€‚ä¸‹é¢çš„ç¤ºä¾‹ä»£ç æ˜¯åˆç†åº“å­˜çš„åŸå­åŒ–å®ç°ï¼Œä½ åº”è¯¥å¾ˆç†Ÿæ‚‰äº†ï¼Œå…¶ä¸­å°±æ˜¯ç”¨åŸå­ç±»è§£å†³äº†ä¸å¯å˜å¯¹è±¡å¼•ç”¨çš„åŸå­æ€§é—®é¢˜ã€‚ public class SafeWM &#123; class WMRange&#123; final int upper; final int lower; WMRange(int upper,int lower)&#123; // çœç•¥æ„é€ å‡½æ•°å®ç° &#125; &#125; final AtomicReference&lt;WMRange&gt; rf = new AtomicReference&lt;&gt;( new WMRange(0,0) ); // è®¾ç½®åº“å­˜ä¸Šé™ void setUpper(int v)&#123; while(true)&#123; WMRange or = rf.get(); // æ£€æŸ¥å‚æ•°åˆæ³•æ€§ if(v &lt; or.lower)&#123; throw new IllegalArgumentException(); &#125; WMRange nr = new WMRange(v, or.lower); if(rf.compareAndSet(or, nr))&#123; return; &#125; &#125; &#125; &#125; æ€»ç»“å…·å¤‡ä¸å˜æ€§çš„å¯¹è±¡ï¼Œåªæœ‰ä¸€ç§çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ç”±å¯¹è±¡å†…éƒ¨æ‰€æœ‰çš„ä¸å˜å±æ€§å…±åŒå†³å®šã€‚å…¶å®è¿˜æœ‰ä¸€ç§æ›´ç®€å•çš„ä¸å˜æ€§å¯¹è±¡ï¼Œé‚£å°±æ˜¯æ— çŠ¶æ€ã€‚æ— çŠ¶æ€å¯¹è±¡å†…éƒ¨æ²¡æœ‰å±æ€§ï¼Œåªæœ‰æ–¹æ³•ã€‚é™¤äº†æ— çŠ¶æ€çš„å¯¹è±¡ï¼Œä½ å¯èƒ½è¿˜å¬è¯´è¿‡æ— çŠ¶æ€çš„æœåŠ¡ã€æ— çŠ¶æ€çš„åè®®ç­‰ç­‰ã€‚æ— çŠ¶æ€æœ‰å¾ˆå¤šå¥½å¤„ï¼Œæœ€æ ¸å¿ƒçš„ä¸€ç‚¹å°±æ˜¯æ€§èƒ½ã€‚åœ¨å¤šçº¿ç¨‹é¢†åŸŸï¼Œæ— çŠ¶æ€å¯¹è±¡æ²¡æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œæ— éœ€åŒæ­¥å¤„ç†ï¼Œè‡ªç„¶æ€§èƒ½å¾ˆå¥½ï¼›åœ¨åˆ†å¸ƒå¼é¢†åŸŸï¼Œæ— çŠ¶æ€æ„å‘³ç€å¯ä»¥æ— é™åœ°æ°´å¹³æ‰©å±•ï¼Œæ‰€ä»¥åˆ†å¸ƒå¼é¢†åŸŸé‡Œé¢æ€§èƒ½çš„ç“¶é¢ˆä¸€å®šä¸æ˜¯å‡ºåœ¨æ— çŠ¶æ€çš„æœåŠ¡èŠ‚ç‚¹ä¸Šã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gyl-coder.top/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://gyl-coder.top/tags/%E5%B9%B6%E5%8F%91/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gyl-coder.top/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"Immutabilityæ¨¡å¼","slug":"Immutabilityæ¨¡å¼","permalink":"https://gyl-coder.top/tags/Immutability%E6%A8%A1%E5%BC%8F/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"å•ä¾‹æ¨¡å¼","slug":"design-pattern/single-pattern","date":"2019-10-24T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"design-pattern/single-pattern/","link":"","permalink":"https://gyl-coder.top/design-pattern/single-pattern/","excerpt":"åœ¨ä»‹ç»å•ä¾‹æ¨¡å¼ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿè®¾è®¡æ¨¡å¼ï¼ˆDesign Patternï¼‰ï¼šæ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨ï¼Œå¤šæ•°äººçŸ¥æ™“çš„ï¼Œç»è¿‡åˆ†ç±»ç¼–ç›®çš„ï¼Œä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ã€‚ç›®çš„ï¼šä½¿ç”¨è®¾è®¡æ¨¡å¼æ˜¯ä¸ºäº†å¯é‡ç”¨æ€§ä»£ç ï¼Œè®©ä»£ç æ›´å®¹æ˜“è¢«ä»–äººç†è§£ï¼Œä¿è¯ä»£ç å¯é æ€§ã€‚ æœ¬æ–‡å°†ä¼šç”¨åˆ°çš„å…³é”®è¯ï¼š å•ä¾‹ï¼šSingleton å®ä¾‹ï¼šinstance åŒæ­¥ï¼šsynchronized ç±»è£…è½½å™¨ï¼šClassLoader å•ä¾‹æ¨¡å¼ï¼šå•ä¾‹ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯åªèƒ½æœ‰ä¸€ä¸ªã€ä¸èƒ½å†å‡ºç°ç¬¬äºŒä¸ªã€‚å°±å¦‚åŒåœ°çƒä¸Šæ²¡æœ‰ä¸¤ç‰‡ä¸€æ¨¡ä¸€æ ·çš„æ ‘å¶ä¸€æ ·ã€‚ åœ¨è¿™é‡Œå°±æ˜¯è¯´ï¼šä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”æ•´ä¸ªé¡¹ç›®ç³»ç»Ÿéƒ½èƒ½è®¿é—®è¯¥å®ä¾‹ã€‚ å•ä¾‹æ¨¡å¼å…±åˆ†ä¸ºä¸¤å¤§ç±»ï¼š æ‡’æ±‰æ¨¡å¼ï¼šå®ä¾‹åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶åˆ›å»º é¥¿æ±‰æ¨¡å¼ï¼šå®ä¾‹åœ¨ç±»è£…è½½æ—¶åˆ›å»º","text":"åœ¨ä»‹ç»å•ä¾‹æ¨¡å¼ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿè®¾è®¡æ¨¡å¼ï¼ˆDesign Patternï¼‰ï¼šæ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨ï¼Œå¤šæ•°äººçŸ¥æ™“çš„ï¼Œç»è¿‡åˆ†ç±»ç¼–ç›®çš„ï¼Œä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ã€‚ç›®çš„ï¼šä½¿ç”¨è®¾è®¡æ¨¡å¼æ˜¯ä¸ºäº†å¯é‡ç”¨æ€§ä»£ç ï¼Œè®©ä»£ç æ›´å®¹æ˜“è¢«ä»–äººç†è§£ï¼Œä¿è¯ä»£ç å¯é æ€§ã€‚ æœ¬æ–‡å°†ä¼šç”¨åˆ°çš„å…³é”®è¯ï¼š å•ä¾‹ï¼šSingleton å®ä¾‹ï¼šinstance åŒæ­¥ï¼šsynchronized ç±»è£…è½½å™¨ï¼šClassLoader å•ä¾‹æ¨¡å¼ï¼šå•ä¾‹ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯åªèƒ½æœ‰ä¸€ä¸ªã€ä¸èƒ½å†å‡ºç°ç¬¬äºŒä¸ªã€‚å°±å¦‚åŒåœ°çƒä¸Šæ²¡æœ‰ä¸¤ç‰‡ä¸€æ¨¡ä¸€æ ·çš„æ ‘å¶ä¸€æ ·ã€‚ åœ¨è¿™é‡Œå°±æ˜¯è¯´ï¼šä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”æ•´ä¸ªé¡¹ç›®ç³»ç»Ÿéƒ½èƒ½è®¿é—®è¯¥å®ä¾‹ã€‚ å•ä¾‹æ¨¡å¼å…±åˆ†ä¸ºä¸¤å¤§ç±»ï¼š æ‡’æ±‰æ¨¡å¼ï¼šå®ä¾‹åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨æ—¶åˆ›å»º é¥¿æ±‰æ¨¡å¼ï¼šå®ä¾‹åœ¨ç±»è£…è½½æ—¶åˆ›å»º å•ä¾‹æ¨¡å¼UMLå›¾ é¥¿æ±‰æ¨¡å¼æŒ‰ç…§å®šä¹‰æˆ‘ä»¬å¯ä»¥å†™å‡ºä¸€ä¸ªåŸºæœ¬ä»£ç ï¼š public class Singleton &#123; // ä½¿ç”¨privateå°†æ„é€ æ–¹æ³•ç§æœ‰åŒ–ï¼Œä»¥é˜²å¤–ç•Œé€šè¿‡è¯¥æ„é€ æ–¹æ³•åˆ›å»ºå¤šä¸ªå®ä¾‹ private Singleton() &#123; &#125; // ç”±äºä¸èƒ½ä½¿ç”¨æ„é€ æ–¹æ³•åˆ›å»ºå®ä¾‹ï¼Œæ‰€ä»¥éœ€è¦åœ¨ç±»çš„å†…éƒ¨åˆ›å»ºè¯¥ç±»çš„å”¯ä¸€å®ä¾‹ // ä½¿ç”¨staticä¿®é¥°singleton åœ¨å¤–ç•Œå¯ä»¥é€šè¿‡ç±»åè°ƒç”¨è¯¥å®ä¾‹ ç±»å.æˆå‘˜å static Singleton singleton = new Singleton(); // 1 // å¦‚æœä½¿ç”¨privateå°è£…è¯¥å®ä¾‹ï¼Œåˆ™éœ€è¦æ·»åŠ getæ–¹æ³•å®ç°å¯¹å¤–ç•Œçš„å¼€æ”¾ private static Singleton instance = new Singleton(); // 2 // æ·»åŠ staticï¼Œå°†è¯¥æ–¹æ³•å˜æˆç±»æ‰€æœ‰ é€šè¿‡ç±»åè®¿é—® public static Singleton getInstance()&#123; return instance; &#125; //1å’Œ2é€‰ä¸€ç§å³å¯ï¼Œæ¨è2 &#125; å¯¹äºé¥¿æ±‰æ¨¡å¼æ¥è¯´ï¼Œè¿™ç§å†™æ³•å·²ç»å¾ˆâ€˜perfectâ€™äº†ï¼Œå”¯ä¸€çš„ç¼ºç‚¹å°±æ˜¯ï¼Œç”±äºinstanceçš„åˆå§‹åŒ–æ˜¯åœ¨ç±»åŠ è½½æ—¶è¿›è¡Œçš„ï¼Œç±»åŠ è½½æ˜¯ç”±ClassLoaderæ¥å®ç°çš„ï¼Œå¦‚æœåˆå§‹åŒ–å¤ªæ—©ï¼Œå°±ä¼šé€ æˆèµ„æºæµªè´¹ã€‚å½“ç„¶ï¼Œå¦‚æœæ‰€éœ€çš„å•ä¾‹å ç”¨çš„èµ„æºå¾ˆå°‘ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¾èµ–äºå…¶ä»–æ•°æ®ï¼Œé‚£ä¹ˆè¿™ç§å®ç°æ–¹å¼ä¹Ÿæ˜¯å¾ˆå¥½çš„ã€‚ ç±»è£…è½½çš„æ—¶æœºï¼š newä¸€ä¸ªå¯¹è±¡æ—¶ ä½¿ç”¨åå°„åˆ›å»ºå®ƒçš„å®ä¾‹æ—¶ å­ç±»è¢«åŠ è½½æ—¶ï¼Œå¦‚æœçˆ¶ç±»è¿˜æ²¡æœ‰åŠ è½½ï¼Œå°±å…ˆåŠ è½½çˆ¶ç±» JVMå¯åŠ¨æ—¶æ‰§è¡Œä¸»ç±» ä¼šå…ˆè¢«åŠ è½½ æ‡’æ±‰æ¨¡å¼æ‡’æ±‰æ¨¡å¼çš„ä»£ç å¦‚ä¸‹ // ä»£ç ä¸€ public class Singleton &#123; private static Singleton instance = null; private Singleton()&#123; &#125; public static Singleton getInstance() &#123; if (instance == null) &#123; instance = new Singleton(); &#125; return instance; &#125; &#125; æ¯æ¬¡è·å–instanceä¹‹å‰å…ˆè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœinstanceä¸ºç©ºå°±newä¸€ä¸ªå‡ºæ¥ï¼Œå¦åˆ™å°±ç›´æ¥è¿”å›å·²å­˜åœ¨çš„instanceã€‚ è¿™ç§å†™æ³•åœ¨å•çº¿ç¨‹çš„æ—¶å€™æ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†æ˜¯ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹ä¸€èµ·å·¥ä½œçš„æ—¶å€™ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œåˆ° if (instance == null)ï¼Œéƒ½åˆ¤æ–­ä¸ºnullï¼ˆç¬¬ä¸€ä¸ªçº¿ç¨‹åˆ¤æ–­ä¸ºç©ºä¹‹åï¼Œå¹¶æ²¡æœ‰ç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œå½“ç¬¬äºŒä¸ªçº¿ç¨‹åˆ¤æ–­çš„æ—¶å€™instanceä¾ç„¶ä¸ºç©ºï¼‰ï¼Œæœ€ç»ˆä¸¤ä¸ªçº¿ç¨‹å°±å„è‡ªä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹å‡ºæ¥ã€‚è¿™æ ·å°±ç ´ç¯äº†å•ä¾‹æ¨¡å¼ å®ä¾‹çš„å”¯ä¸€æ€§ è¦æƒ³ä¿è¯å®ä¾‹çš„å”¯ä¸€æ€§å°±éœ€è¦ä½¿ç”¨synchronizedï¼ŒåŠ ä¸Šä¸€ä¸ªåŒæ­¥é” // ä»£ç äºŒ public class Singleton &#123; private static Singleton instance = null; private Singleton() &#123;&#125; public static Singleton getInstance() &#123; synchronized(Singleton.class)&#123; if (instance == null) instance = new Singleton(); &#125; return instance; &#125; &#125; åŠ ä¸Šsynchronizedå…³é”®å­—ä¹‹åï¼ŒgetInstanceæ–¹æ³•å°±ä¼šé”ä¸Šäº†ã€‚å¦‚æœæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼ˆT1ã€T2ï¼‰åŒæ—¶æ‰§è¡Œåˆ°è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œä¼šæœ‰å…¶ä¸­ä¸€ä¸ªçº¿ç¨‹T1è·å¾—åŒæ­¥é”ï¼Œå¾—ä»¥ç»§ç»­æ‰§è¡Œï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹T2åˆ™éœ€è¦ç­‰å¾…ï¼Œå½“ç¬¬T1æ‰§è¡Œå®Œæ¯•getInstanceä¹‹åï¼ˆå®Œæˆäº†nullåˆ¤æ–­ã€å¯¹è±¡åˆ›å»ºã€è·å¾—è¿”å›å€¼ä¹‹åï¼‰ï¼ŒT2çº¿ç¨‹æ‰ä¼šæ‰§è¡Œæ‰§è¡Œã€‚ æ‰€ä»¥è¿™æ®µä»£ç ä¹Ÿå°±é¿å…äº†ä»£ç ä¸€ä¸­ï¼Œå¯èƒ½å‡ºç°å› ä¸ºå¤šçº¿ç¨‹å¯¼è‡´å¤šä¸ªå®ä¾‹çš„æƒ…å†µã€‚ä½†æ˜¯ï¼Œè¿™ç§å†™æ³•ä¹Ÿæœ‰ä¸€ä¸ªé—®é¢˜ï¼šç»™getInstanceæ–¹æ³•åŠ é”ï¼Œè™½ç„¶é¿å…äº†å¯èƒ½ä¼šå‡ºç°çš„å¤šä¸ªå®ä¾‹é—®é¢˜ï¼Œä½†æ˜¯ä¼šå¼ºåˆ¶é™¤T1ä¹‹å¤–çš„æ‰€æœ‰çº¿ç¨‹ç­‰å¾…ï¼Œå®é™…ä¸Šä¼šå¯¹ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡é€ æˆè´Ÿé¢å½±å“ã€‚ åŒé‡æ£€æŸ¥ï¼ˆDouble-Checkï¼‰ä»£ç äºŒç›¸å¯¹äºä»£ç ä¸€çš„æ•ˆç‡é—®é¢˜ï¼Œå…¶å®æ˜¯ä¸ºäº†è§£å†³1%å‡ ç‡çš„é—®é¢˜ï¼Œè€Œä½¿ç”¨äº†ä¸€ä¸ª100%å‡ºç°çš„é˜²æŠ¤ç›¾ã€‚é‚£æœ‰ä¸€ä¸ªä¼˜åŒ–çš„æ€è·¯ï¼Œå°±æ˜¯æŠŠ100%å‡ºç°çš„é˜²æŠ¤ç›¾ï¼Œä¹Ÿæ”¹ä¸º1%çš„å‡ ç‡å‡ºç°ï¼Œä½¿ä¹‹åªå‡ºç°åœ¨å¯èƒ½ä¼šå¯¼è‡´å¤šä¸ªå®ä¾‹å‡ºç°çš„åœ°æ–¹ã€‚ä»£ç å¦‚ä¸‹ï¼š // ä»£ç ä¸‰ public class Singleton &#123; private static Singleton instance = null; private Singleton() &#123;&#125; public static Singleton getInstance() &#123; if (instance == null)&#123; synchronized(Singleton.class)&#123; if (instance == null) instance = new Singleton(); &#125; &#125; return instance; &#125; &#125; è¿™æ®µä»£ç çœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œæ³¨æ„å…¶ä¸­æœ‰ä¸¤æ¬¡if(instance==null)çš„åˆ¤æ–­ï¼Œè¿™ä¸ªå«åšã€åŒé‡æ£€æŸ¥ Double-Checkã€ã€‚ ç¬¬ä¸€ä¸ª if(instance==null)ï¼Œå…¶å®æ˜¯ä¸ºäº†è§£å†³ä»£ç äºŒä¸­çš„æ•ˆç‡é—®é¢˜ï¼Œåªæœ‰instanceä¸ºnullçš„æ—¶å€™ï¼Œæ‰è¿›å…¥synchronizedçš„ä»£ç æ®µå¤§å¤§å‡å°‘äº†å‡ ç‡ã€‚ ç¬¬äºŒä¸ªif(instance==null)ï¼Œåˆ™æ˜¯è·Ÿä»£ç äºŒä¸€æ ·ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢å¯èƒ½å‡ºç°å¤šä¸ªå®ä¾‹çš„æƒ…å†µã€‚ è¿™æ®µä»£ç çœ‹èµ·æ¥å·²ç»å®Œç¾æ— ç‘•äº†ã€‚å½“ç„¶ï¼Œåªæ˜¯ã€çœ‹èµ·æ¥ã€ï¼Œè¿˜æ˜¯æœ‰å°æ¦‚ç‡å‡ºç°é—®é¢˜çš„ã€‚æƒ³è¦å……åˆ†ç†è§£éœ€è¦å…ˆå¼„æ¸…æ¥šä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µï¼šåŸå­æ“ä½œã€æŒ‡ä»¤é‡æ’ã€‚ åŸå­æ“ä½œç®€å•æ¥è¯´ï¼ŒåŸå­æ“ä½œï¼ˆatomicï¼‰å°±æ˜¯ä¸å¯åˆ†å‰²çš„æ“ä½œï¼Œåœ¨è®¡ç®—æœºä¸­ï¼Œå°±æ˜¯æŒ‡ä¸ä¼šå› ä¸ºçº¿ç¨‹è°ƒåº¦è¢«æ‰“æ–­çš„æ“ä½œã€‚æ¯”å¦‚ï¼Œç®€å•çš„èµ‹å€¼æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼š m = 6; // è¿™æ˜¯ä¸ªåŸå­æ“ä½œ å‡å¦‚måŸå…ˆçš„å€¼ä¸º0ï¼Œé‚£ä¹ˆå¯¹äºè¿™ä¸ªæ“ä½œï¼Œè¦ä¹ˆæ‰§è¡ŒæˆåŠŸmå˜æˆäº†6ï¼Œè¦ä¹ˆæ˜¯æ²¡æ‰§è¡Œ mè¿˜æ˜¯0ï¼Œè€Œä¸ä¼šå‡ºç°è¯¸å¦‚m=3è¿™ç§ä¸­é—´æ€â€”â€”å³ä½¿æ˜¯åœ¨å¹¶å‘çš„çº¿ç¨‹ä¸­ã€‚ ä½†æ˜¯ï¼Œå£°æ˜å¹¶èµ‹å€¼å°±ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼š int n=6;//è¿™ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œ å¯¹äºè¿™ä¸ªè¯­å¥ï¼Œè‡³å°‘æœ‰ä¸¤ä¸ªæ“ä½œï¼šâ‘ å£°æ˜ä¸€ä¸ªå˜é‡n â‘¡ç»™nèµ‹å€¼ä¸º6â€”â€”è¿™æ ·å°±ä¼šæœ‰ä¸€ä¸ªä¸­é—´çŠ¶æ€ï¼šå˜é‡nå·²ç»è¢«å£°æ˜äº†ä½†æ˜¯è¿˜æ²¡æœ‰è¢«èµ‹å€¼çš„çŠ¶æ€ã€‚è¿™æ ·ï¼Œåœ¨å¤šçº¿ç¨‹ä¸­ï¼Œç”±äºçº¿ç¨‹æ‰§è¡Œé¡ºåºçš„ä¸ç¡®å®šæ€§ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹éƒ½ä½¿ç”¨mï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´ä¸ç¨³å®šçš„ç»“æœå‡ºç°ã€‚ æŒ‡ä»¤é‡æ’ç®€å•æ¥è¯´ï¼Œå°±æ˜¯è®¡ç®—æœºä¸ºäº†æé«˜æ‰§è¡Œæ•ˆç‡ï¼Œä¼šåšçš„ä¸€äº›ä¼˜åŒ–ï¼Œåœ¨ä¸å½±å“æœ€ç»ˆç»“æœçš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå¯¹ä¸€äº›è¯­å¥çš„æ‰§è¡Œé¡ºåºè¿›è¡Œè°ƒæ•´ã€‚æ¯”å¦‚ï¼Œè¿™ä¸€æ®µä»£ç ï¼š int a ; // è¯­å¥1 a = 8 ; // è¯­å¥2 int b = 9 ; // è¯­å¥3 int c = a + b ; // è¯­å¥4 æ­£å¸¸æ¥è¯´ï¼Œå¯¹äºé¡ºåºç»“æ„ï¼Œæ‰§è¡Œçš„é¡ºåºæ˜¯è‡ªä¸Šåˆ°ä¸‹ï¼Œä¹Ÿå³1234ã€‚ä½†æ˜¯ï¼Œç”±äºæŒ‡ä»¤é‡æ’çš„åŸå› ï¼Œå› ä¸ºä¸å½±å“æœ€ç»ˆçš„ç»“æœï¼Œæ‰€ä»¥ï¼Œå®é™…æ‰§è¡Œçš„é¡ºåºå¯èƒ½ä¼šå˜æˆ3124æˆ–è€…1324ã€‚ ç”±äºè¯­å¥3å’Œ4æ²¡æœ‰åŸå­æ€§çš„é—®é¢˜ï¼Œè¯­å¥3å’Œè¯­å¥4ä¹Ÿå¯èƒ½ä¼šæ‹†åˆ†æˆåŸå­æ“ä½œï¼Œå†é‡æ’ã€‚â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºéåŸå­æ€§çš„æ“ä½œï¼Œåœ¨ä¸å½±å“æœ€ç»ˆç»“æœçš„æƒ…å†µä¸‹ï¼Œå…¶æ‹†åˆ†æˆçš„åŸå­æ“ä½œå¯èƒ½ä¼šè¢«é‡æ–°æ’åˆ—æ‰§è¡Œé¡ºåºã€‚ OKï¼Œäº†è§£äº†åŸå­æ“ä½œå’ŒæŒ‡ä»¤é‡æ’çš„æ¦‚å¿µä¹‹åï¼Œæˆ‘ä»¬å†ç»§ç»­çœ‹ä»£ç ä¸‰çš„é—®é¢˜ã€‚ ä¸»è¦åœ¨äºsingleton = new Singleton()è¿™å¥ï¼Œè¿™å¹¶éæ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œäº‹å®ä¸Šåœ¨ JVM ä¸­è¿™å¥è¯å¤§æ¦‚åšäº†ä¸‹é¢ 3 ä»¶äº‹æƒ…ã€‚ 1. ç»™ singleton åˆ†é…å†…å­˜ 2. è°ƒç”¨ Singleton çš„æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–æˆå‘˜å˜é‡ï¼Œå½¢æˆå®ä¾‹ 3. å°†singletonå¯¹è±¡æŒ‡å‘åˆ†é…çš„å†…å­˜ç©ºé—´ï¼ˆæ‰§è¡Œå®Œè¿™æ­¥ singletonæ‰æ˜¯é nulläº†ï¼‰ åœ¨JVMçš„å³æ—¶ç¼–è¯‘å™¨ä¸­å­˜åœ¨æŒ‡ä»¤é‡æ’åºçš„ä¼˜åŒ–ã€‚ ä¹Ÿå°±æ˜¯è¯´ä¸Šé¢çš„ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥çš„é¡ºåºæ˜¯ä¸èƒ½ä¿è¯çš„ï¼Œæœ€ç»ˆçš„æ‰§è¡Œé¡ºåºå¯èƒ½æ˜¯ 1-2-3 ä¹Ÿå¯èƒ½æ˜¯ 1-3-2ã€‚å¦‚æœæ˜¯åè€…ï¼Œåˆ™åœ¨ 3 æ‰§è¡Œå®Œæ¯•ã€2 æœªæ‰§è¡Œä¹‹å‰ï¼Œè¢«çº¿ç¨‹äºŒæŠ¢å äº†ï¼Œè¿™æ—¶ instance å·²ç»æ˜¯é null äº†ï¼ˆä½†å´æ²¡æœ‰åˆå§‹åŒ–ï¼‰ï¼Œæ‰€ä»¥çº¿ç¨‹äºŒä¼šç›´æ¥è¿”å› instanceï¼Œç„¶åä½¿ç”¨ï¼Œç„¶åé¡ºç†æˆç« åœ°æŠ¥é”™ã€‚ å†ç¨å¾®è§£é‡Šä¸€ä¸‹ï¼Œå°±æ˜¯è¯´ï¼Œç”±äºæœ‰ä¸€ä¸ªã€instanceå·²ç»ä¸ä¸ºnullä½†æ˜¯ä»æ²¡æœ‰å®Œæˆåˆå§‹åŒ–ã€çš„ä¸­é—´çŠ¶æ€ï¼Œè€Œè¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹åˆšå¥½è¿è¡Œåˆ°ç¬¬ä¸€å±‚if (instance ==null)è¿™é‡Œï¼Œè¿™é‡Œè¯»å–åˆ°çš„instanceå·²ç»ä¸ä¸ºnulläº†ï¼Œæ‰€ä»¥å°±ç›´æ¥æŠŠè¿™ä¸ªä¸­é—´çŠ¶æ€çš„instanceæ‹¿å»ç”¨äº†ï¼Œå°±ä¼šäº§ç”Ÿé—®é¢˜ã€‚è¿™é‡Œçš„å…³é”®åœ¨äºçº¿ç¨‹T1å¯¹instanceçš„å†™æ“ä½œæ²¡æœ‰å®Œæˆï¼Œçº¿ç¨‹T2å°±æ‰§è¡Œäº†è¯»æ“ä½œã€‚ å¯¹äºä»£ç ä¸‰å‡ºç°çš„é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆä¸ºï¼šç»™instanceçš„å£°æ˜åŠ ä¸Švolatileå…³é”®å­—ä»£ç å¦‚ä¸‹ï¼š public class Singleton &#123; private static volatile Singleton instance = null; private Singleton() &#123;&#125; public static Singleton getInstance() &#123; if (instance == null)&#123; synchronized(Singleton.class)&#123; if (instance == null) instance = new Singleton(); &#125; &#125; return instance; &#125; &#125; volatileå…³é”®å­—çš„ä¸€ä¸ªä½œç”¨æ˜¯ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼ŒæŠŠinstanceå£°æ˜ä¸ºvolatileä¹‹åï¼Œå¯¹å®ƒçš„å†™æ“ä½œå°±ä¼šæœ‰ä¸€ä¸ªå†…å­˜å±éšœï¼Œè¿™æ ·ï¼Œåœ¨å®ƒçš„èµ‹å€¼å®Œæˆä¹‹å‰ï¼Œå°±ä¸ç”¨ä¼šè°ƒç”¨è¯»æ“ä½œã€‚ æ³¨æ„ï¼švolatileé˜»æ­¢çš„ä¸æ˜¯singleton = new Singleton()è¿™å¥è¯å†…éƒ¨[1-2-3]çš„æŒ‡ä»¤é‡æ’ï¼Œè€Œæ˜¯ä¿è¯äº†åœ¨ä¸€ä¸ªå†™æ“ä½œï¼ˆ[1-2-3]ï¼‰å®Œæˆä¹‹å‰ï¼Œä¸ä¼šè°ƒç”¨è¯»æ“ä½œï¼ˆif (instance == null)ï¼‰ã€‚ å…¶å®ƒæ–¹æ³•é™æ€å†…éƒ¨ç±»public class Singleton &#123; private static class SingletonHolder &#123; private static final Singleton INSTANCE = new Singleton(); &#125; private Singleton ()&#123;&#125; public static final Singleton getInstance() &#123; return SingletonHolder.INSTANCE; &#125; &#125; è¿™ç§å†™æ³•çš„å·§å¦™ä¹‹å¤„åœ¨äºï¼šå¯¹äºå†…éƒ¨ç±»SingletonHolderï¼Œå®ƒæ˜¯ä¸€ä¸ªé¥¿æ±‰å¼çš„å•ä¾‹å®ç°ï¼Œåœ¨SingletonHolderåˆå§‹åŒ–çš„æ—¶å€™ä¼šç”±ClassLoaderæ¥ä¿è¯åŒæ­¥ï¼Œä½¿INSTANCEæ˜¯ä¸€ä¸ªçœŸå•ä¾‹ã€‚ åŒæ—¶ï¼Œç”±äºSingletonHolderæ˜¯ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œåªåœ¨å¤–éƒ¨ç±»çš„Singletonçš„getInstance()ä¸­è¢«ä½¿ç”¨ï¼Œæ‰€ä»¥å®ƒè¢«åŠ è½½çš„æ—¶æœºä¹Ÿå°±æ˜¯åœ¨getInstance()æ–¹æ³•ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨çš„æ—¶å€™ã€‚ å®ƒåˆ©ç”¨äº†ClassLoaderæ¥ä¿è¯äº†åŒæ­¥ï¼ŒåŒæ—¶åˆèƒ½è®©å¼€å‘è€…æ§åˆ¶ç±»åŠ è½½çš„æ—¶æœºã€‚ä»å†…éƒ¨çœ‹æ˜¯ä¸€ä¸ªé¥¿æ±‰å¼çš„å•ä¾‹ï¼Œä½†æ˜¯ä»å¤–éƒ¨çœ‹æ¥ï¼Œåˆçš„ç¡®æ˜¯æ‡’æ±‰å¼çš„å®ç° æšä¸¾public enum SingleInstance &#123; INSTANCE; public void fun1() &#123; // do something &#125; &#125;// ä½¿ç”¨SingleInstance.INSTANCE.fun1(); æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿè€Œä¸”å› ä¸ºè‡ªåŠ¨åºåˆ—åŒ–æœºåˆ¶ï¼Œä¿è¯äº†çº¿ç¨‹çš„ç»å¯¹å®‰å…¨ã€‚ä¸‰ä¸ªè¯æ¦‚æ‹¬è¯¥æ–¹å¼ï¼šç®€å•ã€é«˜æ•ˆã€å®‰å…¨ è¿™ç§å†™æ³•åœ¨åŠŸèƒ½ä¸Šä¸å…±æœ‰åŸŸæ–¹æ³•ç›¸è¿‘ï¼Œä½†æ˜¯å®ƒæ›´ç®€æ´ï¼Œæ— å¿åœ°æä¾›äº†åºåˆ—åŒ–æœºåˆ¶ï¼Œç»å¯¹é˜²æ­¢å¯¹æ­¤å®ä¾‹åŒ–ï¼Œå³ä½¿æ˜¯åœ¨é¢å¯¹å¤æ‚çš„åºåˆ—åŒ–æˆ–è€…åå°„æ”»å‡»çš„æ—¶å€™ã€‚è™½ç„¶è¿™ä¸­æ–¹æ³•è¿˜æ²¡æœ‰å¹¿æ³›é‡‡ç”¨ï¼Œä½†æ˜¯å•å…ƒç´ çš„æšä¸¾ç±»å‹å·²ç»æˆä¸ºå®ç°Singletonçš„æœ€ä½³æ–¹æ³•ã€‚ è§†é¢‘è®²è§£https://pan.baidu.com/s/1pWotEu9Z883hqWUM_Xu7vQ å¯†ç ï¼š lt0t","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gyl-coder.top/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gyl-coder.top/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"å•ä¾‹æ¨¡å¼","slug":"å•ä¾‹æ¨¡å¼","permalink":"https://gyl-coder.top/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.top"}},{"title":"æ’¸ä¸€ä¸ªJSONè§£æå™¨","slug":"JSONParser","date":"2019-10-24T00:00:00.000Z","updated":"2020-12-27T04:47:15.974Z","comments":true,"path":"JSONParser/","link":"","permalink":"https://gyl-coder.top/JSONParser/","excerpt":"JSON(JavaScript Object Notation, JS å¯¹è±¡ç®€è°±) æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚æ˜“äºäººé˜…è¯»å’Œç¼–å†™ã€‚åŒæ—¶ä¹Ÿæ˜“äºæœºå™¨è§£æå’Œç”Ÿæˆã€‚é‡‡ç”¨å®Œå…¨ç‹¬ç«‹äºè¯­è¨€çš„æ–‡æœ¬æ ¼å¼ï¼Œä½†æ˜¯ä¹Ÿä½¿ç”¨äº†ç±»ä¼¼äº C è¯­è¨€å®¶æ—çš„ä¹ æƒ¯ï¼ˆåŒ…æ‹¬ C, C++, C#, Java, JavaScript, Perl, Python ç­‰ï¼‰ã€‚è¿™äº›ç‰¹æ€§ä½¿ JSON æˆä¸ºç†æƒ³çš„æ•°æ®äº¤æ¢è¯­è¨€ã€‚ JSON ä¸ JS çš„åŒºåˆ«ä»¥åŠå’Œ XML çš„åŒºåˆ«å…·ä½“è¯·å‚è€ƒç™¾åº¦ç™¾ç§‘","text":"JSON(JavaScript Object Notation, JS å¯¹è±¡ç®€è°±) æ˜¯ä¸€ç§è½»é‡çº§çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚æ˜“äºäººé˜…è¯»å’Œç¼–å†™ã€‚åŒæ—¶ä¹Ÿæ˜“äºæœºå™¨è§£æå’Œç”Ÿæˆã€‚é‡‡ç”¨å®Œå…¨ç‹¬ç«‹äºè¯­è¨€çš„æ–‡æœ¬æ ¼å¼ï¼Œä½†æ˜¯ä¹Ÿä½¿ç”¨äº†ç±»ä¼¼äº C è¯­è¨€å®¶æ—çš„ä¹ æƒ¯ï¼ˆåŒ…æ‹¬ C, C++, C#, Java, JavaScript, Perl, Python ç­‰ï¼‰ã€‚è¿™äº›ç‰¹æ€§ä½¿ JSON æˆä¸ºç†æƒ³çš„æ•°æ®äº¤æ¢è¯­è¨€ã€‚ JSON ä¸ JS çš„åŒºåˆ«ä»¥åŠå’Œ XML çš„åŒºåˆ«å…·ä½“è¯·å‚è€ƒç™¾åº¦ç™¾ç§‘ JSON æœ‰ä¸¤ç§ç»“æ„ï¼š ç¬¬ä¸€ç§ï¼šå¯¹è±¡ â€œåç§° / å€¼â€ å¯¹çš„é›†åˆä¸åŒçš„è¯­è¨€ä¸­ï¼Œå®ƒè¢«ç†è§£ä¸ºå¯¹è±¡ï¼ˆobjectï¼‰ï¼Œçºªå½•ï¼ˆrecordï¼‰ï¼Œç»“æ„ï¼ˆstructï¼‰ï¼Œå­—å…¸ï¼ˆdictionaryï¼‰ï¼Œå“ˆå¸Œè¡¨ï¼ˆhash tableï¼‰ï¼Œæœ‰é”®åˆ—è¡¨ï¼ˆkeyed listï¼‰ï¼Œæˆ–è€…å…³è”æ•°ç»„ ï¼ˆassociative arrayï¼‰ã€‚ å¯¹è±¡æ˜¯ä¸€ä¸ªæ— åºçš„ â€œâ€˜åç§° / å€¼â€™å¯¹â€ é›†åˆã€‚ä¸€ä¸ªå¯¹è±¡ä»¥ â€œ{â€ï¼ˆå·¦æ‹¬å·ï¼‰å¼€å§‹ï¼Œâ€œ}â€ï¼ˆå³æ‹¬å·ï¼‰ç»“æŸã€‚æ¯ä¸ªâ€œåç§°â€ åè·Ÿä¸€ä¸ª â€œ:â€ï¼ˆå†’å·ï¼‰ï¼›â€œâ€˜åç§° / å€¼â€™ å¯¹â€ ä¹‹é—´ä½¿ç”¨â€œ,â€ï¼ˆé€—å·ï¼‰åˆ†éš”ã€‚ &#123;&quot;å§“å&quot;: &quot;å¼ ä¸‰&quot;, &quot;å¹´é¾„&quot;: &quot;18&quot;&#125; ç¬¬äºŒç§ï¼šæ•°ç»„ å€¼çš„æœ‰åºåˆ—è¡¨ï¼ˆAn ordered list of valuesï¼‰ã€‚åœ¨å¤§éƒ¨åˆ†è¯­è¨€ä¸­ï¼Œå®ƒè¢«ç†è§£ä¸ºæ•°ç»„ï¼ˆarrayï¼‰ã€‚ æ•°ç»„æ˜¯å€¼ï¼ˆvalueï¼‰çš„æœ‰åºé›†åˆã€‚ä¸€ä¸ªæ•°ç»„ä»¥ â€œ[â€ï¼ˆå·¦ä¸­æ‹¬å·ï¼‰å¼€å§‹ï¼Œâ€œ]â€ï¼ˆå³ä¸­æ‹¬å·ï¼‰ç»“æŸã€‚å€¼ä¹‹é—´ä½¿ç”¨ â€œ,â€ï¼ˆé€—å·ï¼‰åˆ†éš”ã€‚ å€¼ï¼ˆvalueï¼‰å¯ä»¥æ˜¯åŒå¼•å·æ‹¬èµ·æ¥çš„å­—ç¬¦ä¸²ï¼ˆstringï¼‰ã€æ•°å€¼ (number)ã€trueã€falseã€ nullã€å¯¹è±¡ï¼ˆobjectï¼‰æˆ–è€…æ•°ç»„ï¼ˆarrayï¼‰ã€‚è¿™äº›ç»“æ„å¯ä»¥åµŒå¥—ã€‚ [ &#123; &quot;å§“å&quot;: &quot;å¼ ä¸‰&quot;, &quot;å¹´é¾„&quot;:&quot;18&quot; &#125;, &#123; &quot;å§“å&quot;: &quot;é‡Œæ–¯&quot;, &quot;å¹´é¾„&quot;:&quot;19&quot; &#125; ] é€šè¿‡ä¸Šé¢çš„äº†è§£å¯ä»¥çœ‹å‡ºï¼ŒJSON å­˜åœ¨ä»¥ä¸‹å‡ ç§æ•°æ®ç±»å‹ï¼ˆä»¥ Java åšç±»æ¯”ï¼‰ï¼š json java string Java ä¸­çš„ String number Java ä¸­çš„ Long æˆ– Double true/false Java ä¸­çš„ Boolean null Java ä¸­çš„ null [array] Java ä¸­çš„ List æˆ– Object[] {â€œkeyâ€:â€valueâ€} Java ä¸­çš„ Map&lt;String, Object&gt; è§£æ JSONJSON è§£æå™¨çš„åŸºæœ¬åŸç†è¾“å…¥ä¸€ä¸² JSON å­—ç¬¦ä¸²ï¼Œè¾“å‡ºä¸€ä¸ª JSON å¯¹è±¡ã€‚ æ­¥éª¤JSON è§£æçš„è¿‡ç¨‹ä¸»è¦åˆ†ä»¥ä¸‹ä¸¤æ­¥ï¼š ç¬¬ä¸€æ­¥ï¼šå¯¹äºè¾“å…¥çš„ä¸€ä¸² JSON å­—ç¬¦ä¸²æˆ‘ä»¬éœ€è¦å°†å…¶è§£ææˆä¸€ç»„ token æµã€‚ ä¾‹å¦‚ JSON å­—ç¬¦ä¸² {â€œå§“åâ€: â€œå¼ ä¸‰â€, â€œå¹´é¾„â€: â€œ18â€} æˆ‘ä»¬éœ€è¦å°†å®ƒè§£ææˆ &#123;ã€ å§“åã€ :ã€ å¼ ä¸‰ã€ ,ã€ å¹´é¾„ã€ :ã€ 18ã€ &#125; è¿™æ ·ä¸€ç»„ token æµ ç¬¬äºŒæ­¥ï¼šæ ¹æ®å¾—åˆ°çš„ token æµå°†å…¶è§£ææˆå¯¹åº”çš„ JSON å¯¹è±¡ï¼ˆJSONObjectï¼‰æˆ–è€… JSON æ•°ç»„ï¼ˆJSONArrayï¼‰ ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†åˆ†æä¸‹è¿™ä¸¤ä¸ªæ­¥éª¤ï¼š è·å– token æµæ ¹æ® JSON æ ¼å¼çš„å®šä¹‰ï¼Œtoken å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹ token å«ä¹‰ NULL null NUMBER æ•°å­— STRING å­—ç¬¦ä¸² BOOLEAN true/false SEP_COLON : SEP_COMMA , BEGIN_OBJECT { END_OBJECT } BEGIN_ARRAY [ END_ARRAY ] END_DOCUMENT è¡¨ç¤º JSON æ•°æ®ç»“æŸ æ ¹æ®ä»¥ä¸Šçš„ JSON ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶å°è£…æˆ enum ç±»å‹çš„ TokenType package com.json.demo.tokenizer; /** BEGIN_OBJECTï¼ˆ&#123;ï¼‰ END_OBJECTï¼ˆ&#125;ï¼‰ BEGIN_ARRAYï¼ˆ[ï¼‰ END_ARRAYï¼ˆ]ï¼‰ NULLï¼ˆnullï¼‰ NUMBERï¼ˆæ•°å­—ï¼‰ STRINGï¼ˆå­—ç¬¦ä¸²ï¼‰ BOOLEANï¼ˆtrue/falseï¼‰ SEP_COLONï¼ˆ:ï¼‰ SEP_COMMAï¼ˆ,ï¼‰ END_DOCUMENTï¼ˆè¡¨ç¤ºJSONæ–‡æ¡£ç»“æŸï¼‰ */ public enum TokenType &#123; BEGIN_OBJECT(1), END_OBJECT(2), BEGIN_ARRAY(4), END_ARRAY(8), NULL(16), NUMBER(32), STRING(64), BOOLEAN(128), SEP_COLON(256), SEP_COMMA(512), END_DOCUMENT(1024); private int code; // æ¯ä¸ªç±»å‹çš„ç¼–å· TokenType(int code) &#123; this.code = code; &#125; public int getTokenCode() &#123; return code; &#125; &#125; åœ¨ TokenType ä¸­æˆ‘ä»¬ä¸ºæ¯ä¸€ç§ç±»å‹éƒ½èµ‹ä¸€ä¸ªæ•°å­—ï¼Œç›®çš„æ˜¯åœ¨ Parser åšä¸€äº›ä¼˜åŒ–æ“ä½œï¼ˆé€šè¿‡ä½è¿ç®—æ¥åˆ¤æ–­æ˜¯å¦æ˜¯æœŸæœ›å‡ºç°çš„ç±»å‹ï¼‰ åœ¨è¿›è¡Œç¬¬ä¸€æ­¥ä¹‹å‰ JSON ä¸²å¯¹è®¡ç®—æœºæ¥è¯´åªæ˜¯ä¸€ä¸²æ²¡æœ‰æ„ä¹‰çš„å­—ç¬¦è€Œå·²ã€‚ç¬¬ä¸€æ­¥çš„ä½œç”¨å°±æ˜¯æŠŠè¿™äº›æ— æ„ä¹‰çš„å­—ç¬¦ä¸²å˜æˆä¸€ä¸ªä¸€ä¸ªçš„ tokenï¼Œä¸Šé¢æˆ‘ä»¬å·²ç»ä¸ºæ¯ä¸€ç§ token å®šä¹‰äº†ç›¸åº”çš„ç±»å‹å’Œå€¼ã€‚æ‰€ä»¥è®¡ç®—æœºèƒ½å¤ŸåŒºåˆ†ä¸åŒçš„ tokenï¼Œå¹¶èƒ½ä»¥ token ä¸ºå•ä½è§£è¯» JSON æ•°æ®ã€‚ ä¸‹é¢æˆ‘ä»¬å°è£…ä¸€ä¸ª token ç±»æ¥å­˜å‚¨æ¯ä¸€ä¸ª token å¯¹åº”çš„å€¼ package com.json.demo.tokenizer; /** * å­˜å‚¨å¯¹åº”ç±»å‹çš„å­—é¢é‡ */ public class Token &#123; private TokenType tokenType; private String value; public Token(TokenType tokenType, String value) &#123; this.tokenType = tokenType; this.value = value; &#125; public TokenType getTokenType() &#123; return tokenType; &#125; public void setTokenType(TokenType tokenType) &#123; this.tokenType = tokenType; &#125; public String getValue() &#123; return value; &#125; public void setValue(String value) &#123; this.value = value; &#125; @Override public String toString() &#123; return &quot;Token&#123;&quot; + &quot;tokenType=&quot; + tokenType + &quot;, value=&#39;&quot; + value + &#39;\\&#39;&#39; + &#39;&#125;&#39;; &#125; &#125; åœ¨è§£æçš„è¿‡ç¨‹ä¸­æˆ‘ä»¬é€šè¿‡å­—ç¬¦æµæ¥ä¸æ–­çš„è¯»å–å­—ç¬¦ï¼Œå¹¶ä¸”éœ€è¦ç»å¸¸æ ¹æ®ç›¸åº”çš„å­—ç¬¦æ¥åˆ¤æ–­çŠ¶æ€çš„è·³è½¬ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±å°è£…ä¸€ä¸ª ReaderChar ç±»ï¼Œä»¥ä¾¿æˆ‘ä»¬æ›´å¥½çš„æ“ä½œå­—ç¬¦æµã€‚ package com.json.demo.tokenizer; import java.io.IOException; import java.io.Reader; public class ReaderChar &#123; private static final int BUFFER_SIZE = 1024; private Reader reader; private char[] buffer; private int index; // ä¸‹æ ‡ private int size; public ReaderChar(Reader reader) &#123; this.reader = reader; buffer = new char[BUFFER_SIZE]; &#125; /** * è¿”å› pos ä¸‹æ ‡å¤„çš„å­—ç¬¦ï¼Œå¹¶è¿”å› * @return */ public char peek() &#123; if (index - 1 &gt;= size) &#123; return (char) -1; &#125; return buffer[Math.max(0, index - 1)]; &#125; /** * è¿”å› pos ä¸‹æ ‡å¤„çš„å­—ç¬¦ï¼Œå¹¶å°† pos + 1ï¼Œæœ€åè¿”å›å­—ç¬¦ * @return * @throws IOException */ public char next() throws IOException &#123; if (!hasMore()) &#123; return (char) -1; &#125; return buffer[index++]; &#125; /** * ä¸‹æ ‡å›é€€ */ public void back() &#123; index = Math.max(0, --index); &#125; /** * åˆ¤æ–­æµæ˜¯å¦ç»“æŸ */ public boolean hasMore() throws IOException &#123; if (index &lt; size) &#123; return true; &#125; fillBuffer(); return index &lt; size; &#125; /** * å¡«å……bufferæ•°ç»„ * @throws IOException */ void fillBuffer() throws IOException &#123; int n = reader.read(buffer); if (n == -1) &#123; return; &#125; index = 0; size = n; &#125; &#125; å¦å¤–æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ª TokenList æ¥å­˜å‚¨è§£æå‡ºæ¥çš„ token æµ package com.json.demo.tokenizer; import java.util.ArrayList; import java.util.List; /** * å­˜å‚¨è¯æ³•è§£ææ‰€å¾—çš„tokenæµ */ public class TokenList &#123; private List&lt;Token&gt; tokens = new ArrayList&lt;Token&gt;(); private int index = 0; public void add(Token token) &#123; tokens.add(token); &#125; public Token peek() &#123; return index &lt; tokens.size() ? tokens.get(index) : null; &#125; public Token peekPrevious() &#123; return index - 1 &lt; 0 ? null : tokens.get(index - 2); &#125; public Token next() &#123; return tokens.get(index++); &#125; public boolean hasMore() &#123; return index &lt; tokens.size(); &#125; @Override public String toString() &#123; return &quot;TokenList&#123;&quot; + &quot;tokens=&quot; + tokens + &#39;&#125;&#39;; &#125; &#125; JSON è§£ææ¯”å…¶ä»–æ–‡æœ¬è§£æè¦ç®€å•çš„åœ°æ–¹åœ¨äºï¼Œæˆ‘ä»¬åªéœ€è¦æ ¹æ®ä¸‹ä¸€ä¸ªå­—ç¬¦å°±å¯çŸ¥é“æ¥ä¸‹æ¥å®ƒæ‰€æœŸæœ›è¯»å–çš„åˆ°çš„å†…å®¹æ˜¯ä»€ä¹ˆæ ·çš„ã€‚å¦‚æœæ»¡è¶³æœŸæœ›äº†ï¼Œåˆ™è¿”å› Tokenï¼Œå¦åˆ™è¿”å›é”™è¯¯ã€‚ ä¸ºäº†æ–¹ä¾¿ç¨‹åºå‡ºé”™æ—¶æ›´å¥½çš„ debugï¼Œç¨‹åºä¸­è‡ªå®šä¹‰äº†ä¸¤ä¸ª exception ç±»æ¥å¤„ç†é”™è¯¯ä¿¡æ¯ã€‚ï¼ˆå…·ä½“å®ç°å‚è€ƒ exception åŒ…ï¼‰ ä¸‹é¢å°±æ˜¯ç¬¬ä¸€æ­¥ä¸­çš„é‡å¤´æˆï¼ˆæ ¸å¿ƒä»£ç ï¼‰ï¼š public TokenList getTokenStream(ReaderChar readerChar) throws IOException &#123; this.readerChar = readerChar; tokenList = new TokenList(); // è¯æ³•è§£æï¼Œè·å–tokenæµ tokenizer(); return tokenList; &#125; /** * å°†JSONæ–‡ä»¶è§£ææˆtokenæµ * @throws IOException */ private void tokenizer() throws IOException &#123; Token token; do &#123; token = start(); tokenList.add(token); &#125; while (token.getTokenType() != TokenType.END_DOCUMENT); &#125; /** * è§£æè¿‡ç¨‹çš„å…·ä½“å®ç°æ–¹æ³• * @return * @throws IOException * @throws JsonParseException */ private Token start() throws IOException, JsonParseException &#123; char ch; while (true)&#123; //å…ˆè¯»ä¸€ä¸ªå­—ç¬¦ï¼Œè‹¥ä¸ºç©ºç™½ç¬¦ï¼ˆASCIIç åœ¨[0, 20H]ä¸Šï¼‰åˆ™æ¥ç€è¯»ï¼Œç›´åˆ°åˆšè¯»çš„å­—ç¬¦éç©ºç™½ç¬¦ if (!readerChar.hasMore()) &#123; return new Token(TokenType.END_DOCUMENT, null); &#125; ch = readerChar.next(); if (!isWhiteSpace(ch)) &#123; break; &#125; &#125; switch (ch) &#123; case &#39;&#123;&#39;: return new Token(TokenType.BEGIN_OBJECT, String.valueOf(ch)); case &#39;&#125;&#39;: return new Token(TokenType.END_OBJECT, String.valueOf(ch)); case &#39;[&#39;: return new Token(TokenType.BEGIN_ARRAY, String.valueOf(ch)); case &#39;]&#39;: return new Token(TokenType.END_ARRAY, String.valueOf(ch)); case &#39;,&#39;: return new Token(TokenType.SEP_COMMA, String.valueOf(ch)); case &#39;:&#39;: return new Token(TokenType.SEP_COLON, String.valueOf(ch)); case &#39;n&#39;: return readNull(); case &#39;t&#39;: case &#39;f&#39;: return readBoolean(); case &#39;&quot;&#39;: return readString(); case &#39;-&#39;: return readNumber(); &#125; if (isDigit(ch)) &#123; return readNumber(); &#125; throw new JsonParseException(&quot;Illegal character&quot;); &#125; åœ¨ start æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªå¤„ç†æ–¹æ³•éƒ½å°è£…æˆäº†å•ç‹¬çš„å‡½æ•°ã€‚ä¸»è¦æ€æƒ³å°±æ˜¯é€šè¿‡ä¸€ä¸ªæ­»å¾ªç¯ä¸åœçš„è¯»å–å­—ç¬¦ï¼Œç„¶åå†æ ¹æ®å­—ç¬¦çš„æœŸå¾…å€¼ï¼Œæ‰§è¡Œä¸åŒçš„å¤„ç†å‡½æ•°ã€‚ ä¸‹é¢æˆ‘ä»¬è¯¦è§£åˆ†æå‡ ä¸ªå¤„ç†å‡½æ•°ï¼š private Token readString() throws IOException &#123; StringBuilder sb = new StringBuilder(); while(true) &#123; char ch = readerChar.next(); if (ch == &#39;\\\\&#39;) &#123; // å¤„ç†è½¬ä¹‰å­—ç¬¦ if (!isEscape()) &#123; throw new JsonParseException(&quot;Invalid escape character&quot;); &#125; sb.append(&#39;\\\\&#39;); ch = readerChar.peek(); sb.append(ch); if (ch == &#39;u&#39;) &#123; // å¤„ç† Unicode ç¼–ç ï¼Œå½¢å¦‚ \\u4e2dã€‚ä¸”åªæ”¯æŒ \\u0000 ~ \\uFFFF èŒƒå›´å†…çš„ç¼–ç  for (int i = 0; i &lt; 4; i++) &#123; ch = readerChar.next(); if (isHex(ch)) &#123; sb.append(ch); &#125; else &#123; throw new JsonParseException(&quot;Invalid character&quot;); &#125; &#125; &#125; &#125; else if (ch == &#39;&quot;&#39;) &#123; // ç¢°åˆ°å¦ä¸€ä¸ªåŒå¼•å·ï¼Œåˆ™è®¤ä¸ºå­—ç¬¦ä¸²è§£æç»“æŸï¼Œè¿”å› Token return new Token(TokenType.STRING, sb.toString()); &#125; else if (ch == &#39;\\r&#39; || ch == &#39;\\n&#39;) &#123; // ä¼ å…¥çš„ JSON å­—ç¬¦ä¸²ä¸å…è®¸æ¢è¡Œ throw new JsonParseException(&quot;Invalid character&quot;); &#125; else &#123; sb.append(ch); &#125; &#125; &#125; è¯¥æ–¹æ³•ä¹Ÿæ˜¯é€šè¿‡ä¸€ä¸ªæ­»å¾ªç¯æ¥è¯»å–å­—ç¬¦ï¼Œé¦–å…ˆåˆ¤æ–­çš„æ˜¯ JSON ä¸­çš„è½¬ä¹‰å­—ç¬¦ã€‚ JSON ä¸­å…è®¸å‡ºç°çš„æœ‰ä»¥ä¸‹å‡ ç§ \\&quot; \\\\ \\b \\f \\n \\r \\t \\u four-hex-digits \\/ å…·ä½“çš„å¤„ç†æ–¹æ³•å°è£…åœ¨äº† isEscape() æ–¹æ³•ä¸­ï¼Œå¤„ç† Unicode ç¼–ç æ—¶è¦ç‰¹åˆ«æ³¨æ„ä¸€ä¸‹ u çš„åé¢ä¼šå‡ºç°å››ä½åå…­è¿›åˆ¶æ•°ã€‚å½“è¯»å–åˆ°ä¸€ä¸ªåŒå¼•å·æˆ–è€…è¯»å–åˆ°äº†éæ³•å­—ç¬¦ï¼ˆâ€™râ€™æˆ–â€™ã€â€™nâ€™ï¼‰å¾ªç¯é€€å‡ºã€‚ åˆ¤æ–­æ•°å­—çš„æ—¶å€™ä¹Ÿè¦ç‰¹åˆ«å°å¿ƒï¼Œæ³¨æ„è´Ÿæ•°ï¼Œfracï¼Œexp ç­‰ç­‰æƒ…å†µã€‚ é€šè¿‡ä¸Šé¢çš„è§£æï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ç»„ tokenï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ä»¥è¿™ç»„ token ä½œä¸ºè¾“å…¥ï¼Œè§£æå‡ºç›¸åº”çš„ JSON å¯¹è±¡ è§£æå‡º JSON å¯¹è±¡è§£æä¹‹å‰æˆ‘ä»¬éœ€è¦å®šä¹‰å‡º JSON å¯¹è±¡ï¼ˆJSONObjectï¼‰å’Œ JSON æ•°ç»„ (JSONArray) çš„å®ä½“ç±»ã€‚ package com.json.demo.jsonstyle; import com.json.demo.exception.JsonTypeException; import com.json.demo.util.FormatUtil; import java.util.ArrayList; import java.util.HashMap; import java.util.List; import java.util.Map; /** * JSONçš„å¯¹è±¡å½¢å¼ * å¯¹è±¡æ˜¯ä¸€ä¸ªæ— åºçš„â€œâ€˜åç§°/å€¼â€™å¯¹â€é›†åˆã€‚ä¸€ä¸ªå¯¹è±¡ä»¥â€œ&#123;â€ï¼ˆå·¦æ‹¬å·ï¼‰å¼€å§‹ï¼Œâ€œ&#125;â€ï¼ˆå³æ‹¬å·ï¼‰ç»“æŸã€‚æ¯ä¸ªâ€œåç§°â€åè·Ÿä¸€ä¸ªâ€œ:â€ï¼ˆå†’å·ï¼‰ï¼›â€œâ€˜åç§°/å€¼â€™ å¯¹â€ä¹‹é—´ä½¿ç”¨â€œ,â€ï¼ˆé€—å·ï¼‰åˆ†éš”ã€‚ */ public class JsonObject &#123; private Map&lt;String, Object&gt; map = new HashMap&lt;String, Object&gt;(); public void put(String key, Object value) &#123; map.put(key, value); &#125; public Object get(String key) &#123; return map.get(key); &#125; ... &#125; package com.json.demo.jsonstyle; import com.json.demo.exception.JsonTypeException; import com.json.demo.util.FormatUtil; import java.util.ArrayList; import java.util.Iterator; import java.util.List; /** * JSONçš„æ•°ç»„å½¢å¼ * æ•°ç»„æ˜¯å€¼ï¼ˆvalueï¼‰çš„æœ‰åºé›†åˆã€‚ä¸€ä¸ªæ•°ç»„ä»¥â€œ[â€ï¼ˆå·¦ä¸­æ‹¬å·ï¼‰å¼€å§‹ï¼Œâ€œ]â€ï¼ˆå³ä¸­æ‹¬å·ï¼‰ç»“æŸã€‚å€¼ä¹‹é—´ä½¿ç”¨â€œ,â€ï¼ˆé€—å·ï¼‰åˆ†éš”ã€‚ */ public class JsonArray &#123; private List list = new ArrayList(); public void add(Object obj) &#123; list.add(obj); &#125; public Object get(int index) &#123; return list.get(index); &#125; public int size() &#123; return list.size(); &#125; ... &#125; ä¹‹åæˆ‘ä»¬å°±å¯ä»¥å†™è§£æç±»äº†ï¼Œç”±äºä»£ç è¾ƒé•¿ï¼Œè¿™é‡Œå°±ä¸å±•ç¤ºäº†ã€‚æœ‰å…´è¶£çš„å¯ä»¥å» GitHub ä¸Šä¸‹è½½ã€‚å®ç°é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œä¹Ÿæ˜“äºç†è§£ã€‚ è§£æç±»ä¸­çš„ parse æ–¹æ³•é¦–å…ˆæ ¹æ®ç¬¬ä¸€ä¸ª token çš„ç±»å‹é€‰æ‹©è°ƒç”¨ parseJsonObjectï¼ˆï¼‰æˆ–è€… parseJsonArrayï¼ˆï¼‰ï¼Œè¿›è€Œè¿”å› JSON å¯¹è±¡æˆ–è€… JSON æ•°ç»„ã€‚ä¸Šé¢çš„è§£ææ–¹æ³•ä¸­åˆ©ç”¨ä½è¿ç®—æ¥åˆ¤æ–­å­—ç¬¦çš„æœŸå¾…å€¼æ—¢æé«˜äº†ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ä¹Ÿæœ‰åŠ©äºæé«˜ä»£ç çš„ keâ€™duâ€™xi å®Œæˆä¹‹åæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªæµ‹è¯•ç±»æ¥éªŒè¯ä¸‹æˆ‘ä»¬çš„è§£æå™¨çš„è¿è¡Œæƒ…å†µã€‚æˆ‘ä»¬å¯ä»¥è‡ªå·±å®šä¹‰ä¸€ç»„ JSON ä¸²ä¹Ÿå¯ä»¥é€šè¿‡ HttpUtil å·¥å…·ç±»ä»ç½‘ä¸Šè·å–ã€‚æœ€åé€šè¿‡ FormatUtil ç±»æ¥è§„èŒƒæˆ‘ä»¬è¾“å‡ºã€‚ å…·ä½“æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å‚è€ƒæ–‡ç«  http://www.cnblogs.com/absfreâ€¦ https://www.liaoxuefeng.com/aâ€¦ https://segmentfault.com/a/11â€¦ http://json.org/json-zh.html","categories":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/categories/Java/"}],"tags":[{"name":"json","slug":"json","permalink":"https://gyl-coder.top/tags/json/"},{"name":"json è§£æå™¨","slug":"json-è§£æå™¨","permalink":"https://gyl-coder.top/tags/json-%E8%A7%A3%E6%9E%90%E5%99%A8/"}],"author":{"name":"yanliang","avatar":"https://cdn.jsdelivr.net/gh/gyl-coder/blogImgs/images/touxiang.webp","url":"https://gyl-coder.github.io"}}],"categories":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/categories/Java/"},{"name":"Spring","slug":"Spring","permalink":"https://gyl-coder.top/categories/Spring/"},{"name":"Mybatis","slug":"Mybatis","permalink":"https://gyl-coder.top/categories/Mybatis/"},{"name":"è®¾è®¡","slug":"è®¾è®¡","permalink":"https://gyl-coder.top/categories/%E8%AE%BE%E8%AE%A1/"},{"name":"kafka","slug":"kafka","permalink":"https://gyl-coder.top/categories/kafka/"},{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://gyl-coder.top/categories/%E5%B9%B6%E5%8F%91/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gyl-coder.top/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://gyl-coder.top/tags/Java/"},{"name":"æ¥å£","slug":"æ¥å£","permalink":"https://gyl-coder.top/tags/%E6%8E%A5%E5%8F%A3/"},{"name":"æŠ½è±¡","slug":"æŠ½è±¡","permalink":"https://gyl-coder.top/tags/%E6%8A%BD%E8%B1%A1/"},{"name":"é›†åˆ","slug":"é›†åˆ","permalink":"https://gyl-coder.top/tags/%E9%9B%86%E5%90%88/"},{"name":"LinkedHashMap","slug":"LinkedHashMap","permalink":"https://gyl-coder.top/tags/LinkedHashMap/"},{"name":"LinkedList","slug":"LinkedList","permalink":"https://gyl-coder.top/tags/LinkedList/"},{"name":"Vector","slug":"Vector","permalink":"https://gyl-coder.top/tags/Vector/"},{"name":"ArrayList","slug":"ArrayList","permalink":"https://gyl-coder.top/tags/ArrayList/"},{"name":"åŠ¨æ€ä»£ç†","slug":"åŠ¨æ€ä»£ç†","permalink":"https://gyl-coder.top/tags/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"},{"name":"Spring","slug":"Spring","permalink":"https://gyl-coder.top/tags/Spring/"},{"name":"IOC","slug":"IOC","permalink":"https://gyl-coder.top/tags/IOC/"},{"name":"AOP","slug":"AOP","permalink":"https://gyl-coder.top/tags/AOP/"},{"name":"try-catch","slug":"try-catch","permalink":"https://gyl-coder.top/tags/try-catch/"},{"name":"Settings","slug":"Settings","permalink":"https://gyl-coder.top/tags/Settings/"},{"name":"Mybatis","slug":"Mybatis","permalink":"https://gyl-coder.top/tags/Mybatis/"},{"name":"HashMap","slug":"HashMap","permalink":"https://gyl-coder.top/tags/HashMap/"},{"name":"Int","slug":"Int","permalink":"https://gyl-coder.top/tags/Int/"},{"name":"Integer","slug":"Integer","permalink":"https://gyl-coder.top/tags/Integer/"},{"name":"é™æµç®—æ³•","slug":"é™æµç®—æ³•","permalink":"https://gyl-coder.top/tags/%E9%99%90%E6%B5%81%E7%AE%97%E6%B3%95/"},{"name":"è®¾è®¡","slug":"è®¾è®¡","permalink":"https://gyl-coder.top/tags/%E8%AE%BE%E8%AE%A1/"},{"name":"kafka","slug":"kafka","permalink":"https://gyl-coder.top/tags/kafka/"},{"name":"topic","slug":"topic","permalink":"https://gyl-coder.top/tags/topic/"},{"name":"å¯é æ€§","slug":"å¯é æ€§","permalink":"https://gyl-coder.top/tags/%E5%8F%AF%E9%9D%A0%E6%80%A7/"},{"name":"ä¸€è‡´æ€§","slug":"ä¸€è‡´æ€§","permalink":"https://gyl-coder.top/tags/%E4%B8%80%E8%87%B4%E6%80%A7/"},{"name":"çº¿ç¨‹é˜»å¡","slug":"çº¿ç¨‹é˜»å¡","permalink":"https://gyl-coder.top/tags/%E7%BA%BF%E7%A8%8B%E9%98%BB%E5%A1%9E/"},{"name":"å¹¶å‘","slug":"å¹¶å‘","permalink":"https://gyl-coder.top/tags/%E5%B9%B6%E5%8F%91/"},{"name":"ç­‰å¾…é€šçŸ¥æœºåˆ¶","slug":"ç­‰å¾…é€šçŸ¥æœºåˆ¶","permalink":"https://gyl-coder.top/tags/%E7%AD%89%E5%BE%85%E9%80%9A%E7%9F%A5%E6%9C%BA%E5%88%B6/"},{"name":"Concurrency","slug":"Concurrency","permalink":"https://gyl-coder.top/tags/Concurrency/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gyl-coder.top/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"Immutabilityæ¨¡å¼","slug":"Immutabilityæ¨¡å¼","permalink":"https://gyl-coder.top/tags/Immutability%E6%A8%A1%E5%BC%8F/"},{"name":"å•ä¾‹æ¨¡å¼","slug":"å•ä¾‹æ¨¡å¼","permalink":"https://gyl-coder.top/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"},{"name":"json","slug":"json","permalink":"https://gyl-coder.top/tags/json/"},{"name":"json è§£æå™¨","slug":"json-è§£æå™¨","permalink":"https://gyl-coder.top/tags/json-%E8%A7%A3%E6%9E%90%E5%99%A8/"}]}